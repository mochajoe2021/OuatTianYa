<?xml version="1.0" encoding="utf-8"?>
<root>
  <!-- 
    Microsoft ResX Schema 
    
    Version 2.0
    
    The primary goals of this format is to allow a simple XML format 
    that is mostly human readable. The generation and parsing of the 
    various data types are done through the TypeConverter classes 
    associated with the data types.
    
    Example:
    
    ... ado.net/XML headers & schema ...
    <resheader name="resmimetype">text/microsoft-resx</resheader>
    <resheader name="version">2.0</resheader>
    <resheader name="reader">System.Resources.ResXResourceReader, System.Windows.Forms, ...</resheader>
    <resheader name="writer">System.Resources.ResXResourceWriter, System.Windows.Forms, ...</resheader>
    <data name="Name1"><value>this is my long string</value><comment>this is a comment</comment></data>
    <data name="Color1" type="System.Drawing.Color, System.Drawing">Blue</data>
    <data name="Bitmap1" mimetype="application/x-microsoft.net.object.binary.base64">
        <value>[base64 mime encoded serialized .NET Framework object]</value>
    </data>
    <data name="Icon1" type="System.Drawing.Icon, System.Drawing" mimetype="application/x-microsoft.net.object.bytearray.base64">
        <value>[base64 mime encoded string representing a byte array form of the .NET Framework object]</value>
        <comment>This is a comment</comment>
    </data>
                
    There are any number of "resheader" rows that contain simple 
    name/value pairs.
    
    Each data row contains a name, and value. The row also contains a 
    type or mimetype. Type corresponds to a .NET class that support 
    text/value conversion through the TypeConverter architecture. 
    Classes that don't support this are serialized and stored with the 
    mimetype set.
    
    The mimetype is used for serialized objects, and tells the 
    ResXResourceReader how to depersist the object. This is currently not 
    extensible. For a given mimetype the value must be set accordingly:
    
    Note - application/x-microsoft.net.object.binary.base64 is the format 
    that the ResXResourceWriter will generate, however the reader can 
    read any of the formats listed below.
    
    mimetype: application/x-microsoft.net.object.binary.base64
    value   : The object must be serialized with 
            : System.Runtime.Serialization.Formatters.Binary.BinaryFormatter
            : and then encoded with base64 encoding.
    
    mimetype: application/x-microsoft.net.object.soap.base64
    value   : The object must be serialized with 
            : System.Runtime.Serialization.Formatters.Soap.SoapFormatter
            : and then encoded with base64 encoding.

    mimetype: application/x-microsoft.net.object.bytearray.base64
    value   : The object must be serialized into a byte array 
            : using a System.ComponentModel.TypeConverter
            : and then encoded with base64 encoding.
    -->
  <xsd:schema id="root" xmlns="" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata">
    <xsd:import namespace="http://www.w3.org/XML/1998/namespace" />
    <xsd:element name="root" msdata:IsDataSet="true">
      <xsd:complexType>
        <xsd:choice maxOccurs="unbounded">
          <xsd:element name="metadata">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" />
              </xsd:sequence>
              <xsd:attribute name="name" use="required" type="xsd:string" />
              <xsd:attribute name="type" type="xsd:string" />
              <xsd:attribute name="mimetype" type="xsd:string" />
              <xsd:attribute ref="xml:space" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="assembly">
            <xsd:complexType>
              <xsd:attribute name="alias" type="xsd:string" />
              <xsd:attribute name="name" type="xsd:string" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="data">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
                <xsd:element name="comment" type="xsd:string" minOccurs="0" msdata:Ordinal="2" />
              </xsd:sequence>
              <xsd:attribute name="name" type="xsd:string" use="required" msdata:Ordinal="1" />
              <xsd:attribute name="type" type="xsd:string" msdata:Ordinal="3" />
              <xsd:attribute name="mimetype" type="xsd:string" msdata:Ordinal="4" />
              <xsd:attribute ref="xml:space" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="resheader">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
              </xsd:sequence>
              <xsd:attribute name="name" type="xsd:string" use="required" />
            </xsd:complexType>
          </xsd:element>
        </xsd:choice>
      </xsd:complexType>
    </xsd:element>
  </xsd:schema>
  <resheader name="resmimetype">
    <value>text/microsoft-resx</value>
  </resheader>
  <resheader name="version">
    <value>2.0</value>
  </resheader>
  <resheader name="reader">
    <value>System.Resources.ResXResourceReader, System.Windows.Forms, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
  </resheader>
  <resheader name="writer">
    <value>System.Resources.ResXResourceWriter, System.Windows.Forms, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
  </resheader>
  <data name="RsaPublisher" xml:space="preserve">
    <value>LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQ3l0OGV1QnhhZHpjckQKQXptWThlNS84MDlCZEdsZm5ZYmZ5SlR2YkQ3RnUva3dzQ0dDOUdRdDRQcU93VmtBRUxxMURoWWs1VThickFkdwo4YkFQZWxaL0g2d3VTTURFdmd4Wm52ZDFRZ3NvR0QwcjhndFcrOUozeENBUnUraG1aaHdBWWU2dWpnYnpHM1FWCm1aYndjdmMxQi9uU1ZSNDFCalVVaEQ3NnRTZDRjVnovUmttRjFYV3J6VGVGbFFOenVJRWFjc0ZucWVDWkE5cGEKV2t1dkJtd3pGTC83NThpRXl0SHJWL2V2RzVFMDFZV2k3dmJxRjFjRUVETnpnY0d4RXpxMS9seEV6azJqd21ReAplTCtrdHRXdUVYMXpPUTF2RnZSd0h4WE9QZkFOcmxUWkpKS3VCL0dsQS83ZitLN1Fza2cyb1JNaDI1M2pXWEVWCnRjZWJEdmNkQWdNQkFBRUNnZ0VBUzR4VTVNUXFVMXNETTV6UlpFNGhQQVZtbzR6S1hwa0F3dWpQek1ZOVl1a3IKVmVHZXlQVDJ4RTR1bk5vdS9WQVZIU1J2Ui9tSGozTVJValZZNzdJUGpuMmRFNU85cVcyTld2VlFOa2xNM2c0aApEY3FyOElGVFh6MlJNTzMyT0JOQ0V3ZFRGb2NEZVJGSjZUZWNEdGtLbDJoZnV3SXdXc25jOW1kUkdEb3NEVVZwCjJ6Wi9Ueko5MVM5OGtWaVBlVFpTT0FKNzUyb2N5encvQVoyQnpvNVA5eGNWOElUYnllQW5udHpoR0t3dStHUmsKTGZERUtUcklEZno4dWg4blRKQmF3dGIyYUNQUHhCV0Z1THVuOXY2SWRMQTlJT0lQQk1iRVdxUGZMRVJrL0ZleApOem5XWE1OclZONGE1Z0ExUXArakE1UHZvQXFCZ1RlcEg2V2lZRFR4SVFLQmdRRGJuMFVEQ2xzUVNqQVZVZy9ICkdIZlNSUDQ2MkR6bzUrdEUzSitLZW5ka2w4Kzh5Ymh1ZUdzdDZ2VUJ5eHc1c2YxbkFOZE1LK0dVL1YyMFdOSUcKYVdOak1mMnIxUkZhYjVQSWxIRlhJTk43aTU3OXM3U0pYajFkUm81RXh1cGExUnM4cXlIK3VOZko0S3ZxQk0rdgo3SHZKTk5LUE1sWmFTUmVDb1hxKzh3WmlRd0tCZ1FEUVVnZXU5Vy9IUXBjaEtKc3ZDS0FwVjRUQXVKNnVBNE1XCmxUSWNZL0Z2eWpobUhFY0txbEJBSTRod3hvYlpOTC9CbldPM044QmFyRDIrci9wTzMySUJlYU1wMUJ0YUxuRG0KdkpUM2lNZnVaYU5Zb2J2UDdFY2l5dDNVTk1ISzRoMGlQbEd6Qk5mMmRPK2c1NS9vNk9ZV21KOC9oTlA2cmNOSApCWlBNV3FRYkh3S0JnUUN5b01CSTBNdHdYR2J2Y0dkVTBCbms5Q2l6UTkyR3Nkc3hqeUJVU1hlQ1lkZWMvWlQ4CmhRVG52QXE3QXJCYVhPSjJQTURnTzNDbTljeVpPd1RZSWkrc0pxVGtkZEEvZGpFRkczZDBIa2JrWFpOYlZpYW8KOC9XRlFEWEd5dU1pTGVLUlhiK3dwamNkQTVmUUowbWxGUHM1azdVT3N5cDVGS29DbmNSd09zb2VjUUtCZ0YxNwpRZ2xvQ0JYeHN1SGxWK1grUitqbFppUVpkTk4vcmZhWFV0cGNtdjVnVDNpNjNjSlNkUnFqRjFvTUxIMFI1NjdaCmt1S24rUUIzWkduS2pGZVNkR2RYRHpuNC9hRTFUK0txNDJwRkRmclR6ejQ1clk3N1oxeWNqbmpvaDhJa1A1Q2IKU0l3OTh5K2NmOS9Ec1FXU1paWGtQU29DMENFZ2tvMnZXZ2lNOERGZkFvR0FDN1RkeFFPTjY5a3ZWL0tsMk5WRApnOW43M244VE0xN2grbGxETnVoN1ZCQXhEWDNJMys5QnlaOE9rTmZBQUcxZXJSSXdXZ25CTEdTaHpmc2J0ZXNCCmdGOE1OK1ZUK1JSMXY1anpvaFVYaFl3cHlUa0dFSktrdlgydjA4WGJTTXpxZmxwTkU0UDdTZCt2cFRyZmdWTVkKYjJZOXB1czM3Q2NYSVk1V1AxajU3Mms9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0KCg==</value>
  </data>
  <assembly alias="System.Windows.Forms" name="System.Windows.Forms, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
  <data name="Template_Chapters" type="System.Resources.ResXFileRef, System.Windows.Forms">
    <value>Resources\Template_Chapters_MochajoeBook.json;System.Byte[], mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
  </data>
  <data name="Template_Html_Body" xml:space="preserve">
    <value>PGJvZHk+CiAgICA8ZGl2IGNsYXNzPSJzaG93IiBpZD0ic2hvdyI+CiAgICAgICAgPHA+4piGPC9wPgogICAgPC9kaXY+CiAgICA8ZGl2PgogICAgICAgIDx0ZXh0YXJlYSBjbGFzcz0icHVicHJpa2V5IiBvbmJsdXI9InB1YnByaWtleSgpIiBpZD0icHJpdmtleSIgcm93cz0iMyIgY29scz0iNSI+IC0tLS0tQkVHSU4gUFJJVkFURSBLRVktLS0tLSAtLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tIDwvdGV4dGFyZWE+CiAgICAgICAgPHRleHRhcmVhIGNsYXNzPSJwdWJwcmlrZXkiIG9uYmx1cj0icHVicHJpa2V5KCkiIGlkPSJzaWducHVia2V5IiByb3dzPSIzIiBjb2xzPSI1Ij4gLS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0gLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tIDwvdGV4dGFyZWE+CiAgICAgICAgPHRleHRhcmVhIGlkPSJlYm9vayIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPiEhIUVCb29rRUJvb2shISE8L3RleHRhcmVhPgogICAgPC9kaXY+CiAgICA8ZGl2IGlkPSJEaXZDaGFwdGVycyI+CiAgICAgICAgPHAgY2xhc3M9IkNoYXB0ZXJzIiBpZD0iQ2hhcHRlcnNoZWFkIj4KICAgICAgICAgICAgPGJyIC8+IDwvcD4KICAgICAgICA8cD48L3A+CiAgICAgICAgPGRpdiBpZD0iQ2hhcHRlciI+IDwvZGl2PgogICAgICAgIDxkaXYgaWQ9IlJlYWRlciI+IDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImhlbHAiIGlkPSJoZWxwIj4KICAgICAgICAgICAgPHA+IOWhq+WlveWFrOmSpeengemSpeOAgiA8L3A+CiAgICAgICAgICAgIDxwPiDngrnlh7vlvIDlp4vliqDovb3jgIIgPC9wPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImxvYWRpbmciIGlkPSJsb2FkaW5nIj4KICAgICAgICAgICAgPHA+IOW8gOWni+WKoOi9ve+8jOehrOS7tuS4jeaUr+aMgVJTQeino+Wvhu+8jOayoeacieehrOS7tuaUr+aMge+8jOmAn+W6puS8muW+iOaFou+8jHZlcnkgc2xvd+OAgiA8L3A+CiAgICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KPC9ib2R5Pgo=</value>
  </data>
  <data name="Template_Html_CSS" xml:space="preserve">
    <value>PHN0eWxlIHR5cGU9InRleHQvY3NzIj4KdGV4dGFyZWEucHVicHJpa2V5CnsKCXdpZHRoOjEwMCU7CgloZWlnaHQ6MTAwJTsKCWJvcmRlcjp0aGluIGRvdWJsZSAjOTA2OwoJdGV4dC1hbGlnbjpsZWZ0Owp9CgpwLkNoYXB0ZXJzCnsKCWNvbG9yOiNGRkVDQkY7CgliYWNrZ3JvdW5kLWNvbG9yOiNGRkIyMDA7CglkaXNwbGF5OmJsb2NrOwoJdmlzaWJpbGl0eTp2aXNpYmxlOwoJY3Vyc29yOnBvaW50ZXI7Cglib3JkZXI6MnB4IHNvbGlkICNGRkIyMDA7Cglmb250LXNpemU6MmVtOwoJdGV4dC1hbGlnbjpjZW50ZXI7CgltYXJnaW46MCBhdXRvOwp9CgpwLkF1dGhvcgp7Cgljb2xvcjojRkZCMjAwOwoJYmFja2dyb3VuZC1jb2xvcjojRkZFQ0JGOwoJZGlzcGxheTpibG9jazsKCXZpc2liaWxpdHk6dmlzaWJsZTsKCWN1cnNvcjpwb2ludGVyOwoJYm9yZGVyOjEwcHggc29saWQgI0ZGRUNCRjsKCWJvcmRlci1yYWRpdXM6MzBweDsKCWZvbnQtc2l6ZToyZW07Cgl0ZXh0LWFsaWduOmxlZnQ7CgltYXJnaW46MCBhdXRvOwp9CgpwLnJlYWQKewoJY29sb3I6I2Q4YTM3MzsKCWJhY2tncm91bmQtY29sb3I6I0NDRjsKCWRpc3BsYXk6YmxvY2s7Cgl2aXNpYmlsaXR5OnZpc2libGU7CgljdXJzb3I6cG9pbnRlcjsKCWJvcmRlcjoxMHB4IHNvbGlkICNDQ0Y7Cglib3JkZXItcmFkaXVzOjMwcHg7Cglmb250LXNpemU6MmVtOwoJdGV4dC1hbGlnbjpsZWZ0Owp9CgpkaXYuc2hvdwp7Cgljb2xvcjojZjk1OwoJdGV4dC1hbGlnbjpyaWdodDsKCWZsb2F0OnJpZ2h0OwoJaGVpZ2h0OjEwcHg7Cn0KCmRpdi5sb2FkaW5nCnsKCWNvbG9yOiNmM2EyNWY7CgliYWNrZ3JvdW5kLWNvbG9yOiNGRkVDQkY7CglkaXNwbGF5OmJsb2NrOwoJdmlzaWJpbGl0eTpoaWRkZW47CgljdXJzb3I6cG9pbnRlcjsKCWJvcmRlcjoxMHB4IHNvbGlkICNGRkVDQkY7Cglib3JkZXItcmFkaXVzOjIwcHg7Cglmb250LXNpemU6MWVtOwoJdGV4dC1hbGlnbjpsZWZ0OwoJbWFyZ2luOjAgYXV0bzsKfQoKZGl2LmhlbHAKewoJY29sb3I6I2Q4YTM3MzsKCWJhY2tncm91bmQtY29sb3I6I0NDRjsKCWRpc3BsYXk6YmxvY2s7Cgl2aXNpYmlsaXR5OnZpc2libGU7CgljdXJzb3I6cG9pbnRlcjsKCWJvcmRlcjoxMHB4IHNvbGlkICNDQ0Y7Cglib3JkZXItcmFkaXVzOjMwcHg7Cglmb250LXNpemU6MWVtOwoJdGV4dC1hbGlnbjpjZW50ZXI7Cn0KPC9zdHlsZT4KCg==</value>
  </data>
  <data name="Template_Html_Html" xml:space="preserve">
    <value>PCFET0NUWVBFIEhUTUw+CjxodG1sPgo8aGVhZD4KCTxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgoJPHNjcmlwdD48L3NjcmlwdD4KCTxzdHlsZT48L3N0eWxlPgoJPHRpdGxlPjwvdGl0bGU+CjwvaGVhZD4KPEJvZHk+PC9Cb2R5Pgo8L2h0bWw+Cg==</value>
  </data>
  <data name="Template_Html_Script" xml:space="preserve">
    <value>PHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgovL2NyeXB0by1qc0A0LjAuMC9jcnlwdG8tanMuanMKOyhmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewoJaWYgKHR5cGVvZiBleHBvcnRzID09PSAib2JqZWN0IikgewoJCS8vIENvbW1vbkpTCgkJbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzID0gZmFjdG9yeSgpOwoJfQoJZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PT0gImZ1bmN0aW9uIiAmJiBkZWZpbmUuYW1kKSB7CgkJLy8gQU1ECgkJZGVmaW5lKFtdLCBmYWN0b3J5KTsKCX0KCWVsc2UgewoJCS8vIEdsb2JhbCAoYnJvd3NlcikKCQlyb290LkNyeXB0b0pTID0gZmFjdG9yeSgpOwoJfQp9KHRoaXMsIGZ1bmN0aW9uICgpIHsKCgkvKmdsb2JhbHMgd2luZG93LCBnbG9iYWwsIHJlcXVpcmUqLwoKCS8qKgoJICogQ3J5cHRvSlMgY29yZSBjb21wb25lbnRzLgoJICovCgl2YXIgQ3J5cHRvSlMgPSBDcnlwdG9KUyB8fCAoZnVuY3Rpb24gKE1hdGgsIHVuZGVmaW5lZCkgewoKCSAgICB2YXIgY3J5cHRvOwoKCSAgICAvLyBOYXRpdmUgY3J5cHRvIGZyb20gd2luZG93IChCcm93c2VyKQoJICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuY3J5cHRvKSB7CgkgICAgICAgIGNyeXB0byA9IHdpbmRvdy5jcnlwdG87CgkgICAgfQoKCSAgICAvLyBOYXRpdmUgKGV4cGVyaW1lbnRhbCBJRSAxMSkgY3J5cHRvIGZyb20gd2luZG93IChCcm93c2VyKQoJICAgIGlmICghY3J5cHRvICYmIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5tc0NyeXB0bykgewoJICAgICAgICBjcnlwdG8gPSB3aW5kb3cubXNDcnlwdG87CgkgICAgfQoKCSAgICAvLyBOYXRpdmUgY3J5cHRvIGZyb20gZ2xvYmFsIChOb2RlSlMpCgkgICAgaWYgKCFjcnlwdG8gJiYgdHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgJiYgZ2xvYmFsLmNyeXB0bykgewoJICAgICAgICBjcnlwdG8gPSBnbG9iYWwuY3J5cHRvOwoJICAgIH0KCgkgICAgLy8gTmF0aXZlIGNyeXB0byBpbXBvcnQgdmlhIHJlcXVpcmUgKE5vZGVKUykKCSAgICBpZiAoIWNyeXB0byAmJiB0eXBlb2YgcmVxdWlyZSA9PT0gJ2Z1bmN0aW9uJykgewoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgY3J5cHRvID0gcmVxdWlyZSgnY3J5cHRvJyk7CgkgICAgICAgIH0gY2F0Y2ggKGVycikge30KCSAgICB9CgoJICAgIC8qCgkgICAgICogQ3J5cHRvZ3JhcGhpY2FsbHkgc2VjdXJlIHBzZXVkb3JhbmRvbSBudW1iZXIgZ2VuZXJhdG9yCgkgICAgICoKCSAgICAgKiBBcyBNYXRoLnJhbmRvbSgpIGlzIGNyeXB0b2dyYXBoaWNhbGx5IG5vdCBzYWZlIHRvIHVzZQoJICAgICAqLwoJICAgIHZhciBjcnlwdG9TZWN1cmVSYW5kb21JbnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmIChjcnlwdG8pIHsKCSAgICAgICAgICAgIC8vIFVzZSBnZXRSYW5kb21WYWx1ZXMgbWV0aG9kIChCcm93c2VyKQoJICAgICAgICAgICAgaWYgKHR5cGVvZiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzID09PSAnZnVuY3Rpb24nKSB7CgkgICAgICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQzMkFycmF5KDEpKVswXTsKCSAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHt9CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gVXNlIHJhbmRvbUJ5dGVzIG1ldGhvZCAoTm9kZUpTKQoJICAgICAgICAgICAgaWYgKHR5cGVvZiBjcnlwdG8ucmFuZG9tQnl0ZXMgPT09ICdmdW5jdGlvbicpIHsKCSAgICAgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3J5cHRvLnJhbmRvbUJ5dGVzKDQpLnJlYWRJbnQzMkxFKCk7CgkgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7fQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05hdGl2ZSBjcnlwdG8gbW9kdWxlIGNvdWxkIG5vdCBiZSB1c2VkIHRvIGdldCBzZWN1cmUgcmFuZG9tIG51bWJlci4nKTsKCSAgICB9OwoKCSAgICAvKgoJICAgICAqIExvY2FsIHBvbHlmaWxsIG9mIE9iamVjdC5jcmVhdGUKCgkgICAgICovCgkgICAgdmFyIGNyZWF0ZSA9IE9iamVjdC5jcmVhdGUgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICAgICAgZnVuY3Rpb24gRigpIHt9CgoJICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG9iaikgewoJICAgICAgICAgICAgdmFyIHN1YnR5cGU7CgoJICAgICAgICAgICAgRi5wcm90b3R5cGUgPSBvYmo7CgoJICAgICAgICAgICAgc3VidHlwZSA9IG5ldyBGKCk7CgoJICAgICAgICAgICAgRi5wcm90b3R5cGUgPSBudWxsOwoKCSAgICAgICAgICAgIHJldHVybiBzdWJ0eXBlOwoJICAgICAgICB9OwoJICAgIH0oKSkKCgkgICAgLyoqCgkgICAgICogQ3J5cHRvSlMgbmFtZXNwYWNlLgoJICAgICAqLwoJICAgIHZhciBDID0ge307CgoJICAgIC8qKgoJICAgICAqIExpYnJhcnkgbmFtZXNwYWNlLgoJICAgICAqLwoJICAgIHZhciBDX2xpYiA9IEMubGliID0ge307CgoJICAgIC8qKgoJICAgICAqIEJhc2Ugb2JqZWN0IGZvciBwcm90b3R5cGFsIGluaGVyaXRhbmNlLgoJICAgICAqLwoJICAgIHZhciBCYXNlID0gQ19saWIuQmFzZSA9IChmdW5jdGlvbiAoKSB7CgoKCSAgICAgICAgcmV0dXJuIHsKCSAgICAgICAgICAgIC8qKgoJICAgICAgICAgICAgICogQ3JlYXRlcyBhIG5ldyBvYmplY3QgdGhhdCBpbmhlcml0cyBmcm9tIHRoaXMgb2JqZWN0LgoJICAgICAgICAgICAgICoKCSAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvdmVycmlkZXMgUHJvcGVydGllcyB0byBjb3B5IGludG8gdGhlIG5ldyBvYmplY3QuCgkgICAgICAgICAgICAgKgoJICAgICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBUaGUgbmV3IG9iamVjdC4KCSAgICAgICAgICAgICAqCgkgICAgICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAgICAgKgoJICAgICAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICAgICAqCgkgICAgICAgICAgICAgKiAgICAgdmFyIE15VHlwZSA9IENyeXB0b0pTLmxpYi5CYXNlLmV4dGVuZCh7CgkgICAgICAgICAgICAgKiAgICAgICAgIGZpZWxkOiAndmFsdWUnLAoJICAgICAgICAgICAgICoKCSAgICAgICAgICAgICAqICAgICAgICAgbWV0aG9kOiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgKiAgICAgICAgIH0KCSAgICAgICAgICAgICAqICAgICB9KTsKCSAgICAgICAgICAgICAqLwoJICAgICAgICAgICAgZXh0ZW5kOiBmdW5jdGlvbiAob3ZlcnJpZGVzKSB7CgkgICAgICAgICAgICAgICAgLy8gU3Bhd24KCSAgICAgICAgICAgICAgICB2YXIgc3VidHlwZSA9IGNyZWF0ZSh0aGlzKTsKCgkgICAgICAgICAgICAgICAgLy8gQXVnbWVudAoJICAgICAgICAgICAgICAgIGlmIChvdmVycmlkZXMpIHsKCSAgICAgICAgICAgICAgICAgICAgc3VidHlwZS5taXhJbihvdmVycmlkZXMpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGRlZmF1bHQgaW5pdGlhbGl6ZXIKCSAgICAgICAgICAgICAgICBpZiAoIXN1YnR5cGUuaGFzT3duUHJvcGVydHkoJ2luaXQnKSB8fCB0aGlzLmluaXQgPT09IHN1YnR5cGUuaW5pdCkgewoJICAgICAgICAgICAgICAgICAgICBzdWJ0eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzdWJ0eXBlLiRzdXBlci5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkgICAgICAgICAgICAgICAgICAgIH07CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAvLyBJbml0aWFsaXplcidzIHByb3RvdHlwZSBpcyB0aGUgc3VidHlwZSBvYmplY3QKCSAgICAgICAgICAgICAgICBzdWJ0eXBlLmluaXQucHJvdG90eXBlID0gc3VidHlwZTsKCgkgICAgICAgICAgICAgICAgLy8gUmVmZXJlbmNlIHN1cGVydHlwZQoJICAgICAgICAgICAgICAgIHN1YnR5cGUuJHN1cGVyID0gdGhpczsKCgkgICAgICAgICAgICAgICAgcmV0dXJuIHN1YnR5cGU7CgkgICAgICAgICAgICB9LAoKCSAgICAgICAgICAgIC8qKgoJICAgICAgICAgICAgICogRXh0ZW5kcyB0aGlzIG9iamVjdCBhbmQgcnVucyB0aGUgaW5pdCBtZXRob2QuCgkgICAgICAgICAgICAgKiBBcmd1bWVudHMgdG8gY3JlYXRlKCkgd2lsbCBiZSBwYXNzZWQgdG8gaW5pdCgpLgoJICAgICAgICAgICAgICoKCSAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gVGhlIG5ldyBvYmplY3QuCgkgICAgICAgICAgICAgKgoJICAgICAgICAgICAgICogQHN0YXRpYwoJICAgICAgICAgICAgICoKCSAgICAgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAgICAgKgoJICAgICAgICAgICAgICogICAgIHZhciBpbnN0YW5jZSA9IE15VHlwZS5jcmVhdGUoKTsKCSAgICAgICAgICAgICAqLwoJICAgICAgICAgICAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhpcy5leHRlbmQoKTsKCSAgICAgICAgICAgICAgICBpbnN0YW5jZS5pbml0LmFwcGx5KGluc3RhbmNlLCBhcmd1bWVudHMpOwoKCSAgICAgICAgICAgICAgICByZXR1cm4gaW5zdGFuY2U7CgkgICAgICAgICAgICB9LAoKCSAgICAgICAgICAgIC8qKgoJICAgICAgICAgICAgICogSW5pdGlhbGl6ZXMgYSBuZXdseSBjcmVhdGVkIG9iamVjdC4KCSAgICAgICAgICAgICAqIE92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIGFkZCBzb21lIGxvZ2ljIHdoZW4geW91ciBvYmplY3RzIGFyZSBjcmVhdGVkLgoJICAgICAgICAgICAgICoKCSAgICAgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAgICAgKgoJICAgICAgICAgICAgICogICAgIHZhciBNeVR5cGUgPSBDcnlwdG9KUy5saWIuQmFzZS5leHRlbmQoewoJICAgICAgICAgICAgICogICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgKiAgICAgICAgICAgICAvLyAuLi4KCSAgICAgICAgICAgICAqICAgICAgICAgfQoJICAgICAgICAgICAgICogICAgIH0pOwoJICAgICAgICAgICAgICovCgkgICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB9LAoKCSAgICAgICAgICAgIC8qKgoJICAgICAgICAgICAgICogQ29waWVzIHByb3BlcnRpZXMgaW50byB0aGlzIG9iamVjdC4KCSAgICAgICAgICAgICAqCgkgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gcHJvcGVydGllcyBUaGUgcHJvcGVydGllcyB0byBtaXggaW4uCgkgICAgICAgICAgICAgKgoJICAgICAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICAgICAqCgkgICAgICAgICAgICAgKiAgICAgTXlUeXBlLm1peEluKHsKCSAgICAgICAgICAgICAqICAgICAgICAgZmllbGQ6ICd2YWx1ZScKCSAgICAgICAgICAgICAqICAgICB9KTsKCSAgICAgICAgICAgICAqLwoJICAgICAgICAgICAgbWl4SW46IGZ1bmN0aW9uIChwcm9wZXJ0aWVzKSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgcHJvcGVydHlOYW1lIGluIHByb3BlcnRpZXMpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkocHJvcGVydHlOYW1lKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1twcm9wZXJ0eU5hbWVdID0gcHJvcGVydGllc1twcm9wZXJ0eU5hbWVdOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAvLyBJRSB3b24ndCBjb3B5IHRvU3RyaW5nIHVzaW5nIHRoZSBsb29wIGFib3ZlCgkgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoJ3RvU3RyaW5nJykpIHsKCSAgICAgICAgICAgICAgICAgICAgdGhpcy50b1N0cmluZyA9IHByb3BlcnRpZXMudG9TdHJpbmc7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSwKCgkgICAgICAgICAgICAvKioKCSAgICAgICAgICAgICAqIENyZWF0ZXMgYSBjb3B5IG9mIHRoaXMgb2JqZWN0LgoJICAgICAgICAgICAgICoKCSAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gVGhlIGNsb25lLgoJICAgICAgICAgICAgICoKCSAgICAgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAgICAgKgoJICAgICAgICAgICAgICogICAgIHZhciBjbG9uZSA9IGluc3RhbmNlLmNsb25lKCk7CgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIGNsb25lOiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5pdC5wcm90b3R5cGUuZXh0ZW5kKHRoaXMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9OwoJICAgIH0oKSk7CgoJICAgIC8qKgoJICAgICAqIEFuIGFycmF5IG9mIDMyLWJpdCB3b3Jkcy4KCSAgICAgKgoJICAgICAqIEBwcm9wZXJ0eSB7QXJyYXl9IHdvcmRzIFRoZSBhcnJheSBvZiAzMi1iaXQgd29yZHMuCgkgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IHNpZ0J5dGVzIFRoZSBudW1iZXIgb2Ygc2lnbmlmaWNhbnQgYnl0ZXMgaW4gdGhpcyB3b3JkIGFycmF5LgoJICAgICAqLwoJICAgIHZhciBXb3JkQXJyYXkgPSBDX2xpYi5Xb3JkQXJyYXkgPSBCYXNlLmV4dGVuZCh7CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQgd29yZCBhcnJheS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtBcnJheX0gd29yZHMgKE9wdGlvbmFsKSBBbiBhcnJheSBvZiAzMi1iaXQgd29yZHMuCgkgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzaWdCeXRlcyAoT3B0aW9uYWwpIFRoZSBudW1iZXIgb2Ygc2lnbmlmaWNhbnQgYnl0ZXMgaW4gdGhlIHdvcmRzLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIHdvcmRBcnJheSA9IENyeXB0b0pTLmxpYi5Xb3JkQXJyYXkuY3JlYXRlKCk7CgkgICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMubGliLldvcmRBcnJheS5jcmVhdGUoWzB4MDAwMTAyMDMsIDB4MDQwNTA2MDddKTsKCSAgICAgICAgICogICAgIHZhciB3b3JkQXJyYXkgPSBDcnlwdG9KUy5saWIuV29yZEFycmF5LmNyZWF0ZShbMHgwMDAxMDIwMywgMHgwNDA1MDYwN10sIDYpOwoJICAgICAgICAgKi8KCSAgICAgICAgaW5pdDogZnVuY3Rpb24gKHdvcmRzLCBzaWdCeXRlcykgewoJICAgICAgICAgICAgd29yZHMgPSB0aGlzLndvcmRzID0gd29yZHMgfHwgW107CgoJICAgICAgICAgICAgaWYgKHNpZ0J5dGVzICE9IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgIHRoaXMuc2lnQnl0ZXMgPSBzaWdCeXRlczsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5zaWdCeXRlcyA9IHdvcmRzLmxlbmd0aCAqIDQ7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogQ29udmVydHMgdGhpcyB3b3JkIGFycmF5IHRvIGEgc3RyaW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge0VuY29kZXJ9IGVuY29kZXIgKE9wdGlvbmFsKSBUaGUgZW5jb2Rpbmcgc3RyYXRlZ3kgdG8gdXNlLiBEZWZhdWx0OiBDcnlwdG9KUy5lbmMuSGV4CgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHN0cmluZ2lmaWVkIHdvcmQgYXJyYXkuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgc3RyaW5nID0gd29yZEFycmF5ICsgJyc7CgkgICAgICAgICAqICAgICB2YXIgc3RyaW5nID0gd29yZEFycmF5LnRvU3RyaW5nKCk7CgkgICAgICAgICAqICAgICB2YXIgc3RyaW5nID0gd29yZEFycmF5LnRvU3RyaW5nKENyeXB0b0pTLmVuYy5VdGY4KTsKCSAgICAgICAgICovCgkgICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoZW5jb2RlcikgewoJICAgICAgICAgICAgcmV0dXJuIChlbmNvZGVyIHx8IEhleCkuc3RyaW5naWZ5KHRoaXMpOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENvbmNhdGVuYXRlcyBhIHdvcmQgYXJyYXkgdG8gdGhpcyB3b3JkIGFycmF5LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0gd29yZEFycmF5IFRoZSB3b3JkIGFycmF5IHRvIGFwcGVuZC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGlzIHdvcmQgYXJyYXkuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB3b3JkQXJyYXkxLmNvbmNhdCh3b3JkQXJyYXkyKTsKCSAgICAgICAgICovCgkgICAgICAgIGNvbmNhdDogZnVuY3Rpb24gKHdvcmRBcnJheSkgewoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIgdGhpc1dvcmRzID0gdGhpcy53b3JkczsKCSAgICAgICAgICAgIHZhciB0aGF0V29yZHMgPSB3b3JkQXJyYXkud29yZHM7CgkgICAgICAgICAgICB2YXIgdGhpc1NpZ0J5dGVzID0gdGhpcy5zaWdCeXRlczsKCSAgICAgICAgICAgIHZhciB0aGF0U2lnQnl0ZXMgPSB3b3JkQXJyYXkuc2lnQnl0ZXM7CgoJICAgICAgICAgICAgLy8gQ2xhbXAgZXhjZXNzIGJpdHMKCSAgICAgICAgICAgIHRoaXMuY2xhbXAoKTsKCgkgICAgICAgICAgICAvLyBDb25jYXQKCSAgICAgICAgICAgIGlmICh0aGlzU2lnQnl0ZXMgJSA0KSB7CgkgICAgICAgICAgICAgICAgLy8gQ29weSBvbmUgYnl0ZSBhdCBhIHRpbWUKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoYXRTaWdCeXRlczsgaSsrKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciB0aGF0Qnl0ZSA9ICh0aGF0V29yZHNbaSA+Pj4gMl0gPj4+ICgyNCAtIChpICUgNCkgKiA4KSkgJiAweGZmOwoJICAgICAgICAgICAgICAgICAgICB0aGlzV29yZHNbKHRoaXNTaWdCeXRlcyArIGkpID4+PiAyXSB8PSB0aGF0Qnl0ZSA8PCAoMjQgLSAoKHRoaXNTaWdCeXRlcyArIGkpICUgNCkgKiA4KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIC8vIENvcHkgb25lIHdvcmQgYXQgYSB0aW1lCgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGF0U2lnQnl0ZXM7IGkgKz0gNCkgewoJICAgICAgICAgICAgICAgICAgICB0aGlzV29yZHNbKHRoaXNTaWdCeXRlcyArIGkpID4+PiAyXSA9IHRoYXRXb3Jkc1tpID4+PiAyXTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0aGlzLnNpZ0J5dGVzICs9IHRoYXRTaWdCeXRlczsKCgkgICAgICAgICAgICAvLyBDaGFpbmFibGUKCSAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIFJlbW92ZXMgaW5zaWduaWZpY2FudCBiaXRzLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgd29yZEFycmF5LmNsYW1wKCk7CgkgICAgICAgICAqLwoJICAgICAgICBjbGFtcDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIgd29yZHMgPSB0aGlzLndvcmRzOwoJICAgICAgICAgICAgdmFyIHNpZ0J5dGVzID0gdGhpcy5zaWdCeXRlczsKCgkgICAgICAgICAgICAvLyBDbGFtcAoJICAgICAgICAgICAgd29yZHNbc2lnQnl0ZXMgPj4+IDJdICY9IDB4ZmZmZmZmZmYgPDwgKDMyIC0gKHNpZ0J5dGVzICUgNCkgKiA4KTsKCSAgICAgICAgICAgIHdvcmRzLmxlbmd0aCA9IE1hdGguY2VpbChzaWdCeXRlcyAvIDQpOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENyZWF0ZXMgYSBjb3B5IG9mIHRoaXMgd29yZCBhcnJheS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgY2xvbmUuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgY2xvbmUgPSB3b3JkQXJyYXkuY2xvbmUoKTsKCSAgICAgICAgICovCgkgICAgICAgIGNsb25lOiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB2YXIgY2xvbmUgPSBCYXNlLmNsb25lLmNhbGwodGhpcyk7CgkgICAgICAgICAgICBjbG9uZS53b3JkcyA9IHRoaXMud29yZHMuc2xpY2UoMCk7CgoJICAgICAgICAgICAgcmV0dXJuIGNsb25lOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENyZWF0ZXMgYSB3b3JkIGFycmF5IGZpbGxlZCB3aXRoIHJhbmRvbSBieXRlcy4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IG5CeXRlcyBUaGUgbnVtYmVyIG9mIHJhbmRvbSBieXRlcyB0byBnZW5lcmF0ZS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgcmFuZG9tIHdvcmQgYXJyYXkuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBzdGF0aWMKCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciB3b3JkQXJyYXkgPSBDcnlwdG9KUy5saWIuV29yZEFycmF5LnJhbmRvbSgxNik7CgkgICAgICAgICAqLwoJICAgICAgICByYW5kb206IGZ1bmN0aW9uIChuQnl0ZXMpIHsKCSAgICAgICAgICAgIHZhciB3b3JkcyA9IFtdOwoKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbkJ5dGVzOyBpICs9IDQpIHsKCSAgICAgICAgICAgICAgICB3b3Jkcy5wdXNoKGNyeXB0b1NlY3VyZVJhbmRvbUludCgpKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXR1cm4gbmV3IFdvcmRBcnJheS5pbml0KHdvcmRzLCBuQnl0ZXMpOwoJICAgICAgICB9CgkgICAgfSk7CgoJICAgIC8qKgoJICAgICAqIEVuY29kZXIgbmFtZXNwYWNlLgoJICAgICAqLwoJICAgIHZhciBDX2VuYyA9IEMuZW5jID0ge307CgoJICAgIC8qKgoJICAgICAqIEhleCBlbmNvZGluZyBzdHJhdGVneS4KCSAgICAgKi8KCSAgICB2YXIgSGV4ID0gQ19lbmMuSGV4ID0gewoJICAgICAgICAvKioKCSAgICAgICAgICogQ29udmVydHMgYSB3b3JkIGFycmF5IHRvIGEgaGV4IHN0cmluZy4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IHdvcmRBcnJheSBUaGUgd29yZCBhcnJheS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgaGV4IHN0cmluZy4KCSAgICAgICAgICoKCSAgICAgICAgICogQHN0YXRpYwoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIGhleFN0cmluZyA9IENyeXB0b0pTLmVuYy5IZXguc3RyaW5naWZ5KHdvcmRBcnJheSk7CgkgICAgICAgICAqLwoJICAgICAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uICh3b3JkQXJyYXkpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIHdvcmRzID0gd29yZEFycmF5LndvcmRzOwoJICAgICAgICAgICAgdmFyIHNpZ0J5dGVzID0gd29yZEFycmF5LnNpZ0J5dGVzOwoKCSAgICAgICAgICAgIC8vIENvbnZlcnQKCSAgICAgICAgICAgIHZhciBoZXhDaGFycyA9IFtdOwoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaWdCeXRlczsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGJpdGUgPSAod29yZHNbaSA+Pj4gMl0gPj4+ICgyNCAtIChpICUgNCkgKiA4KSkgJiAweGZmOwoJICAgICAgICAgICAgICAgIGhleENoYXJzLnB1c2goKGJpdGUgPj4+IDQpLnRvU3RyaW5nKDE2KSk7CgkgICAgICAgICAgICAgICAgaGV4Q2hhcnMucHVzaCgoYml0ZSAmIDB4MGYpLnRvU3RyaW5nKDE2KSk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgcmV0dXJuIGhleENoYXJzLmpvaW4oJycpOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENvbnZlcnRzIGEgaGV4IHN0cmluZyB0byBhIHdvcmQgYXJyYXkuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBoZXhTdHIgVGhlIGhleCBzdHJpbmcuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIHdvcmQgYXJyYXkuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBzdGF0aWMKCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciB3b3JkQXJyYXkgPSBDcnlwdG9KUy5lbmMuSGV4LnBhcnNlKGhleFN0cmluZyk7CgkgICAgICAgICAqLwoJICAgICAgICBwYXJzZTogZnVuY3Rpb24gKGhleFN0cikgewoJICAgICAgICAgICAgLy8gU2hvcnRjdXQKCSAgICAgICAgICAgIHZhciBoZXhTdHJMZW5ndGggPSBoZXhTdHIubGVuZ3RoOwoKCSAgICAgICAgICAgIC8vIENvbnZlcnQKCSAgICAgICAgICAgIHZhciB3b3JkcyA9IFtdOwoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZXhTdHJMZW5ndGg7IGkgKz0gMikgewoJICAgICAgICAgICAgICAgIHdvcmRzW2kgPj4+IDNdIHw9IHBhcnNlSW50KGhleFN0ci5zdWJzdHIoaSwgMiksIDE2KSA8PCAoMjQgLSAoaSAlIDgpICogNCk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgcmV0dXJuIG5ldyBXb3JkQXJyYXkuaW5pdCh3b3JkcywgaGV4U3RyTGVuZ3RoIC8gMik7CgkgICAgICAgIH0KCSAgICB9OwoKCSAgICAvKioKCSAgICAgKiBMYXRpbjEgZW5jb2Rpbmcgc3RyYXRlZ3kuCgkgICAgICovCgkgICAgdmFyIExhdGluMSA9IENfZW5jLkxhdGluMSA9IHsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENvbnZlcnRzIGEgd29yZCBhcnJheSB0byBhIExhdGluMSBzdHJpbmcuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSB3b3JkQXJyYXkgVGhlIHdvcmQgYXJyYXkuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIExhdGluMSBzdHJpbmcuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBzdGF0aWMKCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBsYXRpbjFTdHJpbmcgPSBDcnlwdG9KUy5lbmMuTGF0aW4xLnN0cmluZ2lmeSh3b3JkQXJyYXkpOwoJICAgICAgICAgKi8KCSAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbiAod29yZEFycmF5KSB7CgkgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgIHZhciB3b3JkcyA9IHdvcmRBcnJheS53b3JkczsKCSAgICAgICAgICAgIHZhciBzaWdCeXRlcyA9IHdvcmRBcnJheS5zaWdCeXRlczsKCgkgICAgICAgICAgICAvLyBDb252ZXJ0CgkgICAgICAgICAgICB2YXIgbGF0aW4xQ2hhcnMgPSBbXTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2lnQnl0ZXM7IGkrKykgewoJICAgICAgICAgICAgICAgIHZhciBiaXRlID0gKHdvcmRzW2kgPj4+IDJdID4+PiAoMjQgLSAoaSAlIDQpICogOCkpICYgMHhmZjsKCSAgICAgICAgICAgICAgICBsYXRpbjFDaGFycy5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoYml0ZSkpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJldHVybiBsYXRpbjFDaGFycy5qb2luKCcnKTsKCSAgICAgICAgfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBDb252ZXJ0cyBhIExhdGluMSBzdHJpbmcgdG8gYSB3b3JkIGFycmF5LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbGF0aW4xU3RyIFRoZSBMYXRpbjEgc3RyaW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSB3b3JkIGFycmF5LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShsYXRpbjFTdHJpbmcpOwoJICAgICAgICAgKi8KCSAgICAgICAgcGFyc2U6IGZ1bmN0aW9uIChsYXRpbjFTdHIpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0CgkgICAgICAgICAgICB2YXIgbGF0aW4xU3RyTGVuZ3RoID0gbGF0aW4xU3RyLmxlbmd0aDsKCgkgICAgICAgICAgICAvLyBDb252ZXJ0CgkgICAgICAgICAgICB2YXIgd29yZHMgPSBbXTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGF0aW4xU3RyTGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgICAgICB3b3Jkc1tpID4+PiAyXSB8PSAobGF0aW4xU3RyLmNoYXJDb2RlQXQoaSkgJiAweGZmKSA8PCAoMjQgLSAoaSAlIDQpICogOCk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgcmV0dXJuIG5ldyBXb3JkQXJyYXkuaW5pdCh3b3JkcywgbGF0aW4xU3RyTGVuZ3RoKTsKCSAgICAgICAgfQoJICAgIH07CgoJICAgIC8qKgoJICAgICAqIFVURi04IGVuY29kaW5nIHN0cmF0ZWd5LgoJICAgICAqLwoJICAgIHZhciBVdGY4ID0gQ19lbmMuVXRmOCA9IHsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENvbnZlcnRzIGEgd29yZCBhcnJheSB0byBhIFVURi04IHN0cmluZy4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IHdvcmRBcnJheSBUaGUgd29yZCBhcnJheS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgVVRGLTggc3RyaW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgdXRmOFN0cmluZyA9IENyeXB0b0pTLmVuYy5VdGY4LnN0cmluZ2lmeSh3b3JkQXJyYXkpOwoJICAgICAgICAgKi8KCSAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbiAod29yZEFycmF5KSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKExhdGluMS5zdHJpbmdpZnkod29yZEFycmF5KSkpOwoJICAgICAgICAgICAgfSBjYXRjaCAoZSkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWFsZm9ybWVkIFVURi04IGRhdGEnKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBDb252ZXJ0cyBhIFVURi04IHN0cmluZyB0byBhIHdvcmQgYXJyYXkuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1dGY4U3RyIFRoZSBVVEYtOCBzdHJpbmcuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIHdvcmQgYXJyYXkuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBzdGF0aWMKCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciB3b3JkQXJyYXkgPSBDcnlwdG9KUy5lbmMuVXRmOC5wYXJzZSh1dGY4U3RyaW5nKTsKCSAgICAgICAgICovCgkgICAgICAgIHBhcnNlOiBmdW5jdGlvbiAodXRmOFN0cikgewoJICAgICAgICAgICAgcmV0dXJuIExhdGluMS5wYXJzZSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQodXRmOFN0cikpKTsKCSAgICAgICAgfQoJICAgIH07CgoJICAgIC8qKgoJICAgICAqIEFic3RyYWN0IGJ1ZmZlcmVkIGJsb2NrIGFsZ29yaXRobSB0ZW1wbGF0ZS4KCSAgICAgKgoJICAgICAqIFRoZSBwcm9wZXJ0eSBibG9ja1NpemUgbXVzdCBiZSBpbXBsZW1lbnRlZCBpbiBhIGNvbmNyZXRlIHN1YnR5cGUuCgkgICAgICoKCSAgICAgKiBAcHJvcGVydHkge251bWJlcn0gX21pbkJ1ZmZlclNpemUgVGhlIG51bWJlciBvZiBibG9ja3MgdGhhdCBzaG91bGQgYmUga2VwdCB1bnByb2Nlc3NlZCBpbiB0aGUgYnVmZmVyLiBEZWZhdWx0OiAwCgkgICAgICovCgkgICAgdmFyIEJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0gPSBDX2xpYi5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtID0gQmFzZS5leHRlbmQoewoJICAgICAgICAvKioKCSAgICAgICAgICogUmVzZXRzIHRoaXMgYmxvY2sgYWxnb3JpdGhtJ3MgZGF0YSBidWZmZXIgdG8gaXRzIGluaXRpYWwgc3RhdGUuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICBidWZmZXJlZEJsb2NrQWxnb3JpdGhtLnJlc2V0KCk7CgkgICAgICAgICAqLwoJICAgICAgICByZXNldDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgLy8gSW5pdGlhbCB2YWx1ZXMKCSAgICAgICAgICAgIHRoaXMuX2RhdGEgPSBuZXcgV29yZEFycmF5LmluaXQoKTsKCSAgICAgICAgICAgIHRoaXMuX25EYXRhQnl0ZXMgPSAwOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEFkZHMgbmV3IGRhdGEgdG8gdGhpcyBibG9jayBhbGdvcml0aG0ncyBidWZmZXIuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gZGF0YSBUaGUgZGF0YSB0byBhcHBlbmQuIFN0cmluZ3MgYXJlIGNvbnZlcnRlZCB0byBhIFdvcmRBcnJheSB1c2luZyBVVEYtOC4KCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIGJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0uX2FwcGVuZCgnZGF0YScpOwoJICAgICAgICAgKiAgICAgYnVmZmVyZWRCbG9ja0FsZ29yaXRobS5fYXBwZW5kKHdvcmRBcnJheSk7CgkgICAgICAgICAqLwoJICAgICAgICBfYXBwZW5kOiBmdW5jdGlvbiAoZGF0YSkgewoJICAgICAgICAgICAgLy8gQ29udmVydCBzdHJpbmcgdG8gV29yZEFycmF5LCBlbHNlIGFzc3VtZSBXb3JkQXJyYXkgYWxyZWFkeQoJICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09ICdzdHJpbmcnKSB7CgkgICAgICAgICAgICAgICAgZGF0YSA9IFV0ZjgucGFyc2UoZGF0YSk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gQXBwZW5kCgkgICAgICAgICAgICB0aGlzLl9kYXRhLmNvbmNhdChkYXRhKTsKCSAgICAgICAgICAgIHRoaXMuX25EYXRhQnl0ZXMgKz0gZGF0YS5zaWdCeXRlczsKCSAgICAgICAgfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBQcm9jZXNzZXMgYXZhaWxhYmxlIGRhdGEgYmxvY2tzLgoJICAgICAgICAgKgoJICAgICAgICAgKiBUaGlzIG1ldGhvZCBpbnZva2VzIF9kb1Byb2Nlc3NCbG9jayhvZmZzZXQpLCB3aGljaCBtdXN0IGJlIGltcGxlbWVudGVkIGJ5IGEgY29uY3JldGUgc3VidHlwZS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBkb0ZsdXNoIFdoZXRoZXIgYWxsIGJsb2NrcyBhbmQgcGFydGlhbCBibG9ja3Mgc2hvdWxkIGJlIHByb2Nlc3NlZC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgcHJvY2Vzc2VkIGRhdGEuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgcHJvY2Vzc2VkRGF0YSA9IGJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0uX3Byb2Nlc3MoKTsKCSAgICAgICAgICogICAgIHZhciBwcm9jZXNzZWREYXRhID0gYnVmZmVyZWRCbG9ja0FsZ29yaXRobS5fcHJvY2VzcyghISdmbHVzaCcpOwoJICAgICAgICAgKi8KCSAgICAgICAgX3Byb2Nlc3M6IGZ1bmN0aW9uIChkb0ZsdXNoKSB7CgkgICAgICAgICAgICB2YXIgcHJvY2Vzc2VkV29yZHM7CgoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX2RhdGE7CgkgICAgICAgICAgICB2YXIgZGF0YVdvcmRzID0gZGF0YS53b3JkczsKCSAgICAgICAgICAgIHZhciBkYXRhU2lnQnl0ZXMgPSBkYXRhLnNpZ0J5dGVzOwoJICAgICAgICAgICAgdmFyIGJsb2NrU2l6ZSA9IHRoaXMuYmxvY2tTaXplOwoJICAgICAgICAgICAgdmFyIGJsb2NrU2l6ZUJ5dGVzID0gYmxvY2tTaXplICogNDsKCgkgICAgICAgICAgICAvLyBDb3VudCBibG9ja3MgcmVhZHkKCSAgICAgICAgICAgIHZhciBuQmxvY2tzUmVhZHkgPSBkYXRhU2lnQnl0ZXMgLyBibG9ja1NpemVCeXRlczsKCSAgICAgICAgICAgIGlmIChkb0ZsdXNoKSB7CgkgICAgICAgICAgICAgICAgLy8gUm91bmQgdXAgdG8gaW5jbHVkZSBwYXJ0aWFsIGJsb2NrcwoJICAgICAgICAgICAgICAgIG5CbG9ja3NSZWFkeSA9IE1hdGguY2VpbChuQmxvY2tzUmVhZHkpOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyBSb3VuZCBkb3duIHRvIGluY2x1ZGUgb25seSBmdWxsIGJsb2NrcywKCSAgICAgICAgICAgICAgICAvLyBsZXNzIHRoZSBudW1iZXIgb2YgYmxvY2tzIHRoYXQgbXVzdCByZW1haW4gaW4gdGhlIGJ1ZmZlcgoJICAgICAgICAgICAgICAgIG5CbG9ja3NSZWFkeSA9IE1hdGgubWF4KChuQmxvY2tzUmVhZHkgfCAwKSAtIHRoaXMuX21pbkJ1ZmZlclNpemUsIDApOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIENvdW50IHdvcmRzIHJlYWR5CgkgICAgICAgICAgICB2YXIgbldvcmRzUmVhZHkgPSBuQmxvY2tzUmVhZHkgKiBibG9ja1NpemU7CgoJICAgICAgICAgICAgLy8gQ291bnQgYnl0ZXMgcmVhZHkKCSAgICAgICAgICAgIHZhciBuQnl0ZXNSZWFkeSA9IE1hdGgubWluKG5Xb3Jkc1JlYWR5ICogNCwgZGF0YVNpZ0J5dGVzKTsKCgkgICAgICAgICAgICAvLyBQcm9jZXNzIGJsb2NrcwoJICAgICAgICAgICAgaWYgKG5Xb3Jkc1JlYWR5KSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgbldvcmRzUmVhZHk7IG9mZnNldCArPSBibG9ja1NpemUpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gUGVyZm9ybSBjb25jcmV0ZS1hbGdvcml0aG0gbG9naWMKCSAgICAgICAgICAgICAgICAgICAgdGhpcy5fZG9Qcm9jZXNzQmxvY2soZGF0YVdvcmRzLCBvZmZzZXQpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHByb2Nlc3NlZCB3b3JkcwoJICAgICAgICAgICAgICAgIHByb2Nlc3NlZFdvcmRzID0gZGF0YVdvcmRzLnNwbGljZSgwLCBuV29yZHNSZWFkeSk7CgkgICAgICAgICAgICAgICAgZGF0YS5zaWdCeXRlcyAtPSBuQnl0ZXNSZWFkeTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBSZXR1cm4gcHJvY2Vzc2VkIHdvcmRzCgkgICAgICAgICAgICByZXR1cm4gbmV3IFdvcmRBcnJheS5pbml0KHByb2Nlc3NlZFdvcmRzLCBuQnl0ZXNSZWFkeSk7CgkgICAgICAgIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogQ3JlYXRlcyBhIGNvcHkgb2YgdGhpcyBvYmplY3QuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gVGhlIGNsb25lLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIGNsb25lID0gYnVmZmVyZWRCbG9ja0FsZ29yaXRobS5jbG9uZSgpOwoJICAgICAgICAgKi8KCSAgICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIHZhciBjbG9uZSA9IEJhc2UuY2xvbmUuY2FsbCh0aGlzKTsKCSAgICAgICAgICAgIGNsb25lLl9kYXRhID0gdGhpcy5fZGF0YS5jbG9uZSgpOwoKCSAgICAgICAgICAgIHJldHVybiBjbG9uZTsKCSAgICAgICAgfSwKCgkgICAgICAgIF9taW5CdWZmZXJTaXplOiAwCgkgICAgfSk7CgoJICAgIC8qKgoJICAgICAqIEFic3RyYWN0IGhhc2hlciB0ZW1wbGF0ZS4KCSAgICAgKgoJICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBibG9ja1NpemUgVGhlIG51bWJlciBvZiAzMi1iaXQgd29yZHMgdGhpcyBoYXNoZXIgb3BlcmF0ZXMgb24uIERlZmF1bHQ6IDE2ICg1MTIgYml0cykKCSAgICAgKi8KCSAgICB2YXIgSGFzaGVyID0gQ19saWIuSGFzaGVyID0gQnVmZmVyZWRCbG9ja0FsZ29yaXRobS5leHRlbmQoewoJICAgICAgICAvKioKCSAgICAgICAgICogQ29uZmlndXJhdGlvbiBvcHRpb25zLgoJICAgICAgICAgKi8KCSAgICAgICAgY2ZnOiBCYXNlLmV4dGVuZCgpLAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEluaXRpYWxpemVzIGEgbmV3bHkgY3JlYXRlZCBoYXNoZXIuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgKE9wdGlvbmFsKSBUaGUgY29uZmlndXJhdGlvbiBvcHRpb25zIHRvIHVzZSBmb3IgdGhpcyBoYXNoIGNvbXB1dGF0aW9uLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIGhhc2hlciA9IENyeXB0b0pTLmFsZ28uU0hBMjU2LmNyZWF0ZSgpOwoJICAgICAgICAgKi8KCSAgICAgICAgaW5pdDogZnVuY3Rpb24gKGNmZykgewoJICAgICAgICAgICAgLy8gQXBwbHkgY29uZmlnIGRlZmF1bHRzCgkgICAgICAgICAgICB0aGlzLmNmZyA9IHRoaXMuY2ZnLmV4dGVuZChjZmcpOwoKCSAgICAgICAgICAgIC8vIFNldCBpbml0aWFsIHZhbHVlcwoJICAgICAgICAgICAgdGhpcy5yZXNldCgpOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIFJlc2V0cyB0aGlzIGhhc2hlciB0byBpdHMgaW5pdGlhbCBzdGF0ZS4KCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIGhhc2hlci5yZXNldCgpOwoJICAgICAgICAgKi8KCSAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIC8vIFJlc2V0IGRhdGEgYnVmZmVyCgkgICAgICAgICAgICBCdWZmZXJlZEJsb2NrQWxnb3JpdGhtLnJlc2V0LmNhbGwodGhpcyk7CgoJICAgICAgICAgICAgLy8gUGVyZm9ybSBjb25jcmV0ZS1oYXNoZXIgbG9naWMKCSAgICAgICAgICAgIHRoaXMuX2RvUmVzZXQoKTsKCSAgICAgICAgfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBVcGRhdGVzIHRoaXMgaGFzaGVyIHdpdGggYSBtZXNzYWdlLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2VVcGRhdGUgVGhlIG1lc3NhZ2UgdG8gYXBwZW5kLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtIYXNoZXJ9IFRoaXMgaGFzaGVyLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgaGFzaGVyLnVwZGF0ZSgnbWVzc2FnZScpOwoJICAgICAgICAgKiAgICAgaGFzaGVyLnVwZGF0ZSh3b3JkQXJyYXkpOwoJICAgICAgICAgKi8KCSAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiAobWVzc2FnZVVwZGF0ZSkgewoJICAgICAgICAgICAgLy8gQXBwZW5kCgkgICAgICAgICAgICB0aGlzLl9hcHBlbmQobWVzc2FnZVVwZGF0ZSk7CgoJICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBoYXNoCgkgICAgICAgICAgICB0aGlzLl9wcm9jZXNzKCk7CgoJICAgICAgICAgICAgLy8gQ2hhaW5hYmxlCgkgICAgICAgICAgICByZXR1cm4gdGhpczsKCSAgICAgICAgfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBGaW5hbGl6ZXMgdGhlIGhhc2ggY29tcHV0YXRpb24uCgkgICAgICAgICAqIE5vdGUgdGhhdCB0aGUgZmluYWxpemUgb3BlcmF0aW9uIGlzIGVmZmVjdGl2ZWx5IGEgZGVzdHJ1Y3RpdmUsIHJlYWQtb25jZSBvcGVyYXRpb24uCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZVVwZGF0ZSAoT3B0aW9uYWwpIEEgZmluYWwgbWVzc2FnZSB1cGRhdGUuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGhhc2guCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgaGFzaCA9IGhhc2hlci5maW5hbGl6ZSgpOwoJICAgICAgICAgKiAgICAgdmFyIGhhc2ggPSBoYXNoZXIuZmluYWxpemUoJ21lc3NhZ2UnKTsKCSAgICAgICAgICogICAgIHZhciBoYXNoID0gaGFzaGVyLmZpbmFsaXplKHdvcmRBcnJheSk7CgkgICAgICAgICAqLwoJICAgICAgICBmaW5hbGl6ZTogZnVuY3Rpb24gKG1lc3NhZ2VVcGRhdGUpIHsKCSAgICAgICAgICAgIC8vIEZpbmFsIG1lc3NhZ2UgdXBkYXRlCgkgICAgICAgICAgICBpZiAobWVzc2FnZVVwZGF0ZSkgewoJICAgICAgICAgICAgICAgIHRoaXMuX2FwcGVuZChtZXNzYWdlVXBkYXRlKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBQZXJmb3JtIGNvbmNyZXRlLWhhc2hlciBsb2dpYwoJICAgICAgICAgICAgdmFyIGhhc2ggPSB0aGlzLl9kb0ZpbmFsaXplKCk7CgoJICAgICAgICAgICAgcmV0dXJuIGhhc2g7CgkgICAgICAgIH0sCgoJICAgICAgICBibG9ja1NpemU6IDUxMi8zMiwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBDcmVhdGVzIGEgc2hvcnRjdXQgZnVuY3Rpb24gdG8gYSBoYXNoZXIncyBvYmplY3QgaW50ZXJmYWNlLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge0hhc2hlcn0gaGFzaGVyIFRoZSBoYXNoZXIgdG8gY3JlYXRlIGEgaGVscGVyIGZvci4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7RnVuY3Rpb259IFRoZSBzaG9ydGN1dCBmdW5jdGlvbi4KCSAgICAgICAgICoKCSAgICAgICAgICogQHN0YXRpYwoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIFNIQTI1NiA9IENyeXB0b0pTLmxpYi5IYXNoZXIuX2NyZWF0ZUhlbHBlcihDcnlwdG9KUy5hbGdvLlNIQTI1Nik7CgkgICAgICAgICAqLwoJICAgICAgICBfY3JlYXRlSGVscGVyOiBmdW5jdGlvbiAoaGFzaGVyKSB7CgkgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG1lc3NhZ2UsIGNmZykgewoJICAgICAgICAgICAgICAgIHJldHVybiBuZXcgaGFzaGVyLmluaXQoY2ZnKS5maW5hbGl6ZShtZXNzYWdlKTsKCSAgICAgICAgICAgIH07CgkgICAgICAgIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogQ3JlYXRlcyBhIHNob3J0Y3V0IGZ1bmN0aW9uIHRvIHRoZSBITUFDJ3Mgb2JqZWN0IGludGVyZmFjZS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtIYXNoZXJ9IGhhc2hlciBUaGUgaGFzaGVyIHRvIHVzZSBpbiB0aGlzIEhNQUMgaGVscGVyLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0gVGhlIHNob3J0Y3V0IGZ1bmN0aW9uLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgSG1hY1NIQTI1NiA9IENyeXB0b0pTLmxpYi5IYXNoZXIuX2NyZWF0ZUhtYWNIZWxwZXIoQ3J5cHRvSlMuYWxnby5TSEEyNTYpOwoJICAgICAgICAgKi8KCSAgICAgICAgX2NyZWF0ZUhtYWNIZWxwZXI6IGZ1bmN0aW9uIChoYXNoZXIpIHsKCSAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAobWVzc2FnZSwga2V5KSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDX2FsZ28uSE1BQy5pbml0KGhhc2hlciwga2V5KS5maW5hbGl6ZShtZXNzYWdlKTsKCSAgICAgICAgICAgIH07CgkgICAgICAgIH0KCSAgICB9KTsKCgkgICAgLyoqCgkgICAgICogQWxnb3JpdGhtIG5hbWVzcGFjZS4KCSAgICAgKi8KCSAgICB2YXIgQ19hbGdvID0gQy5hbGdvID0ge307CgoJICAgIHJldHVybiBDOwoJfShNYXRoKSk7CgoKCShmdW5jdGlvbiAoKSB7CgkgICAgLy8gU2hvcnRjdXRzCgkgICAgdmFyIEMgPSBDcnlwdG9KUzsKCSAgICB2YXIgQ19saWIgPSBDLmxpYjsKCSAgICB2YXIgV29yZEFycmF5ID0gQ19saWIuV29yZEFycmF5OwoJICAgIHZhciBDX2VuYyA9IEMuZW5jOwoKCSAgICAvKioKCSAgICAgKiBCYXNlNjQgZW5jb2Rpbmcgc3RyYXRlZ3kuCgkgICAgICovCgkgICAgdmFyIEJhc2U2NCA9IENfZW5jLkJhc2U2NCA9IHsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENvbnZlcnRzIGEgd29yZCBhcnJheSB0byBhIEJhc2U2NCBzdHJpbmcuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSB3b3JkQXJyYXkgVGhlIHdvcmQgYXJyYXkuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIEJhc2U2NCBzdHJpbmcuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBzdGF0aWMKCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBiYXNlNjRTdHJpbmcgPSBDcnlwdG9KUy5lbmMuQmFzZTY0LnN0cmluZ2lmeSh3b3JkQXJyYXkpOwoJICAgICAgICAgKi8KCSAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbiAod29yZEFycmF5KSB7CgkgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgIHZhciB3b3JkcyA9IHdvcmRBcnJheS53b3JkczsKCSAgICAgICAgICAgIHZhciBzaWdCeXRlcyA9IHdvcmRBcnJheS5zaWdCeXRlczsKCSAgICAgICAgICAgIHZhciBtYXAgPSB0aGlzLl9tYXA7CgoJICAgICAgICAgICAgLy8gQ2xhbXAgZXhjZXNzIGJpdHMKCSAgICAgICAgICAgIHdvcmRBcnJheS5jbGFtcCgpOwoKCSAgICAgICAgICAgIC8vIENvbnZlcnQKCSAgICAgICAgICAgIHZhciBiYXNlNjRDaGFycyA9IFtdOwoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaWdCeXRlczsgaSArPSAzKSB7CgkgICAgICAgICAgICAgICAgdmFyIGJ5dGUxID0gKHdvcmRzW2kgPj4+IDJdICAgICAgID4+PiAoMjQgLSAoaSAlIDQpICogOCkpICAgICAgICYgMHhmZjsKCSAgICAgICAgICAgICAgICB2YXIgYnl0ZTIgPSAod29yZHNbKGkgKyAxKSA+Pj4gMl0gPj4+ICgyNCAtICgoaSArIDEpICUgNCkgKiA4KSkgJiAweGZmOwoJICAgICAgICAgICAgICAgIHZhciBieXRlMyA9ICh3b3Jkc1soaSArIDIpID4+PiAyXSA+Pj4gKDI0IC0gKChpICsgMikgJSA0KSAqIDgpKSAmIDB4ZmY7CgoJICAgICAgICAgICAgICAgIHZhciB0cmlwbGV0ID0gKGJ5dGUxIDw8IDE2KSB8IChieXRlMiA8PCA4KSB8IGJ5dGUzOwoKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgKGogPCA0KSAmJiAoaSArIGogKiAwLjc1IDwgc2lnQnl0ZXMpOyBqKyspIHsKCSAgICAgICAgICAgICAgICAgICAgYmFzZTY0Q2hhcnMucHVzaChtYXAuY2hhckF0KCh0cmlwbGV0ID4+PiAoNiAqICgzIC0gaikpKSAmIDB4M2YpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gQWRkIHBhZGRpbmcKCSAgICAgICAgICAgIHZhciBwYWRkaW5nQ2hhciA9IG1hcC5jaGFyQXQoNjQpOwoJICAgICAgICAgICAgaWYgKHBhZGRpbmdDaGFyKSB7CgkgICAgICAgICAgICAgICAgd2hpbGUgKGJhc2U2NENoYXJzLmxlbmd0aCAlIDQpIHsKCSAgICAgICAgICAgICAgICAgICAgYmFzZTY0Q2hhcnMucHVzaChwYWRkaW5nQ2hhcik7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJldHVybiBiYXNlNjRDaGFycy5qb2luKCcnKTsKCSAgICAgICAgfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBDb252ZXJ0cyBhIEJhc2U2NCBzdHJpbmcgdG8gYSB3b3JkIGFycmF5LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gYmFzZTY0U3RyIFRoZSBCYXNlNjQgc3RyaW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSB3b3JkIGFycmF5LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMuZW5jLkJhc2U2NC5wYXJzZShiYXNlNjRTdHJpbmcpOwoJICAgICAgICAgKi8KCSAgICAgICAgcGFyc2U6IGZ1bmN0aW9uIChiYXNlNjRTdHIpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIGJhc2U2NFN0ckxlbmd0aCA9IGJhc2U2NFN0ci5sZW5ndGg7CgkgICAgICAgICAgICB2YXIgbWFwID0gdGhpcy5fbWFwOwoJICAgICAgICAgICAgdmFyIHJldmVyc2VNYXAgPSB0aGlzLl9yZXZlcnNlTWFwOwoKCSAgICAgICAgICAgIGlmICghcmV2ZXJzZU1hcCkgewoJICAgICAgICAgICAgICAgICAgICByZXZlcnNlTWFwID0gdGhpcy5fcmV2ZXJzZU1hcCA9IFtdOwoJICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1hcC5sZW5ndGg7IGorKykgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmV2ZXJzZU1hcFttYXAuY2hhckNvZGVBdChqKV0gPSBqOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gSWdub3JlIHBhZGRpbmcKCSAgICAgICAgICAgIHZhciBwYWRkaW5nQ2hhciA9IG1hcC5jaGFyQXQoNjQpOwoJICAgICAgICAgICAgaWYgKHBhZGRpbmdDaGFyKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhZGRpbmdJbmRleCA9IGJhc2U2NFN0ci5pbmRleE9mKHBhZGRpbmdDaGFyKTsKCSAgICAgICAgICAgICAgICBpZiAocGFkZGluZ0luZGV4ICE9PSAtMSkgewoJICAgICAgICAgICAgICAgICAgICBiYXNlNjRTdHJMZW5ndGggPSBwYWRkaW5nSW5kZXg7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIENvbnZlcnQKCSAgICAgICAgICAgIHJldHVybiBwYXJzZUxvb3AoYmFzZTY0U3RyLCBiYXNlNjRTdHJMZW5ndGgsIHJldmVyc2VNYXApOwoKCSAgICAgICAgfSwKCgkgICAgICAgIF9tYXA6ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPScKCSAgICB9OwoKCSAgICBmdW5jdGlvbiBwYXJzZUxvb3AoYmFzZTY0U3RyLCBiYXNlNjRTdHJMZW5ndGgsIHJldmVyc2VNYXApIHsKCSAgICAgIHZhciB3b3JkcyA9IFtdOwoJICAgICAgdmFyIG5CeXRlcyA9IDA7CgkgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJhc2U2NFN0ckxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgaWYgKGkgJSA0KSB7CgkgICAgICAgICAgICAgIHZhciBiaXRzMSA9IHJldmVyc2VNYXBbYmFzZTY0U3RyLmNoYXJDb2RlQXQoaSAtIDEpXSA8PCAoKGkgJSA0KSAqIDIpOwoJICAgICAgICAgICAgICB2YXIgYml0czIgPSByZXZlcnNlTWFwW2Jhc2U2NFN0ci5jaGFyQ29kZUF0KGkpXSA+Pj4gKDYgLSAoaSAlIDQpICogMik7CgkgICAgICAgICAgICAgIHZhciBiaXRzQ29tYmluZWQgPSBiaXRzMSB8IGJpdHMyOwoJICAgICAgICAgICAgICB3b3Jkc1tuQnl0ZXMgPj4+IDJdIHw9IGJpdHNDb21iaW5lZCA8PCAoMjQgLSAobkJ5dGVzICUgNCkgKiA4KTsKCSAgICAgICAgICAgICAgbkJ5dGVzKys7CgkgICAgICAgICAgfQoJICAgICAgfQoJICAgICAgcmV0dXJuIFdvcmRBcnJheS5jcmVhdGUod29yZHMsIG5CeXRlcyk7CgkgICAgfQoJfSgpKTsKCgoJKGZ1bmN0aW9uIChNYXRoKSB7CgkgICAgLy8gU2hvcnRjdXRzCgkgICAgdmFyIEMgPSBDcnlwdG9KUzsKCSAgICB2YXIgQ19saWIgPSBDLmxpYjsKCSAgICB2YXIgV29yZEFycmF5ID0gQ19saWIuV29yZEFycmF5OwoJICAgIHZhciBIYXNoZXIgPSBDX2xpYi5IYXNoZXI7CgkgICAgdmFyIENfYWxnbyA9IEMuYWxnbzsKCgkgICAgLy8gQ29uc3RhbnRzIHRhYmxlCgkgICAgdmFyIFQgPSBbXTsKCgkgICAgLy8gQ29tcHV0ZSBjb25zdGFudHMKCSAgICAoZnVuY3Rpb24gKCkgewoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY0OyBpKyspIHsKCSAgICAgICAgICAgIFRbaV0gPSAoTWF0aC5hYnMoTWF0aC5zaW4oaSArIDEpKSAqIDB4MTAwMDAwMDAwKSB8IDA7CgkgICAgICAgIH0KCSAgICB9KCkpOwoKCSAgICAvKioKCSAgICAgKiBNRDUgaGFzaCBhbGdvcml0aG0uCgkgICAgICovCgkgICAgdmFyIE1ENSA9IENfYWxnby5NRDUgPSBIYXNoZXIuZXh0ZW5kKHsKCSAgICAgICAgX2RvUmVzZXQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIHRoaXMuX2hhc2ggPSBuZXcgV29yZEFycmF5LmluaXQoWwoJICAgICAgICAgICAgICAgIDB4Njc0NTIzMDEsIDB4ZWZjZGFiODksCgkgICAgICAgICAgICAgICAgMHg5OGJhZGNmZSwgMHgxMDMyNTQ3NgoJICAgICAgICAgICAgXSk7CgkgICAgICAgIH0sCgoJICAgICAgICBfZG9Qcm9jZXNzQmxvY2s6IGZ1bmN0aW9uIChNLCBvZmZzZXQpIHsKCSAgICAgICAgICAgIC8vIFN3YXAgZW5kaWFuCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDE2OyBpKyspIHsKCSAgICAgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0X2kgPSBvZmZzZXQgKyBpOwoJICAgICAgICAgICAgICAgIHZhciBNX29mZnNldF9pID0gTVtvZmZzZXRfaV07CgoJICAgICAgICAgICAgICAgIE1bb2Zmc2V0X2ldID0gKAoJICAgICAgICAgICAgICAgICAgICAoKChNX29mZnNldF9pIDw8IDgpICB8IChNX29mZnNldF9pID4+PiAyNCkpICYgMHgwMGZmMDBmZikgfAoJICAgICAgICAgICAgICAgICAgICAoKChNX29mZnNldF9pIDw8IDI0KSB8IChNX29mZnNldF9pID4+PiA4KSkgICYgMHhmZjAwZmYwMCkKCSAgICAgICAgICAgICAgICApOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIEggPSB0aGlzLl9oYXNoLndvcmRzOwoKCSAgICAgICAgICAgIHZhciBNX29mZnNldF8wICA9IE1bb2Zmc2V0ICsgMF07CgkgICAgICAgICAgICB2YXIgTV9vZmZzZXRfMSAgPSBNW29mZnNldCArIDFdOwoJICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzIgID0gTVtvZmZzZXQgKyAyXTsKCSAgICAgICAgICAgIHZhciBNX29mZnNldF8zICA9IE1bb2Zmc2V0ICsgM107CgkgICAgICAgICAgICB2YXIgTV9vZmZzZXRfNCAgPSBNW29mZnNldCArIDRdOwoJICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzUgID0gTVtvZmZzZXQgKyA1XTsKCSAgICAgICAgICAgIHZhciBNX29mZnNldF82ICA9IE1bb2Zmc2V0ICsgNl07CgkgICAgICAgICAgICB2YXIgTV9vZmZzZXRfNyAgPSBNW29mZnNldCArIDddOwoJICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzggID0gTVtvZmZzZXQgKyA4XTsKCSAgICAgICAgICAgIHZhciBNX29mZnNldF85ICA9IE1bb2Zmc2V0ICsgOV07CgkgICAgICAgICAgICB2YXIgTV9vZmZzZXRfMTAgPSBNW29mZnNldCArIDEwXTsKCSAgICAgICAgICAgIHZhciBNX29mZnNldF8xMSA9IE1bb2Zmc2V0ICsgMTFdOwoJICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzEyID0gTVtvZmZzZXQgKyAxMl07CgkgICAgICAgICAgICB2YXIgTV9vZmZzZXRfMTMgPSBNW29mZnNldCArIDEzXTsKCSAgICAgICAgICAgIHZhciBNX29mZnNldF8xNCA9IE1bb2Zmc2V0ICsgMTRdOwoJICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzE1ID0gTVtvZmZzZXQgKyAxNV07CgoJICAgICAgICAgICAgLy8gV29ya2luZyB2YXJpYWxiZXMKCSAgICAgICAgICAgIHZhciBhID0gSFswXTsKCSAgICAgICAgICAgIHZhciBiID0gSFsxXTsKCSAgICAgICAgICAgIHZhciBjID0gSFsyXTsKCSAgICAgICAgICAgIHZhciBkID0gSFszXTsKCgkgICAgICAgICAgICAvLyBDb21wdXRhdGlvbgoJICAgICAgICAgICAgYSA9IEZGKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzAsICA3LCAgVFswXSk7CgkgICAgICAgICAgICBkID0gRkYoZCwgYSwgYiwgYywgTV9vZmZzZXRfMSwgIDEyLCBUWzFdKTsKCSAgICAgICAgICAgIGMgPSBGRihjLCBkLCBhLCBiLCBNX29mZnNldF8yLCAgMTcsIFRbMl0pOwoJICAgICAgICAgICAgYiA9IEZGKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzMsICAyMiwgVFszXSk7CgkgICAgICAgICAgICBhID0gRkYoYSwgYiwgYywgZCwgTV9vZmZzZXRfNCwgIDcsICBUWzRdKTsKCSAgICAgICAgICAgIGQgPSBGRihkLCBhLCBiLCBjLCBNX29mZnNldF81LCAgMTIsIFRbNV0pOwoJICAgICAgICAgICAgYyA9IEZGKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzYsICAxNywgVFs2XSk7CgkgICAgICAgICAgICBiID0gRkYoYiwgYywgZCwgYSwgTV9vZmZzZXRfNywgIDIyLCBUWzddKTsKCSAgICAgICAgICAgIGEgPSBGRihhLCBiLCBjLCBkLCBNX29mZnNldF84LCAgNywgIFRbOF0pOwoJICAgICAgICAgICAgZCA9IEZGKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzksICAxMiwgVFs5XSk7CgkgICAgICAgICAgICBjID0gRkYoYywgZCwgYSwgYiwgTV9vZmZzZXRfMTAsIDE3LCBUWzEwXSk7CgkgICAgICAgICAgICBiID0gRkYoYiwgYywgZCwgYSwgTV9vZmZzZXRfMTEsIDIyLCBUWzExXSk7CgkgICAgICAgICAgICBhID0gRkYoYSwgYiwgYywgZCwgTV9vZmZzZXRfMTIsIDcsICBUWzEyXSk7CgkgICAgICAgICAgICBkID0gRkYoZCwgYSwgYiwgYywgTV9vZmZzZXRfMTMsIDEyLCBUWzEzXSk7CgkgICAgICAgICAgICBjID0gRkYoYywgZCwgYSwgYiwgTV9vZmZzZXRfMTQsIDE3LCBUWzE0XSk7CgkgICAgICAgICAgICBiID0gRkYoYiwgYywgZCwgYSwgTV9vZmZzZXRfMTUsIDIyLCBUWzE1XSk7CgoJICAgICAgICAgICAgYSA9IEdHKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzEsICA1LCAgVFsxNl0pOwoJICAgICAgICAgICAgZCA9IEdHKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzYsICA5LCAgVFsxN10pOwoJICAgICAgICAgICAgYyA9IEdHKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzExLCAxNCwgVFsxOF0pOwoJICAgICAgICAgICAgYiA9IEdHKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzAsICAyMCwgVFsxOV0pOwoJICAgICAgICAgICAgYSA9IEdHKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzUsICA1LCAgVFsyMF0pOwoJICAgICAgICAgICAgZCA9IEdHKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzEwLCA5LCAgVFsyMV0pOwoJICAgICAgICAgICAgYyA9IEdHKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzE1LCAxNCwgVFsyMl0pOwoJICAgICAgICAgICAgYiA9IEdHKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzQsICAyMCwgVFsyM10pOwoJICAgICAgICAgICAgYSA9IEdHKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzksICA1LCAgVFsyNF0pOwoJICAgICAgICAgICAgZCA9IEdHKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzE0LCA5LCAgVFsyNV0pOwoJICAgICAgICAgICAgYyA9IEdHKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzMsICAxNCwgVFsyNl0pOwoJICAgICAgICAgICAgYiA9IEdHKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzgsICAyMCwgVFsyN10pOwoJICAgICAgICAgICAgYSA9IEdHKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzEzLCA1LCAgVFsyOF0pOwoJICAgICAgICAgICAgZCA9IEdHKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzIsICA5LCAgVFsyOV0pOwoJICAgICAgICAgICAgYyA9IEdHKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzcsICAxNCwgVFszMF0pOwoJICAgICAgICAgICAgYiA9IEdHKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzEyLCAyMCwgVFszMV0pOwoKCSAgICAgICAgICAgIGEgPSBISChhLCBiLCBjLCBkLCBNX29mZnNldF81LCAgNCwgIFRbMzJdKTsKCSAgICAgICAgICAgIGQgPSBISChkLCBhLCBiLCBjLCBNX29mZnNldF84LCAgMTEsIFRbMzNdKTsKCSAgICAgICAgICAgIGMgPSBISChjLCBkLCBhLCBiLCBNX29mZnNldF8xMSwgMTYsIFRbMzRdKTsKCSAgICAgICAgICAgIGIgPSBISChiLCBjLCBkLCBhLCBNX29mZnNldF8xNCwgMjMsIFRbMzVdKTsKCSAgICAgICAgICAgIGEgPSBISChhLCBiLCBjLCBkLCBNX29mZnNldF8xLCAgNCwgIFRbMzZdKTsKCSAgICAgICAgICAgIGQgPSBISChkLCBhLCBiLCBjLCBNX29mZnNldF80LCAgMTEsIFRbMzddKTsKCSAgICAgICAgICAgIGMgPSBISChjLCBkLCBhLCBiLCBNX29mZnNldF83LCAgMTYsIFRbMzhdKTsKCSAgICAgICAgICAgIGIgPSBISChiLCBjLCBkLCBhLCBNX29mZnNldF8xMCwgMjMsIFRbMzldKTsKCSAgICAgICAgICAgIGEgPSBISChhLCBiLCBjLCBkLCBNX29mZnNldF8xMywgNCwgIFRbNDBdKTsKCSAgICAgICAgICAgIGQgPSBISChkLCBhLCBiLCBjLCBNX29mZnNldF8wLCAgMTEsIFRbNDFdKTsKCSAgICAgICAgICAgIGMgPSBISChjLCBkLCBhLCBiLCBNX29mZnNldF8zLCAgMTYsIFRbNDJdKTsKCSAgICAgICAgICAgIGIgPSBISChiLCBjLCBkLCBhLCBNX29mZnNldF82LCAgMjMsIFRbNDNdKTsKCSAgICAgICAgICAgIGEgPSBISChhLCBiLCBjLCBkLCBNX29mZnNldF85LCAgNCwgIFRbNDRdKTsKCSAgICAgICAgICAgIGQgPSBISChkLCBhLCBiLCBjLCBNX29mZnNldF8xMiwgMTEsIFRbNDVdKTsKCSAgICAgICAgICAgIGMgPSBISChjLCBkLCBhLCBiLCBNX29mZnNldF8xNSwgMTYsIFRbNDZdKTsKCSAgICAgICAgICAgIGIgPSBISChiLCBjLCBkLCBhLCBNX29mZnNldF8yLCAgMjMsIFRbNDddKTsKCgkgICAgICAgICAgICBhID0gSUkoYSwgYiwgYywgZCwgTV9vZmZzZXRfMCwgIDYsICBUWzQ4XSk7CgkgICAgICAgICAgICBkID0gSUkoZCwgYSwgYiwgYywgTV9vZmZzZXRfNywgIDEwLCBUWzQ5XSk7CgkgICAgICAgICAgICBjID0gSUkoYywgZCwgYSwgYiwgTV9vZmZzZXRfMTQsIDE1LCBUWzUwXSk7CgkgICAgICAgICAgICBiID0gSUkoYiwgYywgZCwgYSwgTV9vZmZzZXRfNSwgIDIxLCBUWzUxXSk7CgkgICAgICAgICAgICBhID0gSUkoYSwgYiwgYywgZCwgTV9vZmZzZXRfMTIsIDYsICBUWzUyXSk7CgkgICAgICAgICAgICBkID0gSUkoZCwgYSwgYiwgYywgTV9vZmZzZXRfMywgIDEwLCBUWzUzXSk7CgkgICAgICAgICAgICBjID0gSUkoYywgZCwgYSwgYiwgTV9vZmZzZXRfMTAsIDE1LCBUWzU0XSk7CgkgICAgICAgICAgICBiID0gSUkoYiwgYywgZCwgYSwgTV9vZmZzZXRfMSwgIDIxLCBUWzU1XSk7CgkgICAgICAgICAgICBhID0gSUkoYSwgYiwgYywgZCwgTV9vZmZzZXRfOCwgIDYsICBUWzU2XSk7CgkgICAgICAgICAgICBkID0gSUkoZCwgYSwgYiwgYywgTV9vZmZzZXRfMTUsIDEwLCBUWzU3XSk7CgkgICAgICAgICAgICBjID0gSUkoYywgZCwgYSwgYiwgTV9vZmZzZXRfNiwgIDE1LCBUWzU4XSk7CgkgICAgICAgICAgICBiID0gSUkoYiwgYywgZCwgYSwgTV9vZmZzZXRfMTMsIDIxLCBUWzU5XSk7CgkgICAgICAgICAgICBhID0gSUkoYSwgYiwgYywgZCwgTV9vZmZzZXRfNCwgIDYsICBUWzYwXSk7CgkgICAgICAgICAgICBkID0gSUkoZCwgYSwgYiwgYywgTV9vZmZzZXRfMTEsIDEwLCBUWzYxXSk7CgkgICAgICAgICAgICBjID0gSUkoYywgZCwgYSwgYiwgTV9vZmZzZXRfMiwgIDE1LCBUWzYyXSk7CgkgICAgICAgICAgICBiID0gSUkoYiwgYywgZCwgYSwgTV9vZmZzZXRfOSwgIDIxLCBUWzYzXSk7CgoJICAgICAgICAgICAgLy8gSW50ZXJtZWRpYXRlIGhhc2ggdmFsdWUKCSAgICAgICAgICAgIEhbMF0gPSAoSFswXSArIGEpIHwgMDsKCSAgICAgICAgICAgIEhbMV0gPSAoSFsxXSArIGIpIHwgMDsKCSAgICAgICAgICAgIEhbMl0gPSAoSFsyXSArIGMpIHwgMDsKCSAgICAgICAgICAgIEhbM10gPSAoSFszXSArIGQpIHwgMDsKCSAgICAgICAgfSwKCgkgICAgICAgIF9kb0ZpbmFsaXplOiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgIHZhciBkYXRhID0gdGhpcy5fZGF0YTsKCSAgICAgICAgICAgIHZhciBkYXRhV29yZHMgPSBkYXRhLndvcmRzOwoKCSAgICAgICAgICAgIHZhciBuQml0c1RvdGFsID0gdGhpcy5fbkRhdGFCeXRlcyAqIDg7CgkgICAgICAgICAgICB2YXIgbkJpdHNMZWZ0ID0gZGF0YS5zaWdCeXRlcyAqIDg7CgoJICAgICAgICAgICAgLy8gQWRkIHBhZGRpbmcKCSAgICAgICAgICAgIGRhdGFXb3Jkc1tuQml0c0xlZnQgPj4+IDVdIHw9IDB4ODAgPDwgKDI0IC0gbkJpdHNMZWZ0ICUgMzIpOwoKCSAgICAgICAgICAgIHZhciBuQml0c1RvdGFsSCA9IE1hdGguZmxvb3IobkJpdHNUb3RhbCAvIDB4MTAwMDAwMDAwKTsKCSAgICAgICAgICAgIHZhciBuQml0c1RvdGFsTCA9IG5CaXRzVG90YWw7CgkgICAgICAgICAgICBkYXRhV29yZHNbKCgobkJpdHNMZWZ0ICsgNjQpID4+PiA5KSA8PCA0KSArIDE1XSA9ICgKCSAgICAgICAgICAgICAgICAoKChuQml0c1RvdGFsSCA8PCA4KSAgfCAobkJpdHNUb3RhbEggPj4+IDI0KSkgJiAweDAwZmYwMGZmKSB8CgkgICAgICAgICAgICAgICAgKCgobkJpdHNUb3RhbEggPDwgMjQpIHwgKG5CaXRzVG90YWxIID4+PiA4KSkgICYgMHhmZjAwZmYwMCkKCSAgICAgICAgICAgICk7CgkgICAgICAgICAgICBkYXRhV29yZHNbKCgobkJpdHNMZWZ0ICsgNjQpID4+PiA5KSA8PCA0KSArIDE0XSA9ICgKCSAgICAgICAgICAgICAgICAoKChuQml0c1RvdGFsTCA8PCA4KSAgfCAobkJpdHNUb3RhbEwgPj4+IDI0KSkgJiAweDAwZmYwMGZmKSB8CgkgICAgICAgICAgICAgICAgKCgobkJpdHNUb3RhbEwgPDwgMjQpIHwgKG5CaXRzVG90YWxMID4+PiA4KSkgICYgMHhmZjAwZmYwMCkKCSAgICAgICAgICAgICk7CgoJICAgICAgICAgICAgZGF0YS5zaWdCeXRlcyA9IChkYXRhV29yZHMubGVuZ3RoICsgMSkgKiA0OwoKCSAgICAgICAgICAgIC8vIEhhc2ggZmluYWwgYmxvY2tzCgkgICAgICAgICAgICB0aGlzLl9wcm9jZXNzKCk7CgoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIgaGFzaCA9IHRoaXMuX2hhc2g7CgkgICAgICAgICAgICB2YXIgSCA9IGhhc2gud29yZHM7CgoJICAgICAgICAgICAgLy8gU3dhcCBlbmRpYW4KCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNDsgaSsrKSB7CgkgICAgICAgICAgICAgICAgLy8gU2hvcnRjdXQKCSAgICAgICAgICAgICAgICB2YXIgSF9pID0gSFtpXTsKCgkgICAgICAgICAgICAgICAgSFtpXSA9ICgoKEhfaSA8PCA4KSAgfCAoSF9pID4+PiAyNCkpICYgMHgwMGZmMDBmZikgfAoJICAgICAgICAgICAgICAgICAgICAgICAoKChIX2kgPDwgMjQpIHwgKEhfaSA+Pj4gOCkpICAmIDB4ZmYwMGZmMDApOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIFJldHVybiBmaW5hbCBjb21wdXRlZCBoYXNoCgkgICAgICAgICAgICByZXR1cm4gaGFzaDsKCSAgICAgICAgfSwKCgkgICAgICAgIGNsb25lOiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB2YXIgY2xvbmUgPSBIYXNoZXIuY2xvbmUuY2FsbCh0aGlzKTsKCSAgICAgICAgICAgIGNsb25lLl9oYXNoID0gdGhpcy5faGFzaC5jbG9uZSgpOwoKCSAgICAgICAgICAgIHJldHVybiBjbG9uZTsKCSAgICAgICAgfQoJICAgIH0pOwoKCSAgICBmdW5jdGlvbiBGRihhLCBiLCBjLCBkLCB4LCBzLCB0KSB7CgkgICAgICAgIHZhciBuID0gYSArICgoYiAmIGMpIHwgKH5iICYgZCkpICsgeCArIHQ7CgkgICAgICAgIHJldHVybiAoKG4gPDwgcykgfCAobiA+Pj4gKDMyIC0gcykpKSArIGI7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBHRyhhLCBiLCBjLCBkLCB4LCBzLCB0KSB7CgkgICAgICAgIHZhciBuID0gYSArICgoYiAmIGQpIHwgKGMgJiB+ZCkpICsgeCArIHQ7CgkgICAgICAgIHJldHVybiAoKG4gPDwgcykgfCAobiA+Pj4gKDMyIC0gcykpKSArIGI7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBISChhLCBiLCBjLCBkLCB4LCBzLCB0KSB7CgkgICAgICAgIHZhciBuID0gYSArIChiIF4gYyBeIGQpICsgeCArIHQ7CgkgICAgICAgIHJldHVybiAoKG4gPDwgcykgfCAobiA+Pj4gKDMyIC0gcykpKSArIGI7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBJSShhLCBiLCBjLCBkLCB4LCBzLCB0KSB7CgkgICAgICAgIHZhciBuID0gYSArIChjIF4gKGIgfCB+ZCkpICsgeCArIHQ7CgkgICAgICAgIHJldHVybiAoKG4gPDwgcykgfCAobiA+Pj4gKDMyIC0gcykpKSArIGI7CgkgICAgfQoKCSAgICAvKioKCSAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgaGFzaGVyJ3Mgb2JqZWN0IGludGVyZmFjZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBoYXNoLgoJICAgICAqCgkgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgaGFzaC4KCSAgICAgKgoJICAgICAqIEBzdGF0aWMKCSAgICAgKgoJICAgICAqIEBleGFtcGxlCgkgICAgICoKCSAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5NRDUoJ21lc3NhZ2UnKTsKCSAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5NRDUod29yZEFycmF5KTsKCSAgICAgKi8KCSAgICBDLk1ENSA9IEhhc2hlci5fY3JlYXRlSGVscGVyKE1ENSk7CgoJICAgIC8qKgoJICAgICAqIFNob3J0Y3V0IGZ1bmN0aW9uIHRvIHRoZSBITUFDJ3Mgb2JqZWN0IGludGVyZmFjZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBoYXNoLgoJICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30ga2V5IFRoZSBzZWNyZXQga2V5LgoJICAgICAqCgkgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgSE1BQy4KCSAgICAgKgoJICAgICAqIEBzdGF0aWMKCSAgICAgKgoJICAgICAqIEBleGFtcGxlCgkgICAgICoKCSAgICAgKiAgICAgdmFyIGhtYWMgPSBDcnlwdG9KUy5IbWFjTUQ1KG1lc3NhZ2UsIGtleSk7CgkgICAgICovCgkgICAgQy5IbWFjTUQ1ID0gSGFzaGVyLl9jcmVhdGVIbWFjSGVscGVyKE1ENSk7Cgl9KE1hdGgpKTsKCgoJKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBTaG9ydGN1dHMKCSAgICB2YXIgQyA9IENyeXB0b0pTOwoJICAgIHZhciBDX2xpYiA9IEMubGliOwoJICAgIHZhciBXb3JkQXJyYXkgPSBDX2xpYi5Xb3JkQXJyYXk7CgkgICAgdmFyIEhhc2hlciA9IENfbGliLkhhc2hlcjsKCSAgICB2YXIgQ19hbGdvID0gQy5hbGdvOwoKCSAgICAvLyBSZXVzYWJsZSBvYmplY3QKCSAgICB2YXIgVyA9IFtdOwoKCSAgICAvKioKCSAgICAgKiBTSEEtMSBoYXNoIGFsZ29yaXRobS4KCSAgICAgKi8KCSAgICB2YXIgU0hBMSA9IENfYWxnby5TSEExID0gSGFzaGVyLmV4dGVuZCh7CgkgICAgICAgIF9kb1Jlc2V0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB0aGlzLl9oYXNoID0gbmV3IFdvcmRBcnJheS5pbml0KFsKCSAgICAgICAgICAgICAgICAweDY3NDUyMzAxLCAweGVmY2RhYjg5LAoJICAgICAgICAgICAgICAgIDB4OThiYWRjZmUsIDB4MTAzMjU0NzYsCgkgICAgICAgICAgICAgICAgMHhjM2QyZTFmMAoJICAgICAgICAgICAgXSk7CgkgICAgICAgIH0sCgoJICAgICAgICBfZG9Qcm9jZXNzQmxvY2s6IGZ1bmN0aW9uIChNLCBvZmZzZXQpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0CgkgICAgICAgICAgICB2YXIgSCA9IHRoaXMuX2hhc2gud29yZHM7CgoJICAgICAgICAgICAgLy8gV29ya2luZyB2YXJpYWJsZXMKCSAgICAgICAgICAgIHZhciBhID0gSFswXTsKCSAgICAgICAgICAgIHZhciBiID0gSFsxXTsKCSAgICAgICAgICAgIHZhciBjID0gSFsyXTsKCSAgICAgICAgICAgIHZhciBkID0gSFszXTsKCSAgICAgICAgICAgIHZhciBlID0gSFs0XTsKCgkgICAgICAgICAgICAvLyBDb21wdXRhdGlvbgoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA4MDsgaSsrKSB7CgkgICAgICAgICAgICAgICAgaWYgKGkgPCAxNikgewoJICAgICAgICAgICAgICAgICAgICBXW2ldID0gTVtvZmZzZXQgKyBpXSB8IDA7CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBXW2kgLSAzXSBeIFdbaSAtIDhdIF4gV1tpIC0gMTRdIF4gV1tpIC0gMTZdOwoJICAgICAgICAgICAgICAgICAgICBXW2ldID0gKG4gPDwgMSkgfCAobiA+Pj4gMzEpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgdmFyIHQgPSAoKGEgPDwgNSkgfCAoYSA+Pj4gMjcpKSArIGUgKyBXW2ldOwoJICAgICAgICAgICAgICAgIGlmIChpIDwgMjApIHsKCSAgICAgICAgICAgICAgICAgICAgdCArPSAoKGIgJiBjKSB8ICh+YiAmIGQpKSArIDB4NWE4Mjc5OTk7CgkgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpIDwgNDApIHsKCSAgICAgICAgICAgICAgICAgICAgdCArPSAoYiBeIGMgXiBkKSArIDB4NmVkOWViYTE7CgkgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpIDwgNjApIHsKCSAgICAgICAgICAgICAgICAgICAgdCArPSAoKGIgJiBjKSB8IChiICYgZCkgfCAoYyAmIGQpKSAtIDB4NzBlNDQzMjQ7CgkgICAgICAgICAgICAgICAgfSBlbHNlIC8qIGlmIChpIDwgODApICovIHsKCSAgICAgICAgICAgICAgICAgICAgdCArPSAoYiBeIGMgXiBkKSAtIDB4MzU5ZDNlMmE7CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICBlID0gZDsKCSAgICAgICAgICAgICAgICBkID0gYzsKCSAgICAgICAgICAgICAgICBjID0gKGIgPDwgMzApIHwgKGIgPj4+IDIpOwoJICAgICAgICAgICAgICAgIGIgPSBhOwoJICAgICAgICAgICAgICAgIGEgPSB0OwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIEludGVybWVkaWF0ZSBoYXNoIHZhbHVlCgkgICAgICAgICAgICBIWzBdID0gKEhbMF0gKyBhKSB8IDA7CgkgICAgICAgICAgICBIWzFdID0gKEhbMV0gKyBiKSB8IDA7CgkgICAgICAgICAgICBIWzJdID0gKEhbMl0gKyBjKSB8IDA7CgkgICAgICAgICAgICBIWzNdID0gKEhbM10gKyBkKSB8IDA7CgkgICAgICAgICAgICBIWzRdID0gKEhbNF0gKyBlKSB8IDA7CgkgICAgICAgIH0sCgoJICAgICAgICBfZG9GaW5hbGl6ZTogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX2RhdGE7CgkgICAgICAgICAgICB2YXIgZGF0YVdvcmRzID0gZGF0YS53b3JkczsKCgkgICAgICAgICAgICB2YXIgbkJpdHNUb3RhbCA9IHRoaXMuX25EYXRhQnl0ZXMgKiA4OwoJICAgICAgICAgICAgdmFyIG5CaXRzTGVmdCA9IGRhdGEuc2lnQnl0ZXMgKiA4OwoKCSAgICAgICAgICAgIC8vIEFkZCBwYWRkaW5nCgkgICAgICAgICAgICBkYXRhV29yZHNbbkJpdHNMZWZ0ID4+PiA1XSB8PSAweDgwIDw8ICgyNCAtIG5CaXRzTGVmdCAlIDMyKTsKCSAgICAgICAgICAgIGRhdGFXb3Jkc1soKChuQml0c0xlZnQgKyA2NCkgPj4+IDkpIDw8IDQpICsgMTRdID0gTWF0aC5mbG9vcihuQml0c1RvdGFsIC8gMHgxMDAwMDAwMDApOwoJICAgICAgICAgICAgZGF0YVdvcmRzWygoKG5CaXRzTGVmdCArIDY0KSA+Pj4gOSkgPDwgNCkgKyAxNV0gPSBuQml0c1RvdGFsOwoJICAgICAgICAgICAgZGF0YS5zaWdCeXRlcyA9IGRhdGFXb3Jkcy5sZW5ndGggKiA0OwoKCSAgICAgICAgICAgIC8vIEhhc2ggZmluYWwgYmxvY2tzCgkgICAgICAgICAgICB0aGlzLl9wcm9jZXNzKCk7CgoJICAgICAgICAgICAgLy8gUmV0dXJuIGZpbmFsIGNvbXB1dGVkIGhhc2gKCSAgICAgICAgICAgIHJldHVybiB0aGlzLl9oYXNoOwoJICAgICAgICB9LAoKCSAgICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIHZhciBjbG9uZSA9IEhhc2hlci5jbG9uZS5jYWxsKHRoaXMpOwoJICAgICAgICAgICAgY2xvbmUuX2hhc2ggPSB0aGlzLl9oYXNoLmNsb25lKCk7CgoJICAgICAgICAgICAgcmV0dXJuIGNsb25lOwoJICAgICAgICB9CgkgICAgfSk7CgoJICAgIC8qKgoJICAgICAqIFNob3J0Y3V0IGZ1bmN0aW9uIHRvIHRoZSBoYXNoZXIncyBvYmplY3QgaW50ZXJmYWNlLgoJICAgICAqCgkgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIGhhc2guCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBoYXNoLgoJICAgICAqCgkgICAgICogQHN0YXRpYwoJICAgICAqCgkgICAgICogQGV4YW1wbGUKCSAgICAgKgoJICAgICAqICAgICB2YXIgaGFzaCA9IENyeXB0b0pTLlNIQTEoJ21lc3NhZ2UnKTsKCSAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5TSEExKHdvcmRBcnJheSk7CgkgICAgICovCgkgICAgQy5TSEExID0gSGFzaGVyLl9jcmVhdGVIZWxwZXIoU0hBMSk7CgoJICAgIC8qKgoJICAgICAqIFNob3J0Y3V0IGZ1bmN0aW9uIHRvIHRoZSBITUFDJ3Mgb2JqZWN0IGludGVyZmFjZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBoYXNoLgoJICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30ga2V5IFRoZSBzZWNyZXQga2V5LgoJICAgICAqCgkgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgSE1BQy4KCSAgICAgKgoJICAgICAqIEBzdGF0aWMKCSAgICAgKgoJICAgICAqIEBleGFtcGxlCgkgICAgICoKCSAgICAgKiAgICAgdmFyIGhtYWMgPSBDcnlwdG9KUy5IbWFjU0hBMShtZXNzYWdlLCBrZXkpOwoJICAgICAqLwoJICAgIEMuSG1hY1NIQTEgPSBIYXNoZXIuX2NyZWF0ZUhtYWNIZWxwZXIoU0hBMSk7Cgl9KCkpOwoKCgkoZnVuY3Rpb24gKE1hdGgpIHsKCSAgICAvLyBTaG9ydGN1dHMKCSAgICB2YXIgQyA9IENyeXB0b0pTOwoJICAgIHZhciBDX2xpYiA9IEMubGliOwoJICAgIHZhciBXb3JkQXJyYXkgPSBDX2xpYi5Xb3JkQXJyYXk7CgkgICAgdmFyIEhhc2hlciA9IENfbGliLkhhc2hlcjsKCSAgICB2YXIgQ19hbGdvID0gQy5hbGdvOwoKCSAgICAvLyBJbml0aWFsaXphdGlvbiBhbmQgcm91bmQgY29uc3RhbnRzIHRhYmxlcwoJICAgIHZhciBIID0gW107CgkgICAgdmFyIEsgPSBbXTsKCgkgICAgLy8gQ29tcHV0ZSBjb25zdGFudHMKCSAgICAoZnVuY3Rpb24gKCkgewoJICAgICAgICBmdW5jdGlvbiBpc1ByaW1lKG4pIHsKCSAgICAgICAgICAgIHZhciBzcXJ0TiA9IE1hdGguc3FydChuKTsKCSAgICAgICAgICAgIGZvciAodmFyIGZhY3RvciA9IDI7IGZhY3RvciA8PSBzcXJ0TjsgZmFjdG9yKyspIHsKCSAgICAgICAgICAgICAgICBpZiAoIShuICUgZmFjdG9yKSkgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJldHVybiB0cnVlOwoJICAgICAgICB9CgoJICAgICAgICBmdW5jdGlvbiBnZXRGcmFjdGlvbmFsQml0cyhuKSB7CgkgICAgICAgICAgICByZXR1cm4gKChuIC0gKG4gfCAwKSkgKiAweDEwMDAwMDAwMCkgfCAwOwoJICAgICAgICB9CgoJICAgICAgICB2YXIgbiA9IDI7CgkgICAgICAgIHZhciBuUHJpbWUgPSAwOwoJICAgICAgICB3aGlsZSAoblByaW1lIDwgNjQpIHsKCSAgICAgICAgICAgIGlmIChpc1ByaW1lKG4pKSB7CgkgICAgICAgICAgICAgICAgaWYgKG5QcmltZSA8IDgpIHsKCSAgICAgICAgICAgICAgICAgICAgSFtuUHJpbWVdID0gZ2V0RnJhY3Rpb25hbEJpdHMoTWF0aC5wb3cobiwgMSAvIDIpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgS1tuUHJpbWVdID0gZ2V0RnJhY3Rpb25hbEJpdHMoTWF0aC5wb3cobiwgMSAvIDMpKTsKCgkgICAgICAgICAgICAgICAgblByaW1lKys7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgbisrOwoJICAgICAgICB9CgkgICAgfSgpKTsKCgkgICAgLy8gUmV1c2FibGUgb2JqZWN0CgkgICAgdmFyIFcgPSBbXTsKCgkgICAgLyoqCgkgICAgICogU0hBLTI1NiBoYXNoIGFsZ29yaXRobS4KCSAgICAgKi8KCSAgICB2YXIgU0hBMjU2ID0gQ19hbGdvLlNIQTI1NiA9IEhhc2hlci5leHRlbmQoewoJICAgICAgICBfZG9SZXNldDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgdGhpcy5faGFzaCA9IG5ldyBXb3JkQXJyYXkuaW5pdChILnNsaWNlKDApKTsKCSAgICAgICAgfSwKCgkgICAgICAgIF9kb1Byb2Nlc3NCbG9jazogZnVuY3Rpb24gKE0sIG9mZnNldCkgewoJICAgICAgICAgICAgLy8gU2hvcnRjdXQKCSAgICAgICAgICAgIHZhciBIID0gdGhpcy5faGFzaC53b3JkczsKCgkgICAgICAgICAgICAvLyBXb3JraW5nIHZhcmlhYmxlcwoJICAgICAgICAgICAgdmFyIGEgPSBIWzBdOwoJICAgICAgICAgICAgdmFyIGIgPSBIWzFdOwoJICAgICAgICAgICAgdmFyIGMgPSBIWzJdOwoJICAgICAgICAgICAgdmFyIGQgPSBIWzNdOwoJICAgICAgICAgICAgdmFyIGUgPSBIWzRdOwoJICAgICAgICAgICAgdmFyIGYgPSBIWzVdOwoJICAgICAgICAgICAgdmFyIGcgPSBIWzZdOwoJICAgICAgICAgICAgdmFyIGggPSBIWzddOwoKCSAgICAgICAgICAgIC8vIENvbXB1dGF0aW9uCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY0OyBpKyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaSA8IDE2KSB7CgkgICAgICAgICAgICAgICAgICAgIFdbaV0gPSBNW29mZnNldCArIGldIHwgMDsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICB2YXIgZ2FtbWEweCA9IFdbaSAtIDE1XTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGdhbW1hMCAgPSAoKGdhbW1hMHggPDwgMjUpIHwgKGdhbW1hMHggPj4+IDcpKSAgXgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoZ2FtbWEweCA8PCAxNCkgfCAoZ2FtbWEweCA+Pj4gMTgpKSBeCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChnYW1tYTB4ID4+PiAzKTsKCgkgICAgICAgICAgICAgICAgICAgIHZhciBnYW1tYTF4ID0gV1tpIC0gMl07CgkgICAgICAgICAgICAgICAgICAgIHZhciBnYW1tYTEgID0gKChnYW1tYTF4IDw8IDE1KSB8IChnYW1tYTF4ID4+PiAxNykpIF4KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKGdhbW1hMXggPDwgMTMpIHwgKGdhbW1hMXggPj4+IDE5KSkgXgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZ2FtbWExeCA+Pj4gMTApOwoKCSAgICAgICAgICAgICAgICAgICAgV1tpXSA9IGdhbW1hMCArIFdbaSAtIDddICsgZ2FtbWExICsgV1tpIC0gMTZdOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgdmFyIGNoICA9IChlICYgZikgXiAofmUgJiBnKTsKCSAgICAgICAgICAgICAgICB2YXIgbWFqID0gKGEgJiBiKSBeIChhICYgYykgXiAoYiAmIGMpOwoKCSAgICAgICAgICAgICAgICB2YXIgc2lnbWEwID0gKChhIDw8IDMwKSB8IChhID4+PiAyKSkgXiAoKGEgPDwgMTkpIHwgKGEgPj4+IDEzKSkgXiAoKGEgPDwgMTApIHwgKGEgPj4+IDIyKSk7CgkgICAgICAgICAgICAgICAgdmFyIHNpZ21hMSA9ICgoZSA8PCAyNikgfCAoZSA+Pj4gNikpIF4gKChlIDw8IDIxKSB8IChlID4+PiAxMSkpIF4gKChlIDw8IDcpICB8IChlID4+PiAyNSkpOwoKCSAgICAgICAgICAgICAgICB2YXIgdDEgPSBoICsgc2lnbWExICsgY2ggKyBLW2ldICsgV1tpXTsKCSAgICAgICAgICAgICAgICB2YXIgdDIgPSBzaWdtYTAgKyBtYWo7CgoJICAgICAgICAgICAgICAgIGggPSBnOwoJICAgICAgICAgICAgICAgIGcgPSBmOwoJICAgICAgICAgICAgICAgIGYgPSBlOwoJICAgICAgICAgICAgICAgIGUgPSAoZCArIHQxKSB8IDA7CgkgICAgICAgICAgICAgICAgZCA9IGM7CgkgICAgICAgICAgICAgICAgYyA9IGI7CgkgICAgICAgICAgICAgICAgYiA9IGE7CgkgICAgICAgICAgICAgICAgYSA9ICh0MSArIHQyKSB8IDA7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gSW50ZXJtZWRpYXRlIGhhc2ggdmFsdWUKCSAgICAgICAgICAgIEhbMF0gPSAoSFswXSArIGEpIHwgMDsKCSAgICAgICAgICAgIEhbMV0gPSAoSFsxXSArIGIpIHwgMDsKCSAgICAgICAgICAgIEhbMl0gPSAoSFsyXSArIGMpIHwgMDsKCSAgICAgICAgICAgIEhbM10gPSAoSFszXSArIGQpIHwgMDsKCSAgICAgICAgICAgIEhbNF0gPSAoSFs0XSArIGUpIHwgMDsKCSAgICAgICAgICAgIEhbNV0gPSAoSFs1XSArIGYpIHwgMDsKCSAgICAgICAgICAgIEhbNl0gPSAoSFs2XSArIGcpIHwgMDsKCSAgICAgICAgICAgIEhbN10gPSAoSFs3XSArIGgpIHwgMDsKCSAgICAgICAgfSwKCgkgICAgICAgIF9kb0ZpbmFsaXplOiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgIHZhciBkYXRhID0gdGhpcy5fZGF0YTsKCSAgICAgICAgICAgIHZhciBkYXRhV29yZHMgPSBkYXRhLndvcmRzOwoKCSAgICAgICAgICAgIHZhciBuQml0c1RvdGFsID0gdGhpcy5fbkRhdGFCeXRlcyAqIDg7CgkgICAgICAgICAgICB2YXIgbkJpdHNMZWZ0ID0gZGF0YS5zaWdCeXRlcyAqIDg7CgoJICAgICAgICAgICAgLy8gQWRkIHBhZGRpbmcKCSAgICAgICAgICAgIGRhdGFXb3Jkc1tuQml0c0xlZnQgPj4+IDVdIHw9IDB4ODAgPDwgKDI0IC0gbkJpdHNMZWZ0ICUgMzIpOwoJICAgICAgICAgICAgZGF0YVdvcmRzWygoKG5CaXRzTGVmdCArIDY0KSA+Pj4gOSkgPDwgNCkgKyAxNF0gPSBNYXRoLmZsb29yKG5CaXRzVG90YWwgLyAweDEwMDAwMDAwMCk7CgkgICAgICAgICAgICBkYXRhV29yZHNbKCgobkJpdHNMZWZ0ICsgNjQpID4+PiA5KSA8PCA0KSArIDE1XSA9IG5CaXRzVG90YWw7CgkgICAgICAgICAgICBkYXRhLnNpZ0J5dGVzID0gZGF0YVdvcmRzLmxlbmd0aCAqIDQ7CgoJICAgICAgICAgICAgLy8gSGFzaCBmaW5hbCBibG9ja3MKCSAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3MoKTsKCgkgICAgICAgICAgICAvLyBSZXR1cm4gZmluYWwgY29tcHV0ZWQgaGFzaAoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhc2g7CgkgICAgICAgIH0sCgoJICAgICAgICBjbG9uZTogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgdmFyIGNsb25lID0gSGFzaGVyLmNsb25lLmNhbGwodGhpcyk7CgkgICAgICAgICAgICBjbG9uZS5faGFzaCA9IHRoaXMuX2hhc2guY2xvbmUoKTsKCgkgICAgICAgICAgICByZXR1cm4gY2xvbmU7CgkgICAgICAgIH0KCSAgICB9KTsKCgkgICAgLyoqCgkgICAgICogU2hvcnRjdXQgZnVuY3Rpb24gdG8gdGhlIGhhc2hlcidzIG9iamVjdCBpbnRlcmZhY2UuCgkgICAgICoKCSAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gaGFzaC4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGhhc2guCgkgICAgICoKCSAgICAgKiBAc3RhdGljCgkgICAgICoKCSAgICAgKiBAZXhhbXBsZQoJICAgICAqCgkgICAgICogICAgIHZhciBoYXNoID0gQ3J5cHRvSlMuU0hBMjU2KCdtZXNzYWdlJyk7CgkgICAgICogICAgIHZhciBoYXNoID0gQ3J5cHRvSlMuU0hBMjU2KHdvcmRBcnJheSk7CgkgICAgICovCgkgICAgQy5TSEEyNTYgPSBIYXNoZXIuX2NyZWF0ZUhlbHBlcihTSEEyNTYpOwoKCSAgICAvKioKCSAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgSE1BQydzIG9iamVjdCBpbnRlcmZhY2UuCgkgICAgICoKCSAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gaGFzaC4KCSAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IGtleSBUaGUgc2VjcmV0IGtleS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIEhNQUMuCgkgICAgICoKCSAgICAgKiBAc3RhdGljCgkgICAgICoKCSAgICAgKiBAZXhhbXBsZQoJICAgICAqCgkgICAgICogICAgIHZhciBobWFjID0gQ3J5cHRvSlMuSG1hY1NIQTI1NihtZXNzYWdlLCBrZXkpOwoJICAgICAqLwoJICAgIEMuSG1hY1NIQTI1NiA9IEhhc2hlci5fY3JlYXRlSG1hY0hlbHBlcihTSEEyNTYpOwoJfShNYXRoKSk7CgoKCShmdW5jdGlvbiAoKSB7CgkgICAgLy8gU2hvcnRjdXRzCgkgICAgdmFyIEMgPSBDcnlwdG9KUzsKCSAgICB2YXIgQ19saWIgPSBDLmxpYjsKCSAgICB2YXIgV29yZEFycmF5ID0gQ19saWIuV29yZEFycmF5OwoJICAgIHZhciBDX2VuYyA9IEMuZW5jOwoKCSAgICAvKioKCSAgICAgKiBVVEYtMTYgQkUgZW5jb2Rpbmcgc3RyYXRlZ3kuCgkgICAgICovCgkgICAgdmFyIFV0ZjE2QkUgPSBDX2VuYy5VdGYxNiA9IENfZW5jLlV0ZjE2QkUgPSB7CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBDb252ZXJ0cyBhIHdvcmQgYXJyYXkgdG8gYSBVVEYtMTYgQkUgc3RyaW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0gd29yZEFycmF5IFRoZSB3b3JkIGFycmF5LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBVVEYtMTYgQkUgc3RyaW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgdXRmMTZTdHJpbmcgPSBDcnlwdG9KUy5lbmMuVXRmMTYuc3RyaW5naWZ5KHdvcmRBcnJheSk7CgkgICAgICAgICAqLwoJICAgICAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uICh3b3JkQXJyYXkpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIHdvcmRzID0gd29yZEFycmF5LndvcmRzOwoJICAgICAgICAgICAgdmFyIHNpZ0J5dGVzID0gd29yZEFycmF5LnNpZ0J5dGVzOwoKCSAgICAgICAgICAgIC8vIENvbnZlcnQKCSAgICAgICAgICAgIHZhciB1dGYxNkNoYXJzID0gW107CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpZ0J5dGVzOyBpICs9IDIpIHsKCSAgICAgICAgICAgICAgICB2YXIgY29kZVBvaW50ID0gKHdvcmRzW2kgPj4+IDJdID4+PiAoMTYgLSAoaSAlIDQpICogOCkpICYgMHhmZmZmOwoJICAgICAgICAgICAgICAgIHV0ZjE2Q2hhcnMucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGVQb2ludCkpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJldHVybiB1dGYxNkNoYXJzLmpvaW4oJycpOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENvbnZlcnRzIGEgVVRGLTE2IEJFIHN0cmluZyB0byBhIHdvcmQgYXJyYXkuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1dGYxNlN0ciBUaGUgVVRGLTE2IEJFIHN0cmluZy4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgd29yZCBhcnJheS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHN0YXRpYwoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIHdvcmRBcnJheSA9IENyeXB0b0pTLmVuYy5VdGYxNi5wYXJzZSh1dGYxNlN0cmluZyk7CgkgICAgICAgICAqLwoJICAgICAgICBwYXJzZTogZnVuY3Rpb24gKHV0ZjE2U3RyKSB7CgkgICAgICAgICAgICAvLyBTaG9ydGN1dAoJICAgICAgICAgICAgdmFyIHV0ZjE2U3RyTGVuZ3RoID0gdXRmMTZTdHIubGVuZ3RoOwoKCSAgICAgICAgICAgIC8vIENvbnZlcnQKCSAgICAgICAgICAgIHZhciB3b3JkcyA9IFtdOwoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB1dGYxNlN0ckxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICAgICAgd29yZHNbaSA+Pj4gMV0gfD0gdXRmMTZTdHIuY2hhckNvZGVBdChpKSA8PCAoMTYgLSAoaSAlIDIpICogMTYpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJldHVybiBXb3JkQXJyYXkuY3JlYXRlKHdvcmRzLCB1dGYxNlN0ckxlbmd0aCAqIDIpOwoJICAgICAgICB9CgkgICAgfTsKCgkgICAgLyoqCgkgICAgICogVVRGLTE2IExFIGVuY29kaW5nIHN0cmF0ZWd5LgoJICAgICAqLwoJICAgIENfZW5jLlV0ZjE2TEUgPSB7CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBDb252ZXJ0cyBhIHdvcmQgYXJyYXkgdG8gYSBVVEYtMTYgTEUgc3RyaW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0gd29yZEFycmF5IFRoZSB3b3JkIGFycmF5LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBVVEYtMTYgTEUgc3RyaW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgdXRmMTZTdHIgPSBDcnlwdG9KUy5lbmMuVXRmMTZMRS5zdHJpbmdpZnkod29yZEFycmF5KTsKCSAgICAgICAgICovCgkgICAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24gKHdvcmRBcnJheSkgewoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIgd29yZHMgPSB3b3JkQXJyYXkud29yZHM7CgkgICAgICAgICAgICB2YXIgc2lnQnl0ZXMgPSB3b3JkQXJyYXkuc2lnQnl0ZXM7CgoJICAgICAgICAgICAgLy8gQ29udmVydAoJICAgICAgICAgICAgdmFyIHV0ZjE2Q2hhcnMgPSBbXTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2lnQnl0ZXM7IGkgKz0gMikgewoJICAgICAgICAgICAgICAgIHZhciBjb2RlUG9pbnQgPSBzd2FwRW5kaWFuKCh3b3Jkc1tpID4+PiAyXSA+Pj4gKDE2IC0gKGkgJSA0KSAqIDgpKSAmIDB4ZmZmZik7CgkgICAgICAgICAgICAgICAgdXRmMTZDaGFycy5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZVBvaW50KSk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgcmV0dXJuIHV0ZjE2Q2hhcnMuam9pbignJyk7CgkgICAgICAgIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogQ29udmVydHMgYSBVVEYtMTYgTEUgc3RyaW5nIHRvIGEgd29yZCBhcnJheS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHV0ZjE2U3RyIFRoZSBVVEYtMTYgTEUgc3RyaW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSB3b3JkIGFycmF5LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMuZW5jLlV0ZjE2TEUucGFyc2UodXRmMTZTdHIpOwoJICAgICAgICAgKi8KCSAgICAgICAgcGFyc2U6IGZ1bmN0aW9uICh1dGYxNlN0cikgewoJICAgICAgICAgICAgLy8gU2hvcnRjdXQKCSAgICAgICAgICAgIHZhciB1dGYxNlN0ckxlbmd0aCA9IHV0ZjE2U3RyLmxlbmd0aDsKCgkgICAgICAgICAgICAvLyBDb252ZXJ0CgkgICAgICAgICAgICB2YXIgd29yZHMgPSBbXTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdXRmMTZTdHJMZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgICAgIHdvcmRzW2kgPj4+IDFdIHw9IHN3YXBFbmRpYW4odXRmMTZTdHIuY2hhckNvZGVBdChpKSA8PCAoMTYgLSAoaSAlIDIpICogMTYpKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXR1cm4gV29yZEFycmF5LmNyZWF0ZSh3b3JkcywgdXRmMTZTdHJMZW5ndGggKiAyKTsKCSAgICAgICAgfQoJICAgIH07CgoJICAgIGZ1bmN0aW9uIHN3YXBFbmRpYW4od29yZCkgewoJICAgICAgICByZXR1cm4gKCh3b3JkIDw8IDgpICYgMHhmZjAwZmYwMCkgfCAoKHdvcmQgPj4+IDgpICYgMHgwMGZmMDBmZik7CgkgICAgfQoJfSgpKTsKCgoJKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBDaGVjayBpZiB0eXBlZCBhcnJheXMgYXJlIHN1cHBvcnRlZAoJICAgIGlmICh0eXBlb2YgQXJyYXlCdWZmZXIgIT0gJ2Z1bmN0aW9uJykgewoJICAgICAgICByZXR1cm47CgkgICAgfQoKCSAgICAvLyBTaG9ydGN1dHMKCSAgICB2YXIgQyA9IENyeXB0b0pTOwoJICAgIHZhciBDX2xpYiA9IEMubGliOwoJICAgIHZhciBXb3JkQXJyYXkgPSBDX2xpYi5Xb3JkQXJyYXk7CgoJICAgIC8vIFJlZmVyZW5jZSBvcmlnaW5hbCBpbml0CgkgICAgdmFyIHN1cGVySW5pdCA9IFdvcmRBcnJheS5pbml0OwoKCSAgICAvLyBBdWdtZW50IFdvcmRBcnJheS5pbml0IHRvIGhhbmRsZSB0eXBlZCBhcnJheXMKCSAgICB2YXIgc3ViSW5pdCA9IFdvcmRBcnJheS5pbml0ID0gZnVuY3Rpb24gKHR5cGVkQXJyYXkpIHsKCSAgICAgICAgLy8gQ29udmVydCBidWZmZXJzIHRvIHVpbnQ4CgkgICAgICAgIGlmICh0eXBlZEFycmF5IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHsKCSAgICAgICAgICAgIHR5cGVkQXJyYXkgPSBuZXcgVWludDhBcnJheSh0eXBlZEFycmF5KTsKCSAgICAgICAgfQoKCSAgICAgICAgLy8gQ29udmVydCBvdGhlciBhcnJheSB2aWV3cyB0byB1aW50OAoJICAgICAgICBpZiAoCgkgICAgICAgICAgICB0eXBlZEFycmF5IGluc3RhbmNlb2YgSW50OEFycmF5IHx8CgkgICAgICAgICAgICAodHlwZW9mIFVpbnQ4Q2xhbXBlZEFycmF5ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlZEFycmF5IGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXkpIHx8CgkgICAgICAgICAgICB0eXBlZEFycmF5IGluc3RhbmNlb2YgSW50MTZBcnJheSB8fAoJICAgICAgICAgICAgdHlwZWRBcnJheSBpbnN0YW5jZW9mIFVpbnQxNkFycmF5IHx8CgkgICAgICAgICAgICB0eXBlZEFycmF5IGluc3RhbmNlb2YgSW50MzJBcnJheSB8fAoJICAgICAgICAgICAgdHlwZWRBcnJheSBpbnN0YW5jZW9mIFVpbnQzMkFycmF5IHx8CgkgICAgICAgICAgICB0eXBlZEFycmF5IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5IHx8CgkgICAgICAgICAgICB0eXBlZEFycmF5IGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5CgkgICAgICAgICkgewoJICAgICAgICAgICAgdHlwZWRBcnJheSA9IG5ldyBVaW50OEFycmF5KHR5cGVkQXJyYXkuYnVmZmVyLCB0eXBlZEFycmF5LmJ5dGVPZmZzZXQsIHR5cGVkQXJyYXkuYnl0ZUxlbmd0aCk7CgkgICAgICAgIH0KCgkgICAgICAgIC8vIEhhbmRsZSBVaW50OEFycmF5CgkgICAgICAgIGlmICh0eXBlZEFycmF5IGluc3RhbmNlb2YgVWludDhBcnJheSkgewoJICAgICAgICAgICAgLy8gU2hvcnRjdXQKCSAgICAgICAgICAgIHZhciB0eXBlZEFycmF5Qnl0ZUxlbmd0aCA9IHR5cGVkQXJyYXkuYnl0ZUxlbmd0aDsKCgkgICAgICAgICAgICAvLyBFeHRyYWN0IGJ5dGVzCgkgICAgICAgICAgICB2YXIgd29yZHMgPSBbXTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHlwZWRBcnJheUJ5dGVMZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgICAgIHdvcmRzW2kgPj4+IDJdIHw9IHR5cGVkQXJyYXlbaV0gPDwgKDI0IC0gKGkgJSA0KSAqIDgpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIEluaXRpYWxpemUgdGhpcyB3b3JkIGFycmF5CgkgICAgICAgICAgICBzdXBlckluaXQuY2FsbCh0aGlzLCB3b3JkcywgdHlwZWRBcnJheUJ5dGVMZW5ndGgpOwoJICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgLy8gRWxzZSBjYWxsIG5vcm1hbCBpbml0CgkgICAgICAgICAgICBzdXBlckluaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCSAgICAgICAgfQoJICAgIH07CgoJICAgIHN1YkluaXQucHJvdG90eXBlID0gV29yZEFycmF5OwoJfSgpKTsKCgoJLyoqIEBwcmVzZXJ2ZQoJKGMpIDIwMTIgYnkgQ8OpZHJpYyBNZXNuaWwuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCgoJUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0IG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgoKCSAgICAtIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KCSAgICAtIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KCglUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBIT0xERVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgoJKi8KCgkoZnVuY3Rpb24gKE1hdGgpIHsKCSAgICAvLyBTaG9ydGN1dHMKCSAgICB2YXIgQyA9IENyeXB0b0pTOwoJICAgIHZhciBDX2xpYiA9IEMubGliOwoJICAgIHZhciBXb3JkQXJyYXkgPSBDX2xpYi5Xb3JkQXJyYXk7CgkgICAgdmFyIEhhc2hlciA9IENfbGliLkhhc2hlcjsKCSAgICB2YXIgQ19hbGdvID0gQy5hbGdvOwoKCSAgICAvLyBDb25zdGFudHMgdGFibGUKCSAgICB2YXIgX3psID0gV29yZEFycmF5LmNyZWF0ZShbCgkgICAgICAgIDAsICAxLCAgMiwgIDMsICA0LCAgNSwgIDYsICA3LCAgOCwgIDksIDEwLCAxMSwgMTIsIDEzLCAxNCwgMTUsCgkgICAgICAgIDcsICA0LCAxMywgIDEsIDEwLCAgNiwgMTUsICAzLCAxMiwgIDAsICA5LCAgNSwgIDIsIDE0LCAxMSwgIDgsCgkgICAgICAgIDMsIDEwLCAxNCwgIDQsICA5LCAxNSwgIDgsICAxLCAgMiwgIDcsICAwLCAgNiwgMTMsIDExLCAgNSwgMTIsCgkgICAgICAgIDEsICA5LCAxMSwgMTAsICAwLCAgOCwgMTIsICA0LCAxMywgIDMsICA3LCAxNSwgMTQsICA1LCAgNiwgIDIsCgkgICAgICAgIDQsICAwLCAgNSwgIDksICA3LCAxMiwgIDIsIDEwLCAxNCwgIDEsICAzLCAgOCwgMTEsICA2LCAxNSwgMTNdKTsKCSAgICB2YXIgX3pyID0gV29yZEFycmF5LmNyZWF0ZShbCgkgICAgICAgIDUsIDE0LCAgNywgIDAsICA5LCAgMiwgMTEsICA0LCAxMywgIDYsIDE1LCAgOCwgIDEsIDEwLCAgMywgMTIsCgkgICAgICAgIDYsIDExLCAgMywgIDcsICAwLCAxMywgIDUsIDEwLCAxNCwgMTUsICA4LCAxMiwgIDQsICA5LCAgMSwgIDIsCgkgICAgICAgIDE1LCAgNSwgIDEsICAzLCAgNywgMTQsICA2LCAgOSwgMTEsICA4LCAxMiwgIDIsIDEwLCAgMCwgIDQsIDEzLAoJICAgICAgICA4LCAgNiwgIDQsICAxLCAgMywgMTEsIDE1LCAgMCwgIDUsIDEyLCAgMiwgMTMsICA5LCAgNywgMTAsIDE0LAoJICAgICAgICAxMiwgMTUsIDEwLCAgNCwgIDEsICA1LCAgOCwgIDcsICA2LCAgMiwgMTMsIDE0LCAgMCwgIDMsICA5LCAxMV0pOwoJICAgIHZhciBfc2wgPSBXb3JkQXJyYXkuY3JlYXRlKFsKCSAgICAgICAgIDExLCAxNCwgMTUsIDEyLCAgNSwgIDgsICA3LCAgOSwgMTEsIDEzLCAxNCwgMTUsICA2LCAgNywgIDksICA4LAoJICAgICAgICA3LCA2LCAgIDgsIDEzLCAxMSwgIDksICA3LCAxNSwgIDcsIDEyLCAxNSwgIDksIDExLCAgNywgMTMsIDEyLAoJICAgICAgICAxMSwgMTMsICA2LCAgNywgMTQsICA5LCAxMywgMTUsIDE0LCAgOCwgMTMsICA2LCAgNSwgMTIsICA3LCAgNSwKCSAgICAgICAgICAxMSwgMTIsIDE0LCAxNSwgMTQsIDE1LCAgOSwgIDgsICA5LCAxNCwgIDUsICA2LCAgOCwgIDYsICA1LCAxMiwKCSAgICAgICAgOSwgMTUsICA1LCAxMSwgIDYsICA4LCAxMywgMTIsICA1LCAxMiwgMTMsIDE0LCAxMSwgIDgsICA1LCAgNiBdKTsKCSAgICB2YXIgX3NyID0gV29yZEFycmF5LmNyZWF0ZShbCgkgICAgICAgIDgsICA5LCAgOSwgMTEsIDEzLCAxNSwgMTUsICA1LCAgNywgIDcsICA4LCAxMSwgMTQsIDE0LCAxMiwgIDYsCgkgICAgICAgIDksIDEzLCAxNSwgIDcsIDEyLCAgOCwgIDksIDExLCAgNywgIDcsIDEyLCAgNywgIDYsIDE1LCAxMywgMTEsCgkgICAgICAgIDksICA3LCAxNSwgMTEsICA4LCAgNiwgIDYsIDE0LCAxMiwgMTMsICA1LCAxNCwgMTMsIDEzLCAgNywgIDUsCgkgICAgICAgIDE1LCAgNSwgIDgsIDExLCAxNCwgMTQsICA2LCAxNCwgIDYsICA5LCAxMiwgIDksIDEyLCAgNSwgMTUsICA4LAoJICAgICAgICA4LCAgNSwgMTIsICA5LCAxMiwgIDUsIDE0LCAgNiwgIDgsIDEzLCAgNiwgIDUsIDE1LCAxMywgMTEsIDExIF0pOwoKCSAgICB2YXIgX2hsID0gIFdvcmRBcnJheS5jcmVhdGUoWyAweDAwMDAwMDAwLCAweDVBODI3OTk5LCAweDZFRDlFQkExLCAweDhGMUJCQ0RDLCAweEE5NTNGRDRFXSk7CgkgICAgdmFyIF9ociA9ICBXb3JkQXJyYXkuY3JlYXRlKFsgMHg1MEEyOEJFNiwgMHg1QzRERDEyNCwgMHg2RDcwM0VGMywgMHg3QTZENzZFOSwgMHgwMDAwMDAwMF0pOwoKCSAgICAvKioKCSAgICAgKiBSSVBFTUQxNjAgaGFzaCBhbGdvcml0aG0uCgkgICAgICovCgkgICAgdmFyIFJJUEVNRDE2MCA9IENfYWxnby5SSVBFTUQxNjAgPSBIYXNoZXIuZXh0ZW5kKHsKCSAgICAgICAgX2RvUmVzZXQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIHRoaXMuX2hhc2ggID0gV29yZEFycmF5LmNyZWF0ZShbMHg2NzQ1MjMwMSwgMHhFRkNEQUI4OSwgMHg5OEJBRENGRSwgMHgxMDMyNTQ3NiwgMHhDM0QyRTFGMF0pOwoJICAgICAgICB9LAoKCSAgICAgICAgX2RvUHJvY2Vzc0Jsb2NrOiBmdW5jdGlvbiAoTSwgb2Zmc2V0KSB7CgoJICAgICAgICAgICAgLy8gU3dhcCBlbmRpYW4KCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMTY7IGkrKykgewoJICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgICAgIHZhciBvZmZzZXRfaSA9IG9mZnNldCArIGk7CgkgICAgICAgICAgICAgICAgdmFyIE1fb2Zmc2V0X2kgPSBNW29mZnNldF9pXTsKCgkgICAgICAgICAgICAgICAgLy8gU3dhcAoJICAgICAgICAgICAgICAgIE1bb2Zmc2V0X2ldID0gKAoJICAgICAgICAgICAgICAgICAgICAoKChNX29mZnNldF9pIDw8IDgpICB8IChNX29mZnNldF9pID4+PiAyNCkpICYgMHgwMGZmMDBmZikgfAoJICAgICAgICAgICAgICAgICAgICAoKChNX29mZnNldF9pIDw8IDI0KSB8IChNX29mZnNldF9pID4+PiA4KSkgICYgMHhmZjAwZmYwMCkKCSAgICAgICAgICAgICAgICApOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gU2hvcnRjdXQKCSAgICAgICAgICAgIHZhciBIICA9IHRoaXMuX2hhc2gud29yZHM7CgkgICAgICAgICAgICB2YXIgaGwgPSBfaGwud29yZHM7CgkgICAgICAgICAgICB2YXIgaHIgPSBfaHIud29yZHM7CgkgICAgICAgICAgICB2YXIgemwgPSBfemwud29yZHM7CgkgICAgICAgICAgICB2YXIgenIgPSBfenIud29yZHM7CgkgICAgICAgICAgICB2YXIgc2wgPSBfc2wud29yZHM7CgkgICAgICAgICAgICB2YXIgc3IgPSBfc3Iud29yZHM7CgoJICAgICAgICAgICAgLy8gV29ya2luZyB2YXJpYWJsZXMKCSAgICAgICAgICAgIHZhciBhbCwgYmwsIGNsLCBkbCwgZWw7CgkgICAgICAgICAgICB2YXIgYXIsIGJyLCBjciwgZHIsIGVyOwoKCSAgICAgICAgICAgIGFyID0gYWwgPSBIWzBdOwoJICAgICAgICAgICAgYnIgPSBibCA9IEhbMV07CgkgICAgICAgICAgICBjciA9IGNsID0gSFsyXTsKCSAgICAgICAgICAgIGRyID0gZGwgPSBIWzNdOwoJICAgICAgICAgICAgZXIgPSBlbCA9IEhbNF07CgkgICAgICAgICAgICAvLyBDb21wdXRhdGlvbgoJICAgICAgICAgICAgdmFyIHQ7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDgwOyBpICs9IDEpIHsKCSAgICAgICAgICAgICAgICB0ID0gKGFsICsgIE1bb2Zmc2V0K3psW2ldXSl8MDsKCSAgICAgICAgICAgICAgICBpZiAoaTwxNil7CgkJICAgICAgICAgICAgdCArPSAgZjEoYmwsY2wsZGwpICsgaGxbMF07CgkgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpPDMyKSB7CgkJICAgICAgICAgICAgdCArPSAgZjIoYmwsY2wsZGwpICsgaGxbMV07CgkgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpPDQ4KSB7CgkJICAgICAgICAgICAgdCArPSAgZjMoYmwsY2wsZGwpICsgaGxbMl07CgkgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpPDY0KSB7CgkJICAgICAgICAgICAgdCArPSAgZjQoYmwsY2wsZGwpICsgaGxbM107CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsvLyBpZiAoaTw4MCkgewoJCSAgICAgICAgICAgIHQgKz0gIGY1KGJsLGNsLGRsKSArIGhsWzRdOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB0ID0gdHwwOwoJICAgICAgICAgICAgICAgIHQgPSAgcm90bCh0LHNsW2ldKTsKCSAgICAgICAgICAgICAgICB0ID0gKHQrZWwpfDA7CgkgICAgICAgICAgICAgICAgYWwgPSBlbDsKCSAgICAgICAgICAgICAgICBlbCA9IGRsOwoJICAgICAgICAgICAgICAgIGRsID0gcm90bChjbCwgMTApOwoJICAgICAgICAgICAgICAgIGNsID0gYmw7CgkgICAgICAgICAgICAgICAgYmwgPSB0OwoKCSAgICAgICAgICAgICAgICB0ID0gKGFyICsgTVtvZmZzZXQrenJbaV1dKXwwOwoJICAgICAgICAgICAgICAgIGlmIChpPDE2KXsKCQkgICAgICAgICAgICB0ICs9ICBmNShicixjcixkcikgKyBoclswXTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGk8MzIpIHsKCQkgICAgICAgICAgICB0ICs9ICBmNChicixjcixkcikgKyBoclsxXTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGk8NDgpIHsKCQkgICAgICAgICAgICB0ICs9ICBmMyhicixjcixkcikgKyBoclsyXTsKCSAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGk8NjQpIHsKCQkgICAgICAgICAgICB0ICs9ICBmMihicixjcixkcikgKyBoclszXTsKCSAgICAgICAgICAgICAgICB9IGVsc2Ugey8vIGlmIChpPDgwKSB7CgkJICAgICAgICAgICAgdCArPSAgZjEoYnIsY3IsZHIpICsgaHJbNF07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHQgPSB0fDA7CgkgICAgICAgICAgICAgICAgdCA9ICByb3RsKHQsc3JbaV0pIDsKCSAgICAgICAgICAgICAgICB0ID0gKHQrZXIpfDA7CgkgICAgICAgICAgICAgICAgYXIgPSBlcjsKCSAgICAgICAgICAgICAgICBlciA9IGRyOwoJICAgICAgICAgICAgICAgIGRyID0gcm90bChjciwgMTApOwoJICAgICAgICAgICAgICAgIGNyID0gYnI7CgkgICAgICAgICAgICAgICAgYnIgPSB0OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gSW50ZXJtZWRpYXRlIGhhc2ggdmFsdWUKCSAgICAgICAgICAgIHQgICAgPSAoSFsxXSArIGNsICsgZHIpfDA7CgkgICAgICAgICAgICBIWzFdID0gKEhbMl0gKyBkbCArIGVyKXwwOwoJICAgICAgICAgICAgSFsyXSA9IChIWzNdICsgZWwgKyBhcil8MDsKCSAgICAgICAgICAgIEhbM10gPSAoSFs0XSArIGFsICsgYnIpfDA7CgkgICAgICAgICAgICBIWzRdID0gKEhbMF0gKyBibCArIGNyKXwwOwoJICAgICAgICAgICAgSFswXSA9ICB0OwoJICAgICAgICB9LAoKCSAgICAgICAgX2RvRmluYWxpemU6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLl9kYXRhOwoJICAgICAgICAgICAgdmFyIGRhdGFXb3JkcyA9IGRhdGEud29yZHM7CgoJICAgICAgICAgICAgdmFyIG5CaXRzVG90YWwgPSB0aGlzLl9uRGF0YUJ5dGVzICogODsKCSAgICAgICAgICAgIHZhciBuQml0c0xlZnQgPSBkYXRhLnNpZ0J5dGVzICogODsKCgkgICAgICAgICAgICAvLyBBZGQgcGFkZGluZwoJICAgICAgICAgICAgZGF0YVdvcmRzW25CaXRzTGVmdCA+Pj4gNV0gfD0gMHg4MCA8PCAoMjQgLSBuQml0c0xlZnQgJSAzMik7CgkgICAgICAgICAgICBkYXRhV29yZHNbKCgobkJpdHNMZWZ0ICsgNjQpID4+PiA5KSA8PCA0KSArIDE0XSA9ICgKCSAgICAgICAgICAgICAgICAoKChuQml0c1RvdGFsIDw8IDgpICB8IChuQml0c1RvdGFsID4+PiAyNCkpICYgMHgwMGZmMDBmZikgfAoJICAgICAgICAgICAgICAgICgoKG5CaXRzVG90YWwgPDwgMjQpIHwgKG5CaXRzVG90YWwgPj4+IDgpKSAgJiAweGZmMDBmZjAwKQoJICAgICAgICAgICAgKTsKCSAgICAgICAgICAgIGRhdGEuc2lnQnl0ZXMgPSAoZGF0YVdvcmRzLmxlbmd0aCArIDEpICogNDsKCgkgICAgICAgICAgICAvLyBIYXNoIGZpbmFsIGJsb2NrcwoJICAgICAgICAgICAgdGhpcy5fcHJvY2VzcygpOwoKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIGhhc2ggPSB0aGlzLl9oYXNoOwoJICAgICAgICAgICAgdmFyIEggPSBoYXNoLndvcmRzOwoKCSAgICAgICAgICAgIC8vIFN3YXAgZW5kaWFuCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDU7IGkrKykgewoJICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0CgkgICAgICAgICAgICAgICAgdmFyIEhfaSA9IEhbaV07CgoJICAgICAgICAgICAgICAgIC8vIFN3YXAKCSAgICAgICAgICAgICAgICBIW2ldID0gKCgoSF9pIDw8IDgpICB8IChIX2kgPj4+IDI0KSkgJiAweDAwZmYwMGZmKSB8CgkgICAgICAgICAgICAgICAgICAgICAgICgoKEhfaSA8PCAyNCkgfCAoSF9pID4+PiA4KSkgICYgMHhmZjAwZmYwMCk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gUmV0dXJuIGZpbmFsIGNvbXB1dGVkIGhhc2gKCSAgICAgICAgICAgIHJldHVybiBoYXNoOwoJICAgICAgICB9LAoKCSAgICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIHZhciBjbG9uZSA9IEhhc2hlci5jbG9uZS5jYWxsKHRoaXMpOwoJICAgICAgICAgICAgY2xvbmUuX2hhc2ggPSB0aGlzLl9oYXNoLmNsb25lKCk7CgoJICAgICAgICAgICAgcmV0dXJuIGNsb25lOwoJICAgICAgICB9CgkgICAgfSk7CgoKCSAgICBmdW5jdGlvbiBmMSh4LCB5LCB6KSB7CgkgICAgICAgIHJldHVybiAoKHgpIF4gKHkpIF4gKHopKTsKCgkgICAgfQoKCSAgICBmdW5jdGlvbiBmMih4LCB5LCB6KSB7CgkgICAgICAgIHJldHVybiAoKCh4KSYoeSkpIHwgKCh+eCkmKHopKSk7CgkgICAgfQoKCSAgICBmdW5jdGlvbiBmMyh4LCB5LCB6KSB7CgkgICAgICAgIHJldHVybiAoKCh4KSB8ICh+KHkpKSkgXiAoeikpOwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZjQoeCwgeSwgeikgewoJICAgICAgICByZXR1cm4gKCgoeCkgJiAoeikpIHwgKCh5KSYofih6KSkpKTsKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGY1KHgsIHksIHopIHsKCSAgICAgICAgcmV0dXJuICgoeCkgXiAoKHkpIHwofih6KSkpKTsKCgkgICAgfQoKCSAgICBmdW5jdGlvbiByb3RsKHgsbikgewoJICAgICAgICByZXR1cm4gKHg8PG4pIHwgKHg+Pj4oMzItbikpOwoJICAgIH0KCgoJICAgIC8qKgoJICAgICAqIFNob3J0Y3V0IGZ1bmN0aW9uIHRvIHRoZSBoYXNoZXIncyBvYmplY3QgaW50ZXJmYWNlLgoJICAgICAqCgkgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIGhhc2guCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBoYXNoLgoJICAgICAqCgkgICAgICogQHN0YXRpYwoJICAgICAqCgkgICAgICogQGV4YW1wbGUKCSAgICAgKgoJICAgICAqICAgICB2YXIgaGFzaCA9IENyeXB0b0pTLlJJUEVNRDE2MCgnbWVzc2FnZScpOwoJICAgICAqICAgICB2YXIgaGFzaCA9IENyeXB0b0pTLlJJUEVNRDE2MCh3b3JkQXJyYXkpOwoJICAgICAqLwoJICAgIEMuUklQRU1EMTYwID0gSGFzaGVyLl9jcmVhdGVIZWxwZXIoUklQRU1EMTYwKTsKCgkgICAgLyoqCgkgICAgICogU2hvcnRjdXQgZnVuY3Rpb24gdG8gdGhlIEhNQUMncyBvYmplY3QgaW50ZXJmYWNlLgoJICAgICAqCgkgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIGhhc2guCgkgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBrZXkgVGhlIHNlY3JldCBrZXkuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBITUFDLgoJICAgICAqCgkgICAgICogQHN0YXRpYwoJICAgICAqCgkgICAgICogQGV4YW1wbGUKCSAgICAgKgoJICAgICAqICAgICB2YXIgaG1hYyA9IENyeXB0b0pTLkhtYWNSSVBFTUQxNjAobWVzc2FnZSwga2V5KTsKCSAgICAgKi8KCSAgICBDLkhtYWNSSVBFTUQxNjAgPSBIYXNoZXIuX2NyZWF0ZUhtYWNIZWxwZXIoUklQRU1EMTYwKTsKCX0oTWF0aCkpOwoKCgkoZnVuY3Rpb24gKCkgewoJICAgIC8vIFNob3J0Y3V0cwoJICAgIHZhciBDID0gQ3J5cHRvSlM7CgkgICAgdmFyIENfbGliID0gQy5saWI7CgkgICAgdmFyIEJhc2UgPSBDX2xpYi5CYXNlOwoJICAgIHZhciBDX2VuYyA9IEMuZW5jOwoJICAgIHZhciBVdGY4ID0gQ19lbmMuVXRmODsKCSAgICB2YXIgQ19hbGdvID0gQy5hbGdvOwoKCSAgICAvKioKCSAgICAgKiBITUFDIGFsZ29yaXRobS4KCSAgICAgKi8KCSAgICB2YXIgSE1BQyA9IENfYWxnby5ITUFDID0gQmFzZS5leHRlbmQoewoJICAgICAgICAvKioKCSAgICAgICAgICogSW5pdGlhbGl6ZXMgYSBuZXdseSBjcmVhdGVkIEhNQUMuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7SGFzaGVyfSBoYXNoZXIgVGhlIGhhc2ggYWxnb3JpdGhtIHRvIHVzZS4KCSAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBrZXkgVGhlIHNlY3JldCBrZXkuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgaG1hY0hhc2hlciA9IENyeXB0b0pTLmFsZ28uSE1BQy5jcmVhdGUoQ3J5cHRvSlMuYWxnby5TSEEyNTYsIGtleSk7CgkgICAgICAgICAqLwoJICAgICAgICBpbml0OiBmdW5jdGlvbiAoaGFzaGVyLCBrZXkpIHsKCSAgICAgICAgICAgIC8vIEluaXQgaGFzaGVyCgkgICAgICAgICAgICBoYXNoZXIgPSB0aGlzLl9oYXNoZXIgPSBuZXcgaGFzaGVyLmluaXQoKTsKCgkgICAgICAgICAgICAvLyBDb252ZXJ0IHN0cmluZyB0byBXb3JkQXJyYXksIGVsc2UgYXNzdW1lIFdvcmRBcnJheSBhbHJlYWR5CgkgICAgICAgICAgICBpZiAodHlwZW9mIGtleSA9PSAnc3RyaW5nJykgewoJICAgICAgICAgICAgICAgIGtleSA9IFV0ZjgucGFyc2Uoa2V5KTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgIHZhciBoYXNoZXJCbG9ja1NpemUgPSBoYXNoZXIuYmxvY2tTaXplOwoJICAgICAgICAgICAgdmFyIGhhc2hlckJsb2NrU2l6ZUJ5dGVzID0gaGFzaGVyQmxvY2tTaXplICogNDsKCgkgICAgICAgICAgICAvLyBBbGxvdyBhcmJpdHJhcnkgbGVuZ3RoIGtleXMKCSAgICAgICAgICAgIGlmIChrZXkuc2lnQnl0ZXMgPiBoYXNoZXJCbG9ja1NpemVCeXRlcykgewoJICAgICAgICAgICAgICAgIGtleSA9IGhhc2hlci5maW5hbGl6ZShrZXkpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIENsYW1wIGV4Y2VzcyBiaXRzCgkgICAgICAgICAgICBrZXkuY2xhbXAoKTsKCgkgICAgICAgICAgICAvLyBDbG9uZSBrZXkgZm9yIGlubmVyIGFuZCBvdXRlciBwYWRzCgkgICAgICAgICAgICB2YXIgb0tleSA9IHRoaXMuX29LZXkgPSBrZXkuY2xvbmUoKTsKCSAgICAgICAgICAgIHZhciBpS2V5ID0gdGhpcy5faUtleSA9IGtleS5jbG9uZSgpOwoKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIG9LZXlXb3JkcyA9IG9LZXkud29yZHM7CgkgICAgICAgICAgICB2YXIgaUtleVdvcmRzID0gaUtleS53b3JkczsKCgkgICAgICAgICAgICAvLyBYT1Iga2V5cyB3aXRoIHBhZCBjb25zdGFudHMKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGFzaGVyQmxvY2tTaXplOyBpKyspIHsKCSAgICAgICAgICAgICAgICBvS2V5V29yZHNbaV0gXj0gMHg1YzVjNWM1YzsKCSAgICAgICAgICAgICAgICBpS2V5V29yZHNbaV0gXj0gMHgzNjM2MzYzNjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIG9LZXkuc2lnQnl0ZXMgPSBpS2V5LnNpZ0J5dGVzID0gaGFzaGVyQmxvY2tTaXplQnl0ZXM7CgoJICAgICAgICAgICAgLy8gU2V0IGluaXRpYWwgdmFsdWVzCgkgICAgICAgICAgICB0aGlzLnJlc2V0KCk7CgkgICAgICAgIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogUmVzZXRzIHRoaXMgSE1BQyB0byBpdHMgaW5pdGlhbCBzdGF0ZS4KCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIGhtYWNIYXNoZXIucmVzZXQoKTsKCSAgICAgICAgICovCgkgICAgICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAvLyBTaG9ydGN1dAoJICAgICAgICAgICAgdmFyIGhhc2hlciA9IHRoaXMuX2hhc2hlcjsKCgkgICAgICAgICAgICAvLyBSZXNldAoJICAgICAgICAgICAgaGFzaGVyLnJlc2V0KCk7CgkgICAgICAgICAgICBoYXNoZXIudXBkYXRlKHRoaXMuX2lLZXkpOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIFVwZGF0ZXMgdGhpcyBITUFDIHdpdGggYSBtZXNzYWdlLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2VVcGRhdGUgVGhlIG1lc3NhZ2UgdG8gYXBwZW5kLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtITUFDfSBUaGlzIEhNQUMgaW5zdGFuY2UuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICBobWFjSGFzaGVyLnVwZGF0ZSgnbWVzc2FnZScpOwoJICAgICAgICAgKiAgICAgaG1hY0hhc2hlci51cGRhdGUod29yZEFycmF5KTsKCSAgICAgICAgICovCgkgICAgICAgIHVwZGF0ZTogZnVuY3Rpb24gKG1lc3NhZ2VVcGRhdGUpIHsKCSAgICAgICAgICAgIHRoaXMuX2hhc2hlci51cGRhdGUobWVzc2FnZVVwZGF0ZSk7CgoJICAgICAgICAgICAgLy8gQ2hhaW5hYmxlCgkgICAgICAgICAgICByZXR1cm4gdGhpczsKCSAgICAgICAgfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBGaW5hbGl6ZXMgdGhlIEhNQUMgY29tcHV0YXRpb24uCgkgICAgICAgICAqIE5vdGUgdGhhdCB0aGUgZmluYWxpemUgb3BlcmF0aW9uIGlzIGVmZmVjdGl2ZWx5IGEgZGVzdHJ1Y3RpdmUsIHJlYWQtb25jZSBvcGVyYXRpb24uCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZVVwZGF0ZSAoT3B0aW9uYWwpIEEgZmluYWwgbWVzc2FnZSB1cGRhdGUuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIEhNQUMuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgaG1hYyA9IGhtYWNIYXNoZXIuZmluYWxpemUoKTsKCSAgICAgICAgICogICAgIHZhciBobWFjID0gaG1hY0hhc2hlci5maW5hbGl6ZSgnbWVzc2FnZScpOwoJICAgICAgICAgKiAgICAgdmFyIGhtYWMgPSBobWFjSGFzaGVyLmZpbmFsaXplKHdvcmRBcnJheSk7CgkgICAgICAgICAqLwoJICAgICAgICBmaW5hbGl6ZTogZnVuY3Rpb24gKG1lc3NhZ2VVcGRhdGUpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0CgkgICAgICAgICAgICB2YXIgaGFzaGVyID0gdGhpcy5faGFzaGVyOwoKCSAgICAgICAgICAgIC8vIENvbXB1dGUgSE1BQwoJICAgICAgICAgICAgdmFyIGlubmVySGFzaCA9IGhhc2hlci5maW5hbGl6ZShtZXNzYWdlVXBkYXRlKTsKCSAgICAgICAgICAgIGhhc2hlci5yZXNldCgpOwoJICAgICAgICAgICAgdmFyIGhtYWMgPSBoYXNoZXIuZmluYWxpemUodGhpcy5fb0tleS5jbG9uZSgpLmNvbmNhdChpbm5lckhhc2gpKTsKCgkgICAgICAgICAgICByZXR1cm4gaG1hYzsKCSAgICAgICAgfQoJICAgIH0pOwoJfSgpKTsKCgoJKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBTaG9ydGN1dHMKCSAgICB2YXIgQyA9IENyeXB0b0pTOwoJICAgIHZhciBDX2xpYiA9IEMubGliOwoJICAgIHZhciBCYXNlID0gQ19saWIuQmFzZTsKCSAgICB2YXIgV29yZEFycmF5ID0gQ19saWIuV29yZEFycmF5OwoJICAgIHZhciBDX2FsZ28gPSBDLmFsZ287CgkgICAgdmFyIFNIQTEgPSBDX2FsZ28uU0hBMTsKCSAgICB2YXIgSE1BQyA9IENfYWxnby5ITUFDOwoKCSAgICAvKioKCSAgICAgKiBQYXNzd29yZC1CYXNlZCBLZXkgRGVyaXZhdGlvbiBGdW5jdGlvbiAyIGFsZ29yaXRobS4KCSAgICAgKi8KCSAgICB2YXIgUEJLREYyID0gQ19hbGdvLlBCS0RGMiA9IEJhc2UuZXh0ZW5kKHsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENvbmZpZ3VyYXRpb24gb3B0aW9ucy4KCSAgICAgICAgICoKCSAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IGtleVNpemUgVGhlIGtleSBzaXplIGluIHdvcmRzIHRvIGdlbmVyYXRlLiBEZWZhdWx0OiA0ICgxMjggYml0cykKCSAgICAgICAgICogQHByb3BlcnR5IHtIYXNoZXJ9IGhhc2hlciBUaGUgaGFzaGVyIHRvIHVzZS4gRGVmYXVsdDogU0hBMQoJICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gaXRlcmF0aW9ucyBUaGUgbnVtYmVyIG9mIGl0ZXJhdGlvbnMgdG8gcGVyZm9ybS4gRGVmYXVsdDogMQoJICAgICAgICAgKi8KCSAgICAgICAgY2ZnOiBCYXNlLmV4dGVuZCh7CgkgICAgICAgICAgICBrZXlTaXplOiAxMjgvMzIsCgkgICAgICAgICAgICBoYXNoZXI6IFNIQTEsCgkgICAgICAgICAgICBpdGVyYXRpb25zOiAxCgkgICAgICAgIH0pLAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEluaXRpYWxpemVzIGEgbmV3bHkgY3JlYXRlZCBrZXkgZGVyaXZhdGlvbiBmdW5jdGlvbi4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyAoT3B0aW9uYWwpIFRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMgdG8gdXNlIGZvciB0aGUgZGVyaXZhdGlvbi4KCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBrZGYgPSBDcnlwdG9KUy5hbGdvLlBCS0RGMi5jcmVhdGUoKTsKCSAgICAgICAgICogICAgIHZhciBrZGYgPSBDcnlwdG9KUy5hbGdvLlBCS0RGMi5jcmVhdGUoeyBrZXlTaXplOiA4IH0pOwoJICAgICAgICAgKiAgICAgdmFyIGtkZiA9IENyeXB0b0pTLmFsZ28uUEJLREYyLmNyZWF0ZSh7IGtleVNpemU6IDgsIGl0ZXJhdGlvbnM6IDEwMDAgfSk7CgkgICAgICAgICAqLwoJICAgICAgICBpbml0OiBmdW5jdGlvbiAoY2ZnKSB7CgkgICAgICAgICAgICB0aGlzLmNmZyA9IHRoaXMuY2ZnLmV4dGVuZChjZmcpOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENvbXB1dGVzIHRoZSBQYXNzd29yZC1CYXNlZCBLZXkgRGVyaXZhdGlvbiBGdW5jdGlvbiAyLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IHBhc3N3b3JkIFRoZSBwYXNzd29yZC4KCSAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBzYWx0IEEgc2FsdC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgZGVyaXZlZCBrZXkuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIga2V5ID0ga2RmLmNvbXB1dGUocGFzc3dvcmQsIHNhbHQpOwoJICAgICAgICAgKi8KCSAgICAgICAgY29tcHV0ZTogZnVuY3Rpb24gKHBhc3N3b3JkLCBzYWx0KSB7CgkgICAgICAgICAgICAvLyBTaG9ydGN1dAoJICAgICAgICAgICAgdmFyIGNmZyA9IHRoaXMuY2ZnOwoKCSAgICAgICAgICAgIC8vIEluaXQgSE1BQwoJICAgICAgICAgICAgdmFyIGhtYWMgPSBITUFDLmNyZWF0ZShjZmcuaGFzaGVyLCBwYXNzd29yZCk7CgoJICAgICAgICAgICAgLy8gSW5pdGlhbCB2YWx1ZXMKCSAgICAgICAgICAgIHZhciBkZXJpdmVkS2V5ID0gV29yZEFycmF5LmNyZWF0ZSgpOwoJICAgICAgICAgICAgdmFyIGJsb2NrSW5kZXggPSBXb3JkQXJyYXkuY3JlYXRlKFsweDAwMDAwMDAxXSk7CgoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIgZGVyaXZlZEtleVdvcmRzID0gZGVyaXZlZEtleS53b3JkczsKCSAgICAgICAgICAgIHZhciBibG9ja0luZGV4V29yZHMgPSBibG9ja0luZGV4LndvcmRzOwoJICAgICAgICAgICAgdmFyIGtleVNpemUgPSBjZmcua2V5U2l6ZTsKCSAgICAgICAgICAgIHZhciBpdGVyYXRpb25zID0gY2ZnLml0ZXJhdGlvbnM7CgoJICAgICAgICAgICAgLy8gR2VuZXJhdGUga2V5CgkgICAgICAgICAgICB3aGlsZSAoZGVyaXZlZEtleVdvcmRzLmxlbmd0aCA8IGtleVNpemUpIHsKCSAgICAgICAgICAgICAgICB2YXIgYmxvY2sgPSBobWFjLnVwZGF0ZShzYWx0KS5maW5hbGl6ZShibG9ja0luZGV4KTsKCSAgICAgICAgICAgICAgICBobWFjLnJlc2V0KCk7CgoJICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgICAgIHZhciBibG9ja1dvcmRzID0gYmxvY2sud29yZHM7CgkgICAgICAgICAgICAgICAgdmFyIGJsb2NrV29yZHNMZW5ndGggPSBibG9ja1dvcmRzLmxlbmd0aDsKCgkgICAgICAgICAgICAgICAgLy8gSXRlcmF0aW9ucwoJICAgICAgICAgICAgICAgIHZhciBpbnRlcm1lZGlhdGUgPSBibG9jazsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGl0ZXJhdGlvbnM7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICBpbnRlcm1lZGlhdGUgPSBobWFjLmZpbmFsaXplKGludGVybWVkaWF0ZSk7CgkgICAgICAgICAgICAgICAgICAgIGhtYWMucmVzZXQoKTsKCgkgICAgICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0CgkgICAgICAgICAgICAgICAgICAgIHZhciBpbnRlcm1lZGlhdGVXb3JkcyA9IGludGVybWVkaWF0ZS53b3JkczsKCgkgICAgICAgICAgICAgICAgICAgIC8vIFhPUiBpbnRlcm1lZGlhdGUgd2l0aCBibG9jawoJICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGJsb2NrV29yZHNMZW5ndGg7IGorKykgewoJICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tXb3Jkc1tqXSBePSBpbnRlcm1lZGlhdGVXb3Jkc1tqXTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgZGVyaXZlZEtleS5jb25jYXQoYmxvY2spOwoJICAgICAgICAgICAgICAgIGJsb2NrSW5kZXhXb3Jkc1swXSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZGVyaXZlZEtleS5zaWdCeXRlcyA9IGtleVNpemUgKiA0OwoKCSAgICAgICAgICAgIHJldHVybiBkZXJpdmVkS2V5OwoJICAgICAgICB9CgkgICAgfSk7CgoJICAgIC8qKgoJICAgICAqIENvbXB1dGVzIHRoZSBQYXNzd29yZC1CYXNlZCBLZXkgRGVyaXZhdGlvbiBGdW5jdGlvbiAyLgoJICAgICAqCgkgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBwYXNzd29yZCBUaGUgcGFzc3dvcmQuCgkgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBzYWx0IEEgc2FsdC4KCSAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIChPcHRpb25hbCkgVGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyB0byB1c2UgZm9yIHRoaXMgY29tcHV0YXRpb24uCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBkZXJpdmVkIGtleS4KCSAgICAgKgoJICAgICAqIEBzdGF0aWMKCSAgICAgKgoJICAgICAqIEBleGFtcGxlCgkgICAgICoKCSAgICAgKiAgICAgdmFyIGtleSA9IENyeXB0b0pTLlBCS0RGMihwYXNzd29yZCwgc2FsdCk7CgkgICAgICogICAgIHZhciBrZXkgPSBDcnlwdG9KUy5QQktERjIocGFzc3dvcmQsIHNhbHQsIHsga2V5U2l6ZTogOCB9KTsKCSAgICAgKiAgICAgdmFyIGtleSA9IENyeXB0b0pTLlBCS0RGMihwYXNzd29yZCwgc2FsdCwgeyBrZXlTaXplOiA4LCBpdGVyYXRpb25zOiAxMDAwIH0pOwoJICAgICAqLwoJICAgIEMuUEJLREYyID0gZnVuY3Rpb24gKHBhc3N3b3JkLCBzYWx0LCBjZmcpIHsKCSAgICAgICAgcmV0dXJuIFBCS0RGMi5jcmVhdGUoY2ZnKS5jb21wdXRlKHBhc3N3b3JkLCBzYWx0KTsKCSAgICB9OwoJfSgpKTsKCgoJKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBTaG9ydGN1dHMKCSAgICB2YXIgQyA9IENyeXB0b0pTOwoJICAgIHZhciBDX2xpYiA9IEMubGliOwoJICAgIHZhciBCYXNlID0gQ19saWIuQmFzZTsKCSAgICB2YXIgV29yZEFycmF5ID0gQ19saWIuV29yZEFycmF5OwoJICAgIHZhciBDX2FsZ28gPSBDLmFsZ287CgkgICAgdmFyIE1ENSA9IENfYWxnby5NRDU7CgoJICAgIC8qKgoJICAgICAqIFRoaXMga2V5IGRlcml2YXRpb24gZnVuY3Rpb24gaXMgbWVhbnQgdG8gY29uZm9ybSB3aXRoIEVWUF9CeXRlc1RvS2V5LgoJICAgICAqIHd3dy5vcGVuc3NsLm9yZy9kb2NzL2NyeXB0by9FVlBfQnl0ZXNUb0tleS5odG1sCgkgICAgICovCgkgICAgdmFyIEV2cEtERiA9IENfYWxnby5FdnBLREYgPSBCYXNlLmV4dGVuZCh7CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBDb25maWd1cmF0aW9uIG9wdGlvbnMuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBrZXlTaXplIFRoZSBrZXkgc2l6ZSBpbiB3b3JkcyB0byBnZW5lcmF0ZS4gRGVmYXVsdDogNCAoMTI4IGJpdHMpCgkgICAgICAgICAqIEBwcm9wZXJ0eSB7SGFzaGVyfSBoYXNoZXIgVGhlIGhhc2ggYWxnb3JpdGhtIHRvIHVzZS4gRGVmYXVsdDogTUQ1CgkgICAgICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBpdGVyYXRpb25zIFRoZSBudW1iZXIgb2YgaXRlcmF0aW9ucyB0byBwZXJmb3JtLiBEZWZhdWx0OiAxCgkgICAgICAgICAqLwoJICAgICAgICBjZmc6IEJhc2UuZXh0ZW5kKHsKCSAgICAgICAgICAgIGtleVNpemU6IDEyOC8zMiwKCSAgICAgICAgICAgIGhhc2hlcjogTUQ1LAoJICAgICAgICAgICAgaXRlcmF0aW9uczogMQoJICAgICAgICB9KSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQga2V5IGRlcml2YXRpb24gZnVuY3Rpb24uCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgKE9wdGlvbmFsKSBUaGUgY29uZmlndXJhdGlvbiBvcHRpb25zIHRvIHVzZSBmb3IgdGhlIGRlcml2YXRpb24uCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIga2RmID0gQ3J5cHRvSlMuYWxnby5FdnBLREYuY3JlYXRlKCk7CgkgICAgICAgICAqICAgICB2YXIga2RmID0gQ3J5cHRvSlMuYWxnby5FdnBLREYuY3JlYXRlKHsga2V5U2l6ZTogOCB9KTsKCSAgICAgICAgICogICAgIHZhciBrZGYgPSBDcnlwdG9KUy5hbGdvLkV2cEtERi5jcmVhdGUoeyBrZXlTaXplOiA4LCBpdGVyYXRpb25zOiAxMDAwIH0pOwoJICAgICAgICAgKi8KCSAgICAgICAgaW5pdDogZnVuY3Rpb24gKGNmZykgewoJICAgICAgICAgICAgdGhpcy5jZmcgPSB0aGlzLmNmZy5leHRlbmQoY2ZnKTsKCSAgICAgICAgfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBEZXJpdmVzIGEga2V5IGZyb20gYSBwYXNzd29yZC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBwYXNzd29yZCBUaGUgcGFzc3dvcmQuCgkgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gc2FsdCBBIHNhbHQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGRlcml2ZWQga2V5LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIGtleSA9IGtkZi5jb21wdXRlKHBhc3N3b3JkLCBzYWx0KTsKCSAgICAgICAgICovCgkgICAgICAgIGNvbXB1dGU6IGZ1bmN0aW9uIChwYXNzd29yZCwgc2FsdCkgewoJICAgICAgICAgICAgdmFyIGJsb2NrOwoKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0CgkgICAgICAgICAgICB2YXIgY2ZnID0gdGhpcy5jZmc7CgoJICAgICAgICAgICAgLy8gSW5pdCBoYXNoZXIKCSAgICAgICAgICAgIHZhciBoYXNoZXIgPSBjZmcuaGFzaGVyLmNyZWF0ZSgpOwoKCSAgICAgICAgICAgIC8vIEluaXRpYWwgdmFsdWVzCgkgICAgICAgICAgICB2YXIgZGVyaXZlZEtleSA9IFdvcmRBcnJheS5jcmVhdGUoKTsKCgkgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgIHZhciBkZXJpdmVkS2V5V29yZHMgPSBkZXJpdmVkS2V5LndvcmRzOwoJICAgICAgICAgICAgdmFyIGtleVNpemUgPSBjZmcua2V5U2l6ZTsKCSAgICAgICAgICAgIHZhciBpdGVyYXRpb25zID0gY2ZnLml0ZXJhdGlvbnM7CgoJICAgICAgICAgICAgLy8gR2VuZXJhdGUga2V5CgkgICAgICAgICAgICB3aGlsZSAoZGVyaXZlZEtleVdvcmRzLmxlbmd0aCA8IGtleVNpemUpIHsKCSAgICAgICAgICAgICAgICBpZiAoYmxvY2spIHsKCSAgICAgICAgICAgICAgICAgICAgaGFzaGVyLnVwZGF0ZShibG9jayk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGJsb2NrID0gaGFzaGVyLnVwZGF0ZShwYXNzd29yZCkuZmluYWxpemUoc2FsdCk7CgkgICAgICAgICAgICAgICAgaGFzaGVyLnJlc2V0KCk7CgoJICAgICAgICAgICAgICAgIC8vIEl0ZXJhdGlvbnMKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGl0ZXJhdGlvbnM7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICBibG9jayA9IGhhc2hlci5maW5hbGl6ZShibG9jayk7CgkgICAgICAgICAgICAgICAgICAgIGhhc2hlci5yZXNldCgpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgZGVyaXZlZEtleS5jb25jYXQoYmxvY2spOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZGVyaXZlZEtleS5zaWdCeXRlcyA9IGtleVNpemUgKiA0OwoKCSAgICAgICAgICAgIHJldHVybiBkZXJpdmVkS2V5OwoJICAgICAgICB9CgkgICAgfSk7CgoJICAgIC8qKgoJICAgICAqIERlcml2ZXMgYSBrZXkgZnJvbSBhIHBhc3N3b3JkLgoJICAgICAqCgkgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBwYXNzd29yZCBUaGUgcGFzc3dvcmQuCgkgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBzYWx0IEEgc2FsdC4KCSAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIChPcHRpb25hbCkgVGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyB0byB1c2UgZm9yIHRoaXMgY29tcHV0YXRpb24uCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBkZXJpdmVkIGtleS4KCSAgICAgKgoJICAgICAqIEBzdGF0aWMKCSAgICAgKgoJICAgICAqIEBleGFtcGxlCgkgICAgICoKCSAgICAgKiAgICAgdmFyIGtleSA9IENyeXB0b0pTLkV2cEtERihwYXNzd29yZCwgc2FsdCk7CgkgICAgICogICAgIHZhciBrZXkgPSBDcnlwdG9KUy5FdnBLREYocGFzc3dvcmQsIHNhbHQsIHsga2V5U2l6ZTogOCB9KTsKCSAgICAgKiAgICAgdmFyIGtleSA9IENyeXB0b0pTLkV2cEtERihwYXNzd29yZCwgc2FsdCwgeyBrZXlTaXplOiA4LCBpdGVyYXRpb25zOiAxMDAwIH0pOwoJICAgICAqLwoJICAgIEMuRXZwS0RGID0gZnVuY3Rpb24gKHBhc3N3b3JkLCBzYWx0LCBjZmcpIHsKCSAgICAgICAgcmV0dXJuIEV2cEtERi5jcmVhdGUoY2ZnKS5jb21wdXRlKHBhc3N3b3JkLCBzYWx0KTsKCSAgICB9OwoJfSgpKTsKCgoJKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBTaG9ydGN1dHMKCSAgICB2YXIgQyA9IENyeXB0b0pTOwoJICAgIHZhciBDX2xpYiA9IEMubGliOwoJICAgIHZhciBXb3JkQXJyYXkgPSBDX2xpYi5Xb3JkQXJyYXk7CgkgICAgdmFyIENfYWxnbyA9IEMuYWxnbzsKCSAgICB2YXIgU0hBMjU2ID0gQ19hbGdvLlNIQTI1NjsKCgkgICAgLyoqCgkgICAgICogU0hBLTIyNCBoYXNoIGFsZ29yaXRobS4KCSAgICAgKi8KCSAgICB2YXIgU0hBMjI0ID0gQ19hbGdvLlNIQTIyNCA9IFNIQTI1Ni5leHRlbmQoewoJICAgICAgICBfZG9SZXNldDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgdGhpcy5faGFzaCA9IG5ldyBXb3JkQXJyYXkuaW5pdChbCgkgICAgICAgICAgICAgICAgMHhjMTA1OWVkOCwgMHgzNjdjZDUwNywgMHgzMDcwZGQxNywgMHhmNzBlNTkzOSwKCSAgICAgICAgICAgICAgICAweGZmYzAwYjMxLCAweDY4NTgxNTExLCAweDY0Zjk4ZmE3LCAweGJlZmE0ZmE0CgkgICAgICAgICAgICBdKTsKCSAgICAgICAgfSwKCgkgICAgICAgIF9kb0ZpbmFsaXplOiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB2YXIgaGFzaCA9IFNIQTI1Ni5fZG9GaW5hbGl6ZS5jYWxsKHRoaXMpOwoKCSAgICAgICAgICAgIGhhc2guc2lnQnl0ZXMgLT0gNDsKCgkgICAgICAgICAgICByZXR1cm4gaGFzaDsKCSAgICAgICAgfQoJICAgIH0pOwoKCSAgICAvKioKCSAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgaGFzaGVyJ3Mgb2JqZWN0IGludGVyZmFjZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBoYXNoLgoJICAgICAqCgkgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgaGFzaC4KCSAgICAgKgoJICAgICAqIEBzdGF0aWMKCSAgICAgKgoJICAgICAqIEBleGFtcGxlCgkgICAgICoKCSAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5TSEEyMjQoJ21lc3NhZ2UnKTsKCSAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5TSEEyMjQod29yZEFycmF5KTsKCSAgICAgKi8KCSAgICBDLlNIQTIyNCA9IFNIQTI1Ni5fY3JlYXRlSGVscGVyKFNIQTIyNCk7CgoJICAgIC8qKgoJICAgICAqIFNob3J0Y3V0IGZ1bmN0aW9uIHRvIHRoZSBITUFDJ3Mgb2JqZWN0IGludGVyZmFjZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBoYXNoLgoJICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30ga2V5IFRoZSBzZWNyZXQga2V5LgoJICAgICAqCgkgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgSE1BQy4KCSAgICAgKgoJICAgICAqIEBzdGF0aWMKCSAgICAgKgoJICAgICAqIEBleGFtcGxlCgkgICAgICoKCSAgICAgKiAgICAgdmFyIGhtYWMgPSBDcnlwdG9KUy5IbWFjU0hBMjI0KG1lc3NhZ2UsIGtleSk7CgkgICAgICovCgkgICAgQy5IbWFjU0hBMjI0ID0gU0hBMjU2Ll9jcmVhdGVIbWFjSGVscGVyKFNIQTIyNCk7Cgl9KCkpOwoKCgkoZnVuY3Rpb24gKHVuZGVmaW5lZCkgewoJICAgIC8vIFNob3J0Y3V0cwoJICAgIHZhciBDID0gQ3J5cHRvSlM7CgkgICAgdmFyIENfbGliID0gQy5saWI7CgkgICAgdmFyIEJhc2UgPSBDX2xpYi5CYXNlOwoJICAgIHZhciBYMzJXb3JkQXJyYXkgPSBDX2xpYi5Xb3JkQXJyYXk7CgoJICAgIC8qKgoJICAgICAqIHg2NCBuYW1lc3BhY2UuCgkgICAgICovCgkgICAgdmFyIENfeDY0ID0gQy54NjQgPSB7fTsKCgkgICAgLyoqCgkgICAgICogQSA2NC1iaXQgd29yZC4KCSAgICAgKi8KCSAgICB2YXIgWDY0V29yZCA9IENfeDY0LldvcmQgPSBCYXNlLmV4dGVuZCh7CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQgNjQtYml0IHdvcmQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBoaWdoIFRoZSBoaWdoIDMyIGJpdHMuCgkgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBsb3cgVGhlIGxvdyAzMiBiaXRzLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIHg2NFdvcmQgPSBDcnlwdG9KUy54NjQuV29yZC5jcmVhdGUoMHgwMDAxMDIwMywgMHgwNDA1MDYwNyk7CgkgICAgICAgICAqLwoJICAgICAgICBpbml0OiBmdW5jdGlvbiAoaGlnaCwgbG93KSB7CgkgICAgICAgICAgICB0aGlzLmhpZ2ggPSBoaWdoOwoJICAgICAgICAgICAgdGhpcy5sb3cgPSBsb3c7CgkgICAgICAgIH0KCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBCaXR3aXNlIE5PVHMgdGhpcyB3b3JkLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtYNjRXb3JkfSBBIG5ldyB4NjQtV29yZCBvYmplY3QgYWZ0ZXIgbmVnYXRpbmcuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgbmVnYXRlZCA9IHg2NFdvcmQubm90KCk7CgkgICAgICAgICAqLwoJICAgICAgICAvLyBub3Q6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIC8vIHZhciBoaWdoID0gfnRoaXMuaGlnaDsKCSAgICAgICAgICAgIC8vIHZhciBsb3cgPSB+dGhpcy5sb3c7CgoJICAgICAgICAgICAgLy8gcmV0dXJuIFg2NFdvcmQuY3JlYXRlKGhpZ2gsIGxvdyk7CgkgICAgICAgIC8vIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogQml0d2lzZSBBTkRzIHRoaXMgd29yZCB3aXRoIHRoZSBwYXNzZWQgd29yZC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtYNjRXb3JkfSB3b3JkIFRoZSB4NjQtV29yZCB0byBBTkQgd2l0aCB0aGlzIHdvcmQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge1g2NFdvcmR9IEEgbmV3IHg2NC1Xb3JkIG9iamVjdCBhZnRlciBBTkRpbmcuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgYW5kZWQgPSB4NjRXb3JkLmFuZChhbm90aGVyWDY0V29yZCk7CgkgICAgICAgICAqLwoJICAgICAgICAvLyBhbmQ6IGZ1bmN0aW9uICh3b3JkKSB7CgkgICAgICAgICAgICAvLyB2YXIgaGlnaCA9IHRoaXMuaGlnaCAmIHdvcmQuaGlnaDsKCSAgICAgICAgICAgIC8vIHZhciBsb3cgPSB0aGlzLmxvdyAmIHdvcmQubG93OwoKCSAgICAgICAgICAgIC8vIHJldHVybiBYNjRXb3JkLmNyZWF0ZShoaWdoLCBsb3cpOwoJICAgICAgICAvLyB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEJpdHdpc2UgT1JzIHRoaXMgd29yZCB3aXRoIHRoZSBwYXNzZWQgd29yZC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtYNjRXb3JkfSB3b3JkIFRoZSB4NjQtV29yZCB0byBPUiB3aXRoIHRoaXMgd29yZC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7WDY0V29yZH0gQSBuZXcgeDY0LVdvcmQgb2JqZWN0IGFmdGVyIE9SaW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIG9yZWQgPSB4NjRXb3JkLm9yKGFub3RoZXJYNjRXb3JkKTsKCSAgICAgICAgICovCgkgICAgICAgIC8vIG9yOiBmdW5jdGlvbiAod29yZCkgewoJICAgICAgICAgICAgLy8gdmFyIGhpZ2ggPSB0aGlzLmhpZ2ggfCB3b3JkLmhpZ2g7CgkgICAgICAgICAgICAvLyB2YXIgbG93ID0gdGhpcy5sb3cgfCB3b3JkLmxvdzsKCgkgICAgICAgICAgICAvLyByZXR1cm4gWDY0V29yZC5jcmVhdGUoaGlnaCwgbG93KTsKCSAgICAgICAgLy8gfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBCaXR3aXNlIFhPUnMgdGhpcyB3b3JkIHdpdGggdGhlIHBhc3NlZCB3b3JkLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge1g2NFdvcmR9IHdvcmQgVGhlIHg2NC1Xb3JkIHRvIFhPUiB3aXRoIHRoaXMgd29yZC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7WDY0V29yZH0gQSBuZXcgeDY0LVdvcmQgb2JqZWN0IGFmdGVyIFhPUmluZy4KCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciB4b3JlZCA9IHg2NFdvcmQueG9yKGFub3RoZXJYNjRXb3JkKTsKCSAgICAgICAgICovCgkgICAgICAgIC8vIHhvcjogZnVuY3Rpb24gKHdvcmQpIHsKCSAgICAgICAgICAgIC8vIHZhciBoaWdoID0gdGhpcy5oaWdoIF4gd29yZC5oaWdoOwoJICAgICAgICAgICAgLy8gdmFyIGxvdyA9IHRoaXMubG93IF4gd29yZC5sb3c7CgoJICAgICAgICAgICAgLy8gcmV0dXJuIFg2NFdvcmQuY3JlYXRlKGhpZ2gsIGxvdyk7CgkgICAgICAgIC8vIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogU2hpZnRzIHRoaXMgd29yZCBuIGJpdHMgdG8gdGhlIGxlZnQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBuIFRoZSBudW1iZXIgb2YgYml0cyB0byBzaGlmdC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7WDY0V29yZH0gQSBuZXcgeDY0LVdvcmQgb2JqZWN0IGFmdGVyIHNoaWZ0aW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIHNoaWZ0ZWQgPSB4NjRXb3JkLnNoaWZ0TCgyNSk7CgkgICAgICAgICAqLwoJICAgICAgICAvLyBzaGlmdEw6IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgICAgICAvLyBpZiAobiA8IDMyKSB7CgkgICAgICAgICAgICAgICAgLy8gdmFyIGhpZ2ggPSAodGhpcy5oaWdoIDw8IG4pIHwgKHRoaXMubG93ID4+PiAoMzIgLSBuKSk7CgkgICAgICAgICAgICAgICAgLy8gdmFyIGxvdyA9IHRoaXMubG93IDw8IG47CgkgICAgICAgICAgICAvLyB9IGVsc2UgewoJICAgICAgICAgICAgICAgIC8vIHZhciBoaWdoID0gdGhpcy5sb3cgPDwgKG4gLSAzMik7CgkgICAgICAgICAgICAgICAgLy8gdmFyIGxvdyA9IDA7CgkgICAgICAgICAgICAvLyB9CgoJICAgICAgICAgICAgLy8gcmV0dXJuIFg2NFdvcmQuY3JlYXRlKGhpZ2gsIGxvdyk7CgkgICAgICAgIC8vIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogU2hpZnRzIHRoaXMgd29yZCBuIGJpdHMgdG8gdGhlIHJpZ2h0LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gbiBUaGUgbnVtYmVyIG9mIGJpdHMgdG8gc2hpZnQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge1g2NFdvcmR9IEEgbmV3IHg2NC1Xb3JkIG9iamVjdCBhZnRlciBzaGlmdGluZy4KCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBzaGlmdGVkID0geDY0V29yZC5zaGlmdFIoNyk7CgkgICAgICAgICAqLwoJICAgICAgICAvLyBzaGlmdFI6IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgICAgICAvLyBpZiAobiA8IDMyKSB7CgkgICAgICAgICAgICAgICAgLy8gdmFyIGxvdyA9ICh0aGlzLmxvdyA+Pj4gbikgfCAodGhpcy5oaWdoIDw8ICgzMiAtIG4pKTsKCSAgICAgICAgICAgICAgICAvLyB2YXIgaGlnaCA9IHRoaXMuaGlnaCA+Pj4gbjsKCSAgICAgICAgICAgIC8vIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgLy8gdmFyIGxvdyA9IHRoaXMuaGlnaCA+Pj4gKG4gLSAzMik7CgkgICAgICAgICAgICAgICAgLy8gdmFyIGhpZ2ggPSAwOwoJICAgICAgICAgICAgLy8gfQoKCSAgICAgICAgICAgIC8vIHJldHVybiBYNjRXb3JkLmNyZWF0ZShoaWdoLCBsb3cpOwoJICAgICAgICAvLyB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIFJvdGF0ZXMgdGhpcyB3b3JkIG4gYml0cyB0byB0aGUgbGVmdC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IG4gVGhlIG51bWJlciBvZiBiaXRzIHRvIHJvdGF0ZS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7WDY0V29yZH0gQSBuZXcgeDY0LVdvcmQgb2JqZWN0IGFmdGVyIHJvdGF0aW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIHJvdGF0ZWQgPSB4NjRXb3JkLnJvdEwoMjUpOwoJICAgICAgICAgKi8KCSAgICAgICAgLy8gcm90TDogZnVuY3Rpb24gKG4pIHsKCSAgICAgICAgICAgIC8vIHJldHVybiB0aGlzLnNoaWZ0TChuKS5vcih0aGlzLnNoaWZ0Uig2NCAtIG4pKTsKCSAgICAgICAgLy8gfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBSb3RhdGVzIHRoaXMgd29yZCBuIGJpdHMgdG8gdGhlIHJpZ2h0LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gbiBUaGUgbnVtYmVyIG9mIGJpdHMgdG8gcm90YXRlLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtYNjRXb3JkfSBBIG5ldyB4NjQtV29yZCBvYmplY3QgYWZ0ZXIgcm90YXRpbmcuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgcm90YXRlZCA9IHg2NFdvcmQucm90Uig3KTsKCSAgICAgICAgICovCgkgICAgICAgIC8vIHJvdFI6IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgICAgICAvLyByZXR1cm4gdGhpcy5zaGlmdFIobikub3IodGhpcy5zaGlmdEwoNjQgLSBuKSk7CgkgICAgICAgIC8vIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogQWRkcyB0aGlzIHdvcmQgd2l0aCB0aGUgcGFzc2VkIHdvcmQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7WDY0V29yZH0gd29yZCBUaGUgeDY0LVdvcmQgdG8gYWRkIHdpdGggdGhpcyB3b3JkLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtYNjRXb3JkfSBBIG5ldyB4NjQtV29yZCBvYmplY3QgYWZ0ZXIgYWRkaW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIGFkZGVkID0geDY0V29yZC5hZGQoYW5vdGhlclg2NFdvcmQpOwoJICAgICAgICAgKi8KCSAgICAgICAgLy8gYWRkOiBmdW5jdGlvbiAod29yZCkgewoJICAgICAgICAgICAgLy8gdmFyIGxvdyA9ICh0aGlzLmxvdyArIHdvcmQubG93KSB8IDA7CgkgICAgICAgICAgICAvLyB2YXIgY2FycnkgPSAobG93ID4+PiAwKSA8ICh0aGlzLmxvdyA+Pj4gMCkgPyAxIDogMDsKCSAgICAgICAgICAgIC8vIHZhciBoaWdoID0gKHRoaXMuaGlnaCArIHdvcmQuaGlnaCArIGNhcnJ5KSB8IDA7CgoJICAgICAgICAgICAgLy8gcmV0dXJuIFg2NFdvcmQuY3JlYXRlKGhpZ2gsIGxvdyk7CgkgICAgICAgIC8vIH0KCSAgICB9KTsKCgkgICAgLyoqCgkgICAgICogQW4gYXJyYXkgb2YgNjQtYml0IHdvcmRzLgoJICAgICAqCgkgICAgICogQHByb3BlcnR5IHtBcnJheX0gd29yZHMgVGhlIGFycmF5IG9mIENyeXB0b0pTLng2NC5Xb3JkIG9iamVjdHMuCgkgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IHNpZ0J5dGVzIFRoZSBudW1iZXIgb2Ygc2lnbmlmaWNhbnQgYnl0ZXMgaW4gdGhpcyB3b3JkIGFycmF5LgoJICAgICAqLwoJICAgIHZhciBYNjRXb3JkQXJyYXkgPSBDX3g2NC5Xb3JkQXJyYXkgPSBCYXNlLmV4dGVuZCh7CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQgd29yZCBhcnJheS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtBcnJheX0gd29yZHMgKE9wdGlvbmFsKSBBbiBhcnJheSBvZiBDcnlwdG9KUy54NjQuV29yZCBvYmplY3RzLgoJICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gc2lnQnl0ZXMgKE9wdGlvbmFsKSBUaGUgbnVtYmVyIG9mIHNpZ25pZmljYW50IGJ5dGVzIGluIHRoZSB3b3Jkcy4KCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciB3b3JkQXJyYXkgPSBDcnlwdG9KUy54NjQuV29yZEFycmF5LmNyZWF0ZSgpOwoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIHdvcmRBcnJheSA9IENyeXB0b0pTLng2NC5Xb3JkQXJyYXkuY3JlYXRlKFsKCSAgICAgICAgICogICAgICAgICBDcnlwdG9KUy54NjQuV29yZC5jcmVhdGUoMHgwMDAxMDIwMywgMHgwNDA1MDYwNyksCgkgICAgICAgICAqICAgICAgICAgQ3J5cHRvSlMueDY0LldvcmQuY3JlYXRlKDB4MTgxOTFhMWIsIDB4MWMxZDFlMWYpCgkgICAgICAgICAqICAgICBdKTsKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciB3b3JkQXJyYXkgPSBDcnlwdG9KUy54NjQuV29yZEFycmF5LmNyZWF0ZShbCgkgICAgICAgICAqICAgICAgICAgQ3J5cHRvSlMueDY0LldvcmQuY3JlYXRlKDB4MDAwMTAyMDMsIDB4MDQwNTA2MDcpLAoJICAgICAgICAgKiAgICAgICAgIENyeXB0b0pTLng2NC5Xb3JkLmNyZWF0ZSgweDE4MTkxYTFiLCAweDFjMWQxZTFmKQoJICAgICAgICAgKiAgICAgXSwgMTApOwoJICAgICAgICAgKi8KCSAgICAgICAgaW5pdDogZnVuY3Rpb24gKHdvcmRzLCBzaWdCeXRlcykgewoJICAgICAgICAgICAgd29yZHMgPSB0aGlzLndvcmRzID0gd29yZHMgfHwgW107CgoJICAgICAgICAgICAgaWYgKHNpZ0J5dGVzICE9IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgIHRoaXMuc2lnQnl0ZXMgPSBzaWdCeXRlczsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5zaWdCeXRlcyA9IHdvcmRzLmxlbmd0aCAqIDg7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogQ29udmVydHMgdGhpcyA2NC1iaXQgd29yZCBhcnJheSB0byBhIDMyLWJpdCB3b3JkIGFycmF5LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtDcnlwdG9KUy5saWIuV29yZEFycmF5fSBUaGlzIHdvcmQgYXJyYXkncyBkYXRhIGFzIGEgMzItYml0IHdvcmQgYXJyYXkuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgeDMyV29yZEFycmF5ID0geDY0V29yZEFycmF5LnRvWDMyKCk7CgkgICAgICAgICAqLwoJICAgICAgICB0b1gzMjogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIgeDY0V29yZHMgPSB0aGlzLndvcmRzOwoJICAgICAgICAgICAgdmFyIHg2NFdvcmRzTGVuZ3RoID0geDY0V29yZHMubGVuZ3RoOwoKCSAgICAgICAgICAgIC8vIENvbnZlcnQKCSAgICAgICAgICAgIHZhciB4MzJXb3JkcyA9IFtdOwoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB4NjRXb3Jkc0xlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHg2NFdvcmQgPSB4NjRXb3Jkc1tpXTsKCSAgICAgICAgICAgICAgICB4MzJXb3Jkcy5wdXNoKHg2NFdvcmQuaGlnaCk7CgkgICAgICAgICAgICAgICAgeDMyV29yZHMucHVzaCh4NjRXb3JkLmxvdyk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgcmV0dXJuIFgzMldvcmRBcnJheS5jcmVhdGUoeDMyV29yZHMsIHRoaXMuc2lnQnl0ZXMpOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENyZWF0ZXMgYSBjb3B5IG9mIHRoaXMgd29yZCBhcnJheS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7WDY0V29yZEFycmF5fSBUaGUgY2xvbmUuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgY2xvbmUgPSB4NjRXb3JkQXJyYXkuY2xvbmUoKTsKCSAgICAgICAgICovCgkgICAgICAgIGNsb25lOiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB2YXIgY2xvbmUgPSBCYXNlLmNsb25lLmNhbGwodGhpcyk7CgoJICAgICAgICAgICAgLy8gQ2xvbmUgIndvcmRzIiBhcnJheQoJICAgICAgICAgICAgdmFyIHdvcmRzID0gY2xvbmUud29yZHMgPSB0aGlzLndvcmRzLnNsaWNlKDApOwoKCSAgICAgICAgICAgIC8vIENsb25lIGVhY2ggWDY0V29yZCBvYmplY3QKCSAgICAgICAgICAgIHZhciB3b3Jkc0xlbmd0aCA9IHdvcmRzLmxlbmd0aDsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd29yZHNMZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgICAgIHdvcmRzW2ldID0gd29yZHNbaV0uY2xvbmUoKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXR1cm4gY2xvbmU7CgkgICAgICAgIH0KCSAgICB9KTsKCX0oKSk7CgoKCShmdW5jdGlvbiAoTWF0aCkgewoJICAgIC8vIFNob3J0Y3V0cwoJICAgIHZhciBDID0gQ3J5cHRvSlM7CgkgICAgdmFyIENfbGliID0gQy5saWI7CgkgICAgdmFyIFdvcmRBcnJheSA9IENfbGliLldvcmRBcnJheTsKCSAgICB2YXIgSGFzaGVyID0gQ19saWIuSGFzaGVyOwoJICAgIHZhciBDX3g2NCA9IEMueDY0OwoJICAgIHZhciBYNjRXb3JkID0gQ194NjQuV29yZDsKCSAgICB2YXIgQ19hbGdvID0gQy5hbGdvOwoKCSAgICAvLyBDb25zdGFudHMgdGFibGVzCgkgICAgdmFyIFJIT19PRkZTRVRTID0gW107CgkgICAgdmFyIFBJX0lOREVYRVMgID0gW107CgkgICAgdmFyIFJPVU5EX0NPTlNUQU5UUyA9IFtdOwoKCSAgICAvLyBDb21wdXRlIENvbnN0YW50cwoJICAgIChmdW5jdGlvbiAoKSB7CgkgICAgICAgIC8vIENvbXB1dGUgcmhvIG9mZnNldCBjb25zdGFudHMKCSAgICAgICAgdmFyIHggPSAxLCB5ID0gMDsKCSAgICAgICAgZm9yICh2YXIgdCA9IDA7IHQgPCAyNDsgdCsrKSB7CgkgICAgICAgICAgICBSSE9fT0ZGU0VUU1t4ICsgNSAqIHldID0gKCh0ICsgMSkgKiAodCArIDIpIC8gMikgJSA2NDsKCgkgICAgICAgICAgICB2YXIgbmV3WCA9IHkgJSA1OwoJICAgICAgICAgICAgdmFyIG5ld1kgPSAoMiAqIHggKyAzICogeSkgJSA1OwoJICAgICAgICAgICAgeCA9IG5ld1g7CgkgICAgICAgICAgICB5ID0gbmV3WTsKCSAgICAgICAgfQoKCSAgICAgICAgLy8gQ29tcHV0ZSBwaSBpbmRleCBjb25zdGFudHMKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCA1OyB4KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgNTsgeSsrKSB7CgkgICAgICAgICAgICAgICAgUElfSU5ERVhFU1t4ICsgNSAqIHldID0geSArICgoMiAqIHggKyAzICogeSkgJSA1KSAqIDU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCgkgICAgICAgIC8vIENvbXB1dGUgcm91bmQgY29uc3RhbnRzCgkgICAgICAgIHZhciBMRlNSID0gMHgwMTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgcm91bmRDb25zdGFudE1zdyA9IDA7CgkgICAgICAgICAgICB2YXIgcm91bmRDb25zdGFudExzdyA9IDA7CgoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCA3OyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAoTEZTUiAmIDB4MDEpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGJpdFBvc2l0aW9uID0gKDEgPDwgaikgLSAxOwoJICAgICAgICAgICAgICAgICAgICBpZiAoYml0UG9zaXRpb24gPCAzMikgewoJICAgICAgICAgICAgICAgICAgICAgICAgcm91bmRDb25zdGFudExzdyBePSAxIDw8IGJpdFBvc2l0aW9uOwoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgLyogaWYgKGJpdFBvc2l0aW9uID49IDMyKSAqLyB7CgkgICAgICAgICAgICAgICAgICAgICAgICByb3VuZENvbnN0YW50TXN3IF49IDEgPDwgKGJpdFBvc2l0aW9uIC0gMzIpOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAvLyBDb21wdXRlIG5leHQgTEZTUgoJICAgICAgICAgICAgICAgIGlmIChMRlNSICYgMHg4MCkgewoJICAgICAgICAgICAgICAgICAgICAvLyBQcmltaXRpdmUgcG9seW5vbWlhbCBvdmVyIEdGKDIpOiB4XjggKyB4XjYgKyB4XjUgKyB4XjQgKyAxCgkgICAgICAgICAgICAgICAgICAgIExGU1IgPSAoTEZTUiA8PCAxKSBeIDB4NzE7CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgTEZTUiA8PD0gMTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgUk9VTkRfQ09OU1RBTlRTW2ldID0gWDY0V29yZC5jcmVhdGUocm91bmRDb25zdGFudE1zdywgcm91bmRDb25zdGFudExzdyk7CgkgICAgICAgIH0KCSAgICB9KCkpOwoKCSAgICAvLyBSZXVzYWJsZSBvYmplY3RzIGZvciB0ZW1wb3JhcnkgdmFsdWVzCgkgICAgdmFyIFQgPSBbXTsKCSAgICAoZnVuY3Rpb24gKCkgewoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI1OyBpKyspIHsKCSAgICAgICAgICAgIFRbaV0gPSBYNjRXb3JkLmNyZWF0ZSgpOwoJICAgICAgICB9CgkgICAgfSgpKTsKCgkgICAgLyoqCgkgICAgICogU0hBLTMgaGFzaCBhbGdvcml0aG0uCgkgICAgICovCgkgICAgdmFyIFNIQTMgPSBDX2FsZ28uU0hBMyA9IEhhc2hlci5leHRlbmQoewoJICAgICAgICAvKioKCSAgICAgICAgICogQ29uZmlndXJhdGlvbiBvcHRpb25zLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gb3V0cHV0TGVuZ3RoCgkgICAgICAgICAqICAgVGhlIGRlc2lyZWQgbnVtYmVyIG9mIGJpdHMgaW4gdGhlIG91dHB1dCBoYXNoLgoJICAgICAgICAgKiAgIE9ubHkgdmFsdWVzIHBlcm1pdHRlZCBhcmU6IDIyNCwgMjU2LCAzODQsIDUxMi4KCSAgICAgICAgICogICBEZWZhdWx0OiA1MTIKCSAgICAgICAgICovCgkgICAgICAgIGNmZzogSGFzaGVyLmNmZy5leHRlbmQoewoJICAgICAgICAgICAgb3V0cHV0TGVuZ3RoOiA1MTIKCSAgICAgICAgfSksCgoJICAgICAgICBfZG9SZXNldDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgdmFyIHN0YXRlID0gdGhpcy5fc3RhdGUgPSBbXQoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgc3RhdGVbaV0gPSBuZXcgWDY0V29yZC5pbml0KCk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgdGhpcy5ibG9ja1NpemUgPSAoMTYwMCAtIDIgKiB0aGlzLmNmZy5vdXRwdXRMZW5ndGgpIC8gMzI7CgkgICAgICAgIH0sCgoJICAgICAgICBfZG9Qcm9jZXNzQmxvY2s6IGZ1bmN0aW9uIChNLCBvZmZzZXQpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIHN0YXRlID0gdGhpcy5fc3RhdGU7CgkgICAgICAgICAgICB2YXIgbkJsb2NrU2l6ZUxhbmVzID0gdGhpcy5ibG9ja1NpemUgLyAyOwoKCSAgICAgICAgICAgIC8vIEFic29yYgoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuQmxvY2tTaXplTGFuZXM7IGkrKykgewoJICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgICAgIHZhciBNMmkgID0gTVtvZmZzZXQgKyAyICogaV07CgkgICAgICAgICAgICAgICAgdmFyIE0yaTEgPSBNW29mZnNldCArIDIgKiBpICsgMV07CgoJICAgICAgICAgICAgICAgIC8vIFN3YXAgZW5kaWFuCgkgICAgICAgICAgICAgICAgTTJpID0gKAoJICAgICAgICAgICAgICAgICAgICAoKChNMmkgPDwgOCkgIHwgKE0yaSA+Pj4gMjQpKSAmIDB4MDBmZjAwZmYpIHwKCSAgICAgICAgICAgICAgICAgICAgKCgoTTJpIDw8IDI0KSB8IChNMmkgPj4+IDgpKSAgJiAweGZmMDBmZjAwKQoJICAgICAgICAgICAgICAgICk7CgkgICAgICAgICAgICAgICAgTTJpMSA9ICgKCSAgICAgICAgICAgICAgICAgICAgKCgoTTJpMSA8PCA4KSAgfCAoTTJpMSA+Pj4gMjQpKSAmIDB4MDBmZjAwZmYpIHwKCSAgICAgICAgICAgICAgICAgICAgKCgoTTJpMSA8PCAyNCkgfCAoTTJpMSA+Pj4gOCkpICAmIDB4ZmYwMGZmMDApCgkgICAgICAgICAgICAgICAgKTsKCgkgICAgICAgICAgICAgICAgLy8gQWJzb3JiIG1lc3NhZ2UgaW50byBzdGF0ZQoJICAgICAgICAgICAgICAgIHZhciBsYW5lID0gc3RhdGVbaV07CgkgICAgICAgICAgICAgICAgbGFuZS5oaWdoIF49IE0yaTE7CgkgICAgICAgICAgICAgICAgbGFuZS5sb3cgIF49IE0yaTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBSb3VuZHMKCSAgICAgICAgICAgIGZvciAodmFyIHJvdW5kID0gMDsgcm91bmQgPCAyNDsgcm91bmQrKykgewoJICAgICAgICAgICAgICAgIC8vIFRoZXRhCgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCA1OyB4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gTWl4IGNvbHVtbiBsYW5lcwoJICAgICAgICAgICAgICAgICAgICB2YXIgdE1zdyA9IDAsIHRMc3cgPSAwOwoJICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IDU7IHkrKykgewoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxhbmUgPSBzdGF0ZVt4ICsgNSAqIHldOwoJICAgICAgICAgICAgICAgICAgICAgICAgdE1zdyBePSBsYW5lLmhpZ2g7CgkgICAgICAgICAgICAgICAgICAgICAgICB0THN3IF49IGxhbmUubG93OwoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICAvLyBUZW1wb3JhcnkgdmFsdWVzCgkgICAgICAgICAgICAgICAgICAgIHZhciBUeCA9IFRbeF07CgkgICAgICAgICAgICAgICAgICAgIFR4LmhpZ2ggPSB0TXN3OwoJICAgICAgICAgICAgICAgICAgICBUeC5sb3cgID0gdExzdzsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCA1OyB4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICAgICAgICAgIHZhciBUeDQgPSBUWyh4ICsgNCkgJSA1XTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIFR4MSA9IFRbKHggKyAxKSAlIDVdOwoJICAgICAgICAgICAgICAgICAgICB2YXIgVHgxTXN3ID0gVHgxLmhpZ2g7CgkgICAgICAgICAgICAgICAgICAgIHZhciBUeDFMc3cgPSBUeDEubG93OwoKCSAgICAgICAgICAgICAgICAgICAgLy8gTWl4IHN1cnJvdW5kaW5nIGNvbHVtbnMKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRNc3cgPSBUeDQuaGlnaCBeICgoVHgxTXN3IDw8IDEpIHwgKFR4MUxzdyA+Pj4gMzEpKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRMc3cgPSBUeDQubG93ICBeICgoVHgxTHN3IDw8IDEpIHwgKFR4MU1zdyA+Pj4gMzEpKTsKCSAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCA1OyB5KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsYW5lID0gc3RhdGVbeCArIDUgKiB5XTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGxhbmUuaGlnaCBePSB0TXN3OwoJICAgICAgICAgICAgICAgICAgICAgICAgbGFuZS5sb3cgIF49IHRMc3c7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIC8vIFJobyBQaQoJICAgICAgICAgICAgICAgIGZvciAodmFyIGxhbmVJbmRleCA9IDE7IGxhbmVJbmRleCA8IDI1OyBsYW5lSW5kZXgrKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgdE1zdzsKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRMc3c7CgoJICAgICAgICAgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgICAgICAgICAgdmFyIGxhbmUgPSBzdGF0ZVtsYW5lSW5kZXhdOwoJICAgICAgICAgICAgICAgICAgICB2YXIgbGFuZU1zdyA9IGxhbmUuaGlnaDsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGxhbmVMc3cgPSBsYW5lLmxvdzsKCSAgICAgICAgICAgICAgICAgICAgdmFyIHJob09mZnNldCA9IFJIT19PRkZTRVRTW2xhbmVJbmRleF07CgoJICAgICAgICAgICAgICAgICAgICAvLyBSb3RhdGUgbGFuZXMKCSAgICAgICAgICAgICAgICAgICAgaWYgKHJob09mZnNldCA8IDMyKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB0TXN3ID0gKGxhbmVNc3cgPDwgcmhvT2Zmc2V0KSB8IChsYW5lTHN3ID4+PiAoMzIgLSByaG9PZmZzZXQpKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRMc3cgPSAobGFuZUxzdyA8PCByaG9PZmZzZXQpIHwgKGxhbmVNc3cgPj4+ICgzMiAtIHJob09mZnNldCkpOwoJICAgICAgICAgICAgICAgICAgICB9IGVsc2UgLyogaWYgKHJob09mZnNldCA+PSAzMikgKi8gewoJICAgICAgICAgICAgICAgICAgICAgICAgdE1zdyA9IChsYW5lTHN3IDw8IChyaG9PZmZzZXQgLSAzMikpIHwgKGxhbmVNc3cgPj4+ICg2NCAtIHJob09mZnNldCkpOwoJICAgICAgICAgICAgICAgICAgICAgICAgdExzdyA9IChsYW5lTXN3IDw8IChyaG9PZmZzZXQgLSAzMikpIHwgKGxhbmVMc3cgPj4+ICg2NCAtIHJob09mZnNldCkpOwoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICAvLyBUcmFuc3Bvc2UgbGFuZXMKCSAgICAgICAgICAgICAgICAgICAgdmFyIFRQaUxhbmUgPSBUW1BJX0lOREVYRVNbbGFuZUluZGV4XV07CgkgICAgICAgICAgICAgICAgICAgIFRQaUxhbmUuaGlnaCA9IHRNc3c7CgkgICAgICAgICAgICAgICAgICAgIFRQaUxhbmUubG93ICA9IHRMc3c7CgkgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAvLyBSaG8gcGkgYXQgeCA9IHkgPSAwCgkgICAgICAgICAgICAgICAgdmFyIFQwID0gVFswXTsKCSAgICAgICAgICAgICAgICB2YXIgc3RhdGUwID0gc3RhdGVbMF07CgkgICAgICAgICAgICAgICAgVDAuaGlnaCA9IHN0YXRlMC5oaWdoOwoJICAgICAgICAgICAgICAgIFQwLmxvdyAgPSBzdGF0ZTAubG93OwoKCSAgICAgICAgICAgICAgICAvLyBDaGkKCSAgICAgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IDU7IHgrKykgewoJICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IDU7IHkrKykgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGFuZUluZGV4ID0geCArIDUgKiB5OwoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxhbmUgPSBzdGF0ZVtsYW5lSW5kZXhdOwoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFRMYW5lID0gVFtsYW5lSW5kZXhdOwoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIFR4MUxhbmUgPSBUWygoeCArIDEpICUgNSkgKyA1ICogeV07CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgVHgyTGFuZSA9IFRbKCh4ICsgMikgJSA1KSArIDUgKiB5XTsKCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBNaXggcm93cwoJICAgICAgICAgICAgICAgICAgICAgICAgbGFuZS5oaWdoID0gVExhbmUuaGlnaCBeICh+VHgxTGFuZS5oaWdoICYgVHgyTGFuZS5oaWdoKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGxhbmUubG93ICA9IFRMYW5lLmxvdyAgXiAoflR4MUxhbmUubG93ICAmIFR4MkxhbmUubG93KTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgLy8gSW90YQoJICAgICAgICAgICAgICAgIHZhciBsYW5lID0gc3RhdGVbMF07CgkgICAgICAgICAgICAgICAgdmFyIHJvdW5kQ29uc3RhbnQgPSBST1VORF9DT05TVEFOVFNbcm91bmRdOwoJICAgICAgICAgICAgICAgIGxhbmUuaGlnaCBePSByb3VuZENvbnN0YW50LmhpZ2g7CgkgICAgICAgICAgICAgICAgbGFuZS5sb3cgIF49IHJvdW5kQ29uc3RhbnQubG93OwoJICAgICAgICAgICAgfQoJICAgICAgICB9LAoKCSAgICAgICAgX2RvRmluYWxpemU6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLl9kYXRhOwoJICAgICAgICAgICAgdmFyIGRhdGFXb3JkcyA9IGRhdGEud29yZHM7CgkgICAgICAgICAgICB2YXIgbkJpdHNUb3RhbCA9IHRoaXMuX25EYXRhQnl0ZXMgKiA4OwoJICAgICAgICAgICAgdmFyIG5CaXRzTGVmdCA9IGRhdGEuc2lnQnl0ZXMgKiA4OwoJICAgICAgICAgICAgdmFyIGJsb2NrU2l6ZUJpdHMgPSB0aGlzLmJsb2NrU2l6ZSAqIDMyOwoKCSAgICAgICAgICAgIC8vIEFkZCBwYWRkaW5nCgkgICAgICAgICAgICBkYXRhV29yZHNbbkJpdHNMZWZ0ID4+PiA1XSB8PSAweDEgPDwgKDI0IC0gbkJpdHNMZWZ0ICUgMzIpOwoJICAgICAgICAgICAgZGF0YVdvcmRzWygoTWF0aC5jZWlsKChuQml0c0xlZnQgKyAxKSAvIGJsb2NrU2l6ZUJpdHMpICogYmxvY2tTaXplQml0cykgPj4+IDUpIC0gMV0gfD0gMHg4MDsKCSAgICAgICAgICAgIGRhdGEuc2lnQnl0ZXMgPSBkYXRhV29yZHMubGVuZ3RoICogNDsKCgkgICAgICAgICAgICAvLyBIYXNoIGZpbmFsIGJsb2NrcwoJICAgICAgICAgICAgdGhpcy5fcHJvY2VzcygpOwoKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIHN0YXRlID0gdGhpcy5fc3RhdGU7CgkgICAgICAgICAgICB2YXIgb3V0cHV0TGVuZ3RoQnl0ZXMgPSB0aGlzLmNmZy5vdXRwdXRMZW5ndGggLyA4OwoJICAgICAgICAgICAgdmFyIG91dHB1dExlbmd0aExhbmVzID0gb3V0cHV0TGVuZ3RoQnl0ZXMgLyA4OwoKCSAgICAgICAgICAgIC8vIFNxdWVlemUKCSAgICAgICAgICAgIHZhciBoYXNoV29yZHMgPSBbXTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3V0cHV0TGVuZ3RoTGFuZXM7IGkrKykgewoJICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgICAgIHZhciBsYW5lID0gc3RhdGVbaV07CgkgICAgICAgICAgICAgICAgdmFyIGxhbmVNc3cgPSBsYW5lLmhpZ2g7CgkgICAgICAgICAgICAgICAgdmFyIGxhbmVMc3cgPSBsYW5lLmxvdzsKCgkgICAgICAgICAgICAgICAgLy8gU3dhcCBlbmRpYW4KCSAgICAgICAgICAgICAgICBsYW5lTXN3ID0gKAoJICAgICAgICAgICAgICAgICAgICAoKChsYW5lTXN3IDw8IDgpICB8IChsYW5lTXN3ID4+PiAyNCkpICYgMHgwMGZmMDBmZikgfAoJICAgICAgICAgICAgICAgICAgICAoKChsYW5lTXN3IDw8IDI0KSB8IChsYW5lTXN3ID4+PiA4KSkgICYgMHhmZjAwZmYwMCkKCSAgICAgICAgICAgICAgICApOwoJICAgICAgICAgICAgICAgIGxhbmVMc3cgPSAoCgkgICAgICAgICAgICAgICAgICAgICgoKGxhbmVMc3cgPDwgOCkgIHwgKGxhbmVMc3cgPj4+IDI0KSkgJiAweDAwZmYwMGZmKSB8CgkgICAgICAgICAgICAgICAgICAgICgoKGxhbmVMc3cgPDwgMjQpIHwgKGxhbmVMc3cgPj4+IDgpKSAgJiAweGZmMDBmZjAwKQoJICAgICAgICAgICAgICAgICk7CgoJICAgICAgICAgICAgICAgIC8vIFNxdWVlemUgc3RhdGUgdG8gcmV0cmlldmUgaGFzaAoJICAgICAgICAgICAgICAgIGhhc2hXb3Jkcy5wdXNoKGxhbmVMc3cpOwoJICAgICAgICAgICAgICAgIGhhc2hXb3Jkcy5wdXNoKGxhbmVNc3cpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIFJldHVybiBmaW5hbCBjb21wdXRlZCBoYXNoCgkgICAgICAgICAgICByZXR1cm4gbmV3IFdvcmRBcnJheS5pbml0KGhhc2hXb3Jkcywgb3V0cHV0TGVuZ3RoQnl0ZXMpOwoJICAgICAgICB9LAoKCSAgICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIHZhciBjbG9uZSA9IEhhc2hlci5jbG9uZS5jYWxsKHRoaXMpOwoKCSAgICAgICAgICAgIHZhciBzdGF0ZSA9IGNsb25lLl9zdGF0ZSA9IHRoaXMuX3N0YXRlLnNsaWNlKDApOwoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgc3RhdGVbaV0gPSBzdGF0ZVtpXS5jbG9uZSgpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJldHVybiBjbG9uZTsKCSAgICAgICAgfQoJICAgIH0pOwoKCSAgICAvKioKCSAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgaGFzaGVyJ3Mgb2JqZWN0IGludGVyZmFjZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBoYXNoLgoJICAgICAqCgkgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgaGFzaC4KCSAgICAgKgoJICAgICAqIEBzdGF0aWMKCSAgICAgKgoJICAgICAqIEBleGFtcGxlCgkgICAgICoKCSAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5TSEEzKCdtZXNzYWdlJyk7CgkgICAgICogICAgIHZhciBoYXNoID0gQ3J5cHRvSlMuU0hBMyh3b3JkQXJyYXkpOwoJICAgICAqLwoJICAgIEMuU0hBMyA9IEhhc2hlci5fY3JlYXRlSGVscGVyKFNIQTMpOwoKCSAgICAvKioKCSAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgSE1BQydzIG9iamVjdCBpbnRlcmZhY2UuCgkgICAgICoKCSAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gaGFzaC4KCSAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IGtleSBUaGUgc2VjcmV0IGtleS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIEhNQUMuCgkgICAgICoKCSAgICAgKiBAc3RhdGljCgkgICAgICoKCSAgICAgKiBAZXhhbXBsZQoJICAgICAqCgkgICAgICogICAgIHZhciBobWFjID0gQ3J5cHRvSlMuSG1hY1NIQTMobWVzc2FnZSwga2V5KTsKCSAgICAgKi8KCSAgICBDLkhtYWNTSEEzID0gSGFzaGVyLl9jcmVhdGVIbWFjSGVscGVyKFNIQTMpOwoJfShNYXRoKSk7CgoKCShmdW5jdGlvbiAoKSB7CgkgICAgLy8gU2hvcnRjdXRzCgkgICAgdmFyIEMgPSBDcnlwdG9KUzsKCSAgICB2YXIgQ19saWIgPSBDLmxpYjsKCSAgICB2YXIgSGFzaGVyID0gQ19saWIuSGFzaGVyOwoJICAgIHZhciBDX3g2NCA9IEMueDY0OwoJICAgIHZhciBYNjRXb3JkID0gQ194NjQuV29yZDsKCSAgICB2YXIgWDY0V29yZEFycmF5ID0gQ194NjQuV29yZEFycmF5OwoJICAgIHZhciBDX2FsZ28gPSBDLmFsZ287CgoJICAgIGZ1bmN0aW9uIFg2NFdvcmRfY3JlYXRlKCkgewoJICAgICAgICByZXR1cm4gWDY0V29yZC5jcmVhdGUuYXBwbHkoWDY0V29yZCwgYXJndW1lbnRzKTsKCSAgICB9CgoJICAgIC8vIENvbnN0YW50cwoJICAgIHZhciBLID0gWwoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweDQyOGEyZjk4LCAweGQ3MjhhZTIyKSwgWDY0V29yZF9jcmVhdGUoMHg3MTM3NDQ5MSwgMHgyM2VmNjVjZCksCgkgICAgICAgIFg2NFdvcmRfY3JlYXRlKDB4YjVjMGZiY2YsIDB4ZWM0ZDNiMmYpLCBYNjRXb3JkX2NyZWF0ZSgweGU5YjVkYmE1LCAweDgxODlkYmJjKSwKCSAgICAgICAgWDY0V29yZF9jcmVhdGUoMHgzOTU2YzI1YiwgMHhmMzQ4YjUzOCksIFg2NFdvcmRfY3JlYXRlKDB4NTlmMTExZjEsIDB4YjYwNWQwMTkpLAoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweDkyM2Y4MmE0LCAweGFmMTk0ZjliKSwgWDY0V29yZF9jcmVhdGUoMHhhYjFjNWVkNSwgMHhkYTZkODExOCksCgkgICAgICAgIFg2NFdvcmRfY3JlYXRlKDB4ZDgwN2FhOTgsIDB4YTMwMzAyNDIpLCBYNjRXb3JkX2NyZWF0ZSgweDEyODM1YjAxLCAweDQ1NzA2ZmJlKSwKCSAgICAgICAgWDY0V29yZF9jcmVhdGUoMHgyNDMxODViZSwgMHg0ZWU0YjI4YyksIFg2NFdvcmRfY3JlYXRlKDB4NTUwYzdkYzMsIDB4ZDVmZmI0ZTIpLAoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweDcyYmU1ZDc0LCAweGYyN2I4OTZmKSwgWDY0V29yZF9jcmVhdGUoMHg4MGRlYjFmZSwgMHgzYjE2OTZiMSksCgkgICAgICAgIFg2NFdvcmRfY3JlYXRlKDB4OWJkYzA2YTcsIDB4MjVjNzEyMzUpLCBYNjRXb3JkX2NyZWF0ZSgweGMxOWJmMTc0LCAweGNmNjkyNjk0KSwKCSAgICAgICAgWDY0V29yZF9jcmVhdGUoMHhlNDliNjljMSwgMHg5ZWYxNGFkMiksIFg2NFdvcmRfY3JlYXRlKDB4ZWZiZTQ3ODYsIDB4Mzg0ZjI1ZTMpLAoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweDBmYzE5ZGM2LCAweDhiOGNkNWI1KSwgWDY0V29yZF9jcmVhdGUoMHgyNDBjYTFjYywgMHg3N2FjOWM2NSksCgkgICAgICAgIFg2NFdvcmRfY3JlYXRlKDB4MmRlOTJjNmYsIDB4NTkyYjAyNzUpLCBYNjRXb3JkX2NyZWF0ZSgweDRhNzQ4NGFhLCAweDZlYTZlNDgzKSwKCSAgICAgICAgWDY0V29yZF9jcmVhdGUoMHg1Y2IwYTlkYywgMHhiZDQxZmJkNCksIFg2NFdvcmRfY3JlYXRlKDB4NzZmOTg4ZGEsIDB4ODMxMTUzYjUpLAoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweDk4M2U1MTUyLCAweGVlNjZkZmFiKSwgWDY0V29yZF9jcmVhdGUoMHhhODMxYzY2ZCwgMHgyZGI0MzIxMCksCgkgICAgICAgIFg2NFdvcmRfY3JlYXRlKDB4YjAwMzI3YzgsIDB4OThmYjIxM2YpLCBYNjRXb3JkX2NyZWF0ZSgweGJmNTk3ZmM3LCAweGJlZWYwZWU0KSwKCSAgICAgICAgWDY0V29yZF9jcmVhdGUoMHhjNmUwMGJmMywgMHgzZGE4OGZjMiksIFg2NFdvcmRfY3JlYXRlKDB4ZDVhNzkxNDcsIDB4OTMwYWE3MjUpLAoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweDA2Y2E2MzUxLCAweGUwMDM4MjZmKSwgWDY0V29yZF9jcmVhdGUoMHgxNDI5Mjk2NywgMHgwYTBlNmU3MCksCgkgICAgICAgIFg2NFdvcmRfY3JlYXRlKDB4MjdiNzBhODUsIDB4NDZkMjJmZmMpLCBYNjRXb3JkX2NyZWF0ZSgweDJlMWIyMTM4LCAweDVjMjZjOTI2KSwKCSAgICAgICAgWDY0V29yZF9jcmVhdGUoMHg0ZDJjNmRmYywgMHg1YWM0MmFlZCksIFg2NFdvcmRfY3JlYXRlKDB4NTMzODBkMTMsIDB4OWQ5NWIzZGYpLAoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweDY1MGE3MzU0LCAweDhiYWY2M2RlKSwgWDY0V29yZF9jcmVhdGUoMHg3NjZhMGFiYiwgMHgzYzc3YjJhOCksCgkgICAgICAgIFg2NFdvcmRfY3JlYXRlKDB4ODFjMmM5MmUsIDB4NDdlZGFlZTYpLCBYNjRXb3JkX2NyZWF0ZSgweDkyNzIyYzg1LCAweDE0ODIzNTNiKSwKCSAgICAgICAgWDY0V29yZF9jcmVhdGUoMHhhMmJmZThhMSwgMHg0Y2YxMDM2NCksIFg2NFdvcmRfY3JlYXRlKDB4YTgxYTY2NGIsIDB4YmM0MjMwMDEpLAoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweGMyNGI4YjcwLCAweGQwZjg5NzkxKSwgWDY0V29yZF9jcmVhdGUoMHhjNzZjNTFhMywgMHgwNjU0YmUzMCksCgkgICAgICAgIFg2NFdvcmRfY3JlYXRlKDB4ZDE5MmU4MTksIDB4ZDZlZjUyMTgpLCBYNjRXb3JkX2NyZWF0ZSgweGQ2OTkwNjI0LCAweDU1NjVhOTEwKSwKCSAgICAgICAgWDY0V29yZF9jcmVhdGUoMHhmNDBlMzU4NSwgMHg1NzcxMjAyYSksIFg2NFdvcmRfY3JlYXRlKDB4MTA2YWEwNzAsIDB4MzJiYmQxYjgpLAoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweDE5YTRjMTE2LCAweGI4ZDJkMGM4KSwgWDY0V29yZF9jcmVhdGUoMHgxZTM3NmMwOCwgMHg1MTQxYWI1MyksCgkgICAgICAgIFg2NFdvcmRfY3JlYXRlKDB4Mjc0ODc3NGMsIDB4ZGY4ZWViOTkpLCBYNjRXb3JkX2NyZWF0ZSgweDM0YjBiY2I1LCAweGUxOWI0OGE4KSwKCSAgICAgICAgWDY0V29yZF9jcmVhdGUoMHgzOTFjMGNiMywgMHhjNWM5NWE2MyksIFg2NFdvcmRfY3JlYXRlKDB4NGVkOGFhNGEsIDB4ZTM0MThhY2IpLAoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweDViOWNjYTRmLCAweDc3NjNlMzczKSwgWDY0V29yZF9jcmVhdGUoMHg2ODJlNmZmMywgMHhkNmIyYjhhMyksCgkgICAgICAgIFg2NFdvcmRfY3JlYXRlKDB4NzQ4ZjgyZWUsIDB4NWRlZmIyZmMpLCBYNjRXb3JkX2NyZWF0ZSgweDc4YTU2MzZmLCAweDQzMTcyZjYwKSwKCSAgICAgICAgWDY0V29yZF9jcmVhdGUoMHg4NGM4NzgxNCwgMHhhMWYwYWI3MiksIFg2NFdvcmRfY3JlYXRlKDB4OGNjNzAyMDgsIDB4MWE2NDM5ZWMpLAoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweDkwYmVmZmZhLCAweDIzNjMxZTI4KSwgWDY0V29yZF9jcmVhdGUoMHhhNDUwNmNlYiwgMHhkZTgyYmRlOSksCgkgICAgICAgIFg2NFdvcmRfY3JlYXRlKDB4YmVmOWEzZjcsIDB4YjJjNjc5MTUpLCBYNjRXb3JkX2NyZWF0ZSgweGM2NzE3OGYyLCAweGUzNzI1MzJiKSwKCSAgICAgICAgWDY0V29yZF9jcmVhdGUoMHhjYTI3M2VjZSwgMHhlYTI2NjE5YyksIFg2NFdvcmRfY3JlYXRlKDB4ZDE4NmI4YzcsIDB4MjFjMGMyMDcpLAoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweGVhZGE3ZGQ2LCAweGNkZTBlYjFlKSwgWDY0V29yZF9jcmVhdGUoMHhmNTdkNGY3ZiwgMHhlZTZlZDE3OCksCgkgICAgICAgIFg2NFdvcmRfY3JlYXRlKDB4MDZmMDY3YWEsIDB4NzIxNzZmYmEpLCBYNjRXb3JkX2NyZWF0ZSgweDBhNjM3ZGM1LCAweGEyYzg5OGE2KSwKCSAgICAgICAgWDY0V29yZF9jcmVhdGUoMHgxMTNmOTgwNCwgMHhiZWY5MGRhZSksIFg2NFdvcmRfY3JlYXRlKDB4MWI3MTBiMzUsIDB4MTMxYzQ3MWIpLAoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweDI4ZGI3N2Y1LCAweDIzMDQ3ZDg0KSwgWDY0V29yZF9jcmVhdGUoMHgzMmNhYWI3YiwgMHg0MGM3MjQ5MyksCgkgICAgICAgIFg2NFdvcmRfY3JlYXRlKDB4M2M5ZWJlMGEsIDB4MTVjOWJlYmMpLCBYNjRXb3JkX2NyZWF0ZSgweDQzMWQ2N2M0LCAweDljMTAwZDRjKSwKCSAgICAgICAgWDY0V29yZF9jcmVhdGUoMHg0Y2M1ZDRiZSwgMHhjYjNlNDJiNiksIFg2NFdvcmRfY3JlYXRlKDB4NTk3ZjI5OWMsIDB4ZmM2NTdlMmEpLAoJICAgICAgICBYNjRXb3JkX2NyZWF0ZSgweDVmY2I2ZmFiLCAweDNhZDZmYWVjKSwgWDY0V29yZF9jcmVhdGUoMHg2YzQ0MTk4YywgMHg0YTQ3NTgxNykKCSAgICBdOwoKCSAgICAvLyBSZXVzYWJsZSBvYmplY3RzCgkgICAgdmFyIFcgPSBbXTsKCSAgICAoZnVuY3Rpb24gKCkgewoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDgwOyBpKyspIHsKCSAgICAgICAgICAgIFdbaV0gPSBYNjRXb3JkX2NyZWF0ZSgpOwoJICAgICAgICB9CgkgICAgfSgpKTsKCgkgICAgLyoqCgkgICAgICogU0hBLTUxMiBoYXNoIGFsZ29yaXRobS4KCSAgICAgKi8KCSAgICB2YXIgU0hBNTEyID0gQ19hbGdvLlNIQTUxMiA9IEhhc2hlci5leHRlbmQoewoJICAgICAgICBfZG9SZXNldDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgdGhpcy5faGFzaCA9IG5ldyBYNjRXb3JkQXJyYXkuaW5pdChbCgkgICAgICAgICAgICAgICAgbmV3IFg2NFdvcmQuaW5pdCgweDZhMDllNjY3LCAweGYzYmNjOTA4KSwgbmV3IFg2NFdvcmQuaW5pdCgweGJiNjdhZTg1LCAweDg0Y2FhNzNiKSwKCSAgICAgICAgICAgICAgICBuZXcgWDY0V29yZC5pbml0KDB4M2M2ZWYzNzIsIDB4ZmU5NGY4MmIpLCBuZXcgWDY0V29yZC5pbml0KDB4YTU0ZmY1M2EsIDB4NWYxZDM2ZjEpLAoJICAgICAgICAgICAgICAgIG5ldyBYNjRXb3JkLmluaXQoMHg1MTBlNTI3ZiwgMHhhZGU2ODJkMSksIG5ldyBYNjRXb3JkLmluaXQoMHg5YjA1Njg4YywgMHgyYjNlNmMxZiksCgkgICAgICAgICAgICAgICAgbmV3IFg2NFdvcmQuaW5pdCgweDFmODNkOWFiLCAweGZiNDFiZDZiKSwgbmV3IFg2NFdvcmQuaW5pdCgweDViZTBjZDE5LCAweDEzN2UyMTc5KQoJICAgICAgICAgICAgXSk7CgkgICAgICAgIH0sCgoJICAgICAgICBfZG9Qcm9jZXNzQmxvY2s6IGZ1bmN0aW9uIChNLCBvZmZzZXQpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIEggPSB0aGlzLl9oYXNoLndvcmRzOwoKCSAgICAgICAgICAgIHZhciBIMCA9IEhbMF07CgkgICAgICAgICAgICB2YXIgSDEgPSBIWzFdOwoJICAgICAgICAgICAgdmFyIEgyID0gSFsyXTsKCSAgICAgICAgICAgIHZhciBIMyA9IEhbM107CgkgICAgICAgICAgICB2YXIgSDQgPSBIWzRdOwoJICAgICAgICAgICAgdmFyIEg1ID0gSFs1XTsKCSAgICAgICAgICAgIHZhciBINiA9IEhbNl07CgkgICAgICAgICAgICB2YXIgSDcgPSBIWzddOwoKCSAgICAgICAgICAgIHZhciBIMGggPSBIMC5oaWdoOwoJICAgICAgICAgICAgdmFyIEgwbCA9IEgwLmxvdzsKCSAgICAgICAgICAgIHZhciBIMWggPSBIMS5oaWdoOwoJICAgICAgICAgICAgdmFyIEgxbCA9IEgxLmxvdzsKCSAgICAgICAgICAgIHZhciBIMmggPSBIMi5oaWdoOwoJICAgICAgICAgICAgdmFyIEgybCA9IEgyLmxvdzsKCSAgICAgICAgICAgIHZhciBIM2ggPSBIMy5oaWdoOwoJICAgICAgICAgICAgdmFyIEgzbCA9IEgzLmxvdzsKCSAgICAgICAgICAgIHZhciBINGggPSBINC5oaWdoOwoJICAgICAgICAgICAgdmFyIEg0bCA9IEg0LmxvdzsKCSAgICAgICAgICAgIHZhciBINWggPSBINS5oaWdoOwoJICAgICAgICAgICAgdmFyIEg1bCA9IEg1LmxvdzsKCSAgICAgICAgICAgIHZhciBINmggPSBINi5oaWdoOwoJICAgICAgICAgICAgdmFyIEg2bCA9IEg2LmxvdzsKCSAgICAgICAgICAgIHZhciBIN2ggPSBINy5oaWdoOwoJICAgICAgICAgICAgdmFyIEg3bCA9IEg3LmxvdzsKCgkgICAgICAgICAgICAvLyBXb3JraW5nIHZhcmlhYmxlcwoJICAgICAgICAgICAgdmFyIGFoID0gSDBoOwoJICAgICAgICAgICAgdmFyIGFsID0gSDBsOwoJICAgICAgICAgICAgdmFyIGJoID0gSDFoOwoJICAgICAgICAgICAgdmFyIGJsID0gSDFsOwoJICAgICAgICAgICAgdmFyIGNoID0gSDJoOwoJICAgICAgICAgICAgdmFyIGNsID0gSDJsOwoJICAgICAgICAgICAgdmFyIGRoID0gSDNoOwoJICAgICAgICAgICAgdmFyIGRsID0gSDNsOwoJICAgICAgICAgICAgdmFyIGVoID0gSDRoOwoJICAgICAgICAgICAgdmFyIGVsID0gSDRsOwoJICAgICAgICAgICAgdmFyIGZoID0gSDVoOwoJICAgICAgICAgICAgdmFyIGZsID0gSDVsOwoJICAgICAgICAgICAgdmFyIGdoID0gSDZoOwoJICAgICAgICAgICAgdmFyIGdsID0gSDZsOwoJICAgICAgICAgICAgdmFyIGhoID0gSDdoOwoJICAgICAgICAgICAgdmFyIGhsID0gSDdsOwoKCSAgICAgICAgICAgIC8vIFJvdW5kcwoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA4MDsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIFdpbDsKCSAgICAgICAgICAgICAgICB2YXIgV2loOwoKCSAgICAgICAgICAgICAgICAvLyBTaG9ydGN1dAoJICAgICAgICAgICAgICAgIHZhciBXaSA9IFdbaV07CgoJICAgICAgICAgICAgICAgIC8vIEV4dGVuZCBtZXNzYWdlCgkgICAgICAgICAgICAgICAgaWYgKGkgPCAxNikgewoJICAgICAgICAgICAgICAgICAgICBXaWggPSBXaS5oaWdoID0gTVtvZmZzZXQgKyBpICogMl0gICAgIHwgMDsKCSAgICAgICAgICAgICAgICAgICAgV2lsID0gV2kubG93ICA9IE1bb2Zmc2V0ICsgaSAqIDIgKyAxXSB8IDA7CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gR2FtbWEwCgkgICAgICAgICAgICAgICAgICAgIHZhciBnYW1tYTB4ICA9IFdbaSAtIDE1XTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGdhbW1hMHhoID0gZ2FtbWEweC5oaWdoOwoJICAgICAgICAgICAgICAgICAgICB2YXIgZ2FtbWEweGwgPSBnYW1tYTB4LmxvdzsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGdhbW1hMGggID0gKChnYW1tYTB4aCA+Pj4gMSkgfCAoZ2FtbWEweGwgPDwgMzEpKSBeICgoZ2FtbWEweGggPj4+IDgpIHwgKGdhbW1hMHhsIDw8IDI0KSkgXiAoZ2FtbWEweGggPj4+IDcpOwoJICAgICAgICAgICAgICAgICAgICB2YXIgZ2FtbWEwbCAgPSAoKGdhbW1hMHhsID4+PiAxKSB8IChnYW1tYTB4aCA8PCAzMSkpIF4gKChnYW1tYTB4bCA+Pj4gOCkgfCAoZ2FtbWEweGggPDwgMjQpKSBeICgoZ2FtbWEweGwgPj4+IDcpIHwgKGdhbW1hMHhoIDw8IDI1KSk7CgoJICAgICAgICAgICAgICAgICAgICAvLyBHYW1tYTEKCSAgICAgICAgICAgICAgICAgICAgdmFyIGdhbW1hMXggID0gV1tpIC0gMl07CgkgICAgICAgICAgICAgICAgICAgIHZhciBnYW1tYTF4aCA9IGdhbW1hMXguaGlnaDsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGdhbW1hMXhsID0gZ2FtbWExeC5sb3c7CgkgICAgICAgICAgICAgICAgICAgIHZhciBnYW1tYTFoICA9ICgoZ2FtbWExeGggPj4+IDE5KSB8IChnYW1tYTF4bCA8PCAxMykpIF4gKChnYW1tYTF4aCA8PCAzKSB8IChnYW1tYTF4bCA+Pj4gMjkpKSBeIChnYW1tYTF4aCA+Pj4gNik7CgkgICAgICAgICAgICAgICAgICAgIHZhciBnYW1tYTFsICA9ICgoZ2FtbWExeGwgPj4+IDE5KSB8IChnYW1tYTF4aCA8PCAxMykpIF4gKChnYW1tYTF4bCA8PCAzKSB8IChnYW1tYTF4aCA+Pj4gMjkpKSBeICgoZ2FtbWExeGwgPj4+IDYpIHwgKGdhbW1hMXhoIDw8IDI2KSk7CgoJICAgICAgICAgICAgICAgICAgICAvLyBXW2ldID0gZ2FtbWEwICsgV1tpIC0gN10gKyBnYW1tYTEgKyBXW2kgLSAxNl0KCSAgICAgICAgICAgICAgICAgICAgdmFyIFdpNyAgPSBXW2kgLSA3XTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIFdpN2ggPSBXaTcuaGlnaDsKCSAgICAgICAgICAgICAgICAgICAgdmFyIFdpN2wgPSBXaTcubG93OwoKCSAgICAgICAgICAgICAgICAgICAgdmFyIFdpMTYgID0gV1tpIC0gMTZdOwoJICAgICAgICAgICAgICAgICAgICB2YXIgV2kxNmggPSBXaTE2LmhpZ2g7CgkgICAgICAgICAgICAgICAgICAgIHZhciBXaTE2bCA9IFdpMTYubG93OwoKCSAgICAgICAgICAgICAgICAgICAgV2lsID0gZ2FtbWEwbCArIFdpN2w7CgkgICAgICAgICAgICAgICAgICAgIFdpaCA9IGdhbW1hMGggKyBXaTdoICsgKChXaWwgPj4+IDApIDwgKGdhbW1hMGwgPj4+IDApID8gMSA6IDApOwoJICAgICAgICAgICAgICAgICAgICBXaWwgPSBXaWwgKyBnYW1tYTFsOwoJICAgICAgICAgICAgICAgICAgICBXaWggPSBXaWggKyBnYW1tYTFoICsgKChXaWwgPj4+IDApIDwgKGdhbW1hMWwgPj4+IDApID8gMSA6IDApOwoJICAgICAgICAgICAgICAgICAgICBXaWwgPSBXaWwgKyBXaTE2bDsKCSAgICAgICAgICAgICAgICAgICAgV2loID0gV2loICsgV2kxNmggKyAoKFdpbCA+Pj4gMCkgPCAoV2kxNmwgPj4+IDApID8gMSA6IDApOwoKCSAgICAgICAgICAgICAgICAgICAgV2kuaGlnaCA9IFdpaDsKCSAgICAgICAgICAgICAgICAgICAgV2kubG93ICA9IFdpbDsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIHZhciBjaGggID0gKGVoICYgZmgpIF4gKH5laCAmIGdoKTsKCSAgICAgICAgICAgICAgICB2YXIgY2hsICA9IChlbCAmIGZsKSBeICh+ZWwgJiBnbCk7CgkgICAgICAgICAgICAgICAgdmFyIG1hamggPSAoYWggJiBiaCkgXiAoYWggJiBjaCkgXiAoYmggJiBjaCk7CgkgICAgICAgICAgICAgICAgdmFyIG1hamwgPSAoYWwgJiBibCkgXiAoYWwgJiBjbCkgXiAoYmwgJiBjbCk7CgoJICAgICAgICAgICAgICAgIHZhciBzaWdtYTBoID0gKChhaCA+Pj4gMjgpIHwgKGFsIDw8IDQpKSAgXiAoKGFoIDw8IDMwKSAgfCAoYWwgPj4+IDIpKSBeICgoYWggPDwgMjUpIHwgKGFsID4+PiA3KSk7CgkgICAgICAgICAgICAgICAgdmFyIHNpZ21hMGwgPSAoKGFsID4+PiAyOCkgfCAoYWggPDwgNCkpICBeICgoYWwgPDwgMzApICB8IChhaCA+Pj4gMikpIF4gKChhbCA8PCAyNSkgfCAoYWggPj4+IDcpKTsKCSAgICAgICAgICAgICAgICB2YXIgc2lnbWExaCA9ICgoZWggPj4+IDE0KSB8IChlbCA8PCAxOCkpIF4gKChlaCA+Pj4gMTgpIHwgKGVsIDw8IDE0KSkgXiAoKGVoIDw8IDIzKSB8IChlbCA+Pj4gOSkpOwoJICAgICAgICAgICAgICAgIHZhciBzaWdtYTFsID0gKChlbCA+Pj4gMTQpIHwgKGVoIDw8IDE4KSkgXiAoKGVsID4+PiAxOCkgfCAoZWggPDwgMTQpKSBeICgoZWwgPDwgMjMpIHwgKGVoID4+PiA5KSk7CgoJICAgICAgICAgICAgICAgIC8vIHQxID0gaCArIHNpZ21hMSArIGNoICsgS1tpXSArIFdbaV0KCSAgICAgICAgICAgICAgICB2YXIgS2kgID0gS1tpXTsKCSAgICAgICAgICAgICAgICB2YXIgS2loID0gS2kuaGlnaDsKCSAgICAgICAgICAgICAgICB2YXIgS2lsID0gS2kubG93OwoKCSAgICAgICAgICAgICAgICB2YXIgdDFsID0gaGwgKyBzaWdtYTFsOwoJICAgICAgICAgICAgICAgIHZhciB0MWggPSBoaCArIHNpZ21hMWggKyAoKHQxbCA+Pj4gMCkgPCAoaGwgPj4+IDApID8gMSA6IDApOwoJICAgICAgICAgICAgICAgIHZhciB0MWwgPSB0MWwgKyBjaGw7CgkgICAgICAgICAgICAgICAgdmFyIHQxaCA9IHQxaCArIGNoaCArICgodDFsID4+PiAwKSA8IChjaGwgPj4+IDApID8gMSA6IDApOwoJICAgICAgICAgICAgICAgIHZhciB0MWwgPSB0MWwgKyBLaWw7CgkgICAgICAgICAgICAgICAgdmFyIHQxaCA9IHQxaCArIEtpaCArICgodDFsID4+PiAwKSA8IChLaWwgPj4+IDApID8gMSA6IDApOwoJICAgICAgICAgICAgICAgIHZhciB0MWwgPSB0MWwgKyBXaWw7CgkgICAgICAgICAgICAgICAgdmFyIHQxaCA9IHQxaCArIFdpaCArICgodDFsID4+PiAwKSA8IChXaWwgPj4+IDApID8gMSA6IDApOwoKCSAgICAgICAgICAgICAgICAvLyB0MiA9IHNpZ21hMCArIG1hagoJICAgICAgICAgICAgICAgIHZhciB0MmwgPSBzaWdtYTBsICsgbWFqbDsKCSAgICAgICAgICAgICAgICB2YXIgdDJoID0gc2lnbWEwaCArIG1hamggKyAoKHQybCA+Pj4gMCkgPCAoc2lnbWEwbCA+Pj4gMCkgPyAxIDogMCk7CgoJICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB3b3JraW5nIHZhcmlhYmxlcwoJICAgICAgICAgICAgICAgIGhoID0gZ2g7CgkgICAgICAgICAgICAgICAgaGwgPSBnbDsKCSAgICAgICAgICAgICAgICBnaCA9IGZoOwoJICAgICAgICAgICAgICAgIGdsID0gZmw7CgkgICAgICAgICAgICAgICAgZmggPSBlaDsKCSAgICAgICAgICAgICAgICBmbCA9IGVsOwoJICAgICAgICAgICAgICAgIGVsID0gKGRsICsgdDFsKSB8IDA7CgkgICAgICAgICAgICAgICAgZWggPSAoZGggKyB0MWggKyAoKGVsID4+PiAwKSA8IChkbCA+Pj4gMCkgPyAxIDogMCkpIHwgMDsKCSAgICAgICAgICAgICAgICBkaCA9IGNoOwoJICAgICAgICAgICAgICAgIGRsID0gY2w7CgkgICAgICAgICAgICAgICAgY2ggPSBiaDsKCSAgICAgICAgICAgICAgICBjbCA9IGJsOwoJICAgICAgICAgICAgICAgIGJoID0gYWg7CgkgICAgICAgICAgICAgICAgYmwgPSBhbDsKCSAgICAgICAgICAgICAgICBhbCA9ICh0MWwgKyB0MmwpIHwgMDsKCSAgICAgICAgICAgICAgICBhaCA9ICh0MWggKyB0MmggKyAoKGFsID4+PiAwKSA8ICh0MWwgPj4+IDApID8gMSA6IDApKSB8IDA7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gSW50ZXJtZWRpYXRlIGhhc2ggdmFsdWUKCSAgICAgICAgICAgIEgwbCA9IEgwLmxvdyAgPSAoSDBsICsgYWwpOwoJICAgICAgICAgICAgSDAuaGlnaCA9IChIMGggKyBhaCArICgoSDBsID4+PiAwKSA8IChhbCA+Pj4gMCkgPyAxIDogMCkpOwoJICAgICAgICAgICAgSDFsID0gSDEubG93ICA9IChIMWwgKyBibCk7CgkgICAgICAgICAgICBIMS5oaWdoID0gKEgxaCArIGJoICsgKChIMWwgPj4+IDApIDwgKGJsID4+PiAwKSA/IDEgOiAwKSk7CgkgICAgICAgICAgICBIMmwgPSBIMi5sb3cgID0gKEgybCArIGNsKTsKCSAgICAgICAgICAgIEgyLmhpZ2ggPSAoSDJoICsgY2ggKyAoKEgybCA+Pj4gMCkgPCAoY2wgPj4+IDApID8gMSA6IDApKTsKCSAgICAgICAgICAgIEgzbCA9IEgzLmxvdyAgPSAoSDNsICsgZGwpOwoJICAgICAgICAgICAgSDMuaGlnaCA9IChIM2ggKyBkaCArICgoSDNsID4+PiAwKSA8IChkbCA+Pj4gMCkgPyAxIDogMCkpOwoJICAgICAgICAgICAgSDRsID0gSDQubG93ICA9IChINGwgKyBlbCk7CgkgICAgICAgICAgICBINC5oaWdoID0gKEg0aCArIGVoICsgKChINGwgPj4+IDApIDwgKGVsID4+PiAwKSA/IDEgOiAwKSk7CgkgICAgICAgICAgICBINWwgPSBINS5sb3cgID0gKEg1bCArIGZsKTsKCSAgICAgICAgICAgIEg1LmhpZ2ggPSAoSDVoICsgZmggKyAoKEg1bCA+Pj4gMCkgPCAoZmwgPj4+IDApID8gMSA6IDApKTsKCSAgICAgICAgICAgIEg2bCA9IEg2LmxvdyAgPSAoSDZsICsgZ2wpOwoJICAgICAgICAgICAgSDYuaGlnaCA9IChINmggKyBnaCArICgoSDZsID4+PiAwKSA8IChnbCA+Pj4gMCkgPyAxIDogMCkpOwoJICAgICAgICAgICAgSDdsID0gSDcubG93ICA9IChIN2wgKyBobCk7CgkgICAgICAgICAgICBINy5oaWdoID0gKEg3aCArIGhoICsgKChIN2wgPj4+IDApIDwgKGhsID4+PiAwKSA/IDEgOiAwKSk7CgkgICAgICAgIH0sCgoJICAgICAgICBfZG9GaW5hbGl6ZTogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX2RhdGE7CgkgICAgICAgICAgICB2YXIgZGF0YVdvcmRzID0gZGF0YS53b3JkczsKCgkgICAgICAgICAgICB2YXIgbkJpdHNUb3RhbCA9IHRoaXMuX25EYXRhQnl0ZXMgKiA4OwoJICAgICAgICAgICAgdmFyIG5CaXRzTGVmdCA9IGRhdGEuc2lnQnl0ZXMgKiA4OwoKCSAgICAgICAgICAgIC8vIEFkZCBwYWRkaW5nCgkgICAgICAgICAgICBkYXRhV29yZHNbbkJpdHNMZWZ0ID4+PiA1XSB8PSAweDgwIDw8ICgyNCAtIG5CaXRzTGVmdCAlIDMyKTsKCSAgICAgICAgICAgIGRhdGFXb3Jkc1soKChuQml0c0xlZnQgKyAxMjgpID4+PiAxMCkgPDwgNSkgKyAzMF0gPSBNYXRoLmZsb29yKG5CaXRzVG90YWwgLyAweDEwMDAwMDAwMCk7CgkgICAgICAgICAgICBkYXRhV29yZHNbKCgobkJpdHNMZWZ0ICsgMTI4KSA+Pj4gMTApIDw8IDUpICsgMzFdID0gbkJpdHNUb3RhbDsKCSAgICAgICAgICAgIGRhdGEuc2lnQnl0ZXMgPSBkYXRhV29yZHMubGVuZ3RoICogNDsKCgkgICAgICAgICAgICAvLyBIYXNoIGZpbmFsIGJsb2NrcwoJICAgICAgICAgICAgdGhpcy5fcHJvY2VzcygpOwoKCSAgICAgICAgICAgIC8vIENvbnZlcnQgaGFzaCB0byAzMi1iaXQgd29yZCBhcnJheSBiZWZvcmUgcmV0dXJuaW5nCgkgICAgICAgICAgICB2YXIgaGFzaCA9IHRoaXMuX2hhc2gudG9YMzIoKTsKCgkgICAgICAgICAgICAvLyBSZXR1cm4gZmluYWwgY29tcHV0ZWQgaGFzaAoJICAgICAgICAgICAgcmV0dXJuIGhhc2g7CgkgICAgICAgIH0sCgoJICAgICAgICBjbG9uZTogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgdmFyIGNsb25lID0gSGFzaGVyLmNsb25lLmNhbGwodGhpcyk7CgkgICAgICAgICAgICBjbG9uZS5faGFzaCA9IHRoaXMuX2hhc2guY2xvbmUoKTsKCgkgICAgICAgICAgICByZXR1cm4gY2xvbmU7CgkgICAgICAgIH0sCgoJICAgICAgICBibG9ja1NpemU6IDEwMjQvMzIKCSAgICB9KTsKCgkgICAgLyoqCgkgICAgICogU2hvcnRjdXQgZnVuY3Rpb24gdG8gdGhlIGhhc2hlcidzIG9iamVjdCBpbnRlcmZhY2UuCgkgICAgICoKCSAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gaGFzaC4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGhhc2guCgkgICAgICoKCSAgICAgKiBAc3RhdGljCgkgICAgICoKCSAgICAgKiBAZXhhbXBsZQoJICAgICAqCgkgICAgICogICAgIHZhciBoYXNoID0gQ3J5cHRvSlMuU0hBNTEyKCdtZXNzYWdlJyk7CgkgICAgICogICAgIHZhciBoYXNoID0gQ3J5cHRvSlMuU0hBNTEyKHdvcmRBcnJheSk7CgkgICAgICovCgkgICAgQy5TSEE1MTIgPSBIYXNoZXIuX2NyZWF0ZUhlbHBlcihTSEE1MTIpOwoKCSAgICAvKioKCSAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgSE1BQydzIG9iamVjdCBpbnRlcmZhY2UuCgkgICAgICoKCSAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gaGFzaC4KCSAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IGtleSBUaGUgc2VjcmV0IGtleS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIEhNQUMuCgkgICAgICoKCSAgICAgKiBAc3RhdGljCgkgICAgICoKCSAgICAgKiBAZXhhbXBsZQoJICAgICAqCgkgICAgICogICAgIHZhciBobWFjID0gQ3J5cHRvSlMuSG1hY1NIQTUxMihtZXNzYWdlLCBrZXkpOwoJICAgICAqLwoJICAgIEMuSG1hY1NIQTUxMiA9IEhhc2hlci5fY3JlYXRlSG1hY0hlbHBlcihTSEE1MTIpOwoJfSgpKTsKCgoJKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBTaG9ydGN1dHMKCSAgICB2YXIgQyA9IENyeXB0b0pTOwoJICAgIHZhciBDX3g2NCA9IEMueDY0OwoJICAgIHZhciBYNjRXb3JkID0gQ194NjQuV29yZDsKCSAgICB2YXIgWDY0V29yZEFycmF5ID0gQ194NjQuV29yZEFycmF5OwoJICAgIHZhciBDX2FsZ28gPSBDLmFsZ287CgkgICAgdmFyIFNIQTUxMiA9IENfYWxnby5TSEE1MTI7CgoJICAgIC8qKgoJICAgICAqIFNIQS0zODQgaGFzaCBhbGdvcml0aG0uCgkgICAgICovCgkgICAgdmFyIFNIQTM4NCA9IENfYWxnby5TSEEzODQgPSBTSEE1MTIuZXh0ZW5kKHsKCSAgICAgICAgX2RvUmVzZXQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIHRoaXMuX2hhc2ggPSBuZXcgWDY0V29yZEFycmF5LmluaXQoWwoJICAgICAgICAgICAgICAgIG5ldyBYNjRXb3JkLmluaXQoMHhjYmJiOWQ1ZCwgMHhjMTA1OWVkOCksIG5ldyBYNjRXb3JkLmluaXQoMHg2MjlhMjkyYSwgMHgzNjdjZDUwNyksCgkgICAgICAgICAgICAgICAgbmV3IFg2NFdvcmQuaW5pdCgweDkxNTkwMTVhLCAweDMwNzBkZDE3KSwgbmV3IFg2NFdvcmQuaW5pdCgweDE1MmZlY2Q4LCAweGY3MGU1OTM5KSwKCSAgICAgICAgICAgICAgICBuZXcgWDY0V29yZC5pbml0KDB4NjczMzI2NjcsIDB4ZmZjMDBiMzEpLCBuZXcgWDY0V29yZC5pbml0KDB4OGViNDRhODcsIDB4Njg1ODE1MTEpLAoJICAgICAgICAgICAgICAgIG5ldyBYNjRXb3JkLmluaXQoMHhkYjBjMmUwZCwgMHg2NGY5OGZhNyksIG5ldyBYNjRXb3JkLmluaXQoMHg0N2I1NDgxZCwgMHhiZWZhNGZhNCkKCSAgICAgICAgICAgIF0pOwoJICAgICAgICB9LAoKCSAgICAgICAgX2RvRmluYWxpemU6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIHZhciBoYXNoID0gU0hBNTEyLl9kb0ZpbmFsaXplLmNhbGwodGhpcyk7CgoJICAgICAgICAgICAgaGFzaC5zaWdCeXRlcyAtPSAxNjsKCgkgICAgICAgICAgICByZXR1cm4gaGFzaDsKCSAgICAgICAgfQoJICAgIH0pOwoKCSAgICAvKioKCSAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgaGFzaGVyJ3Mgb2JqZWN0IGludGVyZmFjZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBoYXNoLgoJICAgICAqCgkgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgaGFzaC4KCSAgICAgKgoJICAgICAqIEBzdGF0aWMKCSAgICAgKgoJICAgICAqIEBleGFtcGxlCgkgICAgICoKCSAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5TSEEzODQoJ21lc3NhZ2UnKTsKCSAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5TSEEzODQod29yZEFycmF5KTsKCSAgICAgKi8KCSAgICBDLlNIQTM4NCA9IFNIQTUxMi5fY3JlYXRlSGVscGVyKFNIQTM4NCk7CgoJICAgIC8qKgoJICAgICAqIFNob3J0Y3V0IGZ1bmN0aW9uIHRvIHRoZSBITUFDJ3Mgb2JqZWN0IGludGVyZmFjZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBoYXNoLgoJICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30ga2V5IFRoZSBzZWNyZXQga2V5LgoJICAgICAqCgkgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgSE1BQy4KCSAgICAgKgoJICAgICAqIEBzdGF0aWMKCSAgICAgKgoJICAgICAqIEBleGFtcGxlCgkgICAgICoKCSAgICAgKiAgICAgdmFyIGhtYWMgPSBDcnlwdG9KUy5IbWFjU0hBMzg0KG1lc3NhZ2UsIGtleSk7CgkgICAgICovCgkgICAgQy5IbWFjU0hBMzg0ID0gU0hBNTEyLl9jcmVhdGVIbWFjSGVscGVyKFNIQTM4NCk7Cgl9KCkpOwoKCgkvKioKCSAqIENpcGhlciBjb3JlIGNvbXBvbmVudHMuCgkgKi8KCUNyeXB0b0pTLmxpYi5DaXBoZXIgfHwgKGZ1bmN0aW9uICh1bmRlZmluZWQpIHsKCSAgICAvLyBTaG9ydGN1dHMKCSAgICB2YXIgQyA9IENyeXB0b0pTOwoJICAgIHZhciBDX2xpYiA9IEMubGliOwoJICAgIHZhciBCYXNlID0gQ19saWIuQmFzZTsKCSAgICB2YXIgV29yZEFycmF5ID0gQ19saWIuV29yZEFycmF5OwoJICAgIHZhciBCdWZmZXJlZEJsb2NrQWxnb3JpdGhtID0gQ19saWIuQnVmZmVyZWRCbG9ja0FsZ29yaXRobTsKCSAgICB2YXIgQ19lbmMgPSBDLmVuYzsKCSAgICB2YXIgVXRmOCA9IENfZW5jLlV0Zjg7CgkgICAgdmFyIEJhc2U2NCA9IENfZW5jLkJhc2U2NDsKCSAgICB2YXIgQ19hbGdvID0gQy5hbGdvOwoJICAgIHZhciBFdnBLREYgPSBDX2FsZ28uRXZwS0RGOwoKCSAgICAvKioKCSAgICAgKiBBYnN0cmFjdCBiYXNlIGNpcGhlciB0ZW1wbGF0ZS4KCSAgICAgKgoJICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBrZXlTaXplIFRoaXMgY2lwaGVyJ3Mga2V5IHNpemUuIERlZmF1bHQ6IDQgKDEyOCBiaXRzKQoJICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBpdlNpemUgVGhpcyBjaXBoZXIncyBJViBzaXplLiBEZWZhdWx0OiA0ICgxMjggYml0cykKCSAgICAgKiBAcHJvcGVydHkge251bWJlcn0gX0VOQ19YRk9STV9NT0RFIEEgY29uc3RhbnQgcmVwcmVzZW50aW5nIGVuY3J5cHRpb24gbW9kZS4KCSAgICAgKiBAcHJvcGVydHkge251bWJlcn0gX0RFQ19YRk9STV9NT0RFIEEgY29uc3RhbnQgcmVwcmVzZW50aW5nIGRlY3J5cHRpb24gbW9kZS4KCSAgICAgKi8KCSAgICB2YXIgQ2lwaGVyID0gQ19saWIuQ2lwaGVyID0gQnVmZmVyZWRCbG9ja0FsZ29yaXRobS5leHRlbmQoewoJICAgICAgICAvKioKCSAgICAgICAgICogQ29uZmlndXJhdGlvbiBvcHRpb25zLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcHJvcGVydHkge1dvcmRBcnJheX0gaXYgVGhlIElWIHRvIHVzZSBmb3IgdGhpcyBvcGVyYXRpb24uCgkgICAgICAgICAqLwoJICAgICAgICBjZmc6IEJhc2UuZXh0ZW5kKCksCgoJICAgICAgICAvKioKCSAgICAgICAgICogQ3JlYXRlcyB0aGlzIGNpcGhlciBpbiBlbmNyeXB0aW9uIG1vZGUuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSBrZXkgVGhlIGtleS4KCSAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyAoT3B0aW9uYWwpIFRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMgdG8gdXNlIGZvciB0aGlzIG9wZXJhdGlvbi4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7Q2lwaGVyfSBBIGNpcGhlciBpbnN0YW5jZS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHN0YXRpYwoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIGNpcGhlciA9IENyeXB0b0pTLmFsZ28uQUVTLmNyZWF0ZUVuY3J5cHRvcihrZXlXb3JkQXJyYXksIHsgaXY6IGl2V29yZEFycmF5IH0pOwoJICAgICAgICAgKi8KCSAgICAgICAgY3JlYXRlRW5jcnlwdG9yOiBmdW5jdGlvbiAoa2V5LCBjZmcpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9FTkNfWEZPUk1fTU9ERSwga2V5LCBjZmcpOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENyZWF0ZXMgdGhpcyBjaXBoZXIgaW4gZGVjcnlwdGlvbiBtb2RlLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0ga2V5IFRoZSBrZXkuCgkgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgKE9wdGlvbmFsKSBUaGUgY29uZmlndXJhdGlvbiBvcHRpb25zIHRvIHVzZSBmb3IgdGhpcyBvcGVyYXRpb24uCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge0NpcGhlcn0gQSBjaXBoZXIgaW5zdGFuY2UuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBzdGF0aWMKCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBjaXBoZXIgPSBDcnlwdG9KUy5hbGdvLkFFUy5jcmVhdGVEZWNyeXB0b3Ioa2V5V29yZEFycmF5LCB7IGl2OiBpdldvcmRBcnJheSB9KTsKCSAgICAgICAgICovCgkgICAgICAgIGNyZWF0ZURlY3J5cHRvcjogZnVuY3Rpb24gKGtleSwgY2ZnKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGUodGhpcy5fREVDX1hGT1JNX01PREUsIGtleSwgY2ZnKTsKCSAgICAgICAgfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQgY2lwaGVyLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0geGZvcm1Nb2RlIEVpdGhlciB0aGUgZW5jcnlwdGlvbiBvciBkZWNyeXB0aW9uIHRyYW5zb3JtYXRpb24gbW9kZSBjb25zdGFudC4KCSAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IGtleSBUaGUga2V5LgoJICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIChPcHRpb25hbCkgVGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyB0byB1c2UgZm9yIHRoaXMgb3BlcmF0aW9uLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIGNpcGhlciA9IENyeXB0b0pTLmFsZ28uQUVTLmNyZWF0ZShDcnlwdG9KUy5hbGdvLkFFUy5fRU5DX1hGT1JNX01PREUsIGtleVdvcmRBcnJheSwgeyBpdjogaXZXb3JkQXJyYXkgfSk7CgkgICAgICAgICAqLwoJICAgICAgICBpbml0OiBmdW5jdGlvbiAoeGZvcm1Nb2RlLCBrZXksIGNmZykgewoJICAgICAgICAgICAgLy8gQXBwbHkgY29uZmlnIGRlZmF1bHRzCgkgICAgICAgICAgICB0aGlzLmNmZyA9IHRoaXMuY2ZnLmV4dGVuZChjZmcpOwoKCSAgICAgICAgICAgIC8vIFN0b3JlIHRyYW5zZm9ybSBtb2RlIGFuZCBrZXkKCSAgICAgICAgICAgIHRoaXMuX3hmb3JtTW9kZSA9IHhmb3JtTW9kZTsKCSAgICAgICAgICAgIHRoaXMuX2tleSA9IGtleTsKCgkgICAgICAgICAgICAvLyBTZXQgaW5pdGlhbCB2YWx1ZXMKCSAgICAgICAgICAgIHRoaXMucmVzZXQoKTsKCSAgICAgICAgfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBSZXNldHMgdGhpcyBjaXBoZXIgdG8gaXRzIGluaXRpYWwgc3RhdGUuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICBjaXBoZXIucmVzZXQoKTsKCSAgICAgICAgICovCgkgICAgICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAvLyBSZXNldCBkYXRhIGJ1ZmZlcgoJICAgICAgICAgICAgQnVmZmVyZWRCbG9ja0FsZ29yaXRobS5yZXNldC5jYWxsKHRoaXMpOwoKCSAgICAgICAgICAgIC8vIFBlcmZvcm0gY29uY3JldGUtY2lwaGVyIGxvZ2ljCgkgICAgICAgICAgICB0aGlzLl9kb1Jlc2V0KCk7CgkgICAgICAgIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogQWRkcyBkYXRhIHRvIGJlIGVuY3J5cHRlZCBvciBkZWNyeXB0ZWQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gZGF0YVVwZGF0ZSBUaGUgZGF0YSB0byBlbmNyeXB0IG9yIGRlY3J5cHQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGRhdGEgYWZ0ZXIgcHJvY2Vzc2luZy4KCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBlbmNyeXB0ZWQgPSBjaXBoZXIucHJvY2VzcygnZGF0YScpOwoJICAgICAgICAgKiAgICAgdmFyIGVuY3J5cHRlZCA9IGNpcGhlci5wcm9jZXNzKHdvcmRBcnJheSk7CgkgICAgICAgICAqLwoJICAgICAgICBwcm9jZXNzOiBmdW5jdGlvbiAoZGF0YVVwZGF0ZSkgewoJICAgICAgICAgICAgLy8gQXBwZW5kCgkgICAgICAgICAgICB0aGlzLl9hcHBlbmQoZGF0YVVwZGF0ZSk7CgoJICAgICAgICAgICAgLy8gUHJvY2VzcyBhdmFpbGFibGUgYmxvY2tzCgkgICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvY2VzcygpOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEZpbmFsaXplcyB0aGUgZW5jcnlwdGlvbiBvciBkZWNyeXB0aW9uIHByb2Nlc3MuCgkgICAgICAgICAqIE5vdGUgdGhhdCB0aGUgZmluYWxpemUgb3BlcmF0aW9uIGlzIGVmZmVjdGl2ZWx5IGEgZGVzdHJ1Y3RpdmUsIHJlYWQtb25jZSBvcGVyYXRpb24uCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gZGF0YVVwZGF0ZSBUaGUgZmluYWwgZGF0YSB0byBlbmNyeXB0IG9yIGRlY3J5cHQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGRhdGEgYWZ0ZXIgZmluYWwgcHJvY2Vzc2luZy4KCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBlbmNyeXB0ZWQgPSBjaXBoZXIuZmluYWxpemUoKTsKCSAgICAgICAgICogICAgIHZhciBlbmNyeXB0ZWQgPSBjaXBoZXIuZmluYWxpemUoJ2RhdGEnKTsKCSAgICAgICAgICogICAgIHZhciBlbmNyeXB0ZWQgPSBjaXBoZXIuZmluYWxpemUod29yZEFycmF5KTsKCSAgICAgICAgICovCgkgICAgICAgIGZpbmFsaXplOiBmdW5jdGlvbiAoZGF0YVVwZGF0ZSkgewoJICAgICAgICAgICAgLy8gRmluYWwgZGF0YSB1cGRhdGUKCSAgICAgICAgICAgIGlmIChkYXRhVXBkYXRlKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5fYXBwZW5kKGRhdGFVcGRhdGUpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIFBlcmZvcm0gY29uY3JldGUtY2lwaGVyIGxvZ2ljCgkgICAgICAgICAgICB2YXIgZmluYWxQcm9jZXNzZWREYXRhID0gdGhpcy5fZG9GaW5hbGl6ZSgpOwoKCSAgICAgICAgICAgIHJldHVybiBmaW5hbFByb2Nlc3NlZERhdGE7CgkgICAgICAgIH0sCgoJICAgICAgICBrZXlTaXplOiAxMjgvMzIsCgoJICAgICAgICBpdlNpemU6IDEyOC8zMiwKCgkgICAgICAgIF9FTkNfWEZPUk1fTU9ERTogMSwKCgkgICAgICAgIF9ERUNfWEZPUk1fTU9ERTogMiwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBDcmVhdGVzIHNob3J0Y3V0IGZ1bmN0aW9ucyB0byBhIGNpcGhlcidzIG9iamVjdCBpbnRlcmZhY2UuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7Q2lwaGVyfSBjaXBoZXIgVGhlIGNpcGhlciB0byBjcmVhdGUgYSBoZWxwZXIgZm9yLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IEFuIG9iamVjdCB3aXRoIGVuY3J5cHQgYW5kIGRlY3J5cHQgc2hvcnRjdXQgZnVuY3Rpb25zLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgQUVTID0gQ3J5cHRvSlMubGliLkNpcGhlci5fY3JlYXRlSGVscGVyKENyeXB0b0pTLmFsZ28uQUVTKTsKCSAgICAgICAgICovCgkgICAgICAgIF9jcmVhdGVIZWxwZXI6IChmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBmdW5jdGlvbiBzZWxlY3RDaXBoZXJTdHJhdGVneShrZXkpIHsKCSAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGtleSA9PSAnc3RyaW5nJykgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGFzc3dvcmRCYXNlZENpcGhlcjsKCSAgICAgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gU2VyaWFsaXphYmxlQ2lwaGVyOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGNpcGhlcikgewoJICAgICAgICAgICAgICAgIHJldHVybiB7CgkgICAgICAgICAgICAgICAgICAgIGVuY3J5cHQ6IGZ1bmN0aW9uIChtZXNzYWdlLCBrZXksIGNmZykgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdENpcGhlclN0cmF0ZWd5KGtleSkuZW5jcnlwdChjaXBoZXIsIG1lc3NhZ2UsIGtleSwgY2ZnKTsKCSAgICAgICAgICAgICAgICAgICAgfSwKCgkgICAgICAgICAgICAgICAgICAgIGRlY3J5cHQ6IGZ1bmN0aW9uIChjaXBoZXJ0ZXh0LCBrZXksIGNmZykgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdENpcGhlclN0cmF0ZWd5KGtleSkuZGVjcnlwdChjaXBoZXIsIGNpcGhlcnRleHQsIGtleSwgY2ZnKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH07CgkgICAgICAgICAgICB9OwoJICAgICAgICB9KCkpCgkgICAgfSk7CgoJICAgIC8qKgoJICAgICAqIEFic3RyYWN0IGJhc2Ugc3RyZWFtIGNpcGhlciB0ZW1wbGF0ZS4KCSAgICAgKgoJICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBibG9ja1NpemUgVGhlIG51bWJlciBvZiAzMi1iaXQgd29yZHMgdGhpcyBjaXBoZXIgb3BlcmF0ZXMgb24uIERlZmF1bHQ6IDEgKDMyIGJpdHMpCgkgICAgICovCgkgICAgdmFyIFN0cmVhbUNpcGhlciA9IENfbGliLlN0cmVhbUNpcGhlciA9IENpcGhlci5leHRlbmQoewoJICAgICAgICBfZG9GaW5hbGl6ZTogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgLy8gUHJvY2VzcyBwYXJ0aWFsIGJsb2NrcwoJICAgICAgICAgICAgdmFyIGZpbmFsUHJvY2Vzc2VkQmxvY2tzID0gdGhpcy5fcHJvY2VzcyghISdmbHVzaCcpOwoKCSAgICAgICAgICAgIHJldHVybiBmaW5hbFByb2Nlc3NlZEJsb2NrczsKCSAgICAgICAgfSwKCgkgICAgICAgIGJsb2NrU2l6ZTogMQoJICAgIH0pOwoKCSAgICAvKioKCSAgICAgKiBNb2RlIG5hbWVzcGFjZS4KCSAgICAgKi8KCSAgICB2YXIgQ19tb2RlID0gQy5tb2RlID0ge307CgoJICAgIC8qKgoJICAgICAqIEFic3RyYWN0IGJhc2UgYmxvY2sgY2lwaGVyIG1vZGUgdGVtcGxhdGUuCgkgICAgICovCgkgICAgdmFyIEJsb2NrQ2lwaGVyTW9kZSA9IENfbGliLkJsb2NrQ2lwaGVyTW9kZSA9IEJhc2UuZXh0ZW5kKHsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENyZWF0ZXMgdGhpcyBtb2RlIGZvciBlbmNyeXB0aW9uLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge0NpcGhlcn0gY2lwaGVyIEEgYmxvY2sgY2lwaGVyIGluc3RhbmNlLgoJICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBpdiBUaGUgSVYgd29yZHMuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBzdGF0aWMKCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBtb2RlID0gQ3J5cHRvSlMubW9kZS5DQkMuY3JlYXRlRW5jcnlwdG9yKGNpcGhlciwgaXYud29yZHMpOwoJICAgICAgICAgKi8KCSAgICAgICAgY3JlYXRlRW5jcnlwdG9yOiBmdW5jdGlvbiAoY2lwaGVyLCBpdikgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuRW5jcnlwdG9yLmNyZWF0ZShjaXBoZXIsIGl2KTsKCSAgICAgICAgfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBDcmVhdGVzIHRoaXMgbW9kZSBmb3IgZGVjcnlwdGlvbi4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtDaXBoZXJ9IGNpcGhlciBBIGJsb2NrIGNpcGhlciBpbnN0YW5jZS4KCSAgICAgICAgICogQHBhcmFtIHtBcnJheX0gaXYgVGhlIElWIHdvcmRzLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgbW9kZSA9IENyeXB0b0pTLm1vZGUuQ0JDLmNyZWF0ZURlY3J5cHRvcihjaXBoZXIsIGl2LndvcmRzKTsKCSAgICAgICAgICovCgkgICAgICAgIGNyZWF0ZURlY3J5cHRvcjogZnVuY3Rpb24gKGNpcGhlciwgaXYpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLkRlY3J5cHRvci5jcmVhdGUoY2lwaGVyLCBpdik7CgkgICAgICAgIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogSW5pdGlhbGl6ZXMgYSBuZXdseSBjcmVhdGVkIG1vZGUuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7Q2lwaGVyfSBjaXBoZXIgQSBibG9jayBjaXBoZXIgaW5zdGFuY2UuCgkgICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IGl2IFRoZSBJViB3b3Jkcy4KCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBtb2RlID0gQ3J5cHRvSlMubW9kZS5DQkMuRW5jcnlwdG9yLmNyZWF0ZShjaXBoZXIsIGl2LndvcmRzKTsKCSAgICAgICAgICovCgkgICAgICAgIGluaXQ6IGZ1bmN0aW9uIChjaXBoZXIsIGl2KSB7CgkgICAgICAgICAgICB0aGlzLl9jaXBoZXIgPSBjaXBoZXI7CgkgICAgICAgICAgICB0aGlzLl9pdiA9IGl2OwoJICAgICAgICB9CgkgICAgfSk7CgoJICAgIC8qKgoJICAgICAqIENpcGhlciBCbG9jayBDaGFpbmluZyBtb2RlLgoJICAgICAqLwoJICAgIHZhciBDQkMgPSBDX21vZGUuQ0JDID0gKGZ1bmN0aW9uICgpIHsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEFic3RyYWN0IGJhc2UgQ0JDIG1vZGUuCgkgICAgICAgICAqLwoJICAgICAgICB2YXIgQ0JDID0gQmxvY2tDaXBoZXJNb2RlLmV4dGVuZCgpOwoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENCQyBlbmNyeXB0b3IuCgkgICAgICAgICAqLwoJICAgICAgICBDQkMuRW5jcnlwdG9yID0gQ0JDLmV4dGVuZCh7CgkgICAgICAgICAgICAvKioKCSAgICAgICAgICAgICAqIFByb2Nlc3NlcyB0aGUgZGF0YSBibG9jayBhdCBvZmZzZXQuCgkgICAgICAgICAgICAgKgoJICAgICAgICAgICAgICogQHBhcmFtIHtBcnJheX0gd29yZHMgVGhlIGRhdGEgd29yZHMgdG8gb3BlcmF0ZSBvbi4KCSAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBvZmZzZXQgVGhlIG9mZnNldCB3aGVyZSB0aGUgYmxvY2sgc3RhcnRzLgoJICAgICAgICAgICAgICoKCSAgICAgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAgICAgKgoJICAgICAgICAgICAgICogICAgIG1vZGUucHJvY2Vzc0Jsb2NrKGRhdGEud29yZHMsIG9mZnNldCk7CgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIHByb2Nlc3NCbG9jazogZnVuY3Rpb24gKHdvcmRzLCBvZmZzZXQpIHsKCSAgICAgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgICAgICB2YXIgY2lwaGVyID0gdGhpcy5fY2lwaGVyOwoJICAgICAgICAgICAgICAgIHZhciBibG9ja1NpemUgPSBjaXBoZXIuYmxvY2tTaXplOwoKCSAgICAgICAgICAgICAgICAvLyBYT1IgYW5kIGVuY3J5cHQKCSAgICAgICAgICAgICAgICB4b3JCbG9jay5jYWxsKHRoaXMsIHdvcmRzLCBvZmZzZXQsIGJsb2NrU2l6ZSk7CgkgICAgICAgICAgICAgICAgY2lwaGVyLmVuY3J5cHRCbG9jayh3b3Jkcywgb2Zmc2V0KTsKCgkgICAgICAgICAgICAgICAgLy8gUmVtZW1iZXIgdGhpcyBibG9jayB0byB1c2Ugd2l0aCBuZXh0IGJsb2NrCgkgICAgICAgICAgICAgICAgdGhpcy5fcHJldkJsb2NrID0gd29yZHMuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyBibG9ja1NpemUpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9KTsKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBDQkMgZGVjcnlwdG9yLgoJICAgICAgICAgKi8KCSAgICAgICAgQ0JDLkRlY3J5cHRvciA9IENCQy5leHRlbmQoewoJICAgICAgICAgICAgLyoqCgkgICAgICAgICAgICAgKiBQcm9jZXNzZXMgdGhlIGRhdGEgYmxvY2sgYXQgb2Zmc2V0LgoJICAgICAgICAgICAgICoKCSAgICAgICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHdvcmRzIFRoZSBkYXRhIHdvcmRzIHRvIG9wZXJhdGUgb24uCgkgICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gb2Zmc2V0IFRoZSBvZmZzZXQgd2hlcmUgdGhlIGJsb2NrIHN0YXJ0cy4KCSAgICAgICAgICAgICAqCgkgICAgICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgICAgICoKCSAgICAgICAgICAgICAqICAgICBtb2RlLnByb2Nlc3NCbG9jayhkYXRhLndvcmRzLCBvZmZzZXQpOwoJICAgICAgICAgICAgICovCgkgICAgICAgICAgICBwcm9jZXNzQmxvY2s6IGZ1bmN0aW9uICh3b3Jkcywgb2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICAgICAgdmFyIGNpcGhlciA9IHRoaXMuX2NpcGhlcjsKCSAgICAgICAgICAgICAgICB2YXIgYmxvY2tTaXplID0gY2lwaGVyLmJsb2NrU2l6ZTsKCgkgICAgICAgICAgICAgICAgLy8gUmVtZW1iZXIgdGhpcyBibG9jayB0byB1c2Ugd2l0aCBuZXh0IGJsb2NrCgkgICAgICAgICAgICAgICAgdmFyIHRoaXNCbG9jayA9IHdvcmRzLnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgYmxvY2tTaXplKTsKCgkgICAgICAgICAgICAgICAgLy8gRGVjcnlwdCBhbmQgWE9SCgkgICAgICAgICAgICAgICAgY2lwaGVyLmRlY3J5cHRCbG9jayh3b3Jkcywgb2Zmc2V0KTsKCSAgICAgICAgICAgICAgICB4b3JCbG9jay5jYWxsKHRoaXMsIHdvcmRzLCBvZmZzZXQsIGJsb2NrU2l6ZSk7CgoJICAgICAgICAgICAgICAgIC8vIFRoaXMgYmxvY2sgYmVjb21lcyB0aGUgcHJldmlvdXMgYmxvY2sKCSAgICAgICAgICAgICAgICB0aGlzLl9wcmV2QmxvY2sgPSB0aGlzQmxvY2s7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0pOwoKCSAgICAgICAgZnVuY3Rpb24geG9yQmxvY2sod29yZHMsIG9mZnNldCwgYmxvY2tTaXplKSB7CgkgICAgICAgICAgICB2YXIgYmxvY2s7CgoJICAgICAgICAgICAgLy8gU2hvcnRjdXQKCSAgICAgICAgICAgIHZhciBpdiA9IHRoaXMuX2l2OwoKCSAgICAgICAgICAgIC8vIENob29zZSBtaXhpbmcgYmxvY2sKCSAgICAgICAgICAgIGlmIChpdikgewoJICAgICAgICAgICAgICAgIGJsb2NrID0gaXY7CgoJICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBJViBmb3Igc3Vic2VxdWVudCBibG9ja3MKCSAgICAgICAgICAgICAgICB0aGlzLl9pdiA9IHVuZGVmaW5lZDsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgYmxvY2sgPSB0aGlzLl9wcmV2QmxvY2s7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gWE9SIGJsb2NrcwoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBibG9ja1NpemU7IGkrKykgewoJICAgICAgICAgICAgICAgIHdvcmRzW29mZnNldCArIGldIF49IGJsb2NrW2ldOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICByZXR1cm4gQ0JDOwoJICAgIH0oKSk7CgoJICAgIC8qKgoJICAgICAqIFBhZGRpbmcgbmFtZXNwYWNlLgoJICAgICAqLwoJICAgIHZhciBDX3BhZCA9IEMucGFkID0ge307CgoJICAgIC8qKgoJICAgICAqIFBLQ1MgIzUvNyBwYWRkaW5nIHN0cmF0ZWd5LgoJICAgICAqLwoJICAgIHZhciBQa2NzNyA9IENfcGFkLlBrY3M3ID0gewoJICAgICAgICAvKioKCSAgICAgICAgICogUGFkcyBkYXRhIHVzaW5nIHRoZSBhbGdvcml0aG0gZGVmaW5lZCBpbiBQS0NTICM1LzcuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSBkYXRhIFRoZSBkYXRhIHRvIHBhZC4KCSAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGJsb2NrU2l6ZSBUaGUgbXVsdGlwbGUgdGhhdCB0aGUgZGF0YSBzaG91bGQgYmUgcGFkZGVkIHRvLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICBDcnlwdG9KUy5wYWQuUGtjczcucGFkKHdvcmRBcnJheSwgNCk7CgkgICAgICAgICAqLwoJICAgICAgICBwYWQ6IGZ1bmN0aW9uIChkYXRhLCBibG9ja1NpemUpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0CgkgICAgICAgICAgICB2YXIgYmxvY2tTaXplQnl0ZXMgPSBibG9ja1NpemUgKiA0OwoKCSAgICAgICAgICAgIC8vIENvdW50IHBhZGRpbmcgYnl0ZXMKCSAgICAgICAgICAgIHZhciBuUGFkZGluZ0J5dGVzID0gYmxvY2tTaXplQnl0ZXMgLSBkYXRhLnNpZ0J5dGVzICUgYmxvY2tTaXplQnl0ZXM7CgoJICAgICAgICAgICAgLy8gQ3JlYXRlIHBhZGRpbmcgd29yZAoJICAgICAgICAgICAgdmFyIHBhZGRpbmdXb3JkID0gKG5QYWRkaW5nQnl0ZXMgPDwgMjQpIHwgKG5QYWRkaW5nQnl0ZXMgPDwgMTYpIHwgKG5QYWRkaW5nQnl0ZXMgPDwgOCkgfCBuUGFkZGluZ0J5dGVzOwoKCSAgICAgICAgICAgIC8vIENyZWF0ZSBwYWRkaW5nCgkgICAgICAgICAgICB2YXIgcGFkZGluZ1dvcmRzID0gW107CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5QYWRkaW5nQnl0ZXM7IGkgKz0gNCkgewoJICAgICAgICAgICAgICAgIHBhZGRpbmdXb3Jkcy5wdXNoKHBhZGRpbmdXb3JkKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciBwYWRkaW5nID0gV29yZEFycmF5LmNyZWF0ZShwYWRkaW5nV29yZHMsIG5QYWRkaW5nQnl0ZXMpOwoKCSAgICAgICAgICAgIC8vIEFkZCBwYWRkaW5nCgkgICAgICAgICAgICBkYXRhLmNvbmNhdChwYWRkaW5nKTsKCSAgICAgICAgfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBVbnBhZHMgZGF0YSB0aGF0IGhhZCBiZWVuIHBhZGRlZCB1c2luZyB0aGUgYWxnb3JpdGhtIGRlZmluZWQgaW4gUEtDUyAjNS83LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0gZGF0YSBUaGUgZGF0YSB0byB1bnBhZC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHN0YXRpYwoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgQ3J5cHRvSlMucGFkLlBrY3M3LnVucGFkKHdvcmRBcnJheSk7CgkgICAgICAgICAqLwoJICAgICAgICB1bnBhZDogZnVuY3Rpb24gKGRhdGEpIHsKCSAgICAgICAgICAgIC8vIEdldCBudW1iZXIgb2YgcGFkZGluZyBieXRlcyBmcm9tIGxhc3QgYnl0ZQoJICAgICAgICAgICAgdmFyIG5QYWRkaW5nQnl0ZXMgPSBkYXRhLndvcmRzWyhkYXRhLnNpZ0J5dGVzIC0gMSkgPj4+IDJdICYgMHhmZjsKCgkgICAgICAgICAgICAvLyBSZW1vdmUgcGFkZGluZwoJICAgICAgICAgICAgZGF0YS5zaWdCeXRlcyAtPSBuUGFkZGluZ0J5dGVzOwoJICAgICAgICB9CgkgICAgfTsKCgkgICAgLyoqCgkgICAgICogQWJzdHJhY3QgYmFzZSBibG9jayBjaXBoZXIgdGVtcGxhdGUuCgkgICAgICoKCSAgICAgKiBAcHJvcGVydHkge251bWJlcn0gYmxvY2tTaXplIFRoZSBudW1iZXIgb2YgMzItYml0IHdvcmRzIHRoaXMgY2lwaGVyIG9wZXJhdGVzIG9uLiBEZWZhdWx0OiA0ICgxMjggYml0cykKCSAgICAgKi8KCSAgICB2YXIgQmxvY2tDaXBoZXIgPSBDX2xpYi5CbG9ja0NpcGhlciA9IENpcGhlci5leHRlbmQoewoJICAgICAgICAvKioKCSAgICAgICAgICogQ29uZmlndXJhdGlvbiBvcHRpb25zLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcHJvcGVydHkge01vZGV9IG1vZGUgVGhlIGJsb2NrIG1vZGUgdG8gdXNlLiBEZWZhdWx0OiBDQkMKCSAgICAgICAgICogQHByb3BlcnR5IHtQYWRkaW5nfSBwYWRkaW5nIFRoZSBwYWRkaW5nIHN0cmF0ZWd5IHRvIHVzZS4gRGVmYXVsdDogUGtjczcKCSAgICAgICAgICovCgkgICAgICAgIGNmZzogQ2lwaGVyLmNmZy5leHRlbmQoewoJICAgICAgICAgICAgbW9kZTogQ0JDLAoJICAgICAgICAgICAgcGFkZGluZzogUGtjczcKCSAgICAgICAgfSksCgoJICAgICAgICByZXNldDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgdmFyIG1vZGVDcmVhdG9yOwoKCSAgICAgICAgICAgIC8vIFJlc2V0IGNpcGhlcgoJICAgICAgICAgICAgQ2lwaGVyLnJlc2V0LmNhbGwodGhpcyk7CgoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIgY2ZnID0gdGhpcy5jZmc7CgkgICAgICAgICAgICB2YXIgaXYgPSBjZmcuaXY7CgkgICAgICAgICAgICB2YXIgbW9kZSA9IGNmZy5tb2RlOwoKCSAgICAgICAgICAgIC8vIFJlc2V0IGJsb2NrIG1vZGUKCSAgICAgICAgICAgIGlmICh0aGlzLl94Zm9ybU1vZGUgPT0gdGhpcy5fRU5DX1hGT1JNX01PREUpIHsKCSAgICAgICAgICAgICAgICBtb2RlQ3JlYXRvciA9IG1vZGUuY3JlYXRlRW5jcnlwdG9yOwoJICAgICAgICAgICAgfSBlbHNlIC8qIGlmICh0aGlzLl94Zm9ybU1vZGUgPT0gdGhpcy5fREVDX1hGT1JNX01PREUpICovIHsKCSAgICAgICAgICAgICAgICBtb2RlQ3JlYXRvciA9IG1vZGUuY3JlYXRlRGVjcnlwdG9yOwoJICAgICAgICAgICAgICAgIC8vIEtlZXAgYXQgbGVhc3Qgb25lIGJsb2NrIGluIHRoZSBidWZmZXIgZm9yIHVucGFkZGluZwoJICAgICAgICAgICAgICAgIHRoaXMuX21pbkJ1ZmZlclNpemUgPSAxOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmICh0aGlzLl9tb2RlICYmIHRoaXMuX21vZGUuX19jcmVhdG9yID09IG1vZGVDcmVhdG9yKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5fbW9kZS5pbml0KHRoaXMsIGl2ICYmIGl2LndvcmRzKTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5fbW9kZSA9IG1vZGVDcmVhdG9yLmNhbGwobW9kZSwgdGhpcywgaXYgJiYgaXYud29yZHMpOwoJICAgICAgICAgICAgICAgIHRoaXMuX21vZGUuX19jcmVhdG9yID0gbW9kZUNyZWF0b3I7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0sCgoJICAgICAgICBfZG9Qcm9jZXNzQmxvY2s6IGZ1bmN0aW9uICh3b3Jkcywgb2Zmc2V0KSB7CgkgICAgICAgICAgICB0aGlzLl9tb2RlLnByb2Nlc3NCbG9jayh3b3Jkcywgb2Zmc2V0KTsKCSAgICAgICAgfSwKCgkgICAgICAgIF9kb0ZpbmFsaXplOiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB2YXIgZmluYWxQcm9jZXNzZWRCbG9ja3M7CgoJICAgICAgICAgICAgLy8gU2hvcnRjdXQKCSAgICAgICAgICAgIHZhciBwYWRkaW5nID0gdGhpcy5jZmcucGFkZGluZzsKCgkgICAgICAgICAgICAvLyBGaW5hbGl6ZQoJICAgICAgICAgICAgaWYgKHRoaXMuX3hmb3JtTW9kZSA9PSB0aGlzLl9FTkNfWEZPUk1fTU9ERSkgewoJICAgICAgICAgICAgICAgIC8vIFBhZCBkYXRhCgkgICAgICAgICAgICAgICAgcGFkZGluZy5wYWQodGhpcy5fZGF0YSwgdGhpcy5ibG9ja1NpemUpOwoKCSAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGZpbmFsIGJsb2NrcwoJICAgICAgICAgICAgICAgIGZpbmFsUHJvY2Vzc2VkQmxvY2tzID0gdGhpcy5fcHJvY2VzcyghISdmbHVzaCcpOwoJICAgICAgICAgICAgfSBlbHNlIC8qIGlmICh0aGlzLl94Zm9ybU1vZGUgPT0gdGhpcy5fREVDX1hGT1JNX01PREUpICovIHsKCSAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGZpbmFsIGJsb2NrcwoJICAgICAgICAgICAgICAgIGZpbmFsUHJvY2Vzc2VkQmxvY2tzID0gdGhpcy5fcHJvY2VzcyghISdmbHVzaCcpOwoKCSAgICAgICAgICAgICAgICAvLyBVbnBhZCBkYXRhCgkgICAgICAgICAgICAgICAgcGFkZGluZy51bnBhZChmaW5hbFByb2Nlc3NlZEJsb2Nrcyk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgcmV0dXJuIGZpbmFsUHJvY2Vzc2VkQmxvY2tzOwoJICAgICAgICB9LAoKCSAgICAgICAgYmxvY2tTaXplOiAxMjgvMzIKCSAgICB9KTsKCgkgICAgLyoqCgkgICAgICogQSBjb2xsZWN0aW9uIG9mIGNpcGhlciBwYXJhbWV0ZXJzLgoJICAgICAqCgkgICAgICogQHByb3BlcnR5IHtXb3JkQXJyYXl9IGNpcGhlcnRleHQgVGhlIHJhdyBjaXBoZXJ0ZXh0LgoJICAgICAqIEBwcm9wZXJ0eSB7V29yZEFycmF5fSBrZXkgVGhlIGtleSB0byB0aGlzIGNpcGhlcnRleHQuCgkgICAgICogQHByb3BlcnR5IHtXb3JkQXJyYXl9IGl2IFRoZSBJViB1c2VkIGluIHRoZSBjaXBoZXJpbmcgb3BlcmF0aW9uLgoJICAgICAqIEBwcm9wZXJ0eSB7V29yZEFycmF5fSBzYWx0IFRoZSBzYWx0IHVzZWQgd2l0aCBhIGtleSBkZXJpdmF0aW9uIGZ1bmN0aW9uLgoJICAgICAqIEBwcm9wZXJ0eSB7Q2lwaGVyfSBhbGdvcml0aG0gVGhlIGNpcGhlciBhbGdvcml0aG0uCgkgICAgICogQHByb3BlcnR5IHtNb2RlfSBtb2RlIFRoZSBibG9jayBtb2RlIHVzZWQgaW4gdGhlIGNpcGhlcmluZyBvcGVyYXRpb24uCgkgICAgICogQHByb3BlcnR5IHtQYWRkaW5nfSBwYWRkaW5nIFRoZSBwYWRkaW5nIHNjaGVtZSB1c2VkIGluIHRoZSBjaXBoZXJpbmcgb3BlcmF0aW9uLgoJICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBibG9ja1NpemUgVGhlIGJsb2NrIHNpemUgb2YgdGhlIGNpcGhlci4KCSAgICAgKiBAcHJvcGVydHkge0Zvcm1hdH0gZm9ybWF0dGVyIFRoZSBkZWZhdWx0IGZvcm1hdHRpbmcgc3RyYXRlZ3kgdG8gY29udmVydCB0aGlzIGNpcGhlciBwYXJhbXMgb2JqZWN0IHRvIGEgc3RyaW5nLgoJICAgICAqLwoJICAgIHZhciBDaXBoZXJQYXJhbXMgPSBDX2xpYi5DaXBoZXJQYXJhbXMgPSBCYXNlLmV4dGVuZCh7CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQgY2lwaGVyIHBhcmFtcyBvYmplY3QuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjaXBoZXJQYXJhbXMgQW4gb2JqZWN0IHdpdGggYW55IG9mIHRoZSBwb3NzaWJsZSBjaXBoZXIgcGFyYW1ldGVycy4KCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBjaXBoZXJQYXJhbXMgPSBDcnlwdG9KUy5saWIuQ2lwaGVyUGFyYW1zLmNyZWF0ZSh7CgkgICAgICAgICAqICAgICAgICAgY2lwaGVydGV4dDogY2lwaGVydGV4dFdvcmRBcnJheSwKCSAgICAgICAgICogICAgICAgICBrZXk6IGtleVdvcmRBcnJheSwKCSAgICAgICAgICogICAgICAgICBpdjogaXZXb3JkQXJyYXksCgkgICAgICAgICAqICAgICAgICAgc2FsdDogc2FsdFdvcmRBcnJheSwKCSAgICAgICAgICogICAgICAgICBhbGdvcml0aG06IENyeXB0b0pTLmFsZ28uQUVTLAoJICAgICAgICAgKiAgICAgICAgIG1vZGU6IENyeXB0b0pTLm1vZGUuQ0JDLAoJICAgICAgICAgKiAgICAgICAgIHBhZGRpbmc6IENyeXB0b0pTLnBhZC5QS0NTNywKCSAgICAgICAgICogICAgICAgICBibG9ja1NpemU6IDQsCgkgICAgICAgICAqICAgICAgICAgZm9ybWF0dGVyOiBDcnlwdG9KUy5mb3JtYXQuT3BlblNTTAoJICAgICAgICAgKiAgICAgfSk7CgkgICAgICAgICAqLwoJICAgICAgICBpbml0OiBmdW5jdGlvbiAoY2lwaGVyUGFyYW1zKSB7CgkgICAgICAgICAgICB0aGlzLm1peEluKGNpcGhlclBhcmFtcyk7CgkgICAgICAgIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogQ29udmVydHMgdGhpcyBjaXBoZXIgcGFyYW1zIG9iamVjdCB0byBhIHN0cmluZy4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtGb3JtYXR9IGZvcm1hdHRlciAoT3B0aW9uYWwpIFRoZSBmb3JtYXR0aW5nIHN0cmF0ZWd5IHRvIHVzZS4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgc3RyaW5naWZpZWQgY2lwaGVyIHBhcmFtcy4KCSAgICAgICAgICoKCSAgICAgICAgICogQHRocm93cyBFcnJvciBJZiBuZWl0aGVyIHRoZSBmb3JtYXR0ZXIgbm9yIHRoZSBkZWZhdWx0IGZvcm1hdHRlciBpcyBzZXQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgc3RyaW5nID0gY2lwaGVyUGFyYW1zICsgJyc7CgkgICAgICAgICAqICAgICB2YXIgc3RyaW5nID0gY2lwaGVyUGFyYW1zLnRvU3RyaW5nKCk7CgkgICAgICAgICAqICAgICB2YXIgc3RyaW5nID0gY2lwaGVyUGFyYW1zLnRvU3RyaW5nKENyeXB0b0pTLmZvcm1hdC5PcGVuU1NMKTsKCSAgICAgICAgICovCgkgICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoZm9ybWF0dGVyKSB7CgkgICAgICAgICAgICByZXR1cm4gKGZvcm1hdHRlciB8fCB0aGlzLmZvcm1hdHRlcikuc3RyaW5naWZ5KHRoaXMpOwoJICAgICAgICB9CgkgICAgfSk7CgoJICAgIC8qKgoJICAgICAqIEZvcm1hdCBuYW1lc3BhY2UuCgkgICAgICovCgkgICAgdmFyIENfZm9ybWF0ID0gQy5mb3JtYXQgPSB7fTsKCgkgICAgLyoqCgkgICAgICogT3BlblNTTCBmb3JtYXR0aW5nIHN0cmF0ZWd5LgoJICAgICAqLwoJICAgIHZhciBPcGVuU1NMRm9ybWF0dGVyID0gQ19mb3JtYXQuT3BlblNTTCA9IHsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENvbnZlcnRzIGEgY2lwaGVyIHBhcmFtcyBvYmplY3QgdG8gYW4gT3BlblNTTC1jb21wYXRpYmxlIHN0cmluZy4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtDaXBoZXJQYXJhbXN9IGNpcGhlclBhcmFtcyBUaGUgY2lwaGVyIHBhcmFtcyBvYmplY3QuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIE9wZW5TU0wtY29tcGF0aWJsZSBzdHJpbmcuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBzdGF0aWMKCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBvcGVuU1NMU3RyaW5nID0gQ3J5cHRvSlMuZm9ybWF0Lk9wZW5TU0wuc3RyaW5naWZ5KGNpcGhlclBhcmFtcyk7CgkgICAgICAgICAqLwoJICAgICAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uIChjaXBoZXJQYXJhbXMpIHsKCSAgICAgICAgICAgIHZhciB3b3JkQXJyYXk7CgoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIgY2lwaGVydGV4dCA9IGNpcGhlclBhcmFtcy5jaXBoZXJ0ZXh0OwoJICAgICAgICAgICAgdmFyIHNhbHQgPSBjaXBoZXJQYXJhbXMuc2FsdDsKCgkgICAgICAgICAgICAvLyBGb3JtYXQKCSAgICAgICAgICAgIGlmIChzYWx0KSB7CgkgICAgICAgICAgICAgICAgd29yZEFycmF5ID0gV29yZEFycmF5LmNyZWF0ZShbMHg1MzYxNmM3NCwgMHg2NTY0NWY1Zl0pLmNvbmNhdChzYWx0KS5jb25jYXQoY2lwaGVydGV4dCk7CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIHdvcmRBcnJheSA9IGNpcGhlcnRleHQ7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgcmV0dXJuIHdvcmRBcnJheS50b1N0cmluZyhCYXNlNjQpOwoJICAgICAgICB9LAoKCSAgICAgICAgLyoqCgkgICAgICAgICAqIENvbnZlcnRzIGFuIE9wZW5TU0wtY29tcGF0aWJsZSBzdHJpbmcgdG8gYSBjaXBoZXIgcGFyYW1zIG9iamVjdC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG9wZW5TU0xTdHIgVGhlIE9wZW5TU0wtY29tcGF0aWJsZSBzdHJpbmcuCgkgICAgICAgICAqCgkgICAgICAgICAqIEByZXR1cm4ge0NpcGhlclBhcmFtc30gVGhlIGNpcGhlciBwYXJhbXMgb2JqZWN0LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgY2lwaGVyUGFyYW1zID0gQ3J5cHRvSlMuZm9ybWF0Lk9wZW5TU0wucGFyc2Uob3BlblNTTFN0cmluZyk7CgkgICAgICAgICAqLwoJICAgICAgICBwYXJzZTogZnVuY3Rpb24gKG9wZW5TU0xTdHIpIHsKCSAgICAgICAgICAgIHZhciBzYWx0OwoKCSAgICAgICAgICAgIC8vIFBhcnNlIGJhc2U2NAoJICAgICAgICAgICAgdmFyIGNpcGhlcnRleHQgPSBCYXNlNjQucGFyc2Uob3BlblNTTFN0cik7CgoJICAgICAgICAgICAgLy8gU2hvcnRjdXQKCSAgICAgICAgICAgIHZhciBjaXBoZXJ0ZXh0V29yZHMgPSBjaXBoZXJ0ZXh0LndvcmRzOwoKCSAgICAgICAgICAgIC8vIFRlc3QgZm9yIHNhbHQKCSAgICAgICAgICAgIGlmIChjaXBoZXJ0ZXh0V29yZHNbMF0gPT0gMHg1MzYxNmM3NCAmJiBjaXBoZXJ0ZXh0V29yZHNbMV0gPT0gMHg2NTY0NWY1ZikgewoJICAgICAgICAgICAgICAgIC8vIEV4dHJhY3Qgc2FsdAoJICAgICAgICAgICAgICAgIHNhbHQgPSBXb3JkQXJyYXkuY3JlYXRlKGNpcGhlcnRleHRXb3Jkcy5zbGljZSgyLCA0KSk7CgoJICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBzYWx0IGZyb20gY2lwaGVydGV4dAoJICAgICAgICAgICAgICAgIGNpcGhlcnRleHRXb3Jkcy5zcGxpY2UoMCwgNCk7CgkgICAgICAgICAgICAgICAgY2lwaGVydGV4dC5zaWdCeXRlcyAtPSAxNjsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZXR1cm4gQ2lwaGVyUGFyYW1zLmNyZWF0ZSh7IGNpcGhlcnRleHQ6IGNpcGhlcnRleHQsIHNhbHQ6IHNhbHQgfSk7CgkgICAgICAgIH0KCSAgICB9OwoKCSAgICAvKioKCSAgICAgKiBBIGNpcGhlciB3cmFwcGVyIHRoYXQgcmV0dXJucyBjaXBoZXJ0ZXh0IGFzIGEgc2VyaWFsaXphYmxlIGNpcGhlciBwYXJhbXMgb2JqZWN0LgoJICAgICAqLwoJICAgIHZhciBTZXJpYWxpemFibGVDaXBoZXIgPSBDX2xpYi5TZXJpYWxpemFibGVDaXBoZXIgPSBCYXNlLmV4dGVuZCh7CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBDb25maWd1cmF0aW9uIG9wdGlvbnMuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwcm9wZXJ0eSB7Rm9ybWF0dGVyfSBmb3JtYXQgVGhlIGZvcm1hdHRpbmcgc3RyYXRlZ3kgdG8gY29udmVydCBjaXBoZXIgcGFyYW0gb2JqZWN0cyB0byBhbmQgZnJvbSBhIHN0cmluZy4gRGVmYXVsdDogT3BlblNTTAoJICAgICAgICAgKi8KCSAgICAgICAgY2ZnOiBCYXNlLmV4dGVuZCh7CgkgICAgICAgICAgICBmb3JtYXQ6IE9wZW5TU0xGb3JtYXR0ZXIKCSAgICAgICAgfSksCgoJICAgICAgICAvKioKCSAgICAgICAgICogRW5jcnlwdHMgYSBtZXNzYWdlLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge0NpcGhlcn0gY2lwaGVyIFRoZSBjaXBoZXIgYWxnb3JpdGhtIHRvIHVzZS4KCSAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIGVuY3J5cHQuCgkgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSBrZXkgVGhlIGtleS4KCSAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyAoT3B0aW9uYWwpIFRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMgdG8gdXNlIGZvciB0aGlzIG9wZXJhdGlvbi4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7Q2lwaGVyUGFyYW1zfSBBIGNpcGhlciBwYXJhbXMgb2JqZWN0LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgY2lwaGVydGV4dFBhcmFtcyA9IENyeXB0b0pTLmxpYi5TZXJpYWxpemFibGVDaXBoZXIuZW5jcnlwdChDcnlwdG9KUy5hbGdvLkFFUywgbWVzc2FnZSwga2V5KTsKCSAgICAgICAgICogICAgIHZhciBjaXBoZXJ0ZXh0UGFyYW1zID0gQ3J5cHRvSlMubGliLlNlcmlhbGl6YWJsZUNpcGhlci5lbmNyeXB0KENyeXB0b0pTLmFsZ28uQUVTLCBtZXNzYWdlLCBrZXksIHsgaXY6IGl2IH0pOwoJICAgICAgICAgKiAgICAgdmFyIGNpcGhlcnRleHRQYXJhbXMgPSBDcnlwdG9KUy5saWIuU2VyaWFsaXphYmxlQ2lwaGVyLmVuY3J5cHQoQ3J5cHRvSlMuYWxnby5BRVMsIG1lc3NhZ2UsIGtleSwgeyBpdjogaXYsIGZvcm1hdDogQ3J5cHRvSlMuZm9ybWF0Lk9wZW5TU0wgfSk7CgkgICAgICAgICAqLwoJICAgICAgICBlbmNyeXB0OiBmdW5jdGlvbiAoY2lwaGVyLCBtZXNzYWdlLCBrZXksIGNmZykgewoJICAgICAgICAgICAgLy8gQXBwbHkgY29uZmlnIGRlZmF1bHRzCgkgICAgICAgICAgICBjZmcgPSB0aGlzLmNmZy5leHRlbmQoY2ZnKTsKCgkgICAgICAgICAgICAvLyBFbmNyeXB0CgkgICAgICAgICAgICB2YXIgZW5jcnlwdG9yID0gY2lwaGVyLmNyZWF0ZUVuY3J5cHRvcihrZXksIGNmZyk7CgkgICAgICAgICAgICB2YXIgY2lwaGVydGV4dCA9IGVuY3J5cHRvci5maW5hbGl6ZShtZXNzYWdlKTsKCgkgICAgICAgICAgICAvLyBTaG9ydGN1dAoJICAgICAgICAgICAgdmFyIGNpcGhlckNmZyA9IGVuY3J5cHRvci5jZmc7CgoJICAgICAgICAgICAgLy8gQ3JlYXRlIGFuZCByZXR1cm4gc2VyaWFsaXphYmxlIGNpcGhlciBwYXJhbXMKCSAgICAgICAgICAgIHJldHVybiBDaXBoZXJQYXJhbXMuY3JlYXRlKHsKCSAgICAgICAgICAgICAgICBjaXBoZXJ0ZXh0OiBjaXBoZXJ0ZXh0LAoJICAgICAgICAgICAgICAgIGtleToga2V5LAoJICAgICAgICAgICAgICAgIGl2OiBjaXBoZXJDZmcuaXYsCgkgICAgICAgICAgICAgICAgYWxnb3JpdGhtOiBjaXBoZXIsCgkgICAgICAgICAgICAgICAgbW9kZTogY2lwaGVyQ2ZnLm1vZGUsCgkgICAgICAgICAgICAgICAgcGFkZGluZzogY2lwaGVyQ2ZnLnBhZGRpbmcsCgkgICAgICAgICAgICAgICAgYmxvY2tTaXplOiBjaXBoZXIuYmxvY2tTaXplLAoJICAgICAgICAgICAgICAgIGZvcm1hdHRlcjogY2ZnLmZvcm1hdAoJICAgICAgICAgICAgfSk7CgkgICAgICAgIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogRGVjcnlwdHMgc2VyaWFsaXplZCBjaXBoZXJ0ZXh0LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge0NpcGhlcn0gY2lwaGVyIFRoZSBjaXBoZXIgYWxnb3JpdGhtIHRvIHVzZS4KCSAgICAgICAgICogQHBhcmFtIHtDaXBoZXJQYXJhbXN8c3RyaW5nfSBjaXBoZXJ0ZXh0IFRoZSBjaXBoZXJ0ZXh0IHRvIGRlY3J5cHQuCgkgICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSBrZXkgVGhlIGtleS4KCSAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyAoT3B0aW9uYWwpIFRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMgdG8gdXNlIGZvciB0aGlzIG9wZXJhdGlvbi4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgcGxhaW50ZXh0LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgcGxhaW50ZXh0ID0gQ3J5cHRvSlMubGliLlNlcmlhbGl6YWJsZUNpcGhlci5kZWNyeXB0KENyeXB0b0pTLmFsZ28uQUVTLCBmb3JtYXR0ZWRDaXBoZXJ0ZXh0LCBrZXksIHsgaXY6IGl2LCBmb3JtYXQ6IENyeXB0b0pTLmZvcm1hdC5PcGVuU1NMIH0pOwoJICAgICAgICAgKiAgICAgdmFyIHBsYWludGV4dCA9IENyeXB0b0pTLmxpYi5TZXJpYWxpemFibGVDaXBoZXIuZGVjcnlwdChDcnlwdG9KUy5hbGdvLkFFUywgY2lwaGVydGV4dFBhcmFtcywga2V5LCB7IGl2OiBpdiwgZm9ybWF0OiBDcnlwdG9KUy5mb3JtYXQuT3BlblNTTCB9KTsKCSAgICAgICAgICovCgkgICAgICAgIGRlY3J5cHQ6IGZ1bmN0aW9uIChjaXBoZXIsIGNpcGhlcnRleHQsIGtleSwgY2ZnKSB7CgkgICAgICAgICAgICAvLyBBcHBseSBjb25maWcgZGVmYXVsdHMKCSAgICAgICAgICAgIGNmZyA9IHRoaXMuY2ZnLmV4dGVuZChjZmcpOwoKCSAgICAgICAgICAgIC8vIENvbnZlcnQgc3RyaW5nIHRvIENpcGhlclBhcmFtcwoJICAgICAgICAgICAgY2lwaGVydGV4dCA9IHRoaXMuX3BhcnNlKGNpcGhlcnRleHQsIGNmZy5mb3JtYXQpOwoKCSAgICAgICAgICAgIC8vIERlY3J5cHQKCSAgICAgICAgICAgIHZhciBwbGFpbnRleHQgPSBjaXBoZXIuY3JlYXRlRGVjcnlwdG9yKGtleSwgY2ZnKS5maW5hbGl6ZShjaXBoZXJ0ZXh0LmNpcGhlcnRleHQpOwoKCSAgICAgICAgICAgIHJldHVybiBwbGFpbnRleHQ7CgkgICAgICAgIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogQ29udmVydHMgc2VyaWFsaXplZCBjaXBoZXJ0ZXh0IHRvIENpcGhlclBhcmFtcywKCSAgICAgICAgICogZWxzZSBhc3N1bWVkIENpcGhlclBhcmFtcyBhbHJlYWR5IGFuZCByZXR1cm5zIGNpcGhlcnRleHQgdW5jaGFuZ2VkLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcGFyYW0ge0NpcGhlclBhcmFtc3xzdHJpbmd9IGNpcGhlcnRleHQgVGhlIGNpcGhlcnRleHQuCgkgICAgICAgICAqIEBwYXJhbSB7Rm9ybWF0dGVyfSBmb3JtYXQgVGhlIGZvcm1hdHRpbmcgc3RyYXRlZ3kgdG8gdXNlIHRvIHBhcnNlIHNlcmlhbGl6ZWQgY2lwaGVydGV4dC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7Q2lwaGVyUGFyYW1zfSBUaGUgdW5zZXJpYWxpemVkIGNpcGhlcnRleHQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBzdGF0aWMKCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBjaXBoZXJ0ZXh0UGFyYW1zID0gQ3J5cHRvSlMubGliLlNlcmlhbGl6YWJsZUNpcGhlci5fcGFyc2UoY2lwaGVydGV4dFN0cmluZ09yUGFyYW1zLCBmb3JtYXQpOwoJICAgICAgICAgKi8KCSAgICAgICAgX3BhcnNlOiBmdW5jdGlvbiAoY2lwaGVydGV4dCwgZm9ybWF0KSB7CgkgICAgICAgICAgICBpZiAodHlwZW9mIGNpcGhlcnRleHQgPT0gJ3N0cmluZycpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0LnBhcnNlKGNpcGhlcnRleHQsIHRoaXMpOwoJICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gY2lwaGVydGV4dDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0pOwoKCSAgICAvKioKCSAgICAgKiBLZXkgZGVyaXZhdGlvbiBmdW5jdGlvbiBuYW1lc3BhY2UuCgkgICAgICovCgkgICAgdmFyIENfa2RmID0gQy5rZGYgPSB7fTsKCgkgICAgLyoqCgkgICAgICogT3BlblNTTCBrZXkgZGVyaXZhdGlvbiBmdW5jdGlvbi4KCSAgICAgKi8KCSAgICB2YXIgT3BlblNTTEtkZiA9IENfa2RmLk9wZW5TU0wgPSB7CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBEZXJpdmVzIGEga2V5IGFuZCBJViBmcm9tIGEgcGFzc3dvcmQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwYXNzd29yZCBUaGUgcGFzc3dvcmQgdG8gZGVyaXZlIGZyb20uCgkgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBrZXlTaXplIFRoZSBzaXplIGluIHdvcmRzIG9mIHRoZSBrZXkgdG8gZ2VuZXJhdGUuCgkgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpdlNpemUgVGhlIHNpemUgaW4gd29yZHMgb2YgdGhlIElWIHRvIGdlbmVyYXRlLgoJICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IHNhbHQgKE9wdGlvbmFsKSBBIDY0LWJpdCBzYWx0IHRvIHVzZS4gSWYgb21pdHRlZCwgYSBzYWx0IHdpbGwgYmUgZ2VuZXJhdGVkIHJhbmRvbWx5LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtDaXBoZXJQYXJhbXN9IEEgY2lwaGVyIHBhcmFtcyBvYmplY3Qgd2l0aCB0aGUga2V5LCBJViwgYW5kIHNhbHQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBzdGF0aWMKCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBkZXJpdmVkUGFyYW1zID0gQ3J5cHRvSlMua2RmLk9wZW5TU0wuZXhlY3V0ZSgnUGFzc3dvcmQnLCAyNTYvMzIsIDEyOC8zMik7CgkgICAgICAgICAqICAgICB2YXIgZGVyaXZlZFBhcmFtcyA9IENyeXB0b0pTLmtkZi5PcGVuU1NMLmV4ZWN1dGUoJ1Bhc3N3b3JkJywgMjU2LzMyLCAxMjgvMzIsICdzYWx0c2FsdCcpOwoJICAgICAgICAgKi8KCSAgICAgICAgZXhlY3V0ZTogZnVuY3Rpb24gKHBhc3N3b3JkLCBrZXlTaXplLCBpdlNpemUsIHNhbHQpIHsKCSAgICAgICAgICAgIC8vIEdlbmVyYXRlIHJhbmRvbSBzYWx0CgkgICAgICAgICAgICBpZiAoIXNhbHQpIHsKCSAgICAgICAgICAgICAgICBzYWx0ID0gV29yZEFycmF5LnJhbmRvbSg2NC84KTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBEZXJpdmUga2V5IGFuZCBJVgoJICAgICAgICAgICAgdmFyIGtleSA9IEV2cEtERi5jcmVhdGUoeyBrZXlTaXplOiBrZXlTaXplICsgaXZTaXplIH0pLmNvbXB1dGUocGFzc3dvcmQsIHNhbHQpOwoKCSAgICAgICAgICAgIC8vIFNlcGFyYXRlIGtleSBhbmQgSVYKCSAgICAgICAgICAgIHZhciBpdiA9IFdvcmRBcnJheS5jcmVhdGUoa2V5LndvcmRzLnNsaWNlKGtleVNpemUpLCBpdlNpemUgKiA0KTsKCSAgICAgICAgICAgIGtleS5zaWdCeXRlcyA9IGtleVNpemUgKiA0OwoKCSAgICAgICAgICAgIC8vIFJldHVybiBwYXJhbXMKCSAgICAgICAgICAgIHJldHVybiBDaXBoZXJQYXJhbXMuY3JlYXRlKHsga2V5OiBrZXksIGl2OiBpdiwgc2FsdDogc2FsdCB9KTsKCSAgICAgICAgfQoJICAgIH07CgoJICAgIC8qKgoJICAgICAqIEEgc2VyaWFsaXphYmxlIGNpcGhlciB3cmFwcGVyIHRoYXQgZGVyaXZlcyB0aGUga2V5IGZyb20gYSBwYXNzd29yZCwKCSAgICAgKiBhbmQgcmV0dXJucyBjaXBoZXJ0ZXh0IGFzIGEgc2VyaWFsaXphYmxlIGNpcGhlciBwYXJhbXMgb2JqZWN0LgoJICAgICAqLwoJICAgIHZhciBQYXNzd29yZEJhc2VkQ2lwaGVyID0gQ19saWIuUGFzc3dvcmRCYXNlZENpcGhlciA9IFNlcmlhbGl6YWJsZUNpcGhlci5leHRlbmQoewoJICAgICAgICAvKioKCSAgICAgICAgICogQ29uZmlndXJhdGlvbiBvcHRpb25zLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcHJvcGVydHkge0tERn0ga2RmIFRoZSBrZXkgZGVyaXZhdGlvbiBmdW5jdGlvbiB0byB1c2UgdG8gZ2VuZXJhdGUgYSBrZXkgYW5kIElWIGZyb20gYSBwYXNzd29yZC4gRGVmYXVsdDogT3BlblNTTAoJICAgICAgICAgKi8KCSAgICAgICAgY2ZnOiBTZXJpYWxpemFibGVDaXBoZXIuY2ZnLmV4dGVuZCh7CgkgICAgICAgICAgICBrZGY6IE9wZW5TU0xLZGYKCSAgICAgICAgfSksCgoJICAgICAgICAvKioKCSAgICAgICAgICogRW5jcnlwdHMgYSBtZXNzYWdlIHVzaW5nIGEgcGFzc3dvcmQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7Q2lwaGVyfSBjaXBoZXIgVGhlIGNpcGhlciBhbGdvcml0aG0gdG8gdXNlLgoJICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gZW5jcnlwdC4KCSAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHBhc3N3b3JkIFRoZSBwYXNzd29yZC4KCSAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyAoT3B0aW9uYWwpIFRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMgdG8gdXNlIGZvciB0aGlzIG9wZXJhdGlvbi4KCSAgICAgICAgICoKCSAgICAgICAgICogQHJldHVybiB7Q2lwaGVyUGFyYW1zfSBBIGNpcGhlciBwYXJhbXMgb2JqZWN0LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgY2lwaGVydGV4dFBhcmFtcyA9IENyeXB0b0pTLmxpYi5QYXNzd29yZEJhc2VkQ2lwaGVyLmVuY3J5cHQoQ3J5cHRvSlMuYWxnby5BRVMsIG1lc3NhZ2UsICdwYXNzd29yZCcpOwoJICAgICAgICAgKiAgICAgdmFyIGNpcGhlcnRleHRQYXJhbXMgPSBDcnlwdG9KUy5saWIuUGFzc3dvcmRCYXNlZENpcGhlci5lbmNyeXB0KENyeXB0b0pTLmFsZ28uQUVTLCBtZXNzYWdlLCAncGFzc3dvcmQnLCB7IGZvcm1hdDogQ3J5cHRvSlMuZm9ybWF0Lk9wZW5TU0wgfSk7CgkgICAgICAgICAqLwoJICAgICAgICBlbmNyeXB0OiBmdW5jdGlvbiAoY2lwaGVyLCBtZXNzYWdlLCBwYXNzd29yZCwgY2ZnKSB7CgkgICAgICAgICAgICAvLyBBcHBseSBjb25maWcgZGVmYXVsdHMKCSAgICAgICAgICAgIGNmZyA9IHRoaXMuY2ZnLmV4dGVuZChjZmcpOwoKCSAgICAgICAgICAgIC8vIERlcml2ZSBrZXkgYW5kIG90aGVyIHBhcmFtcwoJICAgICAgICAgICAgdmFyIGRlcml2ZWRQYXJhbXMgPSBjZmcua2RmLmV4ZWN1dGUocGFzc3dvcmQsIGNpcGhlci5rZXlTaXplLCBjaXBoZXIuaXZTaXplKTsKCgkgICAgICAgICAgICAvLyBBZGQgSVYgdG8gY29uZmlnCgkgICAgICAgICAgICBjZmcuaXYgPSBkZXJpdmVkUGFyYW1zLml2OwoKCSAgICAgICAgICAgIC8vIEVuY3J5cHQKCSAgICAgICAgICAgIHZhciBjaXBoZXJ0ZXh0ID0gU2VyaWFsaXphYmxlQ2lwaGVyLmVuY3J5cHQuY2FsbCh0aGlzLCBjaXBoZXIsIG1lc3NhZ2UsIGRlcml2ZWRQYXJhbXMua2V5LCBjZmcpOwoKCSAgICAgICAgICAgIC8vIE1peCBpbiBkZXJpdmVkIHBhcmFtcwoJICAgICAgICAgICAgY2lwaGVydGV4dC5taXhJbihkZXJpdmVkUGFyYW1zKTsKCgkgICAgICAgICAgICByZXR1cm4gY2lwaGVydGV4dDsKCSAgICAgICAgfSwKCgkgICAgICAgIC8qKgoJICAgICAgICAgKiBEZWNyeXB0cyBzZXJpYWxpemVkIGNpcGhlcnRleHQgdXNpbmcgYSBwYXNzd29yZC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtDaXBoZXJ9IGNpcGhlciBUaGUgY2lwaGVyIGFsZ29yaXRobSB0byB1c2UuCgkgICAgICAgICAqIEBwYXJhbSB7Q2lwaGVyUGFyYW1zfHN0cmluZ30gY2lwaGVydGV4dCBUaGUgY2lwaGVydGV4dCB0byBkZWNyeXB0LgoJICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gcGFzc3dvcmQgVGhlIHBhc3N3b3JkLgoJICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIChPcHRpb25hbCkgVGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyB0byB1c2UgZm9yIHRoaXMgb3BlcmF0aW9uLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBwbGFpbnRleHQuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBzdGF0aWMKCSAgICAgICAgICoKCSAgICAgICAgICogQGV4YW1wbGUKCSAgICAgICAgICoKCSAgICAgICAgICogICAgIHZhciBwbGFpbnRleHQgPSBDcnlwdG9KUy5saWIuUGFzc3dvcmRCYXNlZENpcGhlci5kZWNyeXB0KENyeXB0b0pTLmFsZ28uQUVTLCBmb3JtYXR0ZWRDaXBoZXJ0ZXh0LCAncGFzc3dvcmQnLCB7IGZvcm1hdDogQ3J5cHRvSlMuZm9ybWF0Lk9wZW5TU0wgfSk7CgkgICAgICAgICAqICAgICB2YXIgcGxhaW50ZXh0ID0gQ3J5cHRvSlMubGliLlBhc3N3b3JkQmFzZWRDaXBoZXIuZGVjcnlwdChDcnlwdG9KUy5hbGdvLkFFUywgY2lwaGVydGV4dFBhcmFtcywgJ3Bhc3N3b3JkJywgeyBmb3JtYXQ6IENyeXB0b0pTLmZvcm1hdC5PcGVuU1NMIH0pOwoJICAgICAgICAgKi8KCSAgICAgICAgZGVjcnlwdDogZnVuY3Rpb24gKGNpcGhlciwgY2lwaGVydGV4dCwgcGFzc3dvcmQsIGNmZykgewoJICAgICAgICAgICAgLy8gQXBwbHkgY29uZmlnIGRlZmF1bHRzCgkgICAgICAgICAgICBjZmcgPSB0aGlzLmNmZy5leHRlbmQoY2ZnKTsKCgkgICAgICAgICAgICAvLyBDb252ZXJ0IHN0cmluZyB0byBDaXBoZXJQYXJhbXMKCSAgICAgICAgICAgIGNpcGhlcnRleHQgPSB0aGlzLl9wYXJzZShjaXBoZXJ0ZXh0LCBjZmcuZm9ybWF0KTsKCgkgICAgICAgICAgICAvLyBEZXJpdmUga2V5IGFuZCBvdGhlciBwYXJhbXMKCSAgICAgICAgICAgIHZhciBkZXJpdmVkUGFyYW1zID0gY2ZnLmtkZi5leGVjdXRlKHBhc3N3b3JkLCBjaXBoZXIua2V5U2l6ZSwgY2lwaGVyLml2U2l6ZSwgY2lwaGVydGV4dC5zYWx0KTsKCgkgICAgICAgICAgICAvLyBBZGQgSVYgdG8gY29uZmlnCgkgICAgICAgICAgICBjZmcuaXYgPSBkZXJpdmVkUGFyYW1zLml2OwoKCSAgICAgICAgICAgIC8vIERlY3J5cHQKCSAgICAgICAgICAgIHZhciBwbGFpbnRleHQgPSBTZXJpYWxpemFibGVDaXBoZXIuZGVjcnlwdC5jYWxsKHRoaXMsIGNpcGhlciwgY2lwaGVydGV4dCwgZGVyaXZlZFBhcmFtcy5rZXksIGNmZyk7CgoJICAgICAgICAgICAgcmV0dXJuIHBsYWludGV4dDsKCSAgICAgICAgfQoJICAgIH0pOwoJfSgpKTsKCgoJLyoqCgkgKiBDaXBoZXIgRmVlZGJhY2sgYmxvY2sgbW9kZS4KCSAqLwoJQ3J5cHRvSlMubW9kZS5DRkIgPSAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBDRkIgPSBDcnlwdG9KUy5saWIuQmxvY2tDaXBoZXJNb2RlLmV4dGVuZCgpOwoKCSAgICBDRkIuRW5jcnlwdG9yID0gQ0ZCLmV4dGVuZCh7CgkgICAgICAgIHByb2Nlc3NCbG9jazogZnVuY3Rpb24gKHdvcmRzLCBvZmZzZXQpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIGNpcGhlciA9IHRoaXMuX2NpcGhlcjsKCSAgICAgICAgICAgIHZhciBibG9ja1NpemUgPSBjaXBoZXIuYmxvY2tTaXplOwoKCSAgICAgICAgICAgIGdlbmVyYXRlS2V5c3RyZWFtQW5kRW5jcnlwdC5jYWxsKHRoaXMsIHdvcmRzLCBvZmZzZXQsIGJsb2NrU2l6ZSwgY2lwaGVyKTsKCgkgICAgICAgICAgICAvLyBSZW1lbWJlciB0aGlzIGJsb2NrIHRvIHVzZSB3aXRoIG5leHQgYmxvY2sKCSAgICAgICAgICAgIHRoaXMuX3ByZXZCbG9jayA9IHdvcmRzLnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgYmxvY2tTaXplKTsKCSAgICAgICAgfQoJICAgIH0pOwoKCSAgICBDRkIuRGVjcnlwdG9yID0gQ0ZCLmV4dGVuZCh7CgkgICAgICAgIHByb2Nlc3NCbG9jazogZnVuY3Rpb24gKHdvcmRzLCBvZmZzZXQpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIGNpcGhlciA9IHRoaXMuX2NpcGhlcjsKCSAgICAgICAgICAgIHZhciBibG9ja1NpemUgPSBjaXBoZXIuYmxvY2tTaXplOwoKCSAgICAgICAgICAgIC8vIFJlbWVtYmVyIHRoaXMgYmxvY2sgdG8gdXNlIHdpdGggbmV4dCBibG9jawoJICAgICAgICAgICAgdmFyIHRoaXNCbG9jayA9IHdvcmRzLnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgYmxvY2tTaXplKTsKCgkgICAgICAgICAgICBnZW5lcmF0ZUtleXN0cmVhbUFuZEVuY3J5cHQuY2FsbCh0aGlzLCB3b3Jkcywgb2Zmc2V0LCBibG9ja1NpemUsIGNpcGhlcik7CgoJICAgICAgICAgICAgLy8gVGhpcyBibG9jayBiZWNvbWVzIHRoZSBwcmV2aW91cyBibG9jawoJICAgICAgICAgICAgdGhpcy5fcHJldkJsb2NrID0gdGhpc0Jsb2NrOwoJICAgICAgICB9CgkgICAgfSk7CgoJICAgIGZ1bmN0aW9uIGdlbmVyYXRlS2V5c3RyZWFtQW5kRW5jcnlwdCh3b3Jkcywgb2Zmc2V0LCBibG9ja1NpemUsIGNpcGhlcikgewoJICAgICAgICB2YXIga2V5c3RyZWFtOwoKCSAgICAgICAgLy8gU2hvcnRjdXQKCSAgICAgICAgdmFyIGl2ID0gdGhpcy5faXY7CgoJICAgICAgICAvLyBHZW5lcmF0ZSBrZXlzdHJlYW0KCSAgICAgICAgaWYgKGl2KSB7CgkgICAgICAgICAgICBrZXlzdHJlYW0gPSBpdi5zbGljZSgwKTsKCgkgICAgICAgICAgICAvLyBSZW1vdmUgSVYgZm9yIHN1YnNlcXVlbnQgYmxvY2tzCgkgICAgICAgICAgICB0aGlzLl9pdiA9IHVuZGVmaW5lZDsKCSAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgIGtleXN0cmVhbSA9IHRoaXMuX3ByZXZCbG9jazsKCSAgICAgICAgfQoJICAgICAgICBjaXBoZXIuZW5jcnlwdEJsb2NrKGtleXN0cmVhbSwgMCk7CgoJICAgICAgICAvLyBFbmNyeXB0CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYmxvY2tTaXplOyBpKyspIHsKCSAgICAgICAgICAgIHdvcmRzW29mZnNldCArIGldIF49IGtleXN0cmVhbVtpXTsKCSAgICAgICAgfQoJICAgIH0KCgkgICAgcmV0dXJuIENGQjsKCX0oKSk7CgoKCS8qKgoJICogRWxlY3Ryb25pYyBDb2RlYm9vayBibG9jayBtb2RlLgoJICovCglDcnlwdG9KUy5tb2RlLkVDQiA9IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIEVDQiA9IENyeXB0b0pTLmxpYi5CbG9ja0NpcGhlck1vZGUuZXh0ZW5kKCk7CgoJICAgIEVDQi5FbmNyeXB0b3IgPSBFQ0IuZXh0ZW5kKHsKCSAgICAgICAgcHJvY2Vzc0Jsb2NrOiBmdW5jdGlvbiAod29yZHMsIG9mZnNldCkgewoJICAgICAgICAgICAgdGhpcy5fY2lwaGVyLmVuY3J5cHRCbG9jayh3b3Jkcywgb2Zmc2V0KTsKCSAgICAgICAgfQoJICAgIH0pOwoKCSAgICBFQ0IuRGVjcnlwdG9yID0gRUNCLmV4dGVuZCh7CgkgICAgICAgIHByb2Nlc3NCbG9jazogZnVuY3Rpb24gKHdvcmRzLCBvZmZzZXQpIHsKCSAgICAgICAgICAgIHRoaXMuX2NpcGhlci5kZWNyeXB0QmxvY2sod29yZHMsIG9mZnNldCk7CgkgICAgICAgIH0KCSAgICB9KTsKCgkgICAgcmV0dXJuIEVDQjsKCX0oKSk7CgoKCS8qKgoJICogQU5TSSBYLjkyMyBwYWRkaW5nIHN0cmF0ZWd5LgoJICovCglDcnlwdG9KUy5wYWQuQW5zaVg5MjMgPSB7CgkgICAgcGFkOiBmdW5jdGlvbiAoZGF0YSwgYmxvY2tTaXplKSB7CgkgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICB2YXIgZGF0YVNpZ0J5dGVzID0gZGF0YS5zaWdCeXRlczsKCSAgICAgICAgdmFyIGJsb2NrU2l6ZUJ5dGVzID0gYmxvY2tTaXplICogNDsKCgkgICAgICAgIC8vIENvdW50IHBhZGRpbmcgYnl0ZXMKCSAgICAgICAgdmFyIG5QYWRkaW5nQnl0ZXMgPSBibG9ja1NpemVCeXRlcyAtIGRhdGFTaWdCeXRlcyAlIGJsb2NrU2l6ZUJ5dGVzOwoKCSAgICAgICAgLy8gQ29tcHV0ZSBsYXN0IGJ5dGUgcG9zaXRpb24KCSAgICAgICAgdmFyIGxhc3RCeXRlUG9zID0gZGF0YVNpZ0J5dGVzICsgblBhZGRpbmdCeXRlcyAtIDE7CgoJICAgICAgICAvLyBQYWQKCSAgICAgICAgZGF0YS5jbGFtcCgpOwoJICAgICAgICBkYXRhLndvcmRzW2xhc3RCeXRlUG9zID4+PiAyXSB8PSBuUGFkZGluZ0J5dGVzIDw8ICgyNCAtIChsYXN0Qnl0ZVBvcyAlIDQpICogOCk7CgkgICAgICAgIGRhdGEuc2lnQnl0ZXMgKz0gblBhZGRpbmdCeXRlczsKCSAgICB9LAoKCSAgICB1bnBhZDogZnVuY3Rpb24gKGRhdGEpIHsKCSAgICAgICAgLy8gR2V0IG51bWJlciBvZiBwYWRkaW5nIGJ5dGVzIGZyb20gbGFzdCBieXRlCgkgICAgICAgIHZhciBuUGFkZGluZ0J5dGVzID0gZGF0YS53b3Jkc1soZGF0YS5zaWdCeXRlcyAtIDEpID4+PiAyXSAmIDB4ZmY7CgoJICAgICAgICAvLyBSZW1vdmUgcGFkZGluZwoJICAgICAgICBkYXRhLnNpZ0J5dGVzIC09IG5QYWRkaW5nQnl0ZXM7CgkgICAgfQoJfTsKCgoJLyoqCgkgKiBJU08gMTAxMjYgcGFkZGluZyBzdHJhdGVneS4KCSAqLwoJQ3J5cHRvSlMucGFkLklzbzEwMTI2ID0gewoJICAgIHBhZDogZnVuY3Rpb24gKGRhdGEsIGJsb2NrU2l6ZSkgewoJICAgICAgICAvLyBTaG9ydGN1dAoJICAgICAgICB2YXIgYmxvY2tTaXplQnl0ZXMgPSBibG9ja1NpemUgKiA0OwoKCSAgICAgICAgLy8gQ291bnQgcGFkZGluZyBieXRlcwoJICAgICAgICB2YXIgblBhZGRpbmdCeXRlcyA9IGJsb2NrU2l6ZUJ5dGVzIC0gZGF0YS5zaWdCeXRlcyAlIGJsb2NrU2l6ZUJ5dGVzOwoKCSAgICAgICAgLy8gUGFkCgkgICAgICAgIGRhdGEuY29uY2F0KENyeXB0b0pTLmxpYi5Xb3JkQXJyYXkucmFuZG9tKG5QYWRkaW5nQnl0ZXMgLSAxKSkuCgkgICAgICAgICAgICAgY29uY2F0KENyeXB0b0pTLmxpYi5Xb3JkQXJyYXkuY3JlYXRlKFtuUGFkZGluZ0J5dGVzIDw8IDI0XSwgMSkpOwoJICAgIH0sCgoJICAgIHVucGFkOiBmdW5jdGlvbiAoZGF0YSkgewoJICAgICAgICAvLyBHZXQgbnVtYmVyIG9mIHBhZGRpbmcgYnl0ZXMgZnJvbSBsYXN0IGJ5dGUKCSAgICAgICAgdmFyIG5QYWRkaW5nQnl0ZXMgPSBkYXRhLndvcmRzWyhkYXRhLnNpZ0J5dGVzIC0gMSkgPj4+IDJdICYgMHhmZjsKCgkgICAgICAgIC8vIFJlbW92ZSBwYWRkaW5nCgkgICAgICAgIGRhdGEuc2lnQnl0ZXMgLT0gblBhZGRpbmdCeXRlczsKCSAgICB9Cgl9OwoKCgkvKioKCSAqIElTTy9JRUMgOTc5Ny0xIFBhZGRpbmcgTWV0aG9kIDIuCgkgKi8KCUNyeXB0b0pTLnBhZC5Jc285Nzk3MSA9IHsKCSAgICBwYWQ6IGZ1bmN0aW9uIChkYXRhLCBibG9ja1NpemUpIHsKCSAgICAgICAgLy8gQWRkIDB4ODAgYnl0ZQoJICAgICAgICBkYXRhLmNvbmNhdChDcnlwdG9KUy5saWIuV29yZEFycmF5LmNyZWF0ZShbMHg4MDAwMDAwMF0sIDEpKTsKCgkgICAgICAgIC8vIFplcm8gcGFkIHRoZSByZXN0CgkgICAgICAgIENyeXB0b0pTLnBhZC5aZXJvUGFkZGluZy5wYWQoZGF0YSwgYmxvY2tTaXplKTsKCSAgICB9LAoKCSAgICB1bnBhZDogZnVuY3Rpb24gKGRhdGEpIHsKCSAgICAgICAgLy8gUmVtb3ZlIHplcm8gcGFkZGluZwoJICAgICAgICBDcnlwdG9KUy5wYWQuWmVyb1BhZGRpbmcudW5wYWQoZGF0YSk7CgoJICAgICAgICAvLyBSZW1vdmUgb25lIG1vcmUgYnl0ZSAtLSB0aGUgMHg4MCBieXRlCgkgICAgICAgIGRhdGEuc2lnQnl0ZXMtLTsKCSAgICB9Cgl9OwoKCgkvKioKCSAqIE91dHB1dCBGZWVkYmFjayBibG9jayBtb2RlLgoJICovCglDcnlwdG9KUy5tb2RlLk9GQiA9IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIE9GQiA9IENyeXB0b0pTLmxpYi5CbG9ja0NpcGhlck1vZGUuZXh0ZW5kKCk7CgoJICAgIHZhciBFbmNyeXB0b3IgPSBPRkIuRW5jcnlwdG9yID0gT0ZCLmV4dGVuZCh7CgkgICAgICAgIHByb2Nlc3NCbG9jazogZnVuY3Rpb24gKHdvcmRzLCBvZmZzZXQpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIGNpcGhlciA9IHRoaXMuX2NpcGhlcgoJICAgICAgICAgICAgdmFyIGJsb2NrU2l6ZSA9IGNpcGhlci5ibG9ja1NpemU7CgkgICAgICAgICAgICB2YXIgaXYgPSB0aGlzLl9pdjsKCSAgICAgICAgICAgIHZhciBrZXlzdHJlYW0gPSB0aGlzLl9rZXlzdHJlYW07CgoJICAgICAgICAgICAgLy8gR2VuZXJhdGUga2V5c3RyZWFtCgkgICAgICAgICAgICBpZiAoaXYpIHsKCSAgICAgICAgICAgICAgICBrZXlzdHJlYW0gPSB0aGlzLl9rZXlzdHJlYW0gPSBpdi5zbGljZSgwKTsKCgkgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIElWIGZvciBzdWJzZXF1ZW50IGJsb2NrcwoJICAgICAgICAgICAgICAgIHRoaXMuX2l2ID0gdW5kZWZpbmVkOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgY2lwaGVyLmVuY3J5cHRCbG9jayhrZXlzdHJlYW0sIDApOwoKCSAgICAgICAgICAgIC8vIEVuY3J5cHQKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYmxvY2tTaXplOyBpKyspIHsKCSAgICAgICAgICAgICAgICB3b3Jkc1tvZmZzZXQgKyBpXSBePSBrZXlzdHJlYW1baV07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9KTsKCgkgICAgT0ZCLkRlY3J5cHRvciA9IEVuY3J5cHRvcjsKCgkgICAgcmV0dXJuIE9GQjsKCX0oKSk7CgoKCS8qKgoJICogQSBub29wIHBhZGRpbmcgc3RyYXRlZ3kuCgkgKi8KCUNyeXB0b0pTLnBhZC5Ob1BhZGRpbmcgPSB7CgkgICAgcGFkOiBmdW5jdGlvbiAoKSB7CgkgICAgfSwKCgkgICAgdW5wYWQ6IGZ1bmN0aW9uICgpIHsKCSAgICB9Cgl9OwoKCgkoZnVuY3Rpb24gKHVuZGVmaW5lZCkgewoJICAgIC8vIFNob3J0Y3V0cwoJICAgIHZhciBDID0gQ3J5cHRvSlM7CgkgICAgdmFyIENfbGliID0gQy5saWI7CgkgICAgdmFyIENpcGhlclBhcmFtcyA9IENfbGliLkNpcGhlclBhcmFtczsKCSAgICB2YXIgQ19lbmMgPSBDLmVuYzsKCSAgICB2YXIgSGV4ID0gQ19lbmMuSGV4OwoJICAgIHZhciBDX2Zvcm1hdCA9IEMuZm9ybWF0OwoKCSAgICB2YXIgSGV4Rm9ybWF0dGVyID0gQ19mb3JtYXQuSGV4ID0gewoJICAgICAgICAvKioKCSAgICAgICAgICogQ29udmVydHMgdGhlIGNpcGhlcnRleHQgb2YgYSBjaXBoZXIgcGFyYW1zIG9iamVjdCB0byBhIGhleGFkZWNpbWFsbHkgZW5jb2RlZCBzdHJpbmcuCgkgICAgICAgICAqCgkgICAgICAgICAqIEBwYXJhbSB7Q2lwaGVyUGFyYW1zfSBjaXBoZXJQYXJhbXMgVGhlIGNpcGhlciBwYXJhbXMgb2JqZWN0LgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBoZXhhZGVjaW1hbGx5IGVuY29kZWQgc3RyaW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAc3RhdGljCgkgICAgICAgICAqCgkgICAgICAgICAqIEBleGFtcGxlCgkgICAgICAgICAqCgkgICAgICAgICAqICAgICB2YXIgaGV4U3RyaW5nID0gQ3J5cHRvSlMuZm9ybWF0LkhleC5zdHJpbmdpZnkoY2lwaGVyUGFyYW1zKTsKCSAgICAgICAgICovCgkgICAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24gKGNpcGhlclBhcmFtcykgewoJICAgICAgICAgICAgcmV0dXJuIGNpcGhlclBhcmFtcy5jaXBoZXJ0ZXh0LnRvU3RyaW5nKEhleCk7CgkgICAgICAgIH0sCgoJICAgICAgICAvKioKCSAgICAgICAgICogQ29udmVydHMgYSBoZXhhZGVjaW1hbGx5IGVuY29kZWQgY2lwaGVydGV4dCBzdHJpbmcgdG8gYSBjaXBoZXIgcGFyYW1zIG9iamVjdC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGlucHV0IFRoZSBoZXhhZGVjaW1hbGx5IGVuY29kZWQgc3RyaW5nLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcmV0dXJuIHtDaXBoZXJQYXJhbXN9IFRoZSBjaXBoZXIgcGFyYW1zIG9iamVjdC4KCSAgICAgICAgICoKCSAgICAgICAgICogQHN0YXRpYwoJICAgICAgICAgKgoJICAgICAgICAgKiBAZXhhbXBsZQoJICAgICAgICAgKgoJICAgICAgICAgKiAgICAgdmFyIGNpcGhlclBhcmFtcyA9IENyeXB0b0pTLmZvcm1hdC5IZXgucGFyc2UoaGV4U3RyaW5nKTsKCSAgICAgICAgICovCgkgICAgICAgIHBhcnNlOiBmdW5jdGlvbiAoaW5wdXQpIHsKCSAgICAgICAgICAgIHZhciBjaXBoZXJ0ZXh0ID0gSGV4LnBhcnNlKGlucHV0KTsKCSAgICAgICAgICAgIHJldHVybiBDaXBoZXJQYXJhbXMuY3JlYXRlKHsgY2lwaGVydGV4dDogY2lwaGVydGV4dCB9KTsKCSAgICAgICAgfQoJICAgIH07Cgl9KCkpOwoKCgkoZnVuY3Rpb24gKCkgewoJICAgIC8vIFNob3J0Y3V0cwoJICAgIHZhciBDID0gQ3J5cHRvSlM7CgkgICAgdmFyIENfbGliID0gQy5saWI7CgkgICAgdmFyIEJsb2NrQ2lwaGVyID0gQ19saWIuQmxvY2tDaXBoZXI7CgkgICAgdmFyIENfYWxnbyA9IEMuYWxnbzsKCgkgICAgLy8gTG9va3VwIHRhYmxlcwoJICAgIHZhciBTQk9YID0gW107CgkgICAgdmFyIElOVl9TQk9YID0gW107CgkgICAgdmFyIFNVQl9NSVhfMCA9IFtdOwoJICAgIHZhciBTVUJfTUlYXzEgPSBbXTsKCSAgICB2YXIgU1VCX01JWF8yID0gW107CgkgICAgdmFyIFNVQl9NSVhfMyA9IFtdOwoJICAgIHZhciBJTlZfU1VCX01JWF8wID0gW107CgkgICAgdmFyIElOVl9TVUJfTUlYXzEgPSBbXTsKCSAgICB2YXIgSU5WX1NVQl9NSVhfMiA9IFtdOwoJICAgIHZhciBJTlZfU1VCX01JWF8zID0gW107CgoJICAgIC8vIENvbXB1dGUgbG9va3VwIHRhYmxlcwoJICAgIChmdW5jdGlvbiAoKSB7CgkgICAgICAgIC8vIENvbXB1dGUgZG91YmxlIHRhYmxlCgkgICAgICAgIHZhciBkID0gW107CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKCSAgICAgICAgICAgIGlmIChpIDwgMTI4KSB7CgkgICAgICAgICAgICAgICAgZFtpXSA9IGkgPDwgMTsKCSAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgZFtpXSA9IChpIDw8IDEpIF4gMHgxMWI7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCgkgICAgICAgIC8vIFdhbGsgR0YoMl44KQoJICAgICAgICB2YXIgeCA9IDA7CgkgICAgICAgIHZhciB4aSA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKCSAgICAgICAgICAgIC8vIENvbXB1dGUgc2JveAoJICAgICAgICAgICAgdmFyIHN4ID0geGkgXiAoeGkgPDwgMSkgXiAoeGkgPDwgMikgXiAoeGkgPDwgMykgXiAoeGkgPDwgNCk7CgkgICAgICAgICAgICBzeCA9IChzeCA+Pj4gOCkgXiAoc3ggJiAweGZmKSBeIDB4NjM7CgkgICAgICAgICAgICBTQk9YW3hdID0gc3g7CgkgICAgICAgICAgICBJTlZfU0JPWFtzeF0gPSB4OwoKCSAgICAgICAgICAgIC8vIENvbXB1dGUgbXVsdGlwbGljYXRpb24KCSAgICAgICAgICAgIHZhciB4MiA9IGRbeF07CgkgICAgICAgICAgICB2YXIgeDQgPSBkW3gyXTsKCSAgICAgICAgICAgIHZhciB4OCA9IGRbeDRdOwoKCSAgICAgICAgICAgIC8vIENvbXB1dGUgc3ViIGJ5dGVzLCBtaXggY29sdW1ucyB0YWJsZXMKCSAgICAgICAgICAgIHZhciB0ID0gKGRbc3hdICogMHgxMDEpIF4gKHN4ICogMHgxMDEwMTAwKTsKCSAgICAgICAgICAgIFNVQl9NSVhfMFt4XSA9ICh0IDw8IDI0KSB8ICh0ID4+PiA4KTsKCSAgICAgICAgICAgIFNVQl9NSVhfMVt4XSA9ICh0IDw8IDE2KSB8ICh0ID4+PiAxNik7CgkgICAgICAgICAgICBTVUJfTUlYXzJbeF0gPSAodCA8PCA4KSAgfCAodCA+Pj4gMjQpOwoJICAgICAgICAgICAgU1VCX01JWF8zW3hdID0gdDsKCgkgICAgICAgICAgICAvLyBDb21wdXRlIGludiBzdWIgYnl0ZXMsIGludiBtaXggY29sdW1ucyB0YWJsZXMKCSAgICAgICAgICAgIHZhciB0ID0gKHg4ICogMHgxMDEwMTAxKSBeICh4NCAqIDB4MTAwMDEpIF4gKHgyICogMHgxMDEpIF4gKHggKiAweDEwMTAxMDApOwoJICAgICAgICAgICAgSU5WX1NVQl9NSVhfMFtzeF0gPSAodCA8PCAyNCkgfCAodCA+Pj4gOCk7CgkgICAgICAgICAgICBJTlZfU1VCX01JWF8xW3N4XSA9ICh0IDw8IDE2KSB8ICh0ID4+PiAxNik7CgkgICAgICAgICAgICBJTlZfU1VCX01JWF8yW3N4XSA9ICh0IDw8IDgpICB8ICh0ID4+PiAyNCk7CgkgICAgICAgICAgICBJTlZfU1VCX01JWF8zW3N4XSA9IHQ7CgoJICAgICAgICAgICAgLy8gQ29tcHV0ZSBuZXh0IGNvdW50ZXIKCSAgICAgICAgICAgIGlmICgheCkgewoJICAgICAgICAgICAgICAgIHggPSB4aSA9IDE7CgkgICAgICAgICAgICB9IGVsc2UgewoJICAgICAgICAgICAgICAgIHggPSB4MiBeIGRbZFtkW3g4IF4geDJdXV07CgkgICAgICAgICAgICAgICAgeGkgXj0gZFtkW3hpXV07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9KCkpOwoKCSAgICAvLyBQcmVjb21wdXRlZCBSY29uIGxvb2t1cAoJICAgIHZhciBSQ09OID0gWzB4MDAsIDB4MDEsIDB4MDIsIDB4MDQsIDB4MDgsIDB4MTAsIDB4MjAsIDB4NDAsIDB4ODAsIDB4MWIsIDB4MzZdOwoKCSAgICAvKioKCSAgICAgKiBBRVMgYmxvY2sgY2lwaGVyIGFsZ29yaXRobS4KCSAgICAgKi8KCSAgICB2YXIgQUVTID0gQ19hbGdvLkFFUyA9IEJsb2NrQ2lwaGVyLmV4dGVuZCh7CgkgICAgICAgIF9kb1Jlc2V0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICB2YXIgdDsKCgkgICAgICAgICAgICAvLyBTa2lwIHJlc2V0IG9mIG5Sb3VuZHMgaGFzIGJlZW4gc2V0IGJlZm9yZSBhbmQga2V5IGRpZCBub3QgY2hhbmdlCgkgICAgICAgICAgICBpZiAodGhpcy5fblJvdW5kcyAmJiB0aGlzLl9rZXlQcmlvclJlc2V0ID09PSB0aGlzLl9rZXkpIHsKCSAgICAgICAgICAgICAgICByZXR1cm47CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIga2V5ID0gdGhpcy5fa2V5UHJpb3JSZXNldCA9IHRoaXMuX2tleTsKCSAgICAgICAgICAgIHZhciBrZXlXb3JkcyA9IGtleS53b3JkczsKCSAgICAgICAgICAgIHZhciBrZXlTaXplID0ga2V5LnNpZ0J5dGVzIC8gNDsKCgkgICAgICAgICAgICAvLyBDb21wdXRlIG51bWJlciBvZiByb3VuZHMKCSAgICAgICAgICAgIHZhciBuUm91bmRzID0gdGhpcy5fblJvdW5kcyA9IGtleVNpemUgKyA2OwoKCSAgICAgICAgICAgIC8vIENvbXB1dGUgbnVtYmVyIG9mIGtleSBzY2hlZHVsZSByb3dzCgkgICAgICAgICAgICB2YXIga3NSb3dzID0gKG5Sb3VuZHMgKyAxKSAqIDQ7CgoJICAgICAgICAgICAgLy8gQ29tcHV0ZSBrZXkgc2NoZWR1bGUKCSAgICAgICAgICAgIHZhciBrZXlTY2hlZHVsZSA9IHRoaXMuX2tleVNjaGVkdWxlID0gW107CgkgICAgICAgICAgICBmb3IgKHZhciBrc1JvdyA9IDA7IGtzUm93IDwga3NSb3dzOyBrc1JvdysrKSB7CgkgICAgICAgICAgICAgICAgaWYgKGtzUm93IDwga2V5U2l6ZSkgewoJICAgICAgICAgICAgICAgICAgICBrZXlTY2hlZHVsZVtrc1Jvd10gPSBrZXlXb3Jkc1trc1Jvd107CgkgICAgICAgICAgICAgICAgfSBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgdCA9IGtleVNjaGVkdWxlW2tzUm93IC0gMV07CgoJICAgICAgICAgICAgICAgICAgICBpZiAoIShrc1JvdyAlIGtleVNpemUpKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBSb3Qgd29yZAoJICAgICAgICAgICAgICAgICAgICAgICAgdCA9ICh0IDw8IDgpIHwgKHQgPj4+IDI0KTsKCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdWIgd29yZAoJICAgICAgICAgICAgICAgICAgICAgICAgdCA9IChTQk9YW3QgPj4+IDI0XSA8PCAyNCkgfCAoU0JPWFsodCA+Pj4gMTYpICYgMHhmZl0gPDwgMTYpIHwgKFNCT1hbKHQgPj4+IDgpICYgMHhmZl0gPDwgOCkgfCBTQk9YW3QgJiAweGZmXTsKCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBNaXggUmNvbgoJICAgICAgICAgICAgICAgICAgICAgICAgdCBePSBSQ09OWyhrc1JvdyAvIGtleVNpemUpIHwgMF0gPDwgMjQ7CgkgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5U2l6ZSA+IDYgJiYga3NSb3cgJSBrZXlTaXplID09IDQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN1YiB3b3JkCgkgICAgICAgICAgICAgICAgICAgICAgICB0ID0gKFNCT1hbdCA+Pj4gMjRdIDw8IDI0KSB8IChTQk9YWyh0ID4+PiAxNikgJiAweGZmXSA8PCAxNikgfCAoU0JPWFsodCA+Pj4gOCkgJiAweGZmXSA8PCA4KSB8IFNCT1hbdCAmIDB4ZmZdOwoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICBrZXlTY2hlZHVsZVtrc1Jvd10gPSBrZXlTY2hlZHVsZVtrc1JvdyAtIGtleVNpemVdIF4gdDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gQ29tcHV0ZSBpbnYga2V5IHNjaGVkdWxlCgkgICAgICAgICAgICB2YXIgaW52S2V5U2NoZWR1bGUgPSB0aGlzLl9pbnZLZXlTY2hlZHVsZSA9IFtdOwoJICAgICAgICAgICAgZm9yICh2YXIgaW52S3NSb3cgPSAwOyBpbnZLc1JvdyA8IGtzUm93czsgaW52S3NSb3crKykgewoJICAgICAgICAgICAgICAgIHZhciBrc1JvdyA9IGtzUm93cyAtIGludktzUm93OwoKCSAgICAgICAgICAgICAgICBpZiAoaW52S3NSb3cgJSA0KSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciB0ID0ga2V5U2NoZWR1bGVba3NSb3ddOwoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciB0ID0ga2V5U2NoZWR1bGVba3NSb3cgLSA0XTsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgIGlmIChpbnZLc1JvdyA8IDQgfHwga3NSb3cgPD0gNCkgewoJICAgICAgICAgICAgICAgICAgICBpbnZLZXlTY2hlZHVsZVtpbnZLc1Jvd10gPSB0OwoJICAgICAgICAgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIGludktleVNjaGVkdWxlW2ludktzUm93XSA9IElOVl9TVUJfTUlYXzBbU0JPWFt0ID4+PiAyNF1dIF4gSU5WX1NVQl9NSVhfMVtTQk9YWyh0ID4+PiAxNikgJiAweGZmXV0gXgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJTlZfU1VCX01JWF8yW1NCT1hbKHQgPj4+IDgpICYgMHhmZl1dIF4gSU5WX1NVQl9NSVhfM1tTQk9YW3QgJiAweGZmXV07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9LAoKCSAgICAgICAgZW5jcnlwdEJsb2NrOiBmdW5jdGlvbiAoTSwgb2Zmc2V0KSB7CgkgICAgICAgICAgICB0aGlzLl9kb0NyeXB0QmxvY2soTSwgb2Zmc2V0LCB0aGlzLl9rZXlTY2hlZHVsZSwgU1VCX01JWF8wLCBTVUJfTUlYXzEsIFNVQl9NSVhfMiwgU1VCX01JWF8zLCBTQk9YKTsKCSAgICAgICAgfSwKCgkgICAgICAgIGRlY3J5cHRCbG9jazogZnVuY3Rpb24gKE0sIG9mZnNldCkgewoJICAgICAgICAgICAgLy8gU3dhcCAybmQgYW5kIDR0aCByb3dzCgkgICAgICAgICAgICB2YXIgdCA9IE1bb2Zmc2V0ICsgMV07CgkgICAgICAgICAgICBNW29mZnNldCArIDFdID0gTVtvZmZzZXQgKyAzXTsKCSAgICAgICAgICAgIE1bb2Zmc2V0ICsgM10gPSB0OwoKCSAgICAgICAgICAgIHRoaXMuX2RvQ3J5cHRCbG9jayhNLCBvZmZzZXQsIHRoaXMuX2ludktleVNjaGVkdWxlLCBJTlZfU1VCX01JWF8wLCBJTlZfU1VCX01JWF8xLCBJTlZfU1VCX01JWF8yLCBJTlZfU1VCX01JWF8zLCBJTlZfU0JPWCk7CgoJICAgICAgICAgICAgLy8gSW52IHN3YXAgMm5kIGFuZCA0dGggcm93cwoJICAgICAgICAgICAgdmFyIHQgPSBNW29mZnNldCArIDFdOwoJICAgICAgICAgICAgTVtvZmZzZXQgKyAxXSA9IE1bb2Zmc2V0ICsgM107CgkgICAgICAgICAgICBNW29mZnNldCArIDNdID0gdDsKCSAgICAgICAgfSwKCgkgICAgICAgIF9kb0NyeXB0QmxvY2s6IGZ1bmN0aW9uIChNLCBvZmZzZXQsIGtleVNjaGVkdWxlLCBTVUJfTUlYXzAsIFNVQl9NSVhfMSwgU1VCX01JWF8yLCBTVUJfTUlYXzMsIFNCT1gpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0CgkgICAgICAgICAgICB2YXIgblJvdW5kcyA9IHRoaXMuX25Sb3VuZHM7CgoJICAgICAgICAgICAgLy8gR2V0IGlucHV0LCBhZGQgcm91bmQga2V5CgkgICAgICAgICAgICB2YXIgczAgPSBNW29mZnNldF0gICAgIF4ga2V5U2NoZWR1bGVbMF07CgkgICAgICAgICAgICB2YXIgczEgPSBNW29mZnNldCArIDFdIF4ga2V5U2NoZWR1bGVbMV07CgkgICAgICAgICAgICB2YXIgczIgPSBNW29mZnNldCArIDJdIF4ga2V5U2NoZWR1bGVbMl07CgkgICAgICAgICAgICB2YXIgczMgPSBNW29mZnNldCArIDNdIF4ga2V5U2NoZWR1bGVbM107CgoJICAgICAgICAgICAgLy8gS2V5IHNjaGVkdWxlIHJvdyBjb3VudGVyCgkgICAgICAgICAgICB2YXIga3NSb3cgPSA0OwoKCSAgICAgICAgICAgIC8vIFJvdW5kcwoJICAgICAgICAgICAgZm9yICh2YXIgcm91bmQgPSAxOyByb3VuZCA8IG5Sb3VuZHM7IHJvdW5kKyspIHsKCSAgICAgICAgICAgICAgICAvLyBTaGlmdCByb3dzLCBzdWIgYnl0ZXMsIG1peCBjb2x1bW5zLCBhZGQgcm91bmQga2V5CgkgICAgICAgICAgICAgICAgdmFyIHQwID0gU1VCX01JWF8wW3MwID4+PiAyNF0gXiBTVUJfTUlYXzFbKHMxID4+PiAxNikgJiAweGZmXSBeIFNVQl9NSVhfMlsoczIgPj4+IDgpICYgMHhmZl0gXiBTVUJfTUlYXzNbczMgJiAweGZmXSBeIGtleVNjaGVkdWxlW2tzUm93KytdOwoJICAgICAgICAgICAgICAgIHZhciB0MSA9IFNVQl9NSVhfMFtzMSA+Pj4gMjRdIF4gU1VCX01JWF8xWyhzMiA+Pj4gMTYpICYgMHhmZl0gXiBTVUJfTUlYXzJbKHMzID4+PiA4KSAmIDB4ZmZdIF4gU1VCX01JWF8zW3MwICYgMHhmZl0gXiBrZXlTY2hlZHVsZVtrc1JvdysrXTsKCSAgICAgICAgICAgICAgICB2YXIgdDIgPSBTVUJfTUlYXzBbczIgPj4+IDI0XSBeIFNVQl9NSVhfMVsoczMgPj4+IDE2KSAmIDB4ZmZdIF4gU1VCX01JWF8yWyhzMCA+Pj4gOCkgJiAweGZmXSBeIFNVQl9NSVhfM1tzMSAmIDB4ZmZdIF4ga2V5U2NoZWR1bGVba3NSb3crK107CgkgICAgICAgICAgICAgICAgdmFyIHQzID0gU1VCX01JWF8wW3MzID4+PiAyNF0gXiBTVUJfTUlYXzFbKHMwID4+PiAxNikgJiAweGZmXSBeIFNVQl9NSVhfMlsoczEgPj4+IDgpICYgMHhmZl0gXiBTVUJfTUlYXzNbczIgJiAweGZmXSBeIGtleVNjaGVkdWxlW2tzUm93KytdOwoKCSAgICAgICAgICAgICAgICAvLyBVcGRhdGUgc3RhdGUKCSAgICAgICAgICAgICAgICBzMCA9IHQwOwoJICAgICAgICAgICAgICAgIHMxID0gdDE7CgkgICAgICAgICAgICAgICAgczIgPSB0MjsKCSAgICAgICAgICAgICAgICBzMyA9IHQzOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIFNoaWZ0IHJvd3MsIHN1YiBieXRlcywgYWRkIHJvdW5kIGtleQoJICAgICAgICAgICAgdmFyIHQwID0gKChTQk9YW3MwID4+PiAyNF0gPDwgMjQpIHwgKFNCT1hbKHMxID4+PiAxNikgJiAweGZmXSA8PCAxNikgfCAoU0JPWFsoczIgPj4+IDgpICYgMHhmZl0gPDwgOCkgfCBTQk9YW3MzICYgMHhmZl0pIF4ga2V5U2NoZWR1bGVba3NSb3crK107CgkgICAgICAgICAgICB2YXIgdDEgPSAoKFNCT1hbczEgPj4+IDI0XSA8PCAyNCkgfCAoU0JPWFsoczIgPj4+IDE2KSAmIDB4ZmZdIDw8IDE2KSB8IChTQk9YWyhzMyA+Pj4gOCkgJiAweGZmXSA8PCA4KSB8IFNCT1hbczAgJiAweGZmXSkgXiBrZXlTY2hlZHVsZVtrc1JvdysrXTsKCSAgICAgICAgICAgIHZhciB0MiA9ICgoU0JPWFtzMiA+Pj4gMjRdIDw8IDI0KSB8IChTQk9YWyhzMyA+Pj4gMTYpICYgMHhmZl0gPDwgMTYpIHwgKFNCT1hbKHMwID4+PiA4KSAmIDB4ZmZdIDw8IDgpIHwgU0JPWFtzMSAmIDB4ZmZdKSBeIGtleVNjaGVkdWxlW2tzUm93KytdOwoJICAgICAgICAgICAgdmFyIHQzID0gKChTQk9YW3MzID4+PiAyNF0gPDwgMjQpIHwgKFNCT1hbKHMwID4+PiAxNikgJiAweGZmXSA8PCAxNikgfCAoU0JPWFsoczEgPj4+IDgpICYgMHhmZl0gPDwgOCkgfCBTQk9YW3MyICYgMHhmZl0pIF4ga2V5U2NoZWR1bGVba3NSb3crK107CgoJICAgICAgICAgICAgLy8gU2V0IG91dHB1dAoJICAgICAgICAgICAgTVtvZmZzZXRdICAgICA9IHQwOwoJICAgICAgICAgICAgTVtvZmZzZXQgKyAxXSA9IHQxOwoJICAgICAgICAgICAgTVtvZmZzZXQgKyAyXSA9IHQyOwoJICAgICAgICAgICAgTVtvZmZzZXQgKyAzXSA9IHQzOwoJICAgICAgICB9LAoKCSAgICAgICAga2V5U2l6ZTogMjU2LzMyCgkgICAgfSk7CgoJICAgIC8qKgoJICAgICAqIFNob3J0Y3V0IGZ1bmN0aW9ucyB0byB0aGUgY2lwaGVyJ3Mgb2JqZWN0IGludGVyZmFjZS4KCSAgICAgKgoJICAgICAqIEBleGFtcGxlCgkgICAgICoKCSAgICAgKiAgICAgdmFyIGNpcGhlcnRleHQgPSBDcnlwdG9KUy5BRVMuZW5jcnlwdChtZXNzYWdlLCBrZXksIGNmZyk7CgkgICAgICogICAgIHZhciBwbGFpbnRleHQgID0gQ3J5cHRvSlMuQUVTLmRlY3J5cHQoY2lwaGVydGV4dCwga2V5LCBjZmcpOwoJICAgICAqLwoJICAgIEMuQUVTID0gQmxvY2tDaXBoZXIuX2NyZWF0ZUhlbHBlcihBRVMpOwoJfSgpKTsKCgoJKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBTaG9ydGN1dHMKCSAgICB2YXIgQyA9IENyeXB0b0pTOwoJICAgIHZhciBDX2xpYiA9IEMubGliOwoJICAgIHZhciBXb3JkQXJyYXkgPSBDX2xpYi5Xb3JkQXJyYXk7CgkgICAgdmFyIEJsb2NrQ2lwaGVyID0gQ19saWIuQmxvY2tDaXBoZXI7CgkgICAgdmFyIENfYWxnbyA9IEMuYWxnbzsKCgkgICAgLy8gUGVybXV0ZWQgQ2hvaWNlIDEgY29uc3RhbnRzCgkgICAgdmFyIFBDMSA9IFsKCSAgICAgICAgNTcsIDQ5LCA0MSwgMzMsIDI1LCAxNywgOSwgIDEsCgkgICAgICAgIDU4LCA1MCwgNDIsIDM0LCAyNiwgMTgsIDEwLCAyLAoJICAgICAgICA1OSwgNTEsIDQzLCAzNSwgMjcsIDE5LCAxMSwgMywKCSAgICAgICAgNjAsIDUyLCA0NCwgMzYsIDYzLCA1NSwgNDcsIDM5LAoJICAgICAgICAzMSwgMjMsIDE1LCA3LCAgNjIsIDU0LCA0NiwgMzgsCgkgICAgICAgIDMwLCAyMiwgMTQsIDYsICA2MSwgNTMsIDQ1LCAzNywKCSAgICAgICAgMjksIDIxLCAxMywgNSwgIDI4LCAyMCwgMTIsIDQKCSAgICBdOwoKCSAgICAvLyBQZXJtdXRlZCBDaG9pY2UgMiBjb25zdGFudHMKCSAgICB2YXIgUEMyID0gWwoJICAgICAgICAxNCwgMTcsIDExLCAyNCwgMSwgIDUsCgkgICAgICAgIDMsICAyOCwgMTUsIDYsICAyMSwgMTAsCgkgICAgICAgIDIzLCAxOSwgMTIsIDQsICAyNiwgOCwKCSAgICAgICAgMTYsIDcsICAyNywgMjAsIDEzLCAyLAoJICAgICAgICA0MSwgNTIsIDMxLCAzNywgNDcsIDU1LAoJICAgICAgICAzMCwgNDAsIDUxLCA0NSwgMzMsIDQ4LAoJICAgICAgICA0NCwgNDksIDM5LCA1NiwgMzQsIDUzLAoJICAgICAgICA0NiwgNDIsIDUwLCAzNiwgMjksIDMyCgkgICAgXTsKCgkgICAgLy8gQ3VtdWxhdGl2ZSBiaXQgc2hpZnQgY29uc3RhbnRzCgkgICAgdmFyIEJJVF9TSElGVFMgPSBbMSwgIDIsICA0LCAgNiwgIDgsICAxMCwgMTIsIDE0LCAxNSwgMTcsIDE5LCAyMSwgMjMsIDI1LCAyNywgMjhdOwoKCSAgICAvLyBTQk9YZXMgYW5kIHJvdW5kIHBlcm11dGF0aW9uIGNvbnN0YW50cwoJICAgIHZhciBTQk9YX1AgPSBbCgkgICAgICAgIHsKCSAgICAgICAgICAgIDB4MDogMHg4MDgyMDAsCgkgICAgICAgICAgICAweDEwMDAwMDAwOiAweDgwMDAsCgkgICAgICAgICAgICAweDIwMDAwMDAwOiAweDgwODAwMiwKCSAgICAgICAgICAgIDB4MzAwMDAwMDA6IDB4MiwKCSAgICAgICAgICAgIDB4NDAwMDAwMDA6IDB4MjAwLAoJICAgICAgICAgICAgMHg1MDAwMDAwMDogMHg4MDgyMDIsCgkgICAgICAgICAgICAweDYwMDAwMDAwOiAweDgwMDIwMiwKCSAgICAgICAgICAgIDB4NzAwMDAwMDA6IDB4ODAwMDAwLAoJICAgICAgICAgICAgMHg4MDAwMDAwMDogMHgyMDIsCgkgICAgICAgICAgICAweDkwMDAwMDAwOiAweDgwMDIwMCwKCSAgICAgICAgICAgIDB4YTAwMDAwMDA6IDB4ODIwMCwKCSAgICAgICAgICAgIDB4YjAwMDAwMDA6IDB4ODA4MDAwLAoJICAgICAgICAgICAgMHhjMDAwMDAwMDogMHg4MDAyLAoJICAgICAgICAgICAgMHhkMDAwMDAwMDogMHg4MDAwMDIsCgkgICAgICAgICAgICAweGUwMDAwMDAwOiAweDAsCgkgICAgICAgICAgICAweGYwMDAwMDAwOiAweDgyMDIsCgkgICAgICAgICAgICAweDgwMDAwMDA6IDB4MCwKCSAgICAgICAgICAgIDB4MTgwMDAwMDA6IDB4ODA4MjAyLAoJICAgICAgICAgICAgMHgyODAwMDAwMDogMHg4MjAyLAoJICAgICAgICAgICAgMHgzODAwMDAwMDogMHg4MDAwLAoJICAgICAgICAgICAgMHg0ODAwMDAwMDogMHg4MDgyMDAsCgkgICAgICAgICAgICAweDU4MDAwMDAwOiAweDIwMCwKCSAgICAgICAgICAgIDB4NjgwMDAwMDA6IDB4ODA4MDAyLAoJICAgICAgICAgICAgMHg3ODAwMDAwMDogMHgyLAoJICAgICAgICAgICAgMHg4ODAwMDAwMDogMHg4MDAyMDAsCgkgICAgICAgICAgICAweDk4MDAwMDAwOiAweDgyMDAsCgkgICAgICAgICAgICAweGE4MDAwMDAwOiAweDgwODAwMCwKCSAgICAgICAgICAgIDB4YjgwMDAwMDA6IDB4ODAwMjAyLAoJICAgICAgICAgICAgMHhjODAwMDAwMDogMHg4MDAwMDIsCgkgICAgICAgICAgICAweGQ4MDAwMDAwOiAweDgwMDIsCgkgICAgICAgICAgICAweGU4MDAwMDAwOiAweDIwMiwKCSAgICAgICAgICAgIDB4ZjgwMDAwMDA6IDB4ODAwMDAwLAoJICAgICAgICAgICAgMHgxOiAweDgwMDAsCgkgICAgICAgICAgICAweDEwMDAwMDAxOiAweDIsCgkgICAgICAgICAgICAweDIwMDAwMDAxOiAweDgwODIwMCwKCSAgICAgICAgICAgIDB4MzAwMDAwMDE6IDB4ODAwMDAwLAoJICAgICAgICAgICAgMHg0MDAwMDAwMTogMHg4MDgwMDIsCgkgICAgICAgICAgICAweDUwMDAwMDAxOiAweDgyMDAsCgkgICAgICAgICAgICAweDYwMDAwMDAxOiAweDIwMCwKCSAgICAgICAgICAgIDB4NzAwMDAwMDE6IDB4ODAwMjAyLAoJICAgICAgICAgICAgMHg4MDAwMDAwMTogMHg4MDgyMDIsCgkgICAgICAgICAgICAweDkwMDAwMDAxOiAweDgwODAwMCwKCSAgICAgICAgICAgIDB4YTAwMDAwMDE6IDB4ODAwMDAyLAoJICAgICAgICAgICAgMHhiMDAwMDAwMTogMHg4MjAyLAoJICAgICAgICAgICAgMHhjMDAwMDAwMTogMHgyMDIsCgkgICAgICAgICAgICAweGQwMDAwMDAxOiAweDgwMDIwMCwKCSAgICAgICAgICAgIDB4ZTAwMDAwMDE6IDB4ODAwMiwKCSAgICAgICAgICAgIDB4ZjAwMDAwMDE6IDB4MCwKCSAgICAgICAgICAgIDB4ODAwMDAwMTogMHg4MDgyMDIsCgkgICAgICAgICAgICAweDE4MDAwMDAxOiAweDgwODAwMCwKCSAgICAgICAgICAgIDB4MjgwMDAwMDE6IDB4ODAwMDAwLAoJICAgICAgICAgICAgMHgzODAwMDAwMTogMHgyMDAsCgkgICAgICAgICAgICAweDQ4MDAwMDAxOiAweDgwMDAsCgkgICAgICAgICAgICAweDU4MDAwMDAxOiAweDgwMDAwMiwKCSAgICAgICAgICAgIDB4NjgwMDAwMDE6IDB4MiwKCSAgICAgICAgICAgIDB4NzgwMDAwMDE6IDB4ODIwMiwKCSAgICAgICAgICAgIDB4ODgwMDAwMDE6IDB4ODAwMiwKCSAgICAgICAgICAgIDB4OTgwMDAwMDE6IDB4ODAwMjAyLAoJICAgICAgICAgICAgMHhhODAwMDAwMTogMHgyMDIsCgkgICAgICAgICAgICAweGI4MDAwMDAxOiAweDgwODIwMCwKCSAgICAgICAgICAgIDB4YzgwMDAwMDE6IDB4ODAwMjAwLAoJICAgICAgICAgICAgMHhkODAwMDAwMTogMHgwLAoJICAgICAgICAgICAgMHhlODAwMDAwMTogMHg4MjAwLAoJICAgICAgICAgICAgMHhmODAwMDAwMTogMHg4MDgwMDIKCSAgICAgICAgfSwKCSAgICAgICAgewoJICAgICAgICAgICAgMHgwOiAweDQwMDg0MDEwLAoJICAgICAgICAgICAgMHgxMDAwMDAwOiAweDQwMDAsCgkgICAgICAgICAgICAweDIwMDAwMDA6IDB4ODAwMDAsCgkgICAgICAgICAgICAweDMwMDAwMDA6IDB4NDAwODAwMTAsCgkgICAgICAgICAgICAweDQwMDAwMDA6IDB4NDAwMDAwMTAsCgkgICAgICAgICAgICAweDUwMDAwMDA6IDB4NDAwODQwMDAsCgkgICAgICAgICAgICAweDYwMDAwMDA6IDB4NDAwMDQwMDAsCgkgICAgICAgICAgICAweDcwMDAwMDA6IDB4MTAsCgkgICAgICAgICAgICAweDgwMDAwMDA6IDB4ODQwMDAsCgkgICAgICAgICAgICAweDkwMDAwMDA6IDB4NDAwMDQwMTAsCgkgICAgICAgICAgICAweGEwMDAwMDA6IDB4NDAwMDAwMDAsCgkgICAgICAgICAgICAweGIwMDAwMDA6IDB4ODQwMTAsCgkgICAgICAgICAgICAweGMwMDAwMDA6IDB4ODAwMTAsCgkgICAgICAgICAgICAweGQwMDAwMDA6IDB4MCwKCSAgICAgICAgICAgIDB4ZTAwMDAwMDogMHg0MDEwLAoJICAgICAgICAgICAgMHhmMDAwMDAwOiAweDQwMDgwMDAwLAoJICAgICAgICAgICAgMHg4MDAwMDA6IDB4NDAwMDQwMDAsCgkgICAgICAgICAgICAweDE4MDAwMDA6IDB4ODQwMTAsCgkgICAgICAgICAgICAweDI4MDAwMDA6IDB4MTAsCgkgICAgICAgICAgICAweDM4MDAwMDA6IDB4NDAwMDQwMTAsCgkgICAgICAgICAgICAweDQ4MDAwMDA6IDB4NDAwODQwMTAsCgkgICAgICAgICAgICAweDU4MDAwMDA6IDB4NDAwMDAwMDAsCgkgICAgICAgICAgICAweDY4MDAwMDA6IDB4ODAwMDAsCgkgICAgICAgICAgICAweDc4MDAwMDA6IDB4NDAwODAwMTAsCgkgICAgICAgICAgICAweDg4MDAwMDA6IDB4ODAwMTAsCgkgICAgICAgICAgICAweDk4MDAwMDA6IDB4MCwKCSAgICAgICAgICAgIDB4YTgwMDAwMDogMHg0MDAwLAoJICAgICAgICAgICAgMHhiODAwMDAwOiAweDQwMDgwMDAwLAoJICAgICAgICAgICAgMHhjODAwMDAwOiAweDQwMDAwMDEwLAoJICAgICAgICAgICAgMHhkODAwMDAwOiAweDg0MDAwLAoJICAgICAgICAgICAgMHhlODAwMDAwOiAweDQwMDg0MDAwLAoJICAgICAgICAgICAgMHhmODAwMDAwOiAweDQwMTAsCgkgICAgICAgICAgICAweDEwMDAwMDAwOiAweDAsCgkgICAgICAgICAgICAweDExMDAwMDAwOiAweDQwMDgwMDEwLAoJICAgICAgICAgICAgMHgxMjAwMDAwMDogMHg0MDAwNDAxMCwKCSAgICAgICAgICAgIDB4MTMwMDAwMDA6IDB4NDAwODQwMDAsCgkgICAgICAgICAgICAweDE0MDAwMDAwOiAweDQwMDgwMDAwLAoJICAgICAgICAgICAgMHgxNTAwMDAwMDogMHgxMCwKCSAgICAgICAgICAgIDB4MTYwMDAwMDA6IDB4ODQwMTAsCgkgICAgICAgICAgICAweDE3MDAwMDAwOiAweDQwMDAsCgkgICAgICAgICAgICAweDE4MDAwMDAwOiAweDQwMTAsCgkgICAgICAgICAgICAweDE5MDAwMDAwOiAweDgwMDAwLAoJICAgICAgICAgICAgMHgxYTAwMDAwMDogMHg4MDAxMCwKCSAgICAgICAgICAgIDB4MWIwMDAwMDA6IDB4NDAwMDAwMTAsCgkgICAgICAgICAgICAweDFjMDAwMDAwOiAweDg0MDAwLAoJICAgICAgICAgICAgMHgxZDAwMDAwMDogMHg0MDAwNDAwMCwKCSAgICAgICAgICAgIDB4MWUwMDAwMDA6IDB4NDAwMDAwMDAsCgkgICAgICAgICAgICAweDFmMDAwMDAwOiAweDQwMDg0MDEwLAoJICAgICAgICAgICAgMHgxMDgwMDAwMDogMHg4NDAxMCwKCSAgICAgICAgICAgIDB4MTE4MDAwMDA6IDB4ODAwMDAsCgkgICAgICAgICAgICAweDEyODAwMDAwOiAweDQwMDgwMDAwLAoJICAgICAgICAgICAgMHgxMzgwMDAwMDogMHg0MDAwLAoJICAgICAgICAgICAgMHgxNDgwMDAwMDogMHg0MDAwNDAwMCwKCSAgICAgICAgICAgIDB4MTU4MDAwMDA6IDB4NDAwODQwMTAsCgkgICAgICAgICAgICAweDE2ODAwMDAwOiAweDEwLAoJICAgICAgICAgICAgMHgxNzgwMDAwMDogMHg0MDAwMDAwMCwKCSAgICAgICAgICAgIDB4MTg4MDAwMDA6IDB4NDAwODQwMDAsCgkgICAgICAgICAgICAweDE5ODAwMDAwOiAweDQwMDAwMDEwLAoJICAgICAgICAgICAgMHgxYTgwMDAwMDogMHg0MDAwNDAxMCwKCSAgICAgICAgICAgIDB4MWI4MDAwMDA6IDB4ODAwMTAsCgkgICAgICAgICAgICAweDFjODAwMDAwOiAweDAsCgkgICAgICAgICAgICAweDFkODAwMDAwOiAweDQwMTAsCgkgICAgICAgICAgICAweDFlODAwMDAwOiAweDQwMDgwMDEwLAoJICAgICAgICAgICAgMHgxZjgwMDAwMDogMHg4NDAwMAoJICAgICAgICB9LAoJICAgICAgICB7CgkgICAgICAgICAgICAweDA6IDB4MTA0LAoJICAgICAgICAgICAgMHgxMDAwMDA6IDB4MCwKCSAgICAgICAgICAgIDB4MjAwMDAwOiAweDQwMDAxMDAsCgkgICAgICAgICAgICAweDMwMDAwMDogMHgxMDEwNCwKCSAgICAgICAgICAgIDB4NDAwMDAwOiAweDEwMDA0LAoJICAgICAgICAgICAgMHg1MDAwMDA6IDB4NDAwMDAwNCwKCSAgICAgICAgICAgIDB4NjAwMDAwOiAweDQwMTAxMDQsCgkgICAgICAgICAgICAweDcwMDAwMDogMHg0MDEwMDAwLAoJICAgICAgICAgICAgMHg4MDAwMDA6IDB4NDAwMDAwMCwKCSAgICAgICAgICAgIDB4OTAwMDAwOiAweDQwMTAxMDAsCgkgICAgICAgICAgICAweGEwMDAwMDogMHgxMDEwMCwKCSAgICAgICAgICAgIDB4YjAwMDAwOiAweDQwMTAwMDQsCgkgICAgICAgICAgICAweGMwMDAwMDogMHg0MDAwMTA0LAoJICAgICAgICAgICAgMHhkMDAwMDA6IDB4MTAwMDAsCgkgICAgICAgICAgICAweGUwMDAwMDogMHg0LAoJICAgICAgICAgICAgMHhmMDAwMDA6IDB4MTAwLAoJICAgICAgICAgICAgMHg4MDAwMDogMHg0MDEwMTAwLAoJICAgICAgICAgICAgMHgxODAwMDA6IDB4NDAxMDAwNCwKCSAgICAgICAgICAgIDB4MjgwMDAwOiAweDAsCgkgICAgICAgICAgICAweDM4MDAwMDogMHg0MDAwMTAwLAoJICAgICAgICAgICAgMHg0ODAwMDA6IDB4NDAwMDAwNCwKCSAgICAgICAgICAgIDB4NTgwMDAwOiAweDEwMDAwLAoJICAgICAgICAgICAgMHg2ODAwMDA6IDB4MTAwMDQsCgkgICAgICAgICAgICAweDc4MDAwMDogMHgxMDQsCgkgICAgICAgICAgICAweDg4MDAwMDogMHg0LAoJICAgICAgICAgICAgMHg5ODAwMDA6IDB4MTAwLAoJICAgICAgICAgICAgMHhhODAwMDA6IDB4NDAxMDAwMCwKCSAgICAgICAgICAgIDB4YjgwMDAwOiAweDEwMTA0LAoJICAgICAgICAgICAgMHhjODAwMDA6IDB4MTAxMDAsCgkgICAgICAgICAgICAweGQ4MDAwMDogMHg0MDAwMTA0LAoJICAgICAgICAgICAgMHhlODAwMDA6IDB4NDAxMDEwNCwKCSAgICAgICAgICAgIDB4ZjgwMDAwOiAweDQwMDAwMDAsCgkgICAgICAgICAgICAweDEwMDAwMDA6IDB4NDAxMDEwMCwKCSAgICAgICAgICAgIDB4MTEwMDAwMDogMHgxMDAwNCwKCSAgICAgICAgICAgIDB4MTIwMDAwMDogMHgxMDAwMCwKCSAgICAgICAgICAgIDB4MTMwMDAwMDogMHg0MDAwMTAwLAoJICAgICAgICAgICAgMHgxNDAwMDAwOiAweDEwMCwKCSAgICAgICAgICAgIDB4MTUwMDAwMDogMHg0MDEwMTA0LAoJICAgICAgICAgICAgMHgxNjAwMDAwOiAweDQwMDAwMDQsCgkgICAgICAgICAgICAweDE3MDAwMDA6IDB4MCwKCSAgICAgICAgICAgIDB4MTgwMDAwMDogMHg0MDAwMTA0LAoJICAgICAgICAgICAgMHgxOTAwMDAwOiAweDQwMDAwMDAsCgkgICAgICAgICAgICAweDFhMDAwMDA6IDB4NCwKCSAgICAgICAgICAgIDB4MWIwMDAwMDogMHgxMDEwMCwKCSAgICAgICAgICAgIDB4MWMwMDAwMDogMHg0MDEwMDAwLAoJICAgICAgICAgICAgMHgxZDAwMDAwOiAweDEwNCwKCSAgICAgICAgICAgIDB4MWUwMDAwMDogMHgxMDEwNCwKCSAgICAgICAgICAgIDB4MWYwMDAwMDogMHg0MDEwMDA0LAoJICAgICAgICAgICAgMHgxMDgwMDAwOiAweDQwMDAwMDAsCgkgICAgICAgICAgICAweDExODAwMDA6IDB4MTA0LAoJICAgICAgICAgICAgMHgxMjgwMDAwOiAweDQwMTAxMDAsCgkgICAgICAgICAgICAweDEzODAwMDA6IDB4MCwKCSAgICAgICAgICAgIDB4MTQ4MDAwMDogMHgxMDAwNCwKCSAgICAgICAgICAgIDB4MTU4MDAwMDogMHg0MDAwMTAwLAoJICAgICAgICAgICAgMHgxNjgwMDAwOiAweDEwMCwKCSAgICAgICAgICAgIDB4MTc4MDAwMDogMHg0MDEwMDA0LAoJICAgICAgICAgICAgMHgxODgwMDAwOiAweDEwMDAwLAoJICAgICAgICAgICAgMHgxOTgwMDAwOiAweDQwMTAxMDQsCgkgICAgICAgICAgICAweDFhODAwMDA6IDB4MTAxMDQsCgkgICAgICAgICAgICAweDFiODAwMDA6IDB4NDAwMDAwNCwKCSAgICAgICAgICAgIDB4MWM4MDAwMDogMHg0MDAwMTA0LAoJICAgICAgICAgICAgMHgxZDgwMDAwOiAweDQwMTAwMDAsCgkgICAgICAgICAgICAweDFlODAwMDA6IDB4NCwKCSAgICAgICAgICAgIDB4MWY4MDAwMDogMHgxMDEwMAoJICAgICAgICB9LAoJICAgICAgICB7CgkgICAgICAgICAgICAweDA6IDB4ODA0MDEwMDAsCgkgICAgICAgICAgICAweDEwMDAwOiAweDgwMDAxMDQwLAoJICAgICAgICAgICAgMHgyMDAwMDogMHg0MDEwNDAsCgkgICAgICAgICAgICAweDMwMDAwOiAweDgwNDAwMDAwLAoJICAgICAgICAgICAgMHg0MDAwMDogMHgwLAoJICAgICAgICAgICAgMHg1MDAwMDogMHg0MDEwMDAsCgkgICAgICAgICAgICAweDYwMDAwOiAweDgwMDAwMDQwLAoJICAgICAgICAgICAgMHg3MDAwMDogMHg0MDAwNDAsCgkgICAgICAgICAgICAweDgwMDAwOiAweDgwMDAwMDAwLAoJICAgICAgICAgICAgMHg5MDAwMDogMHg0MDAwMDAsCgkgICAgICAgICAgICAweGEwMDAwOiAweDQwLAoJICAgICAgICAgICAgMHhiMDAwMDogMHg4MDAwMTAwMCwKCSAgICAgICAgICAgIDB4YzAwMDA6IDB4ODA0MDAwNDAsCgkgICAgICAgICAgICAweGQwMDAwOiAweDEwNDAsCgkgICAgICAgICAgICAweGUwMDAwOiAweDEwMDAsCgkgICAgICAgICAgICAweGYwMDAwOiAweDgwNDAxMDQwLAoJICAgICAgICAgICAgMHg4MDAwOiAweDgwMDAxMDQwLAoJICAgICAgICAgICAgMHgxODAwMDogMHg0MCwKCSAgICAgICAgICAgIDB4MjgwMDA6IDB4ODA0MDAwNDAsCgkgICAgICAgICAgICAweDM4MDAwOiAweDgwMDAxMDAwLAoJICAgICAgICAgICAgMHg0ODAwMDogMHg0MDEwMDAsCgkgICAgICAgICAgICAweDU4MDAwOiAweDgwNDAxMDQwLAoJICAgICAgICAgICAgMHg2ODAwMDogMHgwLAoJICAgICAgICAgICAgMHg3ODAwMDogMHg4MDQwMDAwMCwKCSAgICAgICAgICAgIDB4ODgwMDA6IDB4MTAwMCwKCSAgICAgICAgICAgIDB4OTgwMDA6IDB4ODA0MDEwMDAsCgkgICAgICAgICAgICAweGE4MDAwOiAweDQwMDAwMCwKCSAgICAgICAgICAgIDB4YjgwMDA6IDB4MTA0MCwKCSAgICAgICAgICAgIDB4YzgwMDA6IDB4ODAwMDAwMDAsCgkgICAgICAgICAgICAweGQ4MDAwOiAweDQwMDA0MCwKCSAgICAgICAgICAgIDB4ZTgwMDA6IDB4NDAxMDQwLAoJICAgICAgICAgICAgMHhmODAwMDogMHg4MDAwMDA0MCwKCSAgICAgICAgICAgIDB4MTAwMDAwOiAweDQwMDA0MCwKCSAgICAgICAgICAgIDB4MTEwMDAwOiAweDQwMTAwMCwKCSAgICAgICAgICAgIDB4MTIwMDAwOiAweDgwMDAwMDQwLAoJICAgICAgICAgICAgMHgxMzAwMDA6IDB4MCwKCSAgICAgICAgICAgIDB4MTQwMDAwOiAweDEwNDAsCgkgICAgICAgICAgICAweDE1MDAwMDogMHg4MDQwMDA0MCwKCSAgICAgICAgICAgIDB4MTYwMDAwOiAweDgwNDAxMDAwLAoJICAgICAgICAgICAgMHgxNzAwMDA6IDB4ODAwMDEwNDAsCgkgICAgICAgICAgICAweDE4MDAwMDogMHg4MDQwMTA0MCwKCSAgICAgICAgICAgIDB4MTkwMDAwOiAweDgwMDAwMDAwLAoJICAgICAgICAgICAgMHgxYTAwMDA6IDB4ODA0MDAwMDAsCgkgICAgICAgICAgICAweDFiMDAwMDogMHg0MDEwNDAsCgkgICAgICAgICAgICAweDFjMDAwMDogMHg4MDAwMTAwMCwKCSAgICAgICAgICAgIDB4MWQwMDAwOiAweDQwMDAwMCwKCSAgICAgICAgICAgIDB4MWUwMDAwOiAweDQwLAoJICAgICAgICAgICAgMHgxZjAwMDA6IDB4MTAwMCwKCSAgICAgICAgICAgIDB4MTA4MDAwOiAweDgwNDAwMDAwLAoJICAgICAgICAgICAgMHgxMTgwMDA6IDB4ODA0MDEwNDAsCgkgICAgICAgICAgICAweDEyODAwMDogMHgwLAoJICAgICAgICAgICAgMHgxMzgwMDA6IDB4NDAxMDAwLAoJICAgICAgICAgICAgMHgxNDgwMDA6IDB4NDAwMDQwLAoJICAgICAgICAgICAgMHgxNTgwMDA6IDB4ODAwMDAwMDAsCgkgICAgICAgICAgICAweDE2ODAwMDogMHg4MDAwMTA0MCwKCSAgICAgICAgICAgIDB4MTc4MDAwOiAweDQwLAoJICAgICAgICAgICAgMHgxODgwMDA6IDB4ODAwMDAwNDAsCgkgICAgICAgICAgICAweDE5ODAwMDogMHgxMDAwLAoJICAgICAgICAgICAgMHgxYTgwMDA6IDB4ODAwMDEwMDAsCgkgICAgICAgICAgICAweDFiODAwMDogMHg4MDQwMDA0MCwKCSAgICAgICAgICAgIDB4MWM4MDAwOiAweDEwNDAsCgkgICAgICAgICAgICAweDFkODAwMDogMHg4MDQwMTAwMCwKCSAgICAgICAgICAgIDB4MWU4MDAwOiAweDQwMDAwMCwKCSAgICAgICAgICAgIDB4MWY4MDAwOiAweDQwMTA0MAoJICAgICAgICB9LAoJICAgICAgICB7CgkgICAgICAgICAgICAweDA6IDB4ODAsCgkgICAgICAgICAgICAweDEwMDA6IDB4MTA0MDAwMCwKCSAgICAgICAgICAgIDB4MjAwMDogMHg0MDAwMCwKCSAgICAgICAgICAgIDB4MzAwMDogMHgyMDAwMDAwMCwKCSAgICAgICAgICAgIDB4NDAwMDogMHgyMDA0MDA4MCwKCSAgICAgICAgICAgIDB4NTAwMDogMHgxMDAwMDgwLAoJICAgICAgICAgICAgMHg2MDAwOiAweDIxMDAwMDgwLAoJICAgICAgICAgICAgMHg3MDAwOiAweDQwMDgwLAoJICAgICAgICAgICAgMHg4MDAwOiAweDEwMDAwMDAsCgkgICAgICAgICAgICAweDkwMDA6IDB4MjAwNDAwMDAsCgkgICAgICAgICAgICAweGEwMDA6IDB4MjAwMDAwODAsCgkgICAgICAgICAgICAweGIwMDA6IDB4MjEwNDAwODAsCgkgICAgICAgICAgICAweGMwMDA6IDB4MjEwNDAwMDAsCgkgICAgICAgICAgICAweGQwMDA6IDB4MCwKCSAgICAgICAgICAgIDB4ZTAwMDogMHgxMDQwMDgwLAoJICAgICAgICAgICAgMHhmMDAwOiAweDIxMDAwMDAwLAoJICAgICAgICAgICAgMHg4MDA6IDB4MTA0MDA4MCwKCSAgICAgICAgICAgIDB4MTgwMDogMHgyMTAwMDA4MCwKCSAgICAgICAgICAgIDB4MjgwMDogMHg4MCwKCSAgICAgICAgICAgIDB4MzgwMDogMHgxMDQwMDAwLAoJICAgICAgICAgICAgMHg0ODAwOiAweDQwMDAwLAoJICAgICAgICAgICAgMHg1ODAwOiAweDIwMDQwMDgwLAoJICAgICAgICAgICAgMHg2ODAwOiAweDIxMDQwMDAwLAoJICAgICAgICAgICAgMHg3ODAwOiAweDIwMDAwMDAwLAoJICAgICAgICAgICAgMHg4ODAwOiAweDIwMDQwMDAwLAoJICAgICAgICAgICAgMHg5ODAwOiAweDAsCgkgICAgICAgICAgICAweGE4MDA6IDB4MjEwNDAwODAsCgkgICAgICAgICAgICAweGI4MDA6IDB4MTAwMDA4MCwKCSAgICAgICAgICAgIDB4YzgwMDogMHgyMDAwMDA4MCwKCSAgICAgICAgICAgIDB4ZDgwMDogMHgyMTAwMDAwMCwKCSAgICAgICAgICAgIDB4ZTgwMDogMHgxMDAwMDAwLAoJICAgICAgICAgICAgMHhmODAwOiAweDQwMDgwLAoJICAgICAgICAgICAgMHgxMDAwMDogMHg0MDAwMCwKCSAgICAgICAgICAgIDB4MTEwMDA6IDB4ODAsCgkgICAgICAgICAgICAweDEyMDAwOiAweDIwMDAwMDAwLAoJICAgICAgICAgICAgMHgxMzAwMDogMHgyMTAwMDA4MCwKCSAgICAgICAgICAgIDB4MTQwMDA6IDB4MTAwMDA4MCwKCSAgICAgICAgICAgIDB4MTUwMDA6IDB4MjEwNDAwMDAsCgkgICAgICAgICAgICAweDE2MDAwOiAweDIwMDQwMDgwLAoJICAgICAgICAgICAgMHgxNzAwMDogMHgxMDAwMDAwLAoJICAgICAgICAgICAgMHgxODAwMDogMHgyMTA0MDA4MCwKCSAgICAgICAgICAgIDB4MTkwMDA6IDB4MjEwMDAwMDAsCgkgICAgICAgICAgICAweDFhMDAwOiAweDEwNDAwMDAsCgkgICAgICAgICAgICAweDFiMDAwOiAweDIwMDQwMDAwLAoJICAgICAgICAgICAgMHgxYzAwMDogMHg0MDA4MCwKCSAgICAgICAgICAgIDB4MWQwMDA6IDB4MjAwMDAwODAsCgkgICAgICAgICAgICAweDFlMDAwOiAweDAsCgkgICAgICAgICAgICAweDFmMDAwOiAweDEwNDAwODAsCgkgICAgICAgICAgICAweDEwODAwOiAweDIxMDAwMDgwLAoJICAgICAgICAgICAgMHgxMTgwMDogMHgxMDAwMDAwLAoJICAgICAgICAgICAgMHgxMjgwMDogMHgxMDQwMDAwLAoJICAgICAgICAgICAgMHgxMzgwMDogMHgyMDA0MDA4MCwKCSAgICAgICAgICAgIDB4MTQ4MDA6IDB4MjAwMDAwMDAsCgkgICAgICAgICAgICAweDE1ODAwOiAweDEwNDAwODAsCgkgICAgICAgICAgICAweDE2ODAwOiAweDgwLAoJICAgICAgICAgICAgMHgxNzgwMDogMHgyMTA0MDAwMCwKCSAgICAgICAgICAgIDB4MTg4MDA6IDB4NDAwODAsCgkgICAgICAgICAgICAweDE5ODAwOiAweDIxMDQwMDgwLAoJICAgICAgICAgICAgMHgxYTgwMDogMHgwLAoJICAgICAgICAgICAgMHgxYjgwMDogMHgyMTAwMDAwMCwKCSAgICAgICAgICAgIDB4MWM4MDA6IDB4MTAwMDA4MCwKCSAgICAgICAgICAgIDB4MWQ4MDA6IDB4NDAwMDAsCgkgICAgICAgICAgICAweDFlODAwOiAweDIwMDQwMDAwLAoJICAgICAgICAgICAgMHgxZjgwMDogMHgyMDAwMDA4MAoJICAgICAgICB9LAoJICAgICAgICB7CgkgICAgICAgICAgICAweDA6IDB4MTAwMDAwMDgsCgkgICAgICAgICAgICAweDEwMDogMHgyMDAwLAoJICAgICAgICAgICAgMHgyMDA6IDB4MTAyMDAwMDAsCgkgICAgICAgICAgICAweDMwMDogMHgxMDIwMjAwOCwKCSAgICAgICAgICAgIDB4NDAwOiAweDEwMDAyMDAwLAoJICAgICAgICAgICAgMHg1MDA6IDB4MjAwMDAwLAoJICAgICAgICAgICAgMHg2MDA6IDB4MjAwMDA4LAoJICAgICAgICAgICAgMHg3MDA6IDB4MTAwMDAwMDAsCgkgICAgICAgICAgICAweDgwMDogMHgwLAoJICAgICAgICAgICAgMHg5MDA6IDB4MTAwMDIwMDgsCgkgICAgICAgICAgICAweGEwMDogMHgyMDIwMDAsCgkgICAgICAgICAgICAweGIwMDogMHg4LAoJICAgICAgICAgICAgMHhjMDA6IDB4MTAyMDAwMDgsCgkgICAgICAgICAgICAweGQwMDogMHgyMDIwMDgsCgkgICAgICAgICAgICAweGUwMDogMHgyMDA4LAoJICAgICAgICAgICAgMHhmMDA6IDB4MTAyMDIwMDAsCgkgICAgICAgICAgICAweDgwOiAweDEwMjAwMDAwLAoJICAgICAgICAgICAgMHgxODA6IDB4MTAyMDIwMDgsCgkgICAgICAgICAgICAweDI4MDogMHg4LAoJICAgICAgICAgICAgMHgzODA6IDB4MjAwMDAwLAoJICAgICAgICAgICAgMHg0ODA6IDB4MjAyMDA4LAoJICAgICAgICAgICAgMHg1ODA6IDB4MTAwMDAwMDgsCgkgICAgICAgICAgICAweDY4MDogMHgxMDAwMjAwMCwKCSAgICAgICAgICAgIDB4NzgwOiAweDIwMDgsCgkgICAgICAgICAgICAweDg4MDogMHgyMDAwMDgsCgkgICAgICAgICAgICAweDk4MDogMHgyMDAwLAoJICAgICAgICAgICAgMHhhODA6IDB4MTAwMDIwMDgsCgkgICAgICAgICAgICAweGI4MDogMHgxMDIwMDAwOCwKCSAgICAgICAgICAgIDB4YzgwOiAweDAsCgkgICAgICAgICAgICAweGQ4MDogMHgxMDIwMjAwMCwKCSAgICAgICAgICAgIDB4ZTgwOiAweDIwMjAwMCwKCSAgICAgICAgICAgIDB4ZjgwOiAweDEwMDAwMDAwLAoJICAgICAgICAgICAgMHgxMDAwOiAweDEwMDAyMDAwLAoJICAgICAgICAgICAgMHgxMTAwOiAweDEwMjAwMDA4LAoJICAgICAgICAgICAgMHgxMjAwOiAweDEwMjAyMDA4LAoJICAgICAgICAgICAgMHgxMzAwOiAweDIwMDgsCgkgICAgICAgICAgICAweDE0MDA6IDB4MjAwMDAwLAoJICAgICAgICAgICAgMHgxNTAwOiAweDEwMDAwMDAwLAoJICAgICAgICAgICAgMHgxNjAwOiAweDEwMDAwMDA4LAoJICAgICAgICAgICAgMHgxNzAwOiAweDIwMjAwMCwKCSAgICAgICAgICAgIDB4MTgwMDogMHgyMDIwMDgsCgkgICAgICAgICAgICAweDE5MDA6IDB4MCwKCSAgICAgICAgICAgIDB4MWEwMDogMHg4LAoJICAgICAgICAgICAgMHgxYjAwOiAweDEwMjAwMDAwLAoJICAgICAgICAgICAgMHgxYzAwOiAweDIwMDAsCgkgICAgICAgICAgICAweDFkMDA6IDB4MTAwMDIwMDgsCgkgICAgICAgICAgICAweDFlMDA6IDB4MTAyMDIwMDAsCgkgICAgICAgICAgICAweDFmMDA6IDB4MjAwMDA4LAoJICAgICAgICAgICAgMHgxMDgwOiAweDgsCgkgICAgICAgICAgICAweDExODA6IDB4MjAyMDAwLAoJICAgICAgICAgICAgMHgxMjgwOiAweDIwMDAwMCwKCSAgICAgICAgICAgIDB4MTM4MDogMHgxMDAwMDAwOCwKCSAgICAgICAgICAgIDB4MTQ4MDogMHgxMDAwMjAwMCwKCSAgICAgICAgICAgIDB4MTU4MDogMHgyMDA4LAoJICAgICAgICAgICAgMHgxNjgwOiAweDEwMjAyMDA4LAoJICAgICAgICAgICAgMHgxNzgwOiAweDEwMjAwMDAwLAoJICAgICAgICAgICAgMHgxODgwOiAweDEwMjAyMDAwLAoJICAgICAgICAgICAgMHgxOTgwOiAweDEwMjAwMDA4LAoJICAgICAgICAgICAgMHgxYTgwOiAweDIwMDAsCgkgICAgICAgICAgICAweDFiODA6IDB4MjAyMDA4LAoJICAgICAgICAgICAgMHgxYzgwOiAweDIwMDAwOCwKCSAgICAgICAgICAgIDB4MWQ4MDogMHgwLAoJICAgICAgICAgICAgMHgxZTgwOiAweDEwMDAwMDAwLAoJICAgICAgICAgICAgMHgxZjgwOiAweDEwMDAyMDA4CgkgICAgICAgIH0sCgkgICAgICAgIHsKCSAgICAgICAgICAgIDB4MDogMHgxMDAwMDAsCgkgICAgICAgICAgICAweDEwOiAweDIwMDA0MDEsCgkgICAgICAgICAgICAweDIwOiAweDQwMCwKCSAgICAgICAgICAgIDB4MzA6IDB4MTAwNDAxLAoJICAgICAgICAgICAgMHg0MDogMHgyMTAwNDAxLAoJICAgICAgICAgICAgMHg1MDogMHgwLAoJICAgICAgICAgICAgMHg2MDogMHgxLAoJICAgICAgICAgICAgMHg3MDogMHgyMTAwMDAxLAoJICAgICAgICAgICAgMHg4MDogMHgyMDAwNDAwLAoJICAgICAgICAgICAgMHg5MDogMHgxMDAwMDEsCgkgICAgICAgICAgICAweGEwOiAweDIwMDAwMDEsCgkgICAgICAgICAgICAweGIwOiAweDIxMDA0MDAsCgkgICAgICAgICAgICAweGMwOiAweDIxMDAwMDAsCgkgICAgICAgICAgICAweGQwOiAweDQwMSwKCSAgICAgICAgICAgIDB4ZTA6IDB4MTAwNDAwLAoJICAgICAgICAgICAgMHhmMDogMHgyMDAwMDAwLAoJICAgICAgICAgICAgMHg4OiAweDIxMDAwMDEsCgkgICAgICAgICAgICAweDE4OiAweDAsCgkgICAgICAgICAgICAweDI4OiAweDIwMDA0MDEsCgkgICAgICAgICAgICAweDM4OiAweDIxMDA0MDAsCgkgICAgICAgICAgICAweDQ4OiAweDEwMDAwMCwKCSAgICAgICAgICAgIDB4NTg6IDB4MjAwMDAwMSwKCSAgICAgICAgICAgIDB4Njg6IDB4MjAwMDAwMCwKCSAgICAgICAgICAgIDB4Nzg6IDB4NDAxLAoJICAgICAgICAgICAgMHg4ODogMHgxMDA0MDEsCgkgICAgICAgICAgICAweDk4OiAweDIwMDA0MDAsCgkgICAgICAgICAgICAweGE4OiAweDIxMDAwMDAsCgkgICAgICAgICAgICAweGI4OiAweDEwMDAwMSwKCSAgICAgICAgICAgIDB4Yzg6IDB4NDAwLAoJICAgICAgICAgICAgMHhkODogMHgyMTAwNDAxLAoJICAgICAgICAgICAgMHhlODogMHgxLAoJICAgICAgICAgICAgMHhmODogMHgxMDA0MDAsCgkgICAgICAgICAgICAweDEwMDogMHgyMDAwMDAwLAoJICAgICAgICAgICAgMHgxMTA6IDB4MTAwMDAwLAoJICAgICAgICAgICAgMHgxMjA6IDB4MjAwMDQwMSwKCSAgICAgICAgICAgIDB4MTMwOiAweDIxMDAwMDEsCgkgICAgICAgICAgICAweDE0MDogMHgxMDAwMDEsCgkgICAgICAgICAgICAweDE1MDogMHgyMDAwNDAwLAoJICAgICAgICAgICAgMHgxNjA6IDB4MjEwMDQwMCwKCSAgICAgICAgICAgIDB4MTcwOiAweDEwMDQwMSwKCSAgICAgICAgICAgIDB4MTgwOiAweDQwMSwKCSAgICAgICAgICAgIDB4MTkwOiAweDIxMDA0MDEsCgkgICAgICAgICAgICAweDFhMDogMHgxMDA0MDAsCgkgICAgICAgICAgICAweDFiMDogMHgxLAoJICAgICAgICAgICAgMHgxYzA6IDB4MCwKCSAgICAgICAgICAgIDB4MWQwOiAweDIxMDAwMDAsCgkgICAgICAgICAgICAweDFlMDogMHgyMDAwMDAxLAoJICAgICAgICAgICAgMHgxZjA6IDB4NDAwLAoJICAgICAgICAgICAgMHgxMDg6IDB4MTAwNDAwLAoJICAgICAgICAgICAgMHgxMTg6IDB4MjAwMDQwMSwKCSAgICAgICAgICAgIDB4MTI4OiAweDIxMDAwMDEsCgkgICAgICAgICAgICAweDEzODogMHgxLAoJICAgICAgICAgICAgMHgxNDg6IDB4MjAwMDAwMCwKCSAgICAgICAgICAgIDB4MTU4OiAweDEwMDAwMCwKCSAgICAgICAgICAgIDB4MTY4OiAweDQwMSwKCSAgICAgICAgICAgIDB4MTc4OiAweDIxMDA0MDAsCgkgICAgICAgICAgICAweDE4ODogMHgyMDAwMDAxLAoJICAgICAgICAgICAgMHgxOTg6IDB4MjEwMDAwMCwKCSAgICAgICAgICAgIDB4MWE4OiAweDAsCgkgICAgICAgICAgICAweDFiODogMHgyMTAwNDAxLAoJICAgICAgICAgICAgMHgxYzg6IDB4MTAwNDAxLAoJICAgICAgICAgICAgMHgxZDg6IDB4NDAwLAoJICAgICAgICAgICAgMHgxZTg6IDB4MjAwMDQwMCwKCSAgICAgICAgICAgIDB4MWY4OiAweDEwMDAwMQoJICAgICAgICB9LAoJICAgICAgICB7CgkgICAgICAgICAgICAweDA6IDB4ODAwMDgyMCwKCSAgICAgICAgICAgIDB4MTogMHgyMDAwMCwKCSAgICAgICAgICAgIDB4MjogMHg4MDAwMDAwLAoJICAgICAgICAgICAgMHgzOiAweDIwLAoJICAgICAgICAgICAgMHg0OiAweDIwMDIwLAoJICAgICAgICAgICAgMHg1OiAweDgwMjA4MjAsCgkgICAgICAgICAgICAweDY6IDB4ODAyMDgwMCwKCSAgICAgICAgICAgIDB4NzogMHg4MDAsCgkgICAgICAgICAgICAweDg6IDB4ODAyMDAwMCwKCSAgICAgICAgICAgIDB4OTogMHg4MDAwODAwLAoJICAgICAgICAgICAgMHhhOiAweDIwODAwLAoJICAgICAgICAgICAgMHhiOiAweDgwMjAwMjAsCgkgICAgICAgICAgICAweGM6IDB4ODIwLAoJICAgICAgICAgICAgMHhkOiAweDAsCgkgICAgICAgICAgICAweGU6IDB4ODAwMDAyMCwKCSAgICAgICAgICAgIDB4ZjogMHgyMDgyMCwKCSAgICAgICAgICAgIDB4ODAwMDAwMDA6IDB4ODAwLAoJICAgICAgICAgICAgMHg4MDAwMDAwMTogMHg4MDIwODIwLAoJICAgICAgICAgICAgMHg4MDAwMDAwMjogMHg4MDAwODIwLAoJICAgICAgICAgICAgMHg4MDAwMDAwMzogMHg4MDAwMDAwLAoJICAgICAgICAgICAgMHg4MDAwMDAwNDogMHg4MDIwMDAwLAoJICAgICAgICAgICAgMHg4MDAwMDAwNTogMHgyMDgwMCwKCSAgICAgICAgICAgIDB4ODAwMDAwMDY6IDB4MjA4MjAsCgkgICAgICAgICAgICAweDgwMDAwMDA3OiAweDIwLAoJICAgICAgICAgICAgMHg4MDAwMDAwODogMHg4MDAwMDIwLAoJICAgICAgICAgICAgMHg4MDAwMDAwOTogMHg4MjAsCgkgICAgICAgICAgICAweDgwMDAwMDBhOiAweDIwMDIwLAoJICAgICAgICAgICAgMHg4MDAwMDAwYjogMHg4MDIwODAwLAoJICAgICAgICAgICAgMHg4MDAwMDAwYzogMHgwLAoJICAgICAgICAgICAgMHg4MDAwMDAwZDogMHg4MDIwMDIwLAoJICAgICAgICAgICAgMHg4MDAwMDAwZTogMHg4MDAwODAwLAoJICAgICAgICAgICAgMHg4MDAwMDAwZjogMHgyMDAwMCwKCSAgICAgICAgICAgIDB4MTA6IDB4MjA4MjAsCgkgICAgICAgICAgICAweDExOiAweDgwMjA4MDAsCgkgICAgICAgICAgICAweDEyOiAweDIwLAoJICAgICAgICAgICAgMHgxMzogMHg4MDAsCgkgICAgICAgICAgICAweDE0OiAweDgwMDA4MDAsCgkgICAgICAgICAgICAweDE1OiAweDgwMDAwMjAsCgkgICAgICAgICAgICAweDE2OiAweDgwMjAwMjAsCgkgICAgICAgICAgICAweDE3OiAweDIwMDAwLAoJICAgICAgICAgICAgMHgxODogMHgwLAoJICAgICAgICAgICAgMHgxOTogMHgyMDAyMCwKCSAgICAgICAgICAgIDB4MWE6IDB4ODAyMDAwMCwKCSAgICAgICAgICAgIDB4MWI6IDB4ODAwMDgyMCwKCSAgICAgICAgICAgIDB4MWM6IDB4ODAyMDgyMCwKCSAgICAgICAgICAgIDB4MWQ6IDB4MjA4MDAsCgkgICAgICAgICAgICAweDFlOiAweDgyMCwKCSAgICAgICAgICAgIDB4MWY6IDB4ODAwMDAwMCwKCSAgICAgICAgICAgIDB4ODAwMDAwMTA6IDB4MjAwMDAsCgkgICAgICAgICAgICAweDgwMDAwMDExOiAweDgwMCwKCSAgICAgICAgICAgIDB4ODAwMDAwMTI6IDB4ODAyMDAyMCwKCSAgICAgICAgICAgIDB4ODAwMDAwMTM6IDB4MjA4MjAsCgkgICAgICAgICAgICAweDgwMDAwMDE0OiAweDIwLAoJICAgICAgICAgICAgMHg4MDAwMDAxNTogMHg4MDIwMDAwLAoJICAgICAgICAgICAgMHg4MDAwMDAxNjogMHg4MDAwMDAwLAoJICAgICAgICAgICAgMHg4MDAwMDAxNzogMHg4MDAwODIwLAoJICAgICAgICAgICAgMHg4MDAwMDAxODogMHg4MDIwODIwLAoJICAgICAgICAgICAgMHg4MDAwMDAxOTogMHg4MDAwMDIwLAoJICAgICAgICAgICAgMHg4MDAwMDAxYTogMHg4MDAwODAwLAoJICAgICAgICAgICAgMHg4MDAwMDAxYjogMHgwLAoJICAgICAgICAgICAgMHg4MDAwMDAxYzogMHgyMDgwMCwKCSAgICAgICAgICAgIDB4ODAwMDAwMWQ6IDB4ODIwLAoJICAgICAgICAgICAgMHg4MDAwMDAxZTogMHgyMDAyMCwKCSAgICAgICAgICAgIDB4ODAwMDAwMWY6IDB4ODAyMDgwMAoJICAgICAgICB9CgkgICAgXTsKCgkgICAgLy8gTWFza3MgdGhhdCBzZWxlY3QgdGhlIFNCT1ggaW5wdXQKCSAgICB2YXIgU0JPWF9NQVNLID0gWwoJICAgICAgICAweGY4MDAwMDAxLCAweDFmODAwMDAwLCAweDAxZjgwMDAwLCAweDAwMWY4MDAwLAoJICAgICAgICAweDAwMDFmODAwLCAweDAwMDAxZjgwLCAweDAwMDAwMWY4LCAweDgwMDAwMDFmCgkgICAgXTsKCgkgICAgLyoqCgkgICAgICogREVTIGJsb2NrIGNpcGhlciBhbGdvcml0aG0uCgkgICAgICovCgkgICAgdmFyIERFUyA9IENfYWxnby5ERVMgPSBCbG9ja0NpcGhlci5leHRlbmQoewoJICAgICAgICBfZG9SZXNldDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIga2V5ID0gdGhpcy5fa2V5OwoJICAgICAgICAgICAgdmFyIGtleVdvcmRzID0ga2V5LndvcmRzOwoKCSAgICAgICAgICAgIC8vIFNlbGVjdCA1NiBiaXRzIGFjY29yZGluZyB0byBQQzEKCSAgICAgICAgICAgIHZhciBrZXlCaXRzID0gW107CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDU2OyBpKyspIHsKCSAgICAgICAgICAgICAgICB2YXIga2V5Qml0UG9zID0gUEMxW2ldIC0gMTsKCSAgICAgICAgICAgICAgICBrZXlCaXRzW2ldID0gKGtleVdvcmRzW2tleUJpdFBvcyA+Pj4gNV0gPj4+ICgzMSAtIGtleUJpdFBvcyAlIDMyKSkgJiAxOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIEFzc2VtYmxlIDE2IHN1YmtleXMKCSAgICAgICAgICAgIHZhciBzdWJLZXlzID0gdGhpcy5fc3ViS2V5cyA9IFtdOwoJICAgICAgICAgICAgZm9yICh2YXIgblN1YktleSA9IDA7IG5TdWJLZXkgPCAxNjsgblN1YktleSsrKSB7CgkgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHN1YmtleQoJICAgICAgICAgICAgICAgIHZhciBzdWJLZXkgPSBzdWJLZXlzW25TdWJLZXldID0gW107CgoJICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0CgkgICAgICAgICAgICAgICAgdmFyIGJpdFNoaWZ0ID0gQklUX1NISUZUU1tuU3ViS2V5XTsKCgkgICAgICAgICAgICAgICAgLy8gU2VsZWN0IDQ4IGJpdHMgYWNjb3JkaW5nIHRvIFBDMgoJICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjQ7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICAvLyBTZWxlY3QgZnJvbSB0aGUgbGVmdCAyOCBrZXkgYml0cwoJICAgICAgICAgICAgICAgICAgICBzdWJLZXlbKGkgLyA2KSB8IDBdIHw9IGtleUJpdHNbKChQQzJbaV0gLSAxKSArIGJpdFNoaWZ0KSAlIDI4XSA8PCAoMzEgLSBpICUgNik7CgoJICAgICAgICAgICAgICAgICAgICAvLyBTZWxlY3QgZnJvbSB0aGUgcmlnaHQgMjgga2V5IGJpdHMKCSAgICAgICAgICAgICAgICAgICAgc3ViS2V5WzQgKyAoKGkgLyA2KSB8IDApXSB8PSBrZXlCaXRzWzI4ICsgKCgoUEMyW2kgKyAyNF0gLSAxKSArIGJpdFNoaWZ0KSAlIDI4KV0gPDwgKDMxIC0gaSAlIDYpOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgLy8gU2luY2UgZWFjaCBzdWJrZXkgaXMgYXBwbGllZCB0byBhbiBleHBhbmRlZCAzMi1iaXQgaW5wdXQsCgkgICAgICAgICAgICAgICAgLy8gdGhlIHN1YmtleSBjYW4gYmUgYnJva2VuIGludG8gOCB2YWx1ZXMgc2NhbGVkIHRvIDMyLWJpdHMsCgkgICAgICAgICAgICAgICAgLy8gd2hpY2ggYWxsb3dzIHRoZSBrZXkgdG8gYmUgdXNlZCB3aXRob3V0IGV4cGFuc2lvbgoJICAgICAgICAgICAgICAgIHN1YktleVswXSA9IChzdWJLZXlbMF0gPDwgMSkgfCAoc3ViS2V5WzBdID4+PiAzMSk7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCA3OyBpKyspIHsKCSAgICAgICAgICAgICAgICAgICAgc3ViS2V5W2ldID0gc3ViS2V5W2ldID4+PiAoKGkgLSAxKSAqIDQgKyAzKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgc3ViS2V5WzddID0gKHN1YktleVs3XSA8PCA1KSB8IChzdWJLZXlbN10gPj4+IDI3KTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBDb21wdXRlIGludmVyc2Ugc3Via2V5cwoJICAgICAgICAgICAgdmFyIGludlN1YktleXMgPSB0aGlzLl9pbnZTdWJLZXlzID0gW107CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDE2OyBpKyspIHsKCSAgICAgICAgICAgICAgICBpbnZTdWJLZXlzW2ldID0gc3ViS2V5c1sxNSAtIGldOwoJICAgICAgICAgICAgfQoJICAgICAgICB9LAoKCSAgICAgICAgZW5jcnlwdEJsb2NrOiBmdW5jdGlvbiAoTSwgb2Zmc2V0KSB7CgkgICAgICAgICAgICB0aGlzLl9kb0NyeXB0QmxvY2soTSwgb2Zmc2V0LCB0aGlzLl9zdWJLZXlzKTsKCSAgICAgICAgfSwKCgkgICAgICAgIGRlY3J5cHRCbG9jazogZnVuY3Rpb24gKE0sIG9mZnNldCkgewoJICAgICAgICAgICAgdGhpcy5fZG9DcnlwdEJsb2NrKE0sIG9mZnNldCwgdGhpcy5faW52U3ViS2V5cyk7CgkgICAgICAgIH0sCgoJICAgICAgICBfZG9DcnlwdEJsb2NrOiBmdW5jdGlvbiAoTSwgb2Zmc2V0LCBzdWJLZXlzKSB7CgkgICAgICAgICAgICAvLyBHZXQgaW5wdXQKCSAgICAgICAgICAgIHRoaXMuX2xCbG9jayA9IE1bb2Zmc2V0XTsKCSAgICAgICAgICAgIHRoaXMuX3JCbG9jayA9IE1bb2Zmc2V0ICsgMV07CgoJICAgICAgICAgICAgLy8gSW5pdGlhbCBwZXJtdXRhdGlvbgoJICAgICAgICAgICAgZXhjaGFuZ2VMUi5jYWxsKHRoaXMsIDQsICAweDBmMGYwZjBmKTsKCSAgICAgICAgICAgIGV4Y2hhbmdlTFIuY2FsbCh0aGlzLCAxNiwgMHgwMDAwZmZmZik7CgkgICAgICAgICAgICBleGNoYW5nZVJMLmNhbGwodGhpcywgMiwgIDB4MzMzMzMzMzMpOwoJICAgICAgICAgICAgZXhjaGFuZ2VSTC5jYWxsKHRoaXMsIDgsICAweDAwZmYwMGZmKTsKCSAgICAgICAgICAgIGV4Y2hhbmdlTFIuY2FsbCh0aGlzLCAxLCAgMHg1NTU1NTU1NSk7CgoJICAgICAgICAgICAgLy8gUm91bmRzCgkgICAgICAgICAgICBmb3IgKHZhciByb3VuZCA9IDA7IHJvdW5kIDwgMTY7IHJvdW5kKyspIHsKCSAgICAgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgICAgICB2YXIgc3ViS2V5ID0gc3ViS2V5c1tyb3VuZF07CgkgICAgICAgICAgICAgICAgdmFyIGxCbG9jayA9IHRoaXMuX2xCbG9jazsKCSAgICAgICAgICAgICAgICB2YXIgckJsb2NrID0gdGhpcy5fckJsb2NrOwoKCSAgICAgICAgICAgICAgICAvLyBGZWlzdGVsIGZ1bmN0aW9uCgkgICAgICAgICAgICAgICAgdmFyIGYgPSAwOwoJICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgODsgaSsrKSB7CgkgICAgICAgICAgICAgICAgICAgIGYgfD0gU0JPWF9QW2ldWygockJsb2NrIF4gc3ViS2V5W2ldKSAmIFNCT1hfTUFTS1tpXSkgPj4+IDBdOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB0aGlzLl9sQmxvY2sgPSByQmxvY2s7CgkgICAgICAgICAgICAgICAgdGhpcy5fckJsb2NrID0gbEJsb2NrIF4gZjsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBVbmRvIHN3YXAgZnJvbSBsYXN0IHJvdW5kCgkgICAgICAgICAgICB2YXIgdCA9IHRoaXMuX2xCbG9jazsKCSAgICAgICAgICAgIHRoaXMuX2xCbG9jayA9IHRoaXMuX3JCbG9jazsKCSAgICAgICAgICAgIHRoaXMuX3JCbG9jayA9IHQ7CgoJICAgICAgICAgICAgLy8gRmluYWwgcGVybXV0YXRpb24KCSAgICAgICAgICAgIGV4Y2hhbmdlTFIuY2FsbCh0aGlzLCAxLCAgMHg1NTU1NTU1NSk7CgkgICAgICAgICAgICBleGNoYW5nZVJMLmNhbGwodGhpcywgOCwgIDB4MDBmZjAwZmYpOwoJICAgICAgICAgICAgZXhjaGFuZ2VSTC5jYWxsKHRoaXMsIDIsICAweDMzMzMzMzMzKTsKCSAgICAgICAgICAgIGV4Y2hhbmdlTFIuY2FsbCh0aGlzLCAxNiwgMHgwMDAwZmZmZik7CgkgICAgICAgICAgICBleGNoYW5nZUxSLmNhbGwodGhpcywgNCwgIDB4MGYwZjBmMGYpOwoKCSAgICAgICAgICAgIC8vIFNldCBvdXRwdXQKCSAgICAgICAgICAgIE1bb2Zmc2V0XSA9IHRoaXMuX2xCbG9jazsKCSAgICAgICAgICAgIE1bb2Zmc2V0ICsgMV0gPSB0aGlzLl9yQmxvY2s7CgkgICAgICAgIH0sCgoJICAgICAgICBrZXlTaXplOiA2NC8zMiwKCgkgICAgICAgIGl2U2l6ZTogNjQvMzIsCgoJICAgICAgICBibG9ja1NpemU6IDY0LzMyCgkgICAgfSk7CgoJICAgIC8vIFN3YXAgYml0cyBhY3Jvc3MgdGhlIGxlZnQgYW5kIHJpZ2h0IHdvcmRzCgkgICAgZnVuY3Rpb24gZXhjaGFuZ2VMUihvZmZzZXQsIG1hc2spIHsKCSAgICAgICAgdmFyIHQgPSAoKHRoaXMuX2xCbG9jayA+Pj4gb2Zmc2V0KSBeIHRoaXMuX3JCbG9jaykgJiBtYXNrOwoJICAgICAgICB0aGlzLl9yQmxvY2sgXj0gdDsKCSAgICAgICAgdGhpcy5fbEJsb2NrIF49IHQgPDwgb2Zmc2V0OwoJICAgIH0KCgkgICAgZnVuY3Rpb24gZXhjaGFuZ2VSTChvZmZzZXQsIG1hc2spIHsKCSAgICAgICAgdmFyIHQgPSAoKHRoaXMuX3JCbG9jayA+Pj4gb2Zmc2V0KSBeIHRoaXMuX2xCbG9jaykgJiBtYXNrOwoJICAgICAgICB0aGlzLl9sQmxvY2sgXj0gdDsKCSAgICAgICAgdGhpcy5fckJsb2NrIF49IHQgPDwgb2Zmc2V0OwoJICAgIH0KCgkgICAgLyoqCgkgICAgICogU2hvcnRjdXQgZnVuY3Rpb25zIHRvIHRoZSBjaXBoZXIncyBvYmplY3QgaW50ZXJmYWNlLgoJICAgICAqCgkgICAgICogQGV4YW1wbGUKCSAgICAgKgoJICAgICAqICAgICB2YXIgY2lwaGVydGV4dCA9IENyeXB0b0pTLkRFUy5lbmNyeXB0KG1lc3NhZ2UsIGtleSwgY2ZnKTsKCSAgICAgKiAgICAgdmFyIHBsYWludGV4dCAgPSBDcnlwdG9KUy5ERVMuZGVjcnlwdChjaXBoZXJ0ZXh0LCBrZXksIGNmZyk7CgkgICAgICovCgkgICAgQy5ERVMgPSBCbG9ja0NpcGhlci5fY3JlYXRlSGVscGVyKERFUyk7CgoJICAgIC8qKgoJICAgICAqIFRyaXBsZS1ERVMgYmxvY2sgY2lwaGVyIGFsZ29yaXRobS4KCSAgICAgKi8KCSAgICB2YXIgVHJpcGxlREVTID0gQ19hbGdvLlRyaXBsZURFUyA9IEJsb2NrQ2lwaGVyLmV4dGVuZCh7CgkgICAgICAgIF9kb1Jlc2V0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgIHZhciBrZXkgPSB0aGlzLl9rZXk7CgkgICAgICAgICAgICB2YXIga2V5V29yZHMgPSBrZXkud29yZHM7CgkgICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIGtleSBsZW5ndGggaXMgdmFsaWQgKDY0LCAxMjggb3IgPj0gMTkyIGJpdCkKCSAgICAgICAgICAgIGlmIChrZXlXb3Jkcy5sZW5ndGggIT09IDIgJiYga2V5V29yZHMubGVuZ3RoICE9PSA0ICYmIGtleVdvcmRzLmxlbmd0aCA8IDYpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQga2V5IGxlbmd0aCAtIDNERVMgcmVxdWlyZXMgdGhlIGtleSBsZW5ndGggdG8gYmUgNjQsIDEyOCwgMTkyIG9yID4xOTIuJyk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gRXh0ZW5kIHRoZSBrZXkgYWNjb3JkaW5nIHRvIHRoZSBrZXlpbmcgb3B0aW9ucyBkZWZpbmVkIGluIDNERVMgc3RhbmRhcmQKCSAgICAgICAgICAgIHZhciBrZXkxID0ga2V5V29yZHMuc2xpY2UoMCwgMik7CgkgICAgICAgICAgICB2YXIga2V5MiA9IGtleVdvcmRzLmxlbmd0aCA8IDQgPyBrZXlXb3Jkcy5zbGljZSgwLCAyKSA6IGtleVdvcmRzLnNsaWNlKDIsIDQpOwoJICAgICAgICAgICAgdmFyIGtleTMgPSBrZXlXb3Jkcy5sZW5ndGggPCA2ID8ga2V5V29yZHMuc2xpY2UoMCwgMikgOiBrZXlXb3Jkcy5zbGljZSg0LCA2KTsKCgkgICAgICAgICAgICAvLyBDcmVhdGUgREVTIGluc3RhbmNlcwoJICAgICAgICAgICAgdGhpcy5fZGVzMSA9IERFUy5jcmVhdGVFbmNyeXB0b3IoV29yZEFycmF5LmNyZWF0ZShrZXkxKSk7CgkgICAgICAgICAgICB0aGlzLl9kZXMyID0gREVTLmNyZWF0ZUVuY3J5cHRvcihXb3JkQXJyYXkuY3JlYXRlKGtleTIpKTsKCSAgICAgICAgICAgIHRoaXMuX2RlczMgPSBERVMuY3JlYXRlRW5jcnlwdG9yKFdvcmRBcnJheS5jcmVhdGUoa2V5MykpOwoJICAgICAgICB9LAoKCSAgICAgICAgZW5jcnlwdEJsb2NrOiBmdW5jdGlvbiAoTSwgb2Zmc2V0KSB7CgkgICAgICAgICAgICB0aGlzLl9kZXMxLmVuY3J5cHRCbG9jayhNLCBvZmZzZXQpOwoJICAgICAgICAgICAgdGhpcy5fZGVzMi5kZWNyeXB0QmxvY2soTSwgb2Zmc2V0KTsKCSAgICAgICAgICAgIHRoaXMuX2RlczMuZW5jcnlwdEJsb2NrKE0sIG9mZnNldCk7CgkgICAgICAgIH0sCgoJICAgICAgICBkZWNyeXB0QmxvY2s6IGZ1bmN0aW9uIChNLCBvZmZzZXQpIHsKCSAgICAgICAgICAgIHRoaXMuX2RlczMuZGVjcnlwdEJsb2NrKE0sIG9mZnNldCk7CgkgICAgICAgICAgICB0aGlzLl9kZXMyLmVuY3J5cHRCbG9jayhNLCBvZmZzZXQpOwoJICAgICAgICAgICAgdGhpcy5fZGVzMS5kZWNyeXB0QmxvY2soTSwgb2Zmc2V0KTsKCSAgICAgICAgfSwKCgkgICAgICAgIGtleVNpemU6IDE5Mi8zMiwKCgkgICAgICAgIGl2U2l6ZTogNjQvMzIsCgoJICAgICAgICBibG9ja1NpemU6IDY0LzMyCgkgICAgfSk7CgoJICAgIC8qKgoJICAgICAqIFNob3J0Y3V0IGZ1bmN0aW9ucyB0byB0aGUgY2lwaGVyJ3Mgb2JqZWN0IGludGVyZmFjZS4KCSAgICAgKgoJICAgICAqIEBleGFtcGxlCgkgICAgICoKCSAgICAgKiAgICAgdmFyIGNpcGhlcnRleHQgPSBDcnlwdG9KUy5UcmlwbGVERVMuZW5jcnlwdChtZXNzYWdlLCBrZXksIGNmZyk7CgkgICAgICogICAgIHZhciBwbGFpbnRleHQgID0gQ3J5cHRvSlMuVHJpcGxlREVTLmRlY3J5cHQoY2lwaGVydGV4dCwga2V5LCBjZmcpOwoJICAgICAqLwoJICAgIEMuVHJpcGxlREVTID0gQmxvY2tDaXBoZXIuX2NyZWF0ZUhlbHBlcihUcmlwbGVERVMpOwoJfSgpKTsKCgoJKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBTaG9ydGN1dHMKCSAgICB2YXIgQyA9IENyeXB0b0pTOwoJICAgIHZhciBDX2xpYiA9IEMubGliOwoJICAgIHZhciBTdHJlYW1DaXBoZXIgPSBDX2xpYi5TdHJlYW1DaXBoZXI7CgkgICAgdmFyIENfYWxnbyA9IEMuYWxnbzsKCgkgICAgLyoqCgkgICAgICogUkM0IHN0cmVhbSBjaXBoZXIgYWxnb3JpdGhtLgoJICAgICAqLwoJICAgIHZhciBSQzQgPSBDX2FsZ28uUkM0ID0gU3RyZWFtQ2lwaGVyLmV4dGVuZCh7CgkgICAgICAgIF9kb1Jlc2V0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgIHZhciBrZXkgPSB0aGlzLl9rZXk7CgkgICAgICAgICAgICB2YXIga2V5V29yZHMgPSBrZXkud29yZHM7CgkgICAgICAgICAgICB2YXIga2V5U2lnQnl0ZXMgPSBrZXkuc2lnQnl0ZXM7CgoJICAgICAgICAgICAgLy8gSW5pdCBzYm94CgkgICAgICAgICAgICB2YXIgUyA9IHRoaXMuX1MgPSBbXTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKCSAgICAgICAgICAgICAgICBTW2ldID0gaTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBLZXkgc2V0dXAKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBqID0gMDsgaSA8IDI1NjsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGtleUJ5dGVJbmRleCA9IGkgJSBrZXlTaWdCeXRlczsKCSAgICAgICAgICAgICAgICB2YXIga2V5Qnl0ZSA9IChrZXlXb3Jkc1trZXlCeXRlSW5kZXggPj4+IDJdID4+PiAoMjQgLSAoa2V5Qnl0ZUluZGV4ICUgNCkgKiA4KSkgJiAweGZmOwoKCSAgICAgICAgICAgICAgICBqID0gKGogKyBTW2ldICsga2V5Qnl0ZSkgJSAyNTY7CgoJICAgICAgICAgICAgICAgIC8vIFN3YXAKCSAgICAgICAgICAgICAgICB2YXIgdCA9IFNbaV07CgkgICAgICAgICAgICAgICAgU1tpXSA9IFNbal07CgkgICAgICAgICAgICAgICAgU1tqXSA9IHQ7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gQ291bnRlcnMKCSAgICAgICAgICAgIHRoaXMuX2kgPSB0aGlzLl9qID0gMDsKCSAgICAgICAgfSwKCgkgICAgICAgIF9kb1Byb2Nlc3NCbG9jazogZnVuY3Rpb24gKE0sIG9mZnNldCkgewoJICAgICAgICAgICAgTVtvZmZzZXRdIF49IGdlbmVyYXRlS2V5c3RyZWFtV29yZC5jYWxsKHRoaXMpOwoJICAgICAgICB9LAoKCSAgICAgICAga2V5U2l6ZTogMjU2LzMyLAoKCSAgICAgICAgaXZTaXplOiAwCgkgICAgfSk7CgoJICAgIGZ1bmN0aW9uIGdlbmVyYXRlS2V5c3RyZWFtV29yZCgpIHsKCSAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgIHZhciBTID0gdGhpcy5fUzsKCSAgICAgICAgdmFyIGkgPSB0aGlzLl9pOwoJICAgICAgICB2YXIgaiA9IHRoaXMuX2o7CgoJICAgICAgICAvLyBHZW5lcmF0ZSBrZXlzdHJlYW0gd29yZAoJICAgICAgICB2YXIga2V5c3RyZWFtV29yZCA9IDA7CgkgICAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgNDsgbisrKSB7CgkgICAgICAgICAgICBpID0gKGkgKyAxKSAlIDI1NjsKCSAgICAgICAgICAgIGogPSAoaiArIFNbaV0pICUgMjU2OwoKCSAgICAgICAgICAgIC8vIFN3YXAKCSAgICAgICAgICAgIHZhciB0ID0gU1tpXTsKCSAgICAgICAgICAgIFNbaV0gPSBTW2pdOwoJICAgICAgICAgICAgU1tqXSA9IHQ7CgoJICAgICAgICAgICAga2V5c3RyZWFtV29yZCB8PSBTWyhTW2ldICsgU1tqXSkgJSAyNTZdIDw8ICgyNCAtIG4gKiA4KTsKCSAgICAgICAgfQoKCSAgICAgICAgLy8gVXBkYXRlIGNvdW50ZXJzCgkgICAgICAgIHRoaXMuX2kgPSBpOwoJICAgICAgICB0aGlzLl9qID0gajsKCgkgICAgICAgIHJldHVybiBrZXlzdHJlYW1Xb3JkOwoJICAgIH0KCgkgICAgLyoqCgkgICAgICogU2hvcnRjdXQgZnVuY3Rpb25zIHRvIHRoZSBjaXBoZXIncyBvYmplY3QgaW50ZXJmYWNlLgoJICAgICAqCgkgICAgICogQGV4YW1wbGUKCSAgICAgKgoJICAgICAqICAgICB2YXIgY2lwaGVydGV4dCA9IENyeXB0b0pTLlJDNC5lbmNyeXB0KG1lc3NhZ2UsIGtleSwgY2ZnKTsKCSAgICAgKiAgICAgdmFyIHBsYWludGV4dCAgPSBDcnlwdG9KUy5SQzQuZGVjcnlwdChjaXBoZXJ0ZXh0LCBrZXksIGNmZyk7CgkgICAgICovCgkgICAgQy5SQzQgPSBTdHJlYW1DaXBoZXIuX2NyZWF0ZUhlbHBlcihSQzQpOwoKCSAgICAvKioKCSAgICAgKiBNb2RpZmllZCBSQzQgc3RyZWFtIGNpcGhlciBhbGdvcml0aG0uCgkgICAgICovCgkgICAgdmFyIFJDNERyb3AgPSBDX2FsZ28uUkM0RHJvcCA9IFJDNC5leHRlbmQoewoJICAgICAgICAvKioKCSAgICAgICAgICogQ29uZmlndXJhdGlvbiBvcHRpb25zLgoJICAgICAgICAgKgoJICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gZHJvcCBUaGUgbnVtYmVyIG9mIGtleXN0cmVhbSB3b3JkcyB0byBkcm9wLiBEZWZhdWx0IDE5MgoJICAgICAgICAgKi8KCSAgICAgICAgY2ZnOiBSQzQuY2ZnLmV4dGVuZCh7CgkgICAgICAgICAgICBkcm9wOiAxOTIKCSAgICAgICAgfSksCgoJICAgICAgICBfZG9SZXNldDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgUkM0Ll9kb1Jlc2V0LmNhbGwodGhpcyk7CgoJICAgICAgICAgICAgLy8gRHJvcAoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuY2ZnLmRyb3A7IGkgPiAwOyBpLS0pIHsKCSAgICAgICAgICAgICAgICBnZW5lcmF0ZUtleXN0cmVhbVdvcmQuY2FsbCh0aGlzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0pOwoKCSAgICAvKioKCSAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbnMgdG8gdGhlIGNpcGhlcidzIG9iamVjdCBpbnRlcmZhY2UuCgkgICAgICoKCSAgICAgKiBAZXhhbXBsZQoJICAgICAqCgkgICAgICogICAgIHZhciBjaXBoZXJ0ZXh0ID0gQ3J5cHRvSlMuUkM0RHJvcC5lbmNyeXB0KG1lc3NhZ2UsIGtleSwgY2ZnKTsKCSAgICAgKiAgICAgdmFyIHBsYWludGV4dCAgPSBDcnlwdG9KUy5SQzREcm9wLmRlY3J5cHQoY2lwaGVydGV4dCwga2V5LCBjZmcpOwoJICAgICAqLwoJICAgIEMuUkM0RHJvcCA9IFN0cmVhbUNpcGhlci5fY3JlYXRlSGVscGVyKFJDNERyb3ApOwoJfSgpKTsKCgoJLyoqIEBwcmVzZXJ2ZQoJICogQ291bnRlciBibG9jayBtb2RlIGNvbXBhdGlibGUgd2l0aCAgRHIgQnJpYW4gR2xhZG1hbiBmaWxlZW5jLmMKCSAqIGRlcml2ZWQgZnJvbSBDcnlwdG9KUy5tb2RlLkNUUgoJICogSmFuIEhydWJ5IGpocnVieS53ZWJAZ21haWwuY29tCgkgKi8KCUNyeXB0b0pTLm1vZGUuQ1RSR2xhZG1hbiA9IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIENUUkdsYWRtYW4gPSBDcnlwdG9KUy5saWIuQmxvY2tDaXBoZXJNb2RlLmV4dGVuZCgpOwoKCQlmdW5jdGlvbiBpbmNXb3JkKHdvcmQpCgkJewoJCQlpZiAoKCh3b3JkID4+IDI0KSAmIDB4ZmYpID09PSAweGZmKSB7IC8vb3ZlcmZsb3cKCQkJdmFyIGIxID0gKHdvcmQgPj4gMTYpJjB4ZmY7CgkJCXZhciBiMiA9ICh3b3JkID4+IDgpJjB4ZmY7CgkJCXZhciBiMyA9IHdvcmQgJiAweGZmOwoKCQkJaWYgKGIxID09PSAweGZmKSAvLyBvdmVyZmxvdyBiMQoJCQl7CgkJCWIxID0gMDsKCQkJaWYgKGIyID09PSAweGZmKQoJCQl7CgkJCQliMiA9IDA7CgkJCQlpZiAoYjMgPT09IDB4ZmYpCgkJCQl7CgkJCQkJYjMgPSAwOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCSsrYjM7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkrK2IyOwoJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCSsrYjE7CgkJCX0KCgkJCXdvcmQgPSAwOwoJCQl3b3JkICs9IChiMSA8PCAxNik7CgkJCXdvcmQgKz0gKGIyIDw8IDgpOwoJCQl3b3JkICs9IGIzOwoJCQl9CgkJCWVsc2UKCQkJewoJCQl3b3JkICs9ICgweDAxIDw8IDI0KTsKCQkJfQoJCQlyZXR1cm4gd29yZDsKCQl9CgoJCWZ1bmN0aW9uIGluY0NvdW50ZXIoY291bnRlcikKCQl7CgkJCWlmICgoY291bnRlclswXSA9IGluY1dvcmQoY291bnRlclswXSkpID09PSAwKQoJCQl7CgkJCQkvLyBlbmNyX2RhdGEgaW4gZmlsZWVuYy5jIGZyb20gIERyIEJyaWFuIEdsYWRtYW4ncyBjb3VudHMgb25seSB3aXRoIERXT1JEIGogPCA4CgkJCQljb3VudGVyWzFdID0gaW5jV29yZChjb3VudGVyWzFdKTsKCQkJfQoJCQlyZXR1cm4gY291bnRlcjsKCQl9CgoJICAgIHZhciBFbmNyeXB0b3IgPSBDVFJHbGFkbWFuLkVuY3J5cHRvciA9IENUUkdsYWRtYW4uZXh0ZW5kKHsKCSAgICAgICAgcHJvY2Vzc0Jsb2NrOiBmdW5jdGlvbiAod29yZHMsIG9mZnNldCkgewoJICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICB2YXIgY2lwaGVyID0gdGhpcy5fY2lwaGVyCgkgICAgICAgICAgICB2YXIgYmxvY2tTaXplID0gY2lwaGVyLmJsb2NrU2l6ZTsKCSAgICAgICAgICAgIHZhciBpdiA9IHRoaXMuX2l2OwoJICAgICAgICAgICAgdmFyIGNvdW50ZXIgPSB0aGlzLl9jb3VudGVyOwoKCSAgICAgICAgICAgIC8vIEdlbmVyYXRlIGtleXN0cmVhbQoJICAgICAgICAgICAgaWYgKGl2KSB7CgkgICAgICAgICAgICAgICAgY291bnRlciA9IHRoaXMuX2NvdW50ZXIgPSBpdi5zbGljZSgwKTsKCgkgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIElWIGZvciBzdWJzZXF1ZW50IGJsb2NrcwoJICAgICAgICAgICAgICAgIHRoaXMuX2l2ID0gdW5kZWZpbmVkOwoJICAgICAgICAgICAgfQoKCQkJCWluY0NvdW50ZXIoY291bnRlcik7CgoJCQkJdmFyIGtleXN0cmVhbSA9IGNvdW50ZXIuc2xpY2UoMCk7CgkgICAgICAgICAgICBjaXBoZXIuZW5jcnlwdEJsb2NrKGtleXN0cmVhbSwgMCk7CgoJICAgICAgICAgICAgLy8gRW5jcnlwdAoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBibG9ja1NpemU7IGkrKykgewoJICAgICAgICAgICAgICAgIHdvcmRzW29mZnNldCArIGldIF49IGtleXN0cmVhbVtpXTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0pOwoKCSAgICBDVFJHbGFkbWFuLkRlY3J5cHRvciA9IEVuY3J5cHRvcjsKCgkgICAgcmV0dXJuIENUUkdsYWRtYW47Cgl9KCkpOwoKCgoKCShmdW5jdGlvbiAoKSB7CgkgICAgLy8gU2hvcnRjdXRzCgkgICAgdmFyIEMgPSBDcnlwdG9KUzsKCSAgICB2YXIgQ19saWIgPSBDLmxpYjsKCSAgICB2YXIgU3RyZWFtQ2lwaGVyID0gQ19saWIuU3RyZWFtQ2lwaGVyOwoJICAgIHZhciBDX2FsZ28gPSBDLmFsZ287CgoJICAgIC8vIFJldXNhYmxlIG9iamVjdHMKCSAgICB2YXIgUyAgPSBbXTsKCSAgICB2YXIgQ18gPSBbXTsKCSAgICB2YXIgRyAgPSBbXTsKCgkgICAgLyoqCgkgICAgICogUmFiYml0IHN0cmVhbSBjaXBoZXIgYWxnb3JpdGhtCgkgICAgICovCgkgICAgdmFyIFJhYmJpdCA9IENfYWxnby5SYWJiaXQgPSBTdHJlYW1DaXBoZXIuZXh0ZW5kKHsKCSAgICAgICAgX2RvUmVzZXQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgdmFyIEsgPSB0aGlzLl9rZXkud29yZHM7CgkgICAgICAgICAgICB2YXIgaXYgPSB0aGlzLmNmZy5pdjsKCgkgICAgICAgICAgICAvLyBTd2FwIGVuZGlhbgoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspIHsKCSAgICAgICAgICAgICAgICBLW2ldID0gKCgoS1tpXSA8PCA4KSAgfCAoS1tpXSA+Pj4gMjQpKSAmIDB4MDBmZjAwZmYpIHwKCSAgICAgICAgICAgICAgICAgICAgICAgKCgoS1tpXSA8PCAyNCkgfCAoS1tpXSA+Pj4gOCkpICAmIDB4ZmYwMGZmMDApOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIEdlbmVyYXRlIGluaXRpYWwgc3RhdGUgdmFsdWVzCgkgICAgICAgICAgICB2YXIgWCA9IHRoaXMuX1ggPSBbCgkgICAgICAgICAgICAgICAgS1swXSwgKEtbM10gPDwgMTYpIHwgKEtbMl0gPj4+IDE2KSwKCSAgICAgICAgICAgICAgICBLWzFdLCAoS1swXSA8PCAxNikgfCAoS1szXSA+Pj4gMTYpLAoJICAgICAgICAgICAgICAgIEtbMl0sIChLWzFdIDw8IDE2KSB8IChLWzBdID4+PiAxNiksCgkgICAgICAgICAgICAgICAgS1szXSwgKEtbMl0gPDwgMTYpIHwgKEtbMV0gPj4+IDE2KQoJICAgICAgICAgICAgXTsKCgkgICAgICAgICAgICAvLyBHZW5lcmF0ZSBpbml0aWFsIGNvdW50ZXIgdmFsdWVzCgkgICAgICAgICAgICB2YXIgQyA9IHRoaXMuX0MgPSBbCgkgICAgICAgICAgICAgICAgKEtbMl0gPDwgMTYpIHwgKEtbMl0gPj4+IDE2KSwgKEtbMF0gJiAweGZmZmYwMDAwKSB8IChLWzFdICYgMHgwMDAwZmZmZiksCgkgICAgICAgICAgICAgICAgKEtbM10gPDwgMTYpIHwgKEtbM10gPj4+IDE2KSwgKEtbMV0gJiAweGZmZmYwMDAwKSB8IChLWzJdICYgMHgwMDAwZmZmZiksCgkgICAgICAgICAgICAgICAgKEtbMF0gPDwgMTYpIHwgKEtbMF0gPj4+IDE2KSwgKEtbMl0gJiAweGZmZmYwMDAwKSB8IChLWzNdICYgMHgwMDAwZmZmZiksCgkgICAgICAgICAgICAgICAgKEtbMV0gPDwgMTYpIHwgKEtbMV0gPj4+IDE2KSwgKEtbM10gJiAweGZmZmYwMDAwKSB8IChLWzBdICYgMHgwMDAwZmZmZikKCSAgICAgICAgICAgIF07CgoJICAgICAgICAgICAgLy8gQ2FycnkgYml0CgkgICAgICAgICAgICB0aGlzLl9iID0gMDsKCgkgICAgICAgICAgICAvLyBJdGVyYXRlIHRoZSBzeXN0ZW0gZm91ciB0aW1lcwoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspIHsKCSAgICAgICAgICAgICAgICBuZXh0U3RhdGUuY2FsbCh0aGlzKTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBNb2RpZnkgdGhlIGNvdW50ZXJzCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDg7IGkrKykgewoJICAgICAgICAgICAgICAgIENbaV0gXj0gWFsoaSArIDQpICYgN107CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gSVYgc2V0dXAKCSAgICAgICAgICAgIGlmIChpdikgewoJICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICAgICAgICAgIHZhciBJViA9IGl2LndvcmRzOwoJICAgICAgICAgICAgICAgIHZhciBJVl8wID0gSVZbMF07CgkgICAgICAgICAgICAgICAgdmFyIElWXzEgPSBJVlsxXTsKCgkgICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgZm91ciBzdWJ2ZWN0b3JzCgkgICAgICAgICAgICAgICAgdmFyIGkwID0gKCgoSVZfMCA8PCA4KSB8IChJVl8wID4+PiAyNCkpICYgMHgwMGZmMDBmZikgfCAoKChJVl8wIDw8IDI0KSB8IChJVl8wID4+PiA4KSkgJiAweGZmMDBmZjAwKTsKCSAgICAgICAgICAgICAgICB2YXIgaTIgPSAoKChJVl8xIDw8IDgpIHwgKElWXzEgPj4+IDI0KSkgJiAweDAwZmYwMGZmKSB8ICgoKElWXzEgPDwgMjQpIHwgKElWXzEgPj4+IDgpKSAmIDB4ZmYwMGZmMDApOwoJICAgICAgICAgICAgICAgIHZhciBpMSA9IChpMCA+Pj4gMTYpIHwgKGkyICYgMHhmZmZmMDAwMCk7CgkgICAgICAgICAgICAgICAgdmFyIGkzID0gKGkyIDw8IDE2KSAgfCAoaTAgJiAweDAwMDBmZmZmKTsKCgkgICAgICAgICAgICAgICAgLy8gTW9kaWZ5IGNvdW50ZXIgdmFsdWVzCgkgICAgICAgICAgICAgICAgQ1swXSBePSBpMDsKCSAgICAgICAgICAgICAgICBDWzFdIF49IGkxOwoJICAgICAgICAgICAgICAgIENbMl0gXj0gaTI7CgkgICAgICAgICAgICAgICAgQ1szXSBePSBpMzsKCSAgICAgICAgICAgICAgICBDWzRdIF49IGkwOwoJICAgICAgICAgICAgICAgIENbNV0gXj0gaTE7CgkgICAgICAgICAgICAgICAgQ1s2XSBePSBpMjsKCSAgICAgICAgICAgICAgICBDWzddIF49IGkzOwoKCSAgICAgICAgICAgICAgICAvLyBJdGVyYXRlIHRoZSBzeXN0ZW0gZm91ciB0aW1lcwoJICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNDsgaSsrKSB7CgkgICAgICAgICAgICAgICAgICAgIG5leHRTdGF0ZS5jYWxsKHRoaXMpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfSwKCgkgICAgICAgIF9kb1Byb2Nlc3NCbG9jazogZnVuY3Rpb24gKE0sIG9mZnNldCkgewoJICAgICAgICAgICAgLy8gU2hvcnRjdXQKCSAgICAgICAgICAgIHZhciBYID0gdGhpcy5fWDsKCgkgICAgICAgICAgICAvLyBJdGVyYXRlIHRoZSBzeXN0ZW0KCSAgICAgICAgICAgIG5leHRTdGF0ZS5jYWxsKHRoaXMpOwoKCSAgICAgICAgICAgIC8vIEdlbmVyYXRlIGZvdXIga2V5c3RyZWFtIHdvcmRzCgkgICAgICAgICAgICBTWzBdID0gWFswXSBeIChYWzVdID4+PiAxNikgXiAoWFszXSA8PCAxNik7CgkgICAgICAgICAgICBTWzFdID0gWFsyXSBeIChYWzddID4+PiAxNikgXiAoWFs1XSA8PCAxNik7CgkgICAgICAgICAgICBTWzJdID0gWFs0XSBeIChYWzFdID4+PiAxNikgXiAoWFs3XSA8PCAxNik7CgkgICAgICAgICAgICBTWzNdID0gWFs2XSBeIChYWzNdID4+PiAxNikgXiAoWFsxXSA8PCAxNik7CgoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspIHsKCSAgICAgICAgICAgICAgICAvLyBTd2FwIGVuZGlhbgoJICAgICAgICAgICAgICAgIFNbaV0gPSAoKChTW2ldIDw8IDgpICB8IChTW2ldID4+PiAyNCkpICYgMHgwMGZmMDBmZikgfAoJICAgICAgICAgICAgICAgICAgICAgICAoKChTW2ldIDw8IDI0KSB8IChTW2ldID4+PiA4KSkgICYgMHhmZjAwZmYwMCk7CgoJICAgICAgICAgICAgICAgIC8vIEVuY3J5cHQKCSAgICAgICAgICAgICAgICBNW29mZnNldCArIGldIF49IFNbaV07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0sCgoJICAgICAgICBibG9ja1NpemU6IDEyOC8zMiwKCgkgICAgICAgIGl2U2l6ZTogNjQvMzIKCSAgICB9KTsKCgkgICAgZnVuY3Rpb24gbmV4dFN0YXRlKCkgewoJICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgdmFyIFggPSB0aGlzLl9YOwoJICAgICAgICB2YXIgQyA9IHRoaXMuX0M7CgoJICAgICAgICAvLyBTYXZlIG9sZCBjb3VudGVyIHZhbHVlcwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDg7IGkrKykgewoJICAgICAgICAgICAgQ19baV0gPSBDW2ldOwoJICAgICAgICB9CgoJICAgICAgICAvLyBDYWxjdWxhdGUgbmV3IGNvdW50ZXIgdmFsdWVzCgkgICAgICAgIENbMF0gPSAoQ1swXSArIDB4NGQzNGQzNGQgKyB0aGlzLl9iKSB8IDA7CgkgICAgICAgIENbMV0gPSAoQ1sxXSArIDB4ZDM0ZDM0ZDMgKyAoKENbMF0gPj4+IDApIDwgKENfWzBdID4+PiAwKSA/IDEgOiAwKSkgfCAwOwoJICAgICAgICBDWzJdID0gKENbMl0gKyAweDM0ZDM0ZDM0ICsgKChDWzFdID4+PiAwKSA8IChDX1sxXSA+Pj4gMCkgPyAxIDogMCkpIHwgMDsKCSAgICAgICAgQ1szXSA9IChDWzNdICsgMHg0ZDM0ZDM0ZCArICgoQ1syXSA+Pj4gMCkgPCAoQ19bMl0gPj4+IDApID8gMSA6IDApKSB8IDA7CgkgICAgICAgIENbNF0gPSAoQ1s0XSArIDB4ZDM0ZDM0ZDMgKyAoKENbM10gPj4+IDApIDwgKENfWzNdID4+PiAwKSA/IDEgOiAwKSkgfCAwOwoJICAgICAgICBDWzVdID0gKENbNV0gKyAweDM0ZDM0ZDM0ICsgKChDWzRdID4+PiAwKSA8IChDX1s0XSA+Pj4gMCkgPyAxIDogMCkpIHwgMDsKCSAgICAgICAgQ1s2XSA9IChDWzZdICsgMHg0ZDM0ZDM0ZCArICgoQ1s1XSA+Pj4gMCkgPCAoQ19bNV0gPj4+IDApID8gMSA6IDApKSB8IDA7CgkgICAgICAgIENbN10gPSAoQ1s3XSArIDB4ZDM0ZDM0ZDMgKyAoKENbNl0gPj4+IDApIDwgKENfWzZdID4+PiAwKSA/IDEgOiAwKSkgfCAwOwoJICAgICAgICB0aGlzLl9iID0gKENbN10gPj4+IDApIDwgKENfWzddID4+PiAwKSA/IDEgOiAwOwoKCSAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBnLXZhbHVlcwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDg7IGkrKykgewoJICAgICAgICAgICAgdmFyIGd4ID0gWFtpXSArIENbaV07CgoJICAgICAgICAgICAgLy8gQ29uc3RydWN0IGhpZ2ggYW5kIGxvdyBhcmd1bWVudCBmb3Igc3F1YXJpbmcKCSAgICAgICAgICAgIHZhciBnYSA9IGd4ICYgMHhmZmZmOwoJICAgICAgICAgICAgdmFyIGdiID0gZ3ggPj4+IDE2OwoKCSAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBoaWdoIGFuZCBsb3cgcmVzdWx0IG9mIHNxdWFyaW5nCgkgICAgICAgICAgICB2YXIgZ2ggPSAoKCgoZ2EgKiBnYSkgPj4+IDE3KSArIGdhICogZ2IpID4+PiAxNSkgKyBnYiAqIGdiOwoJICAgICAgICAgICAgdmFyIGdsID0gKCgoZ3ggJiAweGZmZmYwMDAwKSAqIGd4KSB8IDApICsgKCgoZ3ggJiAweDAwMDBmZmZmKSAqIGd4KSB8IDApOwoKCSAgICAgICAgICAgIC8vIEhpZ2ggWE9SIGxvdwoJICAgICAgICAgICAgR1tpXSA9IGdoIF4gZ2w7CgkgICAgICAgIH0KCgkgICAgICAgIC8vIENhbGN1bGF0ZSBuZXcgc3RhdGUgdmFsdWVzCgkgICAgICAgIFhbMF0gPSAoR1swXSArICgoR1s3XSA8PCAxNikgfCAoR1s3XSA+Pj4gMTYpKSArICgoR1s2XSA8PCAxNikgfCAoR1s2XSA+Pj4gMTYpKSkgfCAwOwoJICAgICAgICBYWzFdID0gKEdbMV0gKyAoKEdbMF0gPDwgOCkgIHwgKEdbMF0gPj4+IDI0KSkgKyBHWzddKSB8IDA7CgkgICAgICAgIFhbMl0gPSAoR1syXSArICgoR1sxXSA8PCAxNikgfCAoR1sxXSA+Pj4gMTYpKSArICgoR1swXSA8PCAxNikgfCAoR1swXSA+Pj4gMTYpKSkgfCAwOwoJICAgICAgICBYWzNdID0gKEdbM10gKyAoKEdbMl0gPDwgOCkgIHwgKEdbMl0gPj4+IDI0KSkgKyBHWzFdKSB8IDA7CgkgICAgICAgIFhbNF0gPSAoR1s0XSArICgoR1szXSA8PCAxNikgfCAoR1szXSA+Pj4gMTYpKSArICgoR1syXSA8PCAxNikgfCAoR1syXSA+Pj4gMTYpKSkgfCAwOwoJICAgICAgICBYWzVdID0gKEdbNV0gKyAoKEdbNF0gPDwgOCkgIHwgKEdbNF0gPj4+IDI0KSkgKyBHWzNdKSB8IDA7CgkgICAgICAgIFhbNl0gPSAoR1s2XSArICgoR1s1XSA8PCAxNikgfCAoR1s1XSA+Pj4gMTYpKSArICgoR1s0XSA8PCAxNikgfCAoR1s0XSA+Pj4gMTYpKSkgfCAwOwoJICAgICAgICBYWzddID0gKEdbN10gKyAoKEdbNl0gPDwgOCkgIHwgKEdbNl0gPj4+IDI0KSkgKyBHWzVdKSB8IDA7CgkgICAgfQoKCSAgICAvKioKCSAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbnMgdG8gdGhlIGNpcGhlcidzIG9iamVjdCBpbnRlcmZhY2UuCgkgICAgICoKCSAgICAgKiBAZXhhbXBsZQoJICAgICAqCgkgICAgICogICAgIHZhciBjaXBoZXJ0ZXh0ID0gQ3J5cHRvSlMuUmFiYml0LmVuY3J5cHQobWVzc2FnZSwga2V5LCBjZmcpOwoJICAgICAqICAgICB2YXIgcGxhaW50ZXh0ICA9IENyeXB0b0pTLlJhYmJpdC5kZWNyeXB0KGNpcGhlcnRleHQsIGtleSwgY2ZnKTsKCSAgICAgKi8KCSAgICBDLlJhYmJpdCA9IFN0cmVhbUNpcGhlci5fY3JlYXRlSGVscGVyKFJhYmJpdCk7Cgl9KCkpOwoKCgkvKioKCSAqIENvdW50ZXIgYmxvY2sgbW9kZS4KCSAqLwoJQ3J5cHRvSlMubW9kZS5DVFIgPSAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBDVFIgPSBDcnlwdG9KUy5saWIuQmxvY2tDaXBoZXJNb2RlLmV4dGVuZCgpOwoKCSAgICB2YXIgRW5jcnlwdG9yID0gQ1RSLkVuY3J5cHRvciA9IENUUi5leHRlbmQoewoJICAgICAgICBwcm9jZXNzQmxvY2s6IGZ1bmN0aW9uICh3b3Jkcywgb2Zmc2V0KSB7CgkgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgIHZhciBjaXBoZXIgPSB0aGlzLl9jaXBoZXIKCSAgICAgICAgICAgIHZhciBibG9ja1NpemUgPSBjaXBoZXIuYmxvY2tTaXplOwoJICAgICAgICAgICAgdmFyIGl2ID0gdGhpcy5faXY7CgkgICAgICAgICAgICB2YXIgY291bnRlciA9IHRoaXMuX2NvdW50ZXI7CgoJICAgICAgICAgICAgLy8gR2VuZXJhdGUga2V5c3RyZWFtCgkgICAgICAgICAgICBpZiAoaXYpIHsKCSAgICAgICAgICAgICAgICBjb3VudGVyID0gdGhpcy5fY291bnRlciA9IGl2LnNsaWNlKDApOwoKCSAgICAgICAgICAgICAgICAvLyBSZW1vdmUgSVYgZm9yIHN1YnNlcXVlbnQgYmxvY2tzCgkgICAgICAgICAgICAgICAgdGhpcy5faXYgPSB1bmRlZmluZWQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIga2V5c3RyZWFtID0gY291bnRlci5zbGljZSgwKTsKCSAgICAgICAgICAgIGNpcGhlci5lbmNyeXB0QmxvY2soa2V5c3RyZWFtLCAwKTsKCgkgICAgICAgICAgICAvLyBJbmNyZW1lbnQgY291bnRlcgoJICAgICAgICAgICAgY291bnRlcltibG9ja1NpemUgLSAxXSA9IChjb3VudGVyW2Jsb2NrU2l6ZSAtIDFdICsgMSkgfCAwCgoJICAgICAgICAgICAgLy8gRW5jcnlwdAoJICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBibG9ja1NpemU7IGkrKykgewoJICAgICAgICAgICAgICAgIHdvcmRzW29mZnNldCArIGldIF49IGtleXN0cmVhbVtpXTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0pOwoKCSAgICBDVFIuRGVjcnlwdG9yID0gRW5jcnlwdG9yOwoKCSAgICByZXR1cm4gQ1RSOwoJfSgpKTsKCgoJKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBTaG9ydGN1dHMKCSAgICB2YXIgQyA9IENyeXB0b0pTOwoJICAgIHZhciBDX2xpYiA9IEMubGliOwoJICAgIHZhciBTdHJlYW1DaXBoZXIgPSBDX2xpYi5TdHJlYW1DaXBoZXI7CgkgICAgdmFyIENfYWxnbyA9IEMuYWxnbzsKCgkgICAgLy8gUmV1c2FibGUgb2JqZWN0cwoJICAgIHZhciBTICA9IFtdOwoJICAgIHZhciBDXyA9IFtdOwoJICAgIHZhciBHICA9IFtdOwoKCSAgICAvKioKCSAgICAgKiBSYWJiaXQgc3RyZWFtIGNpcGhlciBhbGdvcml0aG0uCgkgICAgICoKCSAgICAgKiBUaGlzIGlzIGEgbGVnYWN5IHZlcnNpb24gdGhhdCBuZWdsZWN0ZWQgdG8gY29udmVydCB0aGUga2V5IHRvIGxpdHRsZS1lbmRpYW4uCgkgICAgICogVGhpcyBlcnJvciBkb2Vzbid0IGFmZmVjdCB0aGUgY2lwaGVyJ3Mgc2VjdXJpdHksCgkgICAgICogYnV0IGl0IGRvZXMgYWZmZWN0IGl0cyBjb21wYXRpYmlsaXR5IHdpdGggb3RoZXIgaW1wbGVtZW50YXRpb25zLgoJICAgICAqLwoJICAgIHZhciBSYWJiaXRMZWdhY3kgPSBDX2FsZ28uUmFiYml0TGVnYWN5ID0gU3RyZWFtQ2lwaGVyLmV4dGVuZCh7CgkgICAgICAgIF9kb1Jlc2V0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICAvLyBTaG9ydGN1dHMKCSAgICAgICAgICAgIHZhciBLID0gdGhpcy5fa2V5LndvcmRzOwoJICAgICAgICAgICAgdmFyIGl2ID0gdGhpcy5jZmcuaXY7CgoJICAgICAgICAgICAgLy8gR2VuZXJhdGUgaW5pdGlhbCBzdGF0ZSB2YWx1ZXMKCSAgICAgICAgICAgIHZhciBYID0gdGhpcy5fWCA9IFsKCSAgICAgICAgICAgICAgICBLWzBdLCAoS1szXSA8PCAxNikgfCAoS1syXSA+Pj4gMTYpLAoJICAgICAgICAgICAgICAgIEtbMV0sIChLWzBdIDw8IDE2KSB8IChLWzNdID4+PiAxNiksCgkgICAgICAgICAgICAgICAgS1syXSwgKEtbMV0gPDwgMTYpIHwgKEtbMF0gPj4+IDE2KSwKCSAgICAgICAgICAgICAgICBLWzNdLCAoS1syXSA8PCAxNikgfCAoS1sxXSA+Pj4gMTYpCgkgICAgICAgICAgICBdOwoKCSAgICAgICAgICAgIC8vIEdlbmVyYXRlIGluaXRpYWwgY291bnRlciB2YWx1ZXMKCSAgICAgICAgICAgIHZhciBDID0gdGhpcy5fQyA9IFsKCSAgICAgICAgICAgICAgICAoS1syXSA8PCAxNikgfCAoS1syXSA+Pj4gMTYpLCAoS1swXSAmIDB4ZmZmZjAwMDApIHwgKEtbMV0gJiAweDAwMDBmZmZmKSwKCSAgICAgICAgICAgICAgICAoS1szXSA8PCAxNikgfCAoS1szXSA+Pj4gMTYpLCAoS1sxXSAmIDB4ZmZmZjAwMDApIHwgKEtbMl0gJiAweDAwMDBmZmZmKSwKCSAgICAgICAgICAgICAgICAoS1swXSA8PCAxNikgfCAoS1swXSA+Pj4gMTYpLCAoS1syXSAmIDB4ZmZmZjAwMDApIHwgKEtbM10gJiAweDAwMDBmZmZmKSwKCSAgICAgICAgICAgICAgICAoS1sxXSA8PCAxNikgfCAoS1sxXSA+Pj4gMTYpLCAoS1szXSAmIDB4ZmZmZjAwMDApIHwgKEtbMF0gJiAweDAwMDBmZmZmKQoJICAgICAgICAgICAgXTsKCgkgICAgICAgICAgICAvLyBDYXJyeSBiaXQKCSAgICAgICAgICAgIHRoaXMuX2IgPSAwOwoKCSAgICAgICAgICAgIC8vIEl0ZXJhdGUgdGhlIHN5c3RlbSBmb3VyIHRpbWVzCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDQ7IGkrKykgewoJICAgICAgICAgICAgICAgIG5leHRTdGF0ZS5jYWxsKHRoaXMpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIE1vZGlmeSB0aGUgY291bnRlcnMKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgODsgaSsrKSB7CgkgICAgICAgICAgICAgICAgQ1tpXSBePSBYWyhpICsgNCkgJiA3XTsKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBJViBzZXR1cAoJICAgICAgICAgICAgaWYgKGl2KSB7CgkgICAgICAgICAgICAgICAgLy8gU2hvcnRjdXRzCgkgICAgICAgICAgICAgICAgdmFyIElWID0gaXYud29yZHM7CgkgICAgICAgICAgICAgICAgdmFyIElWXzAgPSBJVlswXTsKCSAgICAgICAgICAgICAgICB2YXIgSVZfMSA9IElWWzFdOwoKCSAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSBmb3VyIHN1YnZlY3RvcnMKCSAgICAgICAgICAgICAgICB2YXIgaTAgPSAoKChJVl8wIDw8IDgpIHwgKElWXzAgPj4+IDI0KSkgJiAweDAwZmYwMGZmKSB8ICgoKElWXzAgPDwgMjQpIHwgKElWXzAgPj4+IDgpKSAmIDB4ZmYwMGZmMDApOwoJICAgICAgICAgICAgICAgIHZhciBpMiA9ICgoKElWXzEgPDwgOCkgfCAoSVZfMSA+Pj4gMjQpKSAmIDB4MDBmZjAwZmYpIHwgKCgoSVZfMSA8PCAyNCkgfCAoSVZfMSA+Pj4gOCkpICYgMHhmZjAwZmYwMCk7CgkgICAgICAgICAgICAgICAgdmFyIGkxID0gKGkwID4+PiAxNikgfCAoaTIgJiAweGZmZmYwMDAwKTsKCSAgICAgICAgICAgICAgICB2YXIgaTMgPSAoaTIgPDwgMTYpICB8IChpMCAmIDB4MDAwMGZmZmYpOwoKCSAgICAgICAgICAgICAgICAvLyBNb2RpZnkgY291bnRlciB2YWx1ZXMKCSAgICAgICAgICAgICAgICBDWzBdIF49IGkwOwoJICAgICAgICAgICAgICAgIENbMV0gXj0gaTE7CgkgICAgICAgICAgICAgICAgQ1syXSBePSBpMjsKCSAgICAgICAgICAgICAgICBDWzNdIF49IGkzOwoJICAgICAgICAgICAgICAgIENbNF0gXj0gaTA7CgkgICAgICAgICAgICAgICAgQ1s1XSBePSBpMTsKCSAgICAgICAgICAgICAgICBDWzZdIF49IGkyOwoJICAgICAgICAgICAgICAgIENbN10gXj0gaTM7CgoJICAgICAgICAgICAgICAgIC8vIEl0ZXJhdGUgdGhlIHN5c3RlbSBmb3VyIHRpbWVzCgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspIHsKCSAgICAgICAgICAgICAgICAgICAgbmV4dFN0YXRlLmNhbGwodGhpcyk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9LAoKCSAgICAgICAgX2RvUHJvY2Vzc0Jsb2NrOiBmdW5jdGlvbiAoTSwgb2Zmc2V0KSB7CgkgICAgICAgICAgICAvLyBTaG9ydGN1dAoJICAgICAgICAgICAgdmFyIFggPSB0aGlzLl9YOwoKCSAgICAgICAgICAgIC8vIEl0ZXJhdGUgdGhlIHN5c3RlbQoJICAgICAgICAgICAgbmV4dFN0YXRlLmNhbGwodGhpcyk7CgoJICAgICAgICAgICAgLy8gR2VuZXJhdGUgZm91ciBrZXlzdHJlYW0gd29yZHMKCSAgICAgICAgICAgIFNbMF0gPSBYWzBdIF4gKFhbNV0gPj4+IDE2KSBeIChYWzNdIDw8IDE2KTsKCSAgICAgICAgICAgIFNbMV0gPSBYWzJdIF4gKFhbN10gPj4+IDE2KSBeIChYWzVdIDw8IDE2KTsKCSAgICAgICAgICAgIFNbMl0gPSBYWzRdIF4gKFhbMV0gPj4+IDE2KSBeIChYWzddIDw8IDE2KTsKCSAgICAgICAgICAgIFNbM10gPSBYWzZdIF4gKFhbM10gPj4+IDE2KSBeIChYWzFdIDw8IDE2KTsKCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDQ7IGkrKykgewoJICAgICAgICAgICAgICAgIC8vIFN3YXAgZW5kaWFuCgkgICAgICAgICAgICAgICAgU1tpXSA9ICgoKFNbaV0gPDwgOCkgIHwgKFNbaV0gPj4+IDI0KSkgJiAweDAwZmYwMGZmKSB8CgkgICAgICAgICAgICAgICAgICAgICAgICgoKFNbaV0gPDwgMjQpIHwgKFNbaV0gPj4+IDgpKSAgJiAweGZmMDBmZjAwKTsKCgkgICAgICAgICAgICAgICAgLy8gRW5jcnlwdAoJICAgICAgICAgICAgICAgIE1bb2Zmc2V0ICsgaV0gXj0gU1tpXTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSwKCgkgICAgICAgIGJsb2NrU2l6ZTogMTI4LzMyLAoKCSAgICAgICAgaXZTaXplOiA2NC8zMgoJICAgIH0pOwoKCSAgICBmdW5jdGlvbiBuZXh0U3RhdGUoKSB7CgkgICAgICAgIC8vIFNob3J0Y3V0cwoJICAgICAgICB2YXIgWCA9IHRoaXMuX1g7CgkgICAgICAgIHZhciBDID0gdGhpcy5fQzsKCgkgICAgICAgIC8vIFNhdmUgb2xkIGNvdW50ZXIgdmFsdWVzCgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgODsgaSsrKSB7CgkgICAgICAgICAgICBDX1tpXSA9IENbaV07CgkgICAgICAgIH0KCgkgICAgICAgIC8vIENhbGN1bGF0ZSBuZXcgY291bnRlciB2YWx1ZXMKCSAgICAgICAgQ1swXSA9IChDWzBdICsgMHg0ZDM0ZDM0ZCArIHRoaXMuX2IpIHwgMDsKCSAgICAgICAgQ1sxXSA9IChDWzFdICsgMHhkMzRkMzRkMyArICgoQ1swXSA+Pj4gMCkgPCAoQ19bMF0gPj4+IDApID8gMSA6IDApKSB8IDA7CgkgICAgICAgIENbMl0gPSAoQ1syXSArIDB4MzRkMzRkMzQgKyAoKENbMV0gPj4+IDApIDwgKENfWzFdID4+PiAwKSA/IDEgOiAwKSkgfCAwOwoJICAgICAgICBDWzNdID0gKENbM10gKyAweDRkMzRkMzRkICsgKChDWzJdID4+PiAwKSA8IChDX1syXSA+Pj4gMCkgPyAxIDogMCkpIHwgMDsKCSAgICAgICAgQ1s0XSA9IChDWzRdICsgMHhkMzRkMzRkMyArICgoQ1szXSA+Pj4gMCkgPCAoQ19bM10gPj4+IDApID8gMSA6IDApKSB8IDA7CgkgICAgICAgIENbNV0gPSAoQ1s1XSArIDB4MzRkMzRkMzQgKyAoKENbNF0gPj4+IDApIDwgKENfWzRdID4+PiAwKSA/IDEgOiAwKSkgfCAwOwoJICAgICAgICBDWzZdID0gKENbNl0gKyAweDRkMzRkMzRkICsgKChDWzVdID4+PiAwKSA8IChDX1s1XSA+Pj4gMCkgPyAxIDogMCkpIHwgMDsKCSAgICAgICAgQ1s3XSA9IChDWzddICsgMHhkMzRkMzRkMyArICgoQ1s2XSA+Pj4gMCkgPCAoQ19bNl0gPj4+IDApID8gMSA6IDApKSB8IDA7CgkgICAgICAgIHRoaXMuX2IgPSAoQ1s3XSA+Pj4gMCkgPCAoQ19bN10gPj4+IDApID8gMSA6IDA7CgoJICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGctdmFsdWVzCgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgODsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgZ3ggPSBYW2ldICsgQ1tpXTsKCgkgICAgICAgICAgICAvLyBDb25zdHJ1Y3QgaGlnaCBhbmQgbG93IGFyZ3VtZW50IGZvciBzcXVhcmluZwoJICAgICAgICAgICAgdmFyIGdhID0gZ3ggJiAweGZmZmY7CgkgICAgICAgICAgICB2YXIgZ2IgPSBneCA+Pj4gMTY7CgoJICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGhpZ2ggYW5kIGxvdyByZXN1bHQgb2Ygc3F1YXJpbmcKCSAgICAgICAgICAgIHZhciBnaCA9ICgoKChnYSAqIGdhKSA+Pj4gMTcpICsgZ2EgKiBnYikgPj4+IDE1KSArIGdiICogZ2I7CgkgICAgICAgICAgICB2YXIgZ2wgPSAoKChneCAmIDB4ZmZmZjAwMDApICogZ3gpIHwgMCkgKyAoKChneCAmIDB4MDAwMGZmZmYpICogZ3gpIHwgMCk7CgoJICAgICAgICAgICAgLy8gSGlnaCBYT1IgbG93CgkgICAgICAgICAgICBHW2ldID0gZ2ggXiBnbDsKCSAgICAgICAgfQoKCSAgICAgICAgLy8gQ2FsY3VsYXRlIG5ldyBzdGF0ZSB2YWx1ZXMKCSAgICAgICAgWFswXSA9IChHWzBdICsgKChHWzddIDw8IDE2KSB8IChHWzddID4+PiAxNikpICsgKChHWzZdIDw8IDE2KSB8IChHWzZdID4+PiAxNikpKSB8IDA7CgkgICAgICAgIFhbMV0gPSAoR1sxXSArICgoR1swXSA8PCA4KSAgfCAoR1swXSA+Pj4gMjQpKSArIEdbN10pIHwgMDsKCSAgICAgICAgWFsyXSA9IChHWzJdICsgKChHWzFdIDw8IDE2KSB8IChHWzFdID4+PiAxNikpICsgKChHWzBdIDw8IDE2KSB8IChHWzBdID4+PiAxNikpKSB8IDA7CgkgICAgICAgIFhbM10gPSAoR1szXSArICgoR1syXSA8PCA4KSAgfCAoR1syXSA+Pj4gMjQpKSArIEdbMV0pIHwgMDsKCSAgICAgICAgWFs0XSA9IChHWzRdICsgKChHWzNdIDw8IDE2KSB8IChHWzNdID4+PiAxNikpICsgKChHWzJdIDw8IDE2KSB8IChHWzJdID4+PiAxNikpKSB8IDA7CgkgICAgICAgIFhbNV0gPSAoR1s1XSArICgoR1s0XSA8PCA4KSAgfCAoR1s0XSA+Pj4gMjQpKSArIEdbM10pIHwgMDsKCSAgICAgICAgWFs2XSA9IChHWzZdICsgKChHWzVdIDw8IDE2KSB8IChHWzVdID4+PiAxNikpICsgKChHWzRdIDw8IDE2KSB8IChHWzRdID4+PiAxNikpKSB8IDA7CgkgICAgICAgIFhbN10gPSAoR1s3XSArICgoR1s2XSA8PCA4KSAgfCAoR1s2XSA+Pj4gMjQpKSArIEdbNV0pIHwgMDsKCSAgICB9CgoJICAgIC8qKgoJICAgICAqIFNob3J0Y3V0IGZ1bmN0aW9ucyB0byB0aGUgY2lwaGVyJ3Mgb2JqZWN0IGludGVyZmFjZS4KCSAgICAgKgoJICAgICAqIEBleGFtcGxlCgkgICAgICoKCSAgICAgKiAgICAgdmFyIGNpcGhlcnRleHQgPSBDcnlwdG9KUy5SYWJiaXRMZWdhY3kuZW5jcnlwdChtZXNzYWdlLCBrZXksIGNmZyk7CgkgICAgICogICAgIHZhciBwbGFpbnRleHQgID0gQ3J5cHRvSlMuUmFiYml0TGVnYWN5LmRlY3J5cHQoY2lwaGVydGV4dCwga2V5LCBjZmcpOwoJICAgICAqLwoJICAgIEMuUmFiYml0TGVnYWN5ID0gU3RyZWFtQ2lwaGVyLl9jcmVhdGVIZWxwZXIoUmFiYml0TGVnYWN5KTsKCX0oKSk7CgoKCS8qKgoJICogWmVybyBwYWRkaW5nIHN0cmF0ZWd5LgoJICovCglDcnlwdG9KUy5wYWQuWmVyb1BhZGRpbmcgPSB7CgkgICAgcGFkOiBmdW5jdGlvbiAoZGF0YSwgYmxvY2tTaXplKSB7CgkgICAgICAgIC8vIFNob3J0Y3V0CgkgICAgICAgIHZhciBibG9ja1NpemVCeXRlcyA9IGJsb2NrU2l6ZSAqIDQ7CgoJICAgICAgICAvLyBQYWQKCSAgICAgICAgZGF0YS5jbGFtcCgpOwoJICAgICAgICBkYXRhLnNpZ0J5dGVzICs9IGJsb2NrU2l6ZUJ5dGVzIC0gKChkYXRhLnNpZ0J5dGVzICUgYmxvY2tTaXplQnl0ZXMpIHx8IGJsb2NrU2l6ZUJ5dGVzKTsKCSAgICB9LAoKCSAgICB1bnBhZDogZnVuY3Rpb24gKGRhdGEpIHsKCSAgICAgICAgLy8gU2hvcnRjdXQKCSAgICAgICAgdmFyIGRhdGFXb3JkcyA9IGRhdGEud29yZHM7CgoJICAgICAgICAvLyBVbnBhZAoJICAgICAgICB2YXIgaSA9IGRhdGEuc2lnQnl0ZXMgLSAxOwoJICAgICAgICBmb3IgKHZhciBpID0gZGF0YS5zaWdCeXRlcyAtIDE7IGkgPj0gMDsgaS0tKSB7CgkgICAgICAgICAgICBpZiAoKChkYXRhV29yZHNbaSA+Pj4gMl0gPj4+ICgyNCAtIChpICUgNCkgKiA4KSkgJiAweGZmKSkgewoJICAgICAgICAgICAgICAgIGRhdGEuc2lnQnl0ZXMgPSBpICsgMTsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0KCX07CgoKCXJldHVybiBDcnlwdG9KUzsKCn0pKTsKPC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KLy9qc2VuY3J5cHRAMy4wLjAtcmMuMS9iaW4vanNlbmNyeXB0LmpzCihmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7Cgl0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBmYWN0b3J5KGV4cG9ydHMpIDoKCXR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShbJ2V4cG9ydHMnXSwgZmFjdG9yeSkgOgoJKGZhY3RvcnkoKGdsb2JhbC5KU0VuY3J5cHQgPSB7fSkpKTsKfSh0aGlzLCAoZnVuY3Rpb24gKGV4cG9ydHMpIHsgJ3VzZSBzdHJpY3QnOwoKdmFyIEJJX1JNID0gIjAxMjM0NTY3ODlhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eiI7CmZ1bmN0aW9uIGludDJjaGFyKG4pIHsKICAgIHJldHVybiBCSV9STS5jaGFyQXQobik7Cn0KLy8jcmVnaW9uIEJJVF9PUEVSQVRJT05TCi8vIChwdWJsaWMpIHRoaXMgJiBhCmZ1bmN0aW9uIG9wX2FuZCh4LCB5KSB7CiAgICByZXR1cm4geCAmIHk7Cn0KLy8gKHB1YmxpYykgdGhpcyB8IGEKZnVuY3Rpb24gb3Bfb3IoeCwgeSkgewogICAgcmV0dXJuIHggfCB5Owp9Ci8vIChwdWJsaWMpIHRoaXMgXiBhCmZ1bmN0aW9uIG9wX3hvcih4LCB5KSB7CiAgICByZXR1cm4geCBeIHk7Cn0KLy8gKHB1YmxpYykgdGhpcyAmIH5hCmZ1bmN0aW9uIG9wX2FuZG5vdCh4LCB5KSB7CiAgICByZXR1cm4geCAmIH55Owp9Ci8vIHJldHVybiBpbmRleCBvZiBsb3dlc3QgMS1iaXQgaW4geCwgeCA8IDJeMzEKZnVuY3Rpb24gbGJpdCh4KSB7CiAgICBpZiAoeCA9PSAwKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgdmFyIHIgPSAwOwogICAgaWYgKCh4ICYgMHhmZmZmKSA9PSAwKSB7CiAgICAgICAgeCA+Pj0gMTY7CiAgICAgICAgciArPSAxNjsKICAgIH0KICAgIGlmICgoeCAmIDB4ZmYpID09IDApIHsKICAgICAgICB4ID4+PSA4OwogICAgICAgIHIgKz0gODsKICAgIH0KICAgIGlmICgoeCAmIDB4ZikgPT0gMCkgewogICAgICAgIHggPj49IDQ7CiAgICAgICAgciArPSA0OwogICAgfQogICAgaWYgKCh4ICYgMykgPT0gMCkgewogICAgICAgIHggPj49IDI7CiAgICAgICAgciArPSAyOwogICAgfQogICAgaWYgKCh4ICYgMSkgPT0gMCkgewogICAgICAgICsrcjsKICAgIH0KICAgIHJldHVybiByOwp9Ci8vIHJldHVybiBudW1iZXIgb2YgMSBiaXRzIGluIHgKZnVuY3Rpb24gY2JpdCh4KSB7CiAgICB2YXIgciA9IDA7CiAgICB3aGlsZSAoeCAhPSAwKSB7CiAgICAgICAgeCAmPSB4IC0gMTsKICAgICAgICArK3I7CiAgICB9CiAgICByZXR1cm4gcjsKfQovLyNlbmRyZWdpb24gQklUX09QRVJBVElPTlMKCnZhciBiNjRtYXAgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyI7CnZhciBiNjRwYWQgPSAiPSI7CmZ1bmN0aW9uIGhleDJiNjQoaCkgewogICAgdmFyIGk7CiAgICB2YXIgYzsKICAgIHZhciByZXQgPSAiIjsKICAgIGZvciAoaSA9IDA7IGkgKyAzIDw9IGgubGVuZ3RoOyBpICs9IDMpIHsKICAgICAgICBjID0gcGFyc2VJbnQoaC5zdWJzdHJpbmcoaSwgaSArIDMpLCAxNik7CiAgICAgICAgcmV0ICs9IGI2NG1hcC5jaGFyQXQoYyA+PiA2KSArIGI2NG1hcC5jaGFyQXQoYyAmIDYzKTsKICAgIH0KICAgIGlmIChpICsgMSA9PSBoLmxlbmd0aCkgewogICAgICAgIGMgPSBwYXJzZUludChoLnN1YnN0cmluZyhpLCBpICsgMSksIDE2KTsKICAgICAgICByZXQgKz0gYjY0bWFwLmNoYXJBdChjIDw8IDIpOwogICAgfQogICAgZWxzZSBpZiAoaSArIDIgPT0gaC5sZW5ndGgpIHsKICAgICAgICBjID0gcGFyc2VJbnQoaC5zdWJzdHJpbmcoaSwgaSArIDIpLCAxNik7CiAgICAgICAgcmV0ICs9IGI2NG1hcC5jaGFyQXQoYyA+PiAyKSArIGI2NG1hcC5jaGFyQXQoKGMgJiAzKSA8PCA0KTsKICAgIH0KICAgIHdoaWxlICgocmV0Lmxlbmd0aCAmIDMpID4gMCkgewogICAgICAgIHJldCArPSBiNjRwYWQ7CiAgICB9CiAgICByZXR1cm4gcmV0Owp9Ci8vIGNvbnZlcnQgYSBiYXNlNjQgc3RyaW5nIHRvIGhleApmdW5jdGlvbiBiNjR0b2hleChzKSB7CiAgICB2YXIgcmV0ID0gIiI7CiAgICB2YXIgaTsKICAgIHZhciBrID0gMDsgLy8gYjY0IHN0YXRlLCAwLTMKICAgIHZhciBzbG9wID0gMDsKICAgIGZvciAoaSA9IDA7IGkgPCBzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgaWYgKHMuY2hhckF0KGkpID09IGI2NHBhZCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgdmFyIHYgPSBiNjRtYXAuaW5kZXhPZihzLmNoYXJBdChpKSk7CiAgICAgICAgaWYgKHYgPCAwKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoayA9PSAwKSB7CiAgICAgICAgICAgIHJldCArPSBpbnQyY2hhcih2ID4+IDIpOwogICAgICAgICAgICBzbG9wID0gdiAmIDM7CiAgICAgICAgICAgIGsgPSAxOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChrID09IDEpIHsKICAgICAgICAgICAgcmV0ICs9IGludDJjaGFyKChzbG9wIDw8IDIpIHwgKHYgPj4gNCkpOwogICAgICAgICAgICBzbG9wID0gdiAmIDB4ZjsKICAgICAgICAgICAgayA9IDI7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGsgPT0gMikgewogICAgICAgICAgICByZXQgKz0gaW50MmNoYXIoc2xvcCk7CiAgICAgICAgICAgIHJldCArPSBpbnQyY2hhcih2ID4+IDIpOwogICAgICAgICAgICBzbG9wID0gdiAmIDM7CiAgICAgICAgICAgIGsgPSAzOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0ICs9IGludDJjaGFyKChzbG9wIDw8IDIpIHwgKHYgPj4gNCkpOwogICAgICAgICAgICByZXQgKz0gaW50MmNoYXIodiAmIDB4Zik7CiAgICAgICAgICAgIGsgPSAwOwogICAgICAgIH0KICAgIH0KICAgIGlmIChrID09IDEpIHsKICAgICAgICByZXQgKz0gaW50MmNoYXIoc2xvcCA8PCAyKTsKICAgIH0KICAgIHJldHVybiByZXQ7Cn0KCi8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgpDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZQp0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZQpMaWNlbnNlIGF0IGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoKVEhJUyBDT0RFIElTIFBST1ZJREVEIE9OIEFOICpBUyBJUyogQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQpLSU5ELCBFSVRIRVIgRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgV0lUSE9VVCBMSU1JVEFUSU9OIEFOWSBJTVBMSUVECldBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBUSVRMRSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UsCk1FUkNIQU5UQUJMSVRZIE9SIE5PTi1JTkZSSU5HRU1FTlQuCgpTZWUgdGhlIEFwYWNoZSBWZXJzaW9uIDIuMCBMaWNlbnNlIGZvciBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMKYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLwovKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSAqLwoKdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7CiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwogICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7Cn07CgpmdW5jdGlvbiBfX2V4dGVuZHMoZCwgYikgewogICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwp9CgovLyBIZXggSmF2YVNjcmlwdCBkZWNvZGVyCi8vIENvcHlyaWdodCAoYykgMjAwOC0yMDEzIExhcG8gTHVjaGluaSA8bGFwb0BsYXBvLml0PgovLyBQZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkKLy8gcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLCBwcm92aWRlZCB0aGF0IHRoZSBhYm92ZQovLyBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIGFwcGVhciBpbiBhbGwgY29waWVzLgovLwovLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMKLy8gV0lUSCBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRgovLyBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUgovLyBBTlkgU1BFQ0lBTCwgRElSRUNULCBJTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTCi8vIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST00gTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTgovLyBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1IgT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRgovLyBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUiBQRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLgovKmpzaGludCBicm93c2VyOiB0cnVlLCBzdHJpY3Q6IHRydWUsIGltbWVkOiB0cnVlLCBsYXRlZGVmOiB0cnVlLCB1bmRlZjogdHJ1ZSwgcmVnZXhkYXNoOiBmYWxzZSAqLwp2YXIgZGVjb2RlcjsKdmFyIEhleCA9IHsKICAgIGRlY29kZTogZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgaTsKICAgICAgICBpZiAoZGVjb2RlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHZhciBoZXggPSAiMDEyMzQ1Njc4OUFCQ0RFRiI7CiAgICAgICAgICAgIHZhciBpZ25vcmUgPSAiIFxmXG5cclx0XHUwMEEwXHUyMDI4XHUyMDI5IjsKICAgICAgICAgICAgZGVjb2RlciA9IHt9OwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMTY7ICsraSkgewogICAgICAgICAgICAgICAgZGVjb2RlcltoZXguY2hhckF0KGkpXSA9IGk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaGV4ID0gaGV4LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIGZvciAoaSA9IDEwOyBpIDwgMTY7ICsraSkgewogICAgICAgICAgICAgICAgZGVjb2RlcltoZXguY2hhckF0KGkpXSA9IGk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGlnbm9yZS5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgZGVjb2RlcltpZ25vcmUuY2hhckF0KGkpXSA9IC0xOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBvdXQgPSBbXTsKICAgICAgICB2YXIgYml0cyA9IDA7CiAgICAgICAgdmFyIGNoYXJfY291bnQgPSAwOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBhLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIHZhciBjID0gYS5jaGFyQXQoaSk7CiAgICAgICAgICAgIGlmIChjID09ICI9IikgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYyA9IGRlY29kZXJbY107CiAgICAgICAgICAgIGlmIChjID09IC0xKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIklsbGVnYWwgY2hhcmFjdGVyIGF0IG9mZnNldCAiICsgaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYml0cyB8PSBjOwogICAgICAgICAgICBpZiAoKytjaGFyX2NvdW50ID49IDIpIHsKICAgICAgICAgICAgICAgIG91dFtvdXQubGVuZ3RoXSA9IGJpdHM7CiAgICAgICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgICAgIGNoYXJfY291bnQgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgYml0cyA8PD0gNDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY2hhcl9jb3VudCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkhleCBlbmNvZGluZyBpbmNvbXBsZXRlOiA0IGJpdHMgbWlzc2luZyIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gb3V0OwogICAgfQp9OwoKLy8gQmFzZTY0IEphdmFTY3JpcHQgZGVjb2RlcgovLyBDb3B5cmlnaHQgKGMpIDIwMDgtMjAxMyBMYXBvIEx1Y2hpbmkgPGxhcG9AbGFwby5pdD4KLy8gUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55Ci8vIHB1cnBvc2Ugd2l0aCBvciB3aXRob3V0IGZlZSBpcyBoZXJlYnkgZ3JhbnRlZCwgcHJvdmlkZWQgdGhhdCB0aGUgYWJvdmUKLy8gY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBhcHBlYXIgaW4gYWxsIGNvcGllcy4KLy8KLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTCi8vIFdJVEggUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YKLy8gTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IKLy8gQU5ZIFNQRUNJQUwsIERJUkVDVCwgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUwovLyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NIExPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4KLy8gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SIE9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YKLy8gT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1IgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4KLypqc2hpbnQgYnJvd3NlcjogdHJ1ZSwgc3RyaWN0OiB0cnVlLCBpbW1lZDogdHJ1ZSwgbGF0ZWRlZjogdHJ1ZSwgdW5kZWY6IHRydWUsIHJlZ2V4ZGFzaDogZmFsc2UgKi8KdmFyIGRlY29kZXIkMTsKdmFyIEJhc2U2NCA9IHsKICAgIGRlY29kZTogZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgaTsKICAgICAgICBpZiAoZGVjb2RlciQxID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdmFyIGI2NCA9ICJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvIjsKICAgICAgICAgICAgdmFyIGlnbm9yZSA9ICI9IFxmXG5cclx0XHUwMEEwXHUyMDI4XHUyMDI5IjsKICAgICAgICAgICAgZGVjb2RlciQxID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDY0OyArK2kpIHsKICAgICAgICAgICAgICAgIGRlY29kZXIkMVtiNjQuY2hhckF0KGkpXSA9IGk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGlnbm9yZS5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgZGVjb2RlciQxW2lnbm9yZS5jaGFyQXQoaSldID0gLTE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIG91dCA9IFtdOwogICAgICAgIHZhciBiaXRzID0gMDsKICAgICAgICB2YXIgY2hhcl9jb3VudCA9IDA7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGEubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgdmFyIGMgPSBhLmNoYXJBdChpKTsKICAgICAgICAgICAgaWYgKGMgPT0gIj0iKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjID0gZGVjb2RlciQxW2NdOwogICAgICAgICAgICBpZiAoYyA9PSAtMSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbGxlZ2FsIGNoYXJhY3RlciBhdCBvZmZzZXQgIiArIGkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJpdHMgfD0gYzsKICAgICAgICAgICAgaWYgKCsrY2hhcl9jb3VudCA+PSA0KSB7CiAgICAgICAgICAgICAgICBvdXRbb3V0Lmxlbmd0aF0gPSAoYml0cyA+PiAxNik7CiAgICAgICAgICAgICAgICBvdXRbb3V0Lmxlbmd0aF0gPSAoYml0cyA+PiA4KSAmIDB4RkY7CiAgICAgICAgICAgICAgICBvdXRbb3V0Lmxlbmd0aF0gPSBiaXRzICYgMHhGRjsKICAgICAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICAgICAgY2hhcl9jb3VudCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBiaXRzIDw8PSA2OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoY2hhcl9jb3VudCkgewogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkJhc2U2NCBlbmNvZGluZyBpbmNvbXBsZXRlOiBhdCBsZWFzdCAyIGJpdHMgbWlzc2luZyIpOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBvdXRbb3V0Lmxlbmd0aF0gPSAoYml0cyA+PiAxMCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgb3V0W291dC5sZW5ndGhdID0gKGJpdHMgPj4gMTYpOwogICAgICAgICAgICAgICAgb3V0W291dC5sZW5ndGhdID0gKGJpdHMgPj4gOCkgJiAweEZGOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJldHVybiBvdXQ7CiAgICB9LAogICAgcmU6IC8tLS0tLUJFR0lOIFteLV0rLS0tLS0oW0EtWmEtejAtOStcLz1cc10rKS0tLS0tRU5EIFteLV0rLS0tLS18YmVnaW4tYmFzZTY0W15cbl0rXG4oW0EtWmEtejAtOStcLz1cc10rKT09PT0vLAogICAgdW5hcm1vcjogZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgbSA9IEJhc2U2NC5yZS5leGVjKGEpOwogICAgICAgIGlmIChtKSB7CiAgICAgICAgICAgIGlmIChtWzFdKSB7CiAgICAgICAgICAgICAgICBhID0gbVsxXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChtWzJdKSB7CiAgICAgICAgICAgICAgICBhID0gbVsyXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiUmVnRXhwIG91dCBvZiBzeW5jIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIEJhc2U2NC5kZWNvZGUoYSk7CiAgICB9Cn07CgovLyBCaWcgaW50ZWdlciBiYXNlLTEwIHByaW50aW5nIGxpYnJhcnkKLy8gQ29weXJpZ2h0IChjKSAyMDE0IExhcG8gTHVjaGluaSA8bGFwb0BsYXBvLml0PgovLyBQZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkKLy8gcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLCBwcm92aWRlZCB0aGF0IHRoZSBhYm92ZQovLyBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIGFwcGVhciBpbiBhbGwgY29waWVzLgovLwovLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMKLy8gV0lUSCBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRgovLyBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUgovLyBBTlkgU1BFQ0lBTCwgRElSRUNULCBJTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTCi8vIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST00gTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTgovLyBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1IgT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRgovLyBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUiBQRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLgovKmpzaGludCBicm93c2VyOiB0cnVlLCBzdHJpY3Q6IHRydWUsIGltbWVkOiB0cnVlLCBsYXRlZGVmOiB0cnVlLCB1bmRlZjogdHJ1ZSwgcmVnZXhkYXNoOiBmYWxzZSAqLwp2YXIgbWF4ID0gMTAwMDAwMDAwMDAwMDA7IC8vIGJpZ2dlc3QgaW50ZWdlciB0aGF0IGNhbiBzdGlsbCBmaXQgMl41MyB3aGVuIG11bHRpcGxpZWQgYnkgMjU2CnZhciBJbnQxMCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIEludDEwKHZhbHVlKSB7CiAgICAgICAgdGhpcy5idWYgPSBbK3ZhbHVlIHx8IDBdOwogICAgfQogICAgSW50MTAucHJvdG90eXBlLm11bEFkZCA9IGZ1bmN0aW9uIChtLCBjKSB7CiAgICAgICAgLy8gYXNzZXJ0KG0gPD0gMjU2KQogICAgICAgIHZhciBiID0gdGhpcy5idWY7CiAgICAgICAgdmFyIGwgPSBiLmxlbmd0aDsKICAgICAgICB2YXIgaTsKICAgICAgICB2YXIgdDsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbDsgKytpKSB7CiAgICAgICAgICAgIHQgPSBiW2ldICogbSArIGM7CiAgICAgICAgICAgIGlmICh0IDwgbWF4KSB7CiAgICAgICAgICAgICAgICBjID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGMgPSAwIHwgKHQgLyBtYXgpOwogICAgICAgICAgICAgICAgdCAtPSBjICogbWF4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJbaV0gPSB0OwogICAgICAgIH0KICAgICAgICBpZiAoYyA+IDApIHsKICAgICAgICAgICAgYltpXSA9IGM7CiAgICAgICAgfQogICAgfTsKICAgIEludDEwLnByb3RvdHlwZS5zdWIgPSBmdW5jdGlvbiAoYykgewogICAgICAgIC8vIGFzc2VydChtIDw9IDI1NikKICAgICAgICB2YXIgYiA9IHRoaXMuYnVmOwogICAgICAgIHZhciBsID0gYi5sZW5ndGg7CiAgICAgICAgdmFyIGk7CiAgICAgICAgdmFyIHQ7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGw7ICsraSkgewogICAgICAgICAgICB0ID0gYltpXSAtIGM7CiAgICAgICAgICAgIGlmICh0IDwgMCkgewogICAgICAgICAgICAgICAgdCArPSBtYXg7CiAgICAgICAgICAgICAgICBjID0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGMgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJbaV0gPSB0OwogICAgICAgIH0KICAgICAgICB3aGlsZSAoYltiLmxlbmd0aCAtIDFdID09PSAwKSB7CiAgICAgICAgICAgIGIucG9wKCk7CiAgICAgICAgfQogICAgfTsKICAgIEludDEwLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIChiYXNlKSB7CiAgICAgICAgaWYgKChiYXNlIHx8IDEwKSAhPSAxMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm9ubHkgYmFzZSAxMCBpcyBzdXBwb3J0ZWQiKTsKICAgICAgICB9CiAgICAgICAgdmFyIGIgPSB0aGlzLmJ1ZjsKICAgICAgICB2YXIgcyA9IGJbYi5sZW5ndGggLSAxXS50b1N0cmluZygpOwogICAgICAgIGZvciAodmFyIGkgPSBiLmxlbmd0aCAtIDI7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgIHMgKz0gKG1heCArIGJbaV0pLnRvU3RyaW5nKCkuc3Vic3RyaW5nKDEpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gczsKICAgIH07CiAgICBJbnQxMC5wcm90b3R5cGUudmFsdWVPZiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYiA9IHRoaXMuYnVmOwogICAgICAgIHZhciB2ID0gMDsKICAgICAgICBmb3IgKHZhciBpID0gYi5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgICB2ID0gdiAqIG1heCArIGJbaV07CiAgICAgICAgfQogICAgICAgIHJldHVybiB2OwogICAgfTsKICAgIEludDEwLnByb3RvdHlwZS5zaW1wbGlmeSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYiA9IHRoaXMuYnVmOwogICAgICAgIHJldHVybiAoYi5sZW5ndGggPT0gMSkgPyBiWzBdIDogdGhpczsKICAgIH07CiAgICByZXR1cm4gSW50MTA7Cn0oKSk7CgovLyBBU04uMSBKYXZhU2NyaXB0IGRlY29kZXIKdmFyIGVsbGlwc2lzID0gIlx1MjAyNiI7CnZhciByZVRpbWVTID0gL14oXGRcZCkoMFsxLTldfDFbMC0yXSkoMFsxLTldfFsxMl1cZHwzWzAxXSkoWzAxXVxkfDJbMC0zXSkoPzooWzAtNV1cZCkoPzooWzAtNV1cZCkoPzpbLixdKFxkezEsM30pKT8pPyk/KFp8Wy0rXSg/OlswXVxkfDFbMC0yXSkoWzAtNV1cZCk/KT8kLzsKdmFyIHJlVGltZUwgPSAvXihcZFxkXGRcZCkoMFsxLTldfDFbMC0yXSkoMFsxLTldfFsxMl1cZHwzWzAxXSkoWzAxXVxkfDJbMC0zXSkoPzooWzAtNV1cZCkoPzooWzAtNV1cZCkoPzpbLixdKFxkezEsM30pKT8pPyk/KFp8Wy0rXSg/OlswXVxkfDFbMC0yXSkoWzAtNV1cZCk/KT8kLzsKZnVuY3Rpb24gc3RyaW5nQ3V0KHN0ciwgbGVuKSB7CiAgICBpZiAoc3RyLmxlbmd0aCA+IGxlbikgewogICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoMCwgbGVuKSArIGVsbGlwc2lzOwogICAgfQogICAgcmV0dXJuIHN0cjsKfQp2YXIgU3RyZWFtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gU3RyZWFtKGVuYywgcG9zKSB7CiAgICAgICAgdGhpcy5oZXhEaWdpdHMgPSAiMDEyMzQ1Njc4OUFCQ0RFRiI7CiAgICAgICAgaWYgKGVuYyBpbnN0YW5jZW9mIFN0cmVhbSkgewogICAgICAgICAgICB0aGlzLmVuYyA9IGVuYy5lbmM7CiAgICAgICAgICAgIHRoaXMucG9zID0gZW5jLnBvczsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIGVuYyBzaG91bGQgYmUgYW4gYXJyYXkgb3IgYSBiaW5hcnkgc3RyaW5nCiAgICAgICAgICAgIHRoaXMuZW5jID0gZW5jOwogICAgICAgICAgICB0aGlzLnBvcyA9IHBvczsKICAgICAgICB9CiAgICB9CiAgICBTdHJlYW0ucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChwb3MpIHsKICAgICAgICBpZiAocG9zID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcG9zID0gdGhpcy5wb3MrKzsKICAgICAgICB9CiAgICAgICAgaWYgKHBvcyA+PSB0aGlzLmVuYy5sZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJSZXF1ZXN0aW5nIGJ5dGUgb2Zmc2V0ICIgKyBwb3MgKyAiIG9uIGEgc3RyZWFtIG9mIGxlbmd0aCAiICsgdGhpcy5lbmMubGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICgic3RyaW5nIiA9PT0gdHlwZW9mIHRoaXMuZW5jKSA/IHRoaXMuZW5jLmNoYXJDb2RlQXQocG9zKSA6IHRoaXMuZW5jW3Bvc107CiAgICB9OwogICAgU3RyZWFtLnByb3RvdHlwZS5oZXhCeXRlID0gZnVuY3Rpb24gKGIpIHsKICAgICAgICByZXR1cm4gdGhpcy5oZXhEaWdpdHMuY2hhckF0KChiID4+IDQpICYgMHhGKSArIHRoaXMuaGV4RGlnaXRzLmNoYXJBdChiICYgMHhGKTsKICAgIH07CiAgICBTdHJlYW0ucHJvdG90eXBlLmhleER1bXAgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCwgcmF3KSB7CiAgICAgICAgdmFyIHMgPSAiIjsKICAgICAgICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgPCBlbmQ7ICsraSkgewogICAgICAgICAgICBzICs9IHRoaXMuaGV4Qnl0ZSh0aGlzLmdldChpKSk7CiAgICAgICAgICAgIGlmIChyYXcgIT09IHRydWUpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoaSAmIDB4RikgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMHg3OgogICAgICAgICAgICAgICAgICAgICAgICBzICs9ICIgICI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMHhGOgogICAgICAgICAgICAgICAgICAgICAgICBzICs9ICJcbiI7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHMgKz0gIiAiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzOwogICAgfTsKICAgIFN0cmVhbS5wcm90b3R5cGUuaXNBU0NJSSA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHsKICAgICAgICAgICAgdmFyIGMgPSB0aGlzLmdldChpKTsKICAgICAgICAgICAgaWYgKGMgPCAzMiB8fCBjID4gMTc2KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9OwogICAgU3RyZWFtLnByb3RvdHlwZS5wYXJzZVN0cmluZ0lTTyA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7CiAgICAgICAgdmFyIHMgPSAiIjsKICAgICAgICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgPCBlbmQ7ICsraSkgewogICAgICAgICAgICBzICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodGhpcy5nZXQoaSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gczsKICAgIH07CiAgICBTdHJlYW0ucHJvdG90eXBlLnBhcnNlU3RyaW5nVVRGID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHsKICAgICAgICB2YXIgcyA9ICIiOwogICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDspIHsKICAgICAgICAgICAgdmFyIGMgPSB0aGlzLmdldChpKyspOwogICAgICAgICAgICBpZiAoYyA8IDEyOCkgewogICAgICAgICAgICAgICAgcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKChjID4gMTkxKSAmJiAoYyA8IDIyNCkpIHsKICAgICAgICAgICAgICAgIHMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAweDFGKSA8PCA2KSB8ICh0aGlzLmdldChpKyspICYgMHgzRikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyAmIDB4MEYpIDw8IDEyKSB8ICgodGhpcy5nZXQoaSsrKSAmIDB4M0YpIDw8IDYpIHwgKHRoaXMuZ2V0KGkrKykgJiAweDNGKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHM7CiAgICB9OwogICAgU3RyZWFtLnByb3RvdHlwZS5wYXJzZVN0cmluZ0JNUCA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7CiAgICAgICAgdmFyIHN0ciA9ICIiOwogICAgICAgIHZhciBoaTsKICAgICAgICB2YXIgbG87CiAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOykgewogICAgICAgICAgICBoaSA9IHRoaXMuZ2V0KGkrKyk7CiAgICAgICAgICAgIGxvID0gdGhpcy5nZXQoaSsrKTsKICAgICAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGhpIDw8IDgpIHwgbG8pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyOwogICAgfTsKICAgIFN0cmVhbS5wcm90b3R5cGUucGFyc2VUaW1lID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQsIHNob3J0WWVhcikgewogICAgICAgIHZhciBzID0gdGhpcy5wYXJzZVN0cmluZ0lTTyhzdGFydCwgZW5kKTsKICAgICAgICB2YXIgbSA9IChzaG9ydFllYXIgPyByZVRpbWVTIDogcmVUaW1lTCkuZXhlYyhzKTsKICAgICAgICBpZiAoIW0pIHsKICAgICAgICAgICAgcmV0dXJuICJVbnJlY29nbml6ZWQgdGltZTogIiArIHM7CiAgICAgICAgfQogICAgICAgIGlmIChzaG9ydFllYXIpIHsKICAgICAgICAgICAgLy8gdG8gYXZvaWQgcXVlcnlpbmcgdGhlIHRpbWVyLCB1c2UgdGhlIGZpeGVkIHJhbmdlIFsxOTcwLCAyMDY5XQogICAgICAgICAgICAvLyBpdCB3aWxsIGNvbmZvcm0gd2l0aCBJVFUgWC40MDAgWy0xMCwgKzQwXSBzbGlkaW5nIHdpbmRvdyB1bnRpbCAyMDMwCiAgICAgICAgICAgIG1bMV0gPSArbVsxXTsKICAgICAgICAgICAgbVsxXSArPSAoK21bMV0gPCA3MCkgPyAyMDAwIDogMTkwMDsKICAgICAgICB9CiAgICAgICAgcyA9IG1bMV0gKyAiLSIgKyBtWzJdICsgIi0iICsgbVszXSArICIgIiArIG1bNF07CiAgICAgICAgaWYgKG1bNV0pIHsKICAgICAgICAgICAgcyArPSAiOiIgKyBtWzVdOwogICAgICAgICAgICBpZiAobVs2XSkgewogICAgICAgICAgICAgICAgcyArPSAiOiIgKyBtWzZdOwogICAgICAgICAgICAgICAgaWYgKG1bN10pIHsKICAgICAgICAgICAgICAgICAgICBzICs9ICIuIiArIG1bN107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG1bOF0pIHsKICAgICAgICAgICAgcyArPSAiIFVUQyI7CiAgICAgICAgICAgIGlmIChtWzhdICE9ICJaIikgewogICAgICAgICAgICAgICAgcyArPSBtWzhdOwogICAgICAgICAgICAgICAgaWYgKG1bOV0pIHsKICAgICAgICAgICAgICAgICAgICBzICs9ICI6IiArIG1bOV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHM7CiAgICB9OwogICAgU3RyZWFtLnByb3RvdHlwZS5wYXJzZUludGVnZXIgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkgewogICAgICAgIHZhciB2ID0gdGhpcy5nZXQoc3RhcnQpOwogICAgICAgIHZhciBuZWcgPSAodiA+IDEyNyk7CiAgICAgICAgdmFyIHBhZCA9IG5lZyA/IDI1NSA6IDA7CiAgICAgICAgdmFyIGxlbjsKICAgICAgICB2YXIgcyA9ICIiOwogICAgICAgIC8vIHNraXAgdW51c2VmdWwgYml0cyAobm90IGFsbG93ZWQgaW4gREVSKQogICAgICAgIHdoaWxlICh2ID09IHBhZCAmJiArK3N0YXJ0IDwgZW5kKSB7CiAgICAgICAgICAgIHYgPSB0aGlzLmdldChzdGFydCk7CiAgICAgICAgfQogICAgICAgIGxlbiA9IGVuZCAtIHN0YXJ0OwogICAgICAgIGlmIChsZW4gPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIG5lZyA/IC0xIDogMDsKICAgICAgICB9CiAgICAgICAgLy8gc2hvdyBiaXQgbGVuZ3RoIG9mIGh1Z2UgaW50ZWdlcnMKICAgICAgICBpZiAobGVuID4gNCkgewogICAgICAgICAgICBzID0gdjsKICAgICAgICAgICAgbGVuIDw8PSAzOwogICAgICAgICAgICB3aGlsZSAoKCgrcyBeIHBhZCkgJiAweDgwKSA9PSAwKSB7CiAgICAgICAgICAgICAgICBzID0gK3MgPDwgMTsKICAgICAgICAgICAgICAgIC0tbGVuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHMgPSAiKCIgKyBsZW4gKyAiIGJpdClcbiI7CiAgICAgICAgfQogICAgICAgIC8vIGRlY29kZSB0aGUgaW50ZWdlcgogICAgICAgIGlmIChuZWcpIHsKICAgICAgICAgICAgdiA9IHYgLSAyNTY7CiAgICAgICAgfQogICAgICAgIHZhciBuID0gbmV3IEludDEwKHYpOwogICAgICAgIGZvciAodmFyIGkgPSBzdGFydCArIDE7IGkgPCBlbmQ7ICsraSkgewogICAgICAgICAgICBuLm11bEFkZCgyNTYsIHRoaXMuZ2V0KGkpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHMgKyBuLnRvU3RyaW5nKCk7CiAgICB9OwogICAgU3RyZWFtLnByb3RvdHlwZS5wYXJzZUJpdFN0cmluZyA9IGZ1bmN0aW9uIChzdGFydCwgZW5kLCBtYXhMZW5ndGgpIHsKICAgICAgICB2YXIgdW51c2VkQml0ID0gdGhpcy5nZXQoc3RhcnQpOwogICAgICAgIHZhciBsZW5CaXQgPSAoKGVuZCAtIHN0YXJ0IC0gMSkgPDwgMykgLSB1bnVzZWRCaXQ7CiAgICAgICAgdmFyIGludHJvID0gIigiICsgbGVuQml0ICsgIiBiaXQpXG4iOwogICAgICAgIHZhciBzID0gIiI7CiAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0ICsgMTsgaSA8IGVuZDsgKytpKSB7CiAgICAgICAgICAgIHZhciBiID0gdGhpcy5nZXQoaSk7CiAgICAgICAgICAgIHZhciBza2lwID0gKGkgPT0gZW5kIC0gMSkgPyB1bnVzZWRCaXQgOiAwOwogICAgICAgICAgICBmb3IgKHZhciBqID0gNzsgaiA+PSBza2lwOyAtLWopIHsKICAgICAgICAgICAgICAgIHMgKz0gKGIgPj4gaikgJiAxID8gIjEiIDogIjAiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzLmxlbmd0aCA+IG1heExlbmd0aCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGludHJvICsgc3RyaW5nQ3V0KHMsIG1heExlbmd0aCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGludHJvICsgczsKICAgIH07CiAgICBTdHJlYW0ucHJvdG90eXBlLnBhcnNlT2N0ZXRTdHJpbmcgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCwgbWF4TGVuZ3RoKSB7CiAgICAgICAgaWYgKHRoaXMuaXNBU0NJSShzdGFydCwgZW5kKSkgewogICAgICAgICAgICByZXR1cm4gc3RyaW5nQ3V0KHRoaXMucGFyc2VTdHJpbmdJU08oc3RhcnQsIGVuZCksIG1heExlbmd0aCk7CiAgICAgICAgfQogICAgICAgIHZhciBsZW4gPSBlbmQgLSBzdGFydDsKICAgICAgICB2YXIgcyA9ICIoIiArIGxlbiArICIgYnl0ZSlcbiI7CiAgICAgICAgbWF4TGVuZ3RoIC89IDI7IC8vIHdlIHdvcmsgaW4gYnl0ZXMKICAgICAgICBpZiAobGVuID4gbWF4TGVuZ3RoKSB7CiAgICAgICAgICAgIGVuZCA9IHN0YXJ0ICsgbWF4TGVuZ3RoOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgPCBlbmQ7ICsraSkgewogICAgICAgICAgICBzICs9IHRoaXMuaGV4Qnl0ZSh0aGlzLmdldChpKSk7CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gPiBtYXhMZW5ndGgpIHsKICAgICAgICAgICAgcyArPSBlbGxpcHNpczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHM7CiAgICB9OwogICAgU3RyZWFtLnByb3RvdHlwZS5wYXJzZU9JRCA9IGZ1bmN0aW9uIChzdGFydCwgZW5kLCBtYXhMZW5ndGgpIHsKICAgICAgICB2YXIgcyA9ICIiOwogICAgICAgIHZhciBuID0gbmV3IEludDEwKCk7CiAgICAgICAgdmFyIGJpdHMgPSAwOwogICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7CiAgICAgICAgICAgIHZhciB2ID0gdGhpcy5nZXQoaSk7CiAgICAgICAgICAgIG4ubXVsQWRkKDEyOCwgdiAmIDB4N0YpOwogICAgICAgICAgICBiaXRzICs9IDc7CiAgICAgICAgICAgIGlmICghKHYgJiAweDgwKSkgeyAvLyBmaW5pc2hlZAogICAgICAgICAgICAgICAgaWYgKHMgPT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgbiA9IG4uc2ltcGxpZnkoKTsKICAgICAgICAgICAgICAgICAgICBpZiAobiBpbnN0YW5jZW9mIEludDEwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG4uc3ViKDgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgcyA9ICIyLiIgKyBuLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IG4gPCA4MCA/IG4gPCA0MCA/IDAgOiAxIDogMjsKICAgICAgICAgICAgICAgICAgICAgICAgcyA9IG0gKyAiLiIgKyAobiAtIG0gKiA0MCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcyArPSAiLiIgKyBuLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocy5sZW5ndGggPiBtYXhMZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nQ3V0KHMsIG1heExlbmd0aCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBuID0gbmV3IEludDEwKCk7CiAgICAgICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoYml0cyA+IDApIHsKICAgICAgICAgICAgcyArPSAiLmluY29tcGxldGUiOwogICAgICAgIH0KICAgICAgICByZXR1cm4gczsKICAgIH07CiAgICByZXR1cm4gU3RyZWFtOwp9KCkpOwp2YXIgQVNOMSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIEFTTjEoc3RyZWFtLCBoZWFkZXIsIGxlbmd0aCwgdGFnLCBzdWIpIHsKICAgICAgICBpZiAoISh0YWcgaW5zdGFuY2VvZiBBU04xVGFnKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgdGFnIHZhbHVlLiIpOwogICAgICAgIH0KICAgICAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgICAgICB0aGlzLmhlYWRlciA9IGhlYWRlcjsKICAgICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aDsKICAgICAgICB0aGlzLnRhZyA9IHRhZzsKICAgICAgICB0aGlzLnN1YiA9IHN1YjsKICAgIH0KICAgIEFTTjEucHJvdG90eXBlLnR5cGVOYW1lID0gZnVuY3Rpb24gKCkgewogICAgICAgIHN3aXRjaCAodGhpcy50YWcudGFnQ2xhc3MpIHsKICAgICAgICAgICAgY2FzZSAwOiAvLyB1bml2ZXJzYWwKICAgICAgICAgICAgICAgIHN3aXRjaCAodGhpcy50YWcudGFnTnVtYmVyKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkVPQyI7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAweDAxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkJPT0xFQU4iOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwMjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJJTlRFR0VSIjsKICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MDM6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiQklUX1NUUklORyI7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAweDA0OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIk9DVEVUX1NUUklORyI7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAweDA1OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIk5VTEwiOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwNjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJPQkpFQ1RfSURFTlRJRklFUiI7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAweDA3OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIk9iamVjdERlc2NyaXB0b3IiOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwODoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJFWFRFUk5BTCI7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAweDA5OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlJFQUwiOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMHgwQToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJFTlVNRVJBVEVEIjsKICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MEI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiRU1CRURERURfUERWIjsKICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MEM6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiVVRGOFN0cmluZyI7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAweDEwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlNFUVVFTkNFIjsKICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MTE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiU0VUIjsKICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MTI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiTnVtZXJpY1N0cmluZyI7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAweDEzOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlByaW50YWJsZVN0cmluZyI7IC8vIEFTQ0lJIHN1YnNldAogICAgICAgICAgICAgICAgICAgIGNhc2UgMHgxNDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJUZWxldGV4U3RyaW5nIjsgLy8gYWthIFQ2MVN0cmluZwogICAgICAgICAgICAgICAgICAgIGNhc2UgMHgxNToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJWaWRlb3RleFN0cmluZyI7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAweDE2OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIklBNVN0cmluZyI7IC8vIEFTQ0lJCiAgICAgICAgICAgICAgICAgICAgY2FzZSAweDE3OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlVUQ1RpbWUiOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMHgxODoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJHZW5lcmFsaXplZFRpbWUiOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMHgxOToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJHcmFwaGljU3RyaW5nIjsKICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MUE6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiVmlzaWJsZVN0cmluZyI7IC8vIEFTQ0lJIHN1YnNldAogICAgICAgICAgICAgICAgICAgIGNhc2UgMHgxQjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJHZW5lcmFsU3RyaW5nIjsKICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MUM6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiVW5pdmVyc2FsU3RyaW5nIjsKICAgICAgICAgICAgICAgICAgICBjYXNlIDB4MUU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAiQk1QU3RyaW5nIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAiVW5pdmVyc2FsXyIgKyB0aGlzLnRhZy50YWdOdW1iZXIudG9TdHJpbmcoKTsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgcmV0dXJuICJBcHBsaWNhdGlvbl8iICsgdGhpcy50YWcudGFnTnVtYmVyLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJldHVybiAiWyIgKyB0aGlzLnRhZy50YWdOdW1iZXIudG9TdHJpbmcoKSArICJdIjsgLy8gQ29udGV4dAogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXR1cm4gIlByaXZhdGVfIiArIHRoaXMudGFnLnRhZ051bWJlci50b1N0cmluZygpOwogICAgICAgIH0KICAgIH07CiAgICBBU04xLnByb3RvdHlwZS5jb250ZW50ID0gZnVuY3Rpb24gKG1heExlbmd0aCkgewogICAgICAgIGlmICh0aGlzLnRhZyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAobWF4TGVuZ3RoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgbWF4TGVuZ3RoID0gSW5maW5pdHk7CiAgICAgICAgfQogICAgICAgIHZhciBjb250ZW50ID0gdGhpcy5wb3NDb250ZW50KCk7CiAgICAgICAgdmFyIGxlbiA9IE1hdGguYWJzKHRoaXMubGVuZ3RoKTsKICAgICAgICBpZiAoIXRoaXMudGFnLmlzVW5pdmVyc2FsKCkpIHsKICAgICAgICAgICAgaWYgKHRoaXMuc3ViICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIigiICsgdGhpcy5zdWIubGVuZ3RoICsgIiBlbGVtKSI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RyZWFtLnBhcnNlT2N0ZXRTdHJpbmcoY29udGVudCwgY29udGVudCArIGxlbiwgbWF4TGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgc3dpdGNoICh0aGlzLnRhZy50YWdOdW1iZXIpIHsKICAgICAgICAgICAgY2FzZSAweDAxOiAvLyBCT09MRUFOCiAgICAgICAgICAgICAgICByZXR1cm4gKHRoaXMuc3RyZWFtLmdldChjb250ZW50KSA9PT0gMCkgPyAiZmFsc2UiIDogInRydWUiOwogICAgICAgICAgICBjYXNlIDB4MDI6IC8vIElOVEVHRVIKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0cmVhbS5wYXJzZUludGVnZXIoY29udGVudCwgY29udGVudCArIGxlbik7CiAgICAgICAgICAgIGNhc2UgMHgwMzogLy8gQklUX1NUUklORwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3ViID8gIigiICsgdGhpcy5zdWIubGVuZ3RoICsgIiBlbGVtKSIgOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RyZWFtLnBhcnNlQml0U3RyaW5nKGNvbnRlbnQsIGNvbnRlbnQgKyBsZW4sIG1heExlbmd0aCk7CiAgICAgICAgICAgIGNhc2UgMHgwNDogLy8gT0NURVRfU1RSSU5HCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdWIgPyAiKCIgKyB0aGlzLnN1Yi5sZW5ndGggKyAiIGVsZW0pIiA6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHJlYW0ucGFyc2VPY3RldFN0cmluZyhjb250ZW50LCBjb250ZW50ICsgbGVuLCBtYXhMZW5ndGgpOwogICAgICAgICAgICAvLyBjYXNlIDB4MDU6IC8vIE5VTEwKICAgICAgICAgICAgY2FzZSAweDA2OiAvLyBPQkpFQ1RfSURFTlRJRklFUgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RyZWFtLnBhcnNlT0lEKGNvbnRlbnQsIGNvbnRlbnQgKyBsZW4sIG1heExlbmd0aCk7CiAgICAgICAgICAgIC8vIGNhc2UgMHgwNzogLy8gT2JqZWN0RGVzY3JpcHRvcgogICAgICAgICAgICAvLyBjYXNlIDB4MDg6IC8vIEVYVEVSTkFMCiAgICAgICAgICAgIC8vIGNhc2UgMHgwOTogLy8gUkVBTAogICAgICAgICAgICAvLyBjYXNlIDB4MEE6IC8vIEVOVU1FUkFURUQKICAgICAgICAgICAgLy8gY2FzZSAweDBCOiAvLyBFTUJFRERFRF9QRFYKICAgICAgICAgICAgY2FzZSAweDEwOiAvLyBTRVFVRU5DRQogICAgICAgICAgICBjYXNlIDB4MTE6IC8vIFNFVAogICAgICAgICAgICAgICAgaWYgKHRoaXMuc3ViICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIoIiArIHRoaXMuc3ViLmxlbmd0aCArICIgZWxlbSkiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIobm8gZWxlbSkiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDB4MEM6IC8vIFVURjhTdHJpbmcKICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmdDdXQodGhpcy5zdHJlYW0ucGFyc2VTdHJpbmdVVEYoY29udGVudCwgY29udGVudCArIGxlbiksIG1heExlbmd0aCk7CiAgICAgICAgICAgIGNhc2UgMHgxMjogLy8gTnVtZXJpY1N0cmluZwogICAgICAgICAgICBjYXNlIDB4MTM6IC8vIFByaW50YWJsZVN0cmluZwogICAgICAgICAgICBjYXNlIDB4MTQ6IC8vIFRlbGV0ZXhTdHJpbmcKICAgICAgICAgICAgY2FzZSAweDE1OiAvLyBWaWRlb3RleFN0cmluZwogICAgICAgICAgICBjYXNlIDB4MTY6IC8vIElBNVN0cmluZwogICAgICAgICAgICAvLyBjYXNlIDB4MTk6IC8vIEdyYXBoaWNTdHJpbmcKICAgICAgICAgICAgY2FzZSAweDFBOiAvLyBWaXNpYmxlU3RyaW5nCiAgICAgICAgICAgICAgICAvLyBjYXNlIDB4MUI6IC8vIEdlbmVyYWxTdHJpbmcKICAgICAgICAgICAgICAgIC8vIGNhc2UgMHgxQzogLy8gVW5pdmVyc2FsU3RyaW5nCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nQ3V0KHRoaXMuc3RyZWFtLnBhcnNlU3RyaW5nSVNPKGNvbnRlbnQsIGNvbnRlbnQgKyBsZW4pLCBtYXhMZW5ndGgpOwogICAgICAgICAgICBjYXNlIDB4MUU6IC8vIEJNUFN0cmluZwogICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZ0N1dCh0aGlzLnN0cmVhbS5wYXJzZVN0cmluZ0JNUChjb250ZW50LCBjb250ZW50ICsgbGVuKSwgbWF4TGVuZ3RoKTsKICAgICAgICAgICAgY2FzZSAweDE3OiAvLyBVVENUaW1lCiAgICAgICAgICAgIGNhc2UgMHgxODogLy8gR2VuZXJhbGl6ZWRUaW1lCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdHJlYW0ucGFyc2VUaW1lKGNvbnRlbnQsIGNvbnRlbnQgKyBsZW4sICh0aGlzLnRhZy50YWdOdW1iZXIgPT0gMHgxNykpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH07CiAgICBBU04xLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy50eXBlTmFtZSgpICsgIkAiICsgdGhpcy5zdHJlYW0ucG9zICsgIltoZWFkZXI6IiArIHRoaXMuaGVhZGVyICsgIixsZW5ndGg6IiArIHRoaXMubGVuZ3RoICsgIixzdWI6IiArICgodGhpcy5zdWIgPT09IG51bGwpID8gIm51bGwiIDogdGhpcy5zdWIubGVuZ3RoKSArICJdIjsKICAgIH07CiAgICBBU04xLnByb3RvdHlwZS50b1ByZXR0eVN0cmluZyA9IGZ1bmN0aW9uIChpbmRlbnQpIHsKICAgICAgICBpZiAoaW5kZW50ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaW5kZW50ID0gIiI7CiAgICAgICAgfQogICAgICAgIHZhciBzID0gaW5kZW50ICsgdGhpcy50eXBlTmFtZSgpICsgIiBAIiArIHRoaXMuc3RyZWFtLnBvczsKICAgICAgICBpZiAodGhpcy5sZW5ndGggPj0gMCkgewogICAgICAgICAgICBzICs9ICIrIjsKICAgICAgICB9CiAgICAgICAgcyArPSB0aGlzLmxlbmd0aDsKICAgICAgICBpZiAodGhpcy50YWcudGFnQ29uc3RydWN0ZWQpIHsKICAgICAgICAgICAgcyArPSAiIChjb25zdHJ1Y3RlZCkiOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICgodGhpcy50YWcuaXNVbml2ZXJzYWwoKSAmJiAoKHRoaXMudGFnLnRhZ051bWJlciA9PSAweDAzKSB8fCAodGhpcy50YWcudGFnTnVtYmVyID09IDB4MDQpKSkgJiYgKHRoaXMuc3ViICE9PSBudWxsKSkgewogICAgICAgICAgICBzICs9ICIgKGVuY2Fwc3VsYXRlcykiOwogICAgICAgIH0KICAgICAgICBzICs9ICJcbiI7CiAgICAgICAgaWYgKHRoaXMuc3ViICE9PSBudWxsKSB7CiAgICAgICAgICAgIGluZGVudCArPSAiICAiOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbWF4ID0gdGhpcy5zdWIubGVuZ3RoOyBpIDwgbWF4OyArK2kpIHsKICAgICAgICAgICAgICAgIHMgKz0gdGhpcy5zdWJbaV0udG9QcmV0dHlTdHJpbmcoaW5kZW50KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gczsKICAgIH07CiAgICBBU04xLnByb3RvdHlwZS5wb3NTdGFydCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5zdHJlYW0ucG9zOwogICAgfTsKICAgIEFTTjEucHJvdG90eXBlLnBvc0NvbnRlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3RyZWFtLnBvcyArIHRoaXMuaGVhZGVyOwogICAgfTsKICAgIEFTTjEucHJvdG90eXBlLnBvc0VuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5zdHJlYW0ucG9zICsgdGhpcy5oZWFkZXIgKyBNYXRoLmFicyh0aGlzLmxlbmd0aCk7CiAgICB9OwogICAgQVNOMS5wcm90b3R5cGUudG9IZXhTdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3RyZWFtLmhleER1bXAodGhpcy5wb3NTdGFydCgpLCB0aGlzLnBvc0VuZCgpLCB0cnVlKTsKICAgIH07CiAgICBBU04xLmRlY29kZUxlbmd0aCA9IGZ1bmN0aW9uIChzdHJlYW0pIHsKICAgICAgICB2YXIgYnVmID0gc3RyZWFtLmdldCgpOwogICAgICAgIHZhciBsZW4gPSBidWYgJiAweDdGOwogICAgICAgIGlmIChsZW4gPT0gYnVmKSB7CiAgICAgICAgICAgIHJldHVybiBsZW47CiAgICAgICAgfQogICAgICAgIC8vIG5vIHJlYXNvbiB0byB1c2UgSW50MTAsIGFzIGl0IHdvdWxkIGJlIGEgaHVnZSBidWZmZXIgYW55d2F5cwogICAgICAgIGlmIChsZW4gPiA2KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTGVuZ3RoIG92ZXIgNDggYml0cyBub3Qgc3VwcG9ydGVkIGF0IHBvc2l0aW9uICIgKyAoc3RyZWFtLnBvcyAtIDEpKTsKICAgICAgICB9CiAgICAgICAgaWYgKGxlbiA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9IC8vIHVuZGVmaW5lZAogICAgICAgIGJ1ZiA9IDA7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICBidWYgPSAoYnVmICogMjU2KSArIHN0cmVhbS5nZXQoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1ZjsKICAgIH07CiAgICAvKioKICAgICAqIFJldHJpZXZlIHRoZSBoZXhhZGVjaW1hbCB2YWx1ZSAoYXMgYSBzdHJpbmcpIG9mIHRoZSBjdXJyZW50IEFTTi4xIGVsZW1lbnQKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgKiBAcHVibGljCiAgICAgKi8KICAgIEFTTjEucHJvdG90eXBlLmdldEhleFN0cmluZ1ZhbHVlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBoZXhTdHJpbmcgPSB0aGlzLnRvSGV4U3RyaW5nKCk7CiAgICAgICAgdmFyIG9mZnNldCA9IHRoaXMuaGVhZGVyICogMjsKICAgICAgICB2YXIgbGVuZ3RoID0gdGhpcy5sZW5ndGggKiAyOwogICAgICAgIHJldHVybiBoZXhTdHJpbmcuc3Vic3RyKG9mZnNldCwgbGVuZ3RoKTsKICAgIH07CiAgICBBU04xLmRlY29kZSA9IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgICB2YXIgc3RyZWFtOwogICAgICAgIGlmICghKHN0ciBpbnN0YW5jZW9mIFN0cmVhbSkpIHsKICAgICAgICAgICAgc3RyZWFtID0gbmV3IFN0cmVhbShzdHIsIDApOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgc3RyZWFtID0gc3RyOwogICAgICAgIH0KICAgICAgICB2YXIgc3RyZWFtU3RhcnQgPSBuZXcgU3RyZWFtKHN0cmVhbSk7CiAgICAgICAgdmFyIHRhZyA9IG5ldyBBU04xVGFnKHN0cmVhbSk7CiAgICAgICAgdmFyIGxlbiA9IEFTTjEuZGVjb2RlTGVuZ3RoKHN0cmVhbSk7CiAgICAgICAgdmFyIHN0YXJ0ID0gc3RyZWFtLnBvczsKICAgICAgICB2YXIgaGVhZGVyID0gc3RhcnQgLSBzdHJlYW1TdGFydC5wb3M7CiAgICAgICAgdmFyIHN1YiA9IG51bGw7CiAgICAgICAgdmFyIGdldFN1YiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHJldCA9IFtdOwogICAgICAgICAgICBpZiAobGVuICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBkZWZpbml0ZSBsZW5ndGgKICAgICAgICAgICAgICAgIHZhciBlbmQgPSBzdGFydCArIGxlbjsKICAgICAgICAgICAgICAgIHdoaWxlIChzdHJlYW0ucG9zIDwgZW5kKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0W3JldC5sZW5ndGhdID0gQVNOMS5kZWNvZGUoc3RyZWFtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzdHJlYW0ucG9zICE9IGVuZCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ29udGVudCBzaXplIGlzIG5vdCBjb3JyZWN0IGZvciBjb250YWluZXIgc3RhcnRpbmcgYXQgb2Zmc2V0ICIgKyBzdGFydCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyB1bmRlZmluZWQgbGVuZ3RoCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGZvciAoOzspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSBBU04xLmRlY29kZShzdHJlYW0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocy50YWcuaXNFT0MoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0W3JldC5sZW5ndGhdID0gczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbGVuID0gc3RhcnQgLSBzdHJlYW0ucG9zOyAvLyB1bmRlZmluZWQgbGVuZ3RocyBhcmUgcmVwcmVzZW50ZWQgYXMgbmVnYXRpdmUgdmFsdWVzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRXhjZXB0aW9uIHdoaWxlIGRlY29kaW5nIHVuZGVmaW5lZCBsZW5ndGggY29udGVudDogIiArIGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfTsKICAgICAgICBpZiAodGFnLnRhZ0NvbnN0cnVjdGVkKSB7CiAgICAgICAgICAgIC8vIG11c3QgaGF2ZSB2YWxpZCBjb250ZW50CiAgICAgICAgICAgIHN1YiA9IGdldFN1YigpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICh0YWcuaXNVbml2ZXJzYWwoKSAmJiAoKHRhZy50YWdOdW1iZXIgPT0gMHgwMykgfHwgKHRhZy50YWdOdW1iZXIgPT0gMHgwNCkpKSB7CiAgICAgICAgICAgIC8vIHNvbWV0aW1lcyBCaXRTdHJpbmcgYW5kIE9jdGV0U3RyaW5nIGFyZSB1c2VkIHRvIGVuY2Fwc3VsYXRlIEFTTi4xCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAodGFnLnRhZ051bWJlciA9PSAweDAzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmVhbS5nZXQoKSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQklUIFNUUklOR3Mgd2l0aCB1bnVzZWQgYml0cyBjYW5ub3QgZW5jYXBzdWxhdGUuIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3ViID0gZ2V0U3ViKCk7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN1Yi5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgICAgICAgIGlmIChzdWJbaV0udGFnLmlzRU9DKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFT0MgaXMgbm90IHN1cHBvc2VkIHRvIGJlIGFjdHVhbCBjb250ZW50LiIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgLy8gYnV0IHNpbGVudGx5IGlnbm9yZSB3aGVuIHRoZXkgZG9uJ3QKICAgICAgICAgICAgICAgIHN1YiA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHN1YiA9PT0gbnVsbCkgewogICAgICAgICAgICBpZiAobGVuID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIldlIGNhbid0IHNraXAgb3ZlciBhbiBpbnZhbGlkIHRhZyB3aXRoIHVuZGVmaW5lZCBsZW5ndGggYXQgb2Zmc2V0ICIgKyBzdGFydCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RyZWFtLnBvcyA9IHN0YXJ0ICsgTWF0aC5hYnMobGVuKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBBU04xKHN0cmVhbVN0YXJ0LCBoZWFkZXIsIGxlbiwgdGFnLCBzdWIpOwogICAgfTsKICAgIHJldHVybiBBU04xOwp9KCkpOwp2YXIgQVNOMVRhZyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIEFTTjFUYWcoc3RyZWFtKSB7CiAgICAgICAgdmFyIGJ1ZiA9IHN0cmVhbS5nZXQoKTsKICAgICAgICB0aGlzLnRhZ0NsYXNzID0gYnVmID4+IDY7CiAgICAgICAgdGhpcy50YWdDb25zdHJ1Y3RlZCA9ICgoYnVmICYgMHgyMCkgIT09IDApOwogICAgICAgIHRoaXMudGFnTnVtYmVyID0gYnVmICYgMHgxRjsKICAgICAgICBpZiAodGhpcy50YWdOdW1iZXIgPT0gMHgxRikgeyAvLyBsb25nIHRhZwogICAgICAgICAgICB2YXIgbiA9IG5ldyBJbnQxMCgpOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICBidWYgPSBzdHJlYW0uZ2V0KCk7CiAgICAgICAgICAgICAgICBuLm11bEFkZCgxMjgsIGJ1ZiAmIDB4N0YpOwogICAgICAgICAgICB9IHdoaWxlIChidWYgJiAweDgwKTsKICAgICAgICAgICAgdGhpcy50YWdOdW1iZXIgPSBuLnNpbXBsaWZ5KCk7CiAgICAgICAgfQogICAgfQogICAgQVNOMVRhZy5wcm90b3R5cGUuaXNVbml2ZXJzYWwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudGFnQ2xhc3MgPT09IDB4MDA7CiAgICB9OwogICAgQVNOMVRhZy5wcm90b3R5cGUuaXNFT0MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudGFnQ2xhc3MgPT09IDB4MDAgJiYgdGhpcy50YWdOdW1iZXIgPT09IDB4MDA7CiAgICB9OwogICAgcmV0dXJuIEFTTjFUYWc7Cn0oKSk7CgovLyBDb3B5cmlnaHQgKGMpIDIwMDUgIFRvbSBXdQovLyBCaXRzIHBlciBkaWdpdAp2YXIgZGJpdHM7Ci8vIEphdmFTY3JpcHQgZW5naW5lIGFuYWx5c2lzCnZhciBjYW5hcnkgPSAweGRlYWRiZWVmY2FmZTsKdmFyIGpfbG0gPSAoKGNhbmFyeSAmIDB4ZmZmZmZmKSA9PSAweGVmY2FmZSk7Ci8vI3JlZ2lvbgp2YXIgbG93cHJpbWVzID0gWzIsIDMsIDUsIDcsIDExLCAxMywgMTcsIDE5LCAyMywgMjksIDMxLCAzNywgNDEsIDQzLCA0NywgNTMsIDU5LCA2MSwgNjcsIDcxLCA3MywgNzksIDgzLCA4OSwgOTcsIDEwMSwgMTAzLCAxMDcsIDEwOSwgMTEzLCAxMjcsIDEzMSwgMTM3LCAxMzksIDE0OSwgMTUxLCAxNTcsIDE2MywgMTY3LCAxNzMsIDE3OSwgMTgxLCAxOTEsIDE5MywgMTk3LCAxOTksIDIxMSwgMjIzLCAyMjcsIDIyOSwgMjMzLCAyMzksIDI0MSwgMjUxLCAyNTcsIDI2MywgMjY5LCAyNzEsIDI3NywgMjgxLCAyODMsIDI5MywgMzA3LCAzMTEsIDMxMywgMzE3LCAzMzEsIDMzNywgMzQ3LCAzNDksIDM1MywgMzU5LCAzNjcsIDM3MywgMzc5LCAzODMsIDM4OSwgMzk3LCA0MDEsIDQwOSwgNDE5LCA0MjEsIDQzMSwgNDMzLCA0MzksIDQ0MywgNDQ5LCA0NTcsIDQ2MSwgNDYzLCA0NjcsIDQ3OSwgNDg3LCA0OTEsIDQ5OSwgNTAzLCA1MDksIDUyMSwgNTIzLCA1NDEsIDU0NywgNTU3LCA1NjMsIDU2OSwgNTcxLCA1NzcsIDU4NywgNTkzLCA1OTksIDYwMSwgNjA3LCA2MTMsIDYxNywgNjE5LCA2MzEsIDY0MSwgNjQzLCA2NDcsIDY1MywgNjU5LCA2NjEsIDY3MywgNjc3LCA2ODMsIDY5MSwgNzAxLCA3MDksIDcxOSwgNzI3LCA3MzMsIDczOSwgNzQzLCA3NTEsIDc1NywgNzYxLCA3NjksIDc3MywgNzg3LCA3OTcsIDgwOSwgODExLCA4MjEsIDgyMywgODI3LCA4MjksIDgzOSwgODUzLCA4NTcsIDg1OSwgODYzLCA4NzcsIDg4MSwgODgzLCA4ODcsIDkwNywgOTExLCA5MTksIDkyOSwgOTM3LCA5NDEsIDk0NywgOTUzLCA5NjcsIDk3MSwgOTc3LCA5ODMsIDk5MSwgOTk3XTsKdmFyIGxwbGltID0gKDEgPDwgMjYpIC8gbG93cHJpbWVzW2xvd3ByaW1lcy5sZW5ndGggLSAxXTsKLy8jZW5kcmVnaW9uCi8vIChwdWJsaWMpIENvbnN0cnVjdG9yCnZhciBCaWdJbnRlZ2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gQmlnSW50ZWdlcihhLCBiLCBjKSB7CiAgICAgICAgaWYgKGEgIT0gbnVsbCkgewogICAgICAgICAgICBpZiAoIm51bWJlciIgPT0gdHlwZW9mIGEpIHsKICAgICAgICAgICAgICAgIHRoaXMuZnJvbU51bWJlcihhLCBiLCBjKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChiID09IG51bGwgJiYgInN0cmluZyIgIT0gdHlwZW9mIGEpIHsKICAgICAgICAgICAgICAgIHRoaXMuZnJvbVN0cmluZyhhLCAyNTYpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5mcm9tU3RyaW5nKGEsIGIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgLy8jcmVnaW9uIFBVQkxJQwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUudG9TdHJpbmcgPSBiblRvU3RyaW5nOwogICAgLy8gKHB1YmxpYykgcmV0dXJuIHN0cmluZyByZXByZXNlbnRhdGlvbiBpbiBnaXZlbiByYWRpeAogICAgQmlnSW50ZWdlci5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoYikgewogICAgICAgIGlmICh0aGlzLnMgPCAwKSB7CiAgICAgICAgICAgIHJldHVybiAiLSIgKyB0aGlzLm5lZ2F0ZSgpLnRvU3RyaW5nKGIpOwogICAgICAgIH0KICAgICAgICB2YXIgazsKICAgICAgICBpZiAoYiA9PSAxNikgewogICAgICAgICAgICBrID0gNDsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoYiA9PSA4KSB7CiAgICAgICAgICAgIGsgPSAzOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChiID09IDIpIHsKICAgICAgICAgICAgayA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGIgPT0gMzIpIHsKICAgICAgICAgICAgayA9IDU7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGIgPT0gNCkgewogICAgICAgICAgICBrID0gMjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRvUmFkaXgoYik7CiAgICAgICAgfQogICAgICAgIHZhciBrbSA9ICgxIDw8IGspIC0gMTsKICAgICAgICB2YXIgZDsKICAgICAgICB2YXIgbSA9IGZhbHNlOwogICAgICAgIHZhciByID0gIiI7CiAgICAgICAgdmFyIGkgPSB0aGlzLnQ7CiAgICAgICAgdmFyIHAgPSB0aGlzLkRCIC0gKGkgKiB0aGlzLkRCKSAlIGs7CiAgICAgICAgaWYgKGktLSA+IDApIHsKICAgICAgICAgICAgaWYgKHAgPCB0aGlzLkRCICYmIChkID0gdGhpc1tpXSA+PiBwKSA+IDApIHsKICAgICAgICAgICAgICAgIG0gPSB0cnVlOwogICAgICAgICAgICAgICAgciA9IGludDJjaGFyKGQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdoaWxlIChpID49IDApIHsKICAgICAgICAgICAgICAgIGlmIChwIDwgaykgewogICAgICAgICAgICAgICAgICAgIGQgPSAodGhpc1tpXSAmICgoMSA8PCBwKSAtIDEpKSA8PCAoayAtIHApOwogICAgICAgICAgICAgICAgICAgIGQgfD0gdGhpc1stLWldID4+IChwICs9IHRoaXMuREIgLSBrKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGQgPSAodGhpc1tpXSA+PiAocCAtPSBrKSkgJiBrbTsKICAgICAgICAgICAgICAgICAgICBpZiAocCA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHAgKz0gdGhpcy5EQjsKICAgICAgICAgICAgICAgICAgICAgICAgLS1pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChkID4gMCkgewogICAgICAgICAgICAgICAgICAgIG0gPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG0pIHsKICAgICAgICAgICAgICAgICAgICByICs9IGludDJjaGFyKGQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBtID8gciA6ICIwIjsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5uZWdhdGUgPSBibk5lZ2F0ZTsKICAgIC8vIChwdWJsaWMpIC10aGlzCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5uZWdhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHIgPSBuYmkoKTsKICAgICAgICBCaWdJbnRlZ2VyLlpFUk8uc3ViVG8odGhpcywgcik7CiAgICAgICAgcmV0dXJuIHI7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuYWJzID0gYm5BYnM7CiAgICAvLyAocHVibGljKSB8dGhpc3wKICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLmFicyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gKHRoaXMucyA8IDApID8gdGhpcy5uZWdhdGUoKSA6IHRoaXM7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuY29tcGFyZVRvID0gYm5Db21wYXJlVG87CiAgICAvLyAocHVibGljKSByZXR1cm4gKyBpZiB0aGlzID4gYSwgLSBpZiB0aGlzIDwgYSwgMCBpZiBlcXVhbAogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuY29tcGFyZVRvID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgciA9IHRoaXMucyAtIGEuczsKICAgICAgICBpZiAociAhPSAwKSB7CiAgICAgICAgICAgIHJldHVybiByOwogICAgICAgIH0KICAgICAgICB2YXIgaSA9IHRoaXMudDsKICAgICAgICByID0gaSAtIGEudDsKICAgICAgICBpZiAociAhPSAwKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5zIDwgMCkgPyAtciA6IHI7CiAgICAgICAgfQogICAgICAgIHdoaWxlICgtLWkgPj0gMCkgewogICAgICAgICAgICBpZiAoKHIgPSB0aGlzW2ldIC0gYVtpXSkgIT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIDA7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuYml0TGVuZ3RoID0gYm5CaXRMZW5ndGg7CiAgICAvLyAocHVibGljKSByZXR1cm4gdGhlIG51bWJlciBvZiBiaXRzIGluICJ0aGlzIgogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuYml0TGVuZ3RoID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0aGlzLnQgPD0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuREIgKiAodGhpcy50IC0gMSkgKyBuYml0cyh0aGlzW3RoaXMudCAtIDFdIF4gKHRoaXMucyAmIHRoaXMuRE0pKTsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5tb2QgPSBibk1vZDsKICAgIC8vIChwdWJsaWMpIHRoaXMgbW9kIGEKICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLm1vZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIHIgPSBuYmkoKTsKICAgICAgICB0aGlzLmFicygpLmRpdlJlbVRvKGEsIG51bGwsIHIpOwogICAgICAgIGlmICh0aGlzLnMgPCAwICYmIHIuY29tcGFyZVRvKEJpZ0ludGVnZXIuWkVSTykgPiAwKSB7CiAgICAgICAgICAgIGEuc3ViVG8ociwgcik7CiAgICAgICAgfQogICAgICAgIHJldHVybiByOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLm1vZFBvd0ludCA9IGJuTW9kUG93SW50OwogICAgLy8gKHB1YmxpYykgdGhpc15lICUgbSwgMCA8PSBlIDwgMl4zMgogICAgQmlnSW50ZWdlci5wcm90b3R5cGUubW9kUG93SW50ID0gZnVuY3Rpb24gKGUsIG0pIHsKICAgICAgICB2YXIgejsKICAgICAgICBpZiAoZSA8IDI1NiB8fCBtLmlzRXZlbigpKSB7CiAgICAgICAgICAgIHogPSBuZXcgQ2xhc3NpYyhtKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHogPSBuZXcgTW9udGdvbWVyeShtKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuZXhwKGUsIHopOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLmNsb25lID0gYm5DbG9uZTsKICAgIC8vIChwdWJsaWMpCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgciA9IG5iaSgpOwogICAgICAgIHRoaXMuY29weVRvKHIpOwogICAgICAgIHJldHVybiByOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLmludFZhbHVlID0gYm5JbnRWYWx1ZTsKICAgIC8vIChwdWJsaWMpIHJldHVybiB2YWx1ZSBhcyBpbnRlZ2VyCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5pbnRWYWx1ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodGhpcy5zIDwgMCkgewogICAgICAgICAgICBpZiAodGhpcy50ID09IDEpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzWzBdIC0gdGhpcy5EVjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh0aGlzLnQgPT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHRoaXMudCA9PSAxKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzWzBdOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICh0aGlzLnQgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgLy8gYXNzdW1lcyAxNiA8IERCIDwgMzIKICAgICAgICByZXR1cm4gKCh0aGlzWzFdICYgKCgxIDw8ICgzMiAtIHRoaXMuREIpKSAtIDEpKSA8PCB0aGlzLkRCKSB8IHRoaXNbMF07CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuYnl0ZVZhbHVlID0gYm5CeXRlVmFsdWU7CiAgICAvLyAocHVibGljKSByZXR1cm4gdmFsdWUgYXMgYnl0ZQogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuYnl0ZVZhbHVlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAodGhpcy50ID09IDApID8gdGhpcy5zIDogKHRoaXNbMF0gPDwgMjQpID4+IDI0OwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLnNob3J0VmFsdWUgPSBiblNob3J0VmFsdWU7CiAgICAvLyAocHVibGljKSByZXR1cm4gdmFsdWUgYXMgc2hvcnQgKGFzc3VtZXMgREI+PTE2KQogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuc2hvcnRWYWx1ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gKHRoaXMudCA9PSAwKSA/IHRoaXMucyA6ICh0aGlzWzBdIDw8IDE2KSA+PiAxNjsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5zaWdudW0gPSBiblNpZ051bTsKICAgIC8vIChwdWJsaWMpIDAgaWYgdGhpcyA9PSAwLCAxIGlmIHRoaXMgPiAwCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5zaWdudW0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMucyA8IDApIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICh0aGlzLnQgPD0gMCB8fCAodGhpcy50ID09IDEgJiYgdGhpc1swXSA8PSAwKSkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS50b0J5dGVBcnJheSA9IGJuVG9CeXRlQXJyYXk7CiAgICAvLyAocHVibGljKSBjb252ZXJ0IHRvIGJpZ2VuZGlhbiBieXRlIGFycmF5CiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS50b0J5dGVBcnJheSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgaSA9IHRoaXMudDsKICAgICAgICB2YXIgciA9IFtdOwogICAgICAgIHJbMF0gPSB0aGlzLnM7CiAgICAgICAgdmFyIHAgPSB0aGlzLkRCIC0gKGkgKiB0aGlzLkRCKSAlIDg7CiAgICAgICAgdmFyIGQ7CiAgICAgICAgdmFyIGsgPSAwOwogICAgICAgIGlmIChpLS0gPiAwKSB7CiAgICAgICAgICAgIGlmIChwIDwgdGhpcy5EQiAmJiAoZCA9IHRoaXNbaV0gPj4gcCkgIT0gKHRoaXMucyAmIHRoaXMuRE0pID4+IHApIHsKICAgICAgICAgICAgICAgIHJbaysrXSA9IGQgfCAodGhpcy5zIDw8ICh0aGlzLkRCIC0gcCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdoaWxlIChpID49IDApIHsKICAgICAgICAgICAgICAgIGlmIChwIDwgOCkgewogICAgICAgICAgICAgICAgICAgIGQgPSAodGhpc1tpXSAmICgoMSA8PCBwKSAtIDEpKSA8PCAoOCAtIHApOwogICAgICAgICAgICAgICAgICAgIGQgfD0gdGhpc1stLWldID4+IChwICs9IHRoaXMuREIgLSA4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGQgPSAodGhpc1tpXSA+PiAocCAtPSA4KSkgJiAweGZmOwogICAgICAgICAgICAgICAgICAgIGlmIChwIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcCArPSB0aGlzLkRCOwogICAgICAgICAgICAgICAgICAgICAgICAtLWk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKChkICYgMHg4MCkgIT0gMCkgewogICAgICAgICAgICAgICAgICAgIGQgfD0gLTI1NjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChrID09IDAgJiYgKHRoaXMucyAmIDB4ODApICE9IChkICYgMHg4MCkpIHsKICAgICAgICAgICAgICAgICAgICArK2s7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoayA+IDAgfHwgZCAhPSB0aGlzLnMpIHsKICAgICAgICAgICAgICAgICAgICByW2srK10gPSBkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLmVxdWFscyA9IGJuRXF1YWxzOwogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gKHRoaXMuY29tcGFyZVRvKGEpID09IDApOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLm1pbiA9IGJuTWluOwogICAgQmlnSW50ZWdlci5wcm90b3R5cGUubWluID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gKHRoaXMuY29tcGFyZVRvKGEpIDwgMCkgPyB0aGlzIDogYTsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5tYXggPSBibk1heDsKICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLm1heCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuICh0aGlzLmNvbXBhcmVUbyhhKSA+IDApID8gdGhpcyA6IGE7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuYW5kID0gYm5BbmQ7CiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5hbmQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciByID0gbmJpKCk7CiAgICAgICAgdGhpcy5iaXR3aXNlVG8oYSwgb3BfYW5kLCByKTsKICAgICAgICByZXR1cm4gcjsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5vciA9IGJuT3I7CiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5vciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIHIgPSBuYmkoKTsKICAgICAgICB0aGlzLmJpdHdpc2VUbyhhLCBvcF9vciwgcik7CiAgICAgICAgcmV0dXJuIHI7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUueG9yID0gYm5Yb3I7CiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciByID0gbmJpKCk7CiAgICAgICAgdGhpcy5iaXR3aXNlVG8oYSwgb3BfeG9yLCByKTsKICAgICAgICByZXR1cm4gcjsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5hbmROb3QgPSBibkFuZE5vdDsKICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLmFuZE5vdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIHIgPSBuYmkoKTsKICAgICAgICB0aGlzLmJpdHdpc2VUbyhhLCBvcF9hbmRub3QsIHIpOwogICAgICAgIHJldHVybiByOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLm5vdCA9IGJuTm90OwogICAgLy8gKHB1YmxpYykgfnRoaXMKICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLm5vdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgciA9IG5iaSgpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50OyArK2kpIHsKICAgICAgICAgICAgcltpXSA9IHRoaXMuRE0gJiB+dGhpc1tpXTsKICAgICAgICB9CiAgICAgICAgci50ID0gdGhpcy50OwogICAgICAgIHIucyA9IH50aGlzLnM7CiAgICAgICAgcmV0dXJuIHI7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuc2hpZnRMZWZ0ID0gYm5TaGlmdExlZnQ7CiAgICAvLyAocHVibGljKSB0aGlzIDw8IG4KICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLnNoaWZ0TGVmdCA9IGZ1bmN0aW9uIChuKSB7CiAgICAgICAgdmFyIHIgPSBuYmkoKTsKICAgICAgICBpZiAobiA8IDApIHsKICAgICAgICAgICAgdGhpcy5yU2hpZnRUbygtbiwgcik7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0aGlzLmxTaGlmdFRvKG4sIHIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcjsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5zaGlmdFJpZ2h0ID0gYm5TaGlmdFJpZ2h0OwogICAgLy8gKHB1YmxpYykgdGhpcyA+PiBuCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5zaGlmdFJpZ2h0ID0gZnVuY3Rpb24gKG4pIHsKICAgICAgICB2YXIgciA9IG5iaSgpOwogICAgICAgIGlmIChuIDwgMCkgewogICAgICAgICAgICB0aGlzLmxTaGlmdFRvKC1uLCByKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHRoaXMuclNoaWZ0VG8obiwgcik7CiAgICAgICAgfQogICAgICAgIHJldHVybiByOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLmdldExvd2VzdFNldEJpdCA9IGJuR2V0TG93ZXN0U2V0Qml0OwogICAgLy8gKHB1YmxpYykgcmV0dXJucyBpbmRleCBvZiBsb3dlc3QgMS1iaXQgKG9yIC0xIGlmIG5vbmUpCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5nZXRMb3dlc3RTZXRCaXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnQ7ICsraSkgewogICAgICAgICAgICBpZiAodGhpc1tpXSAhPSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaSAqIHRoaXMuREIgKyBsYml0KHRoaXNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnMgPCAwKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnQgKiB0aGlzLkRCOwogICAgICAgIH0KICAgICAgICByZXR1cm4gLTE7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuYml0Q291bnQgPSBibkJpdENvdW50OwogICAgLy8gKHB1YmxpYykgcmV0dXJuIG51bWJlciBvZiBzZXQgYml0cwogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuYml0Q291bnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHIgPSAwOwogICAgICAgIHZhciB4ID0gdGhpcy5zICYgdGhpcy5ETTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudDsgKytpKSB7CiAgICAgICAgICAgIHIgKz0gY2JpdCh0aGlzW2ldIF4geCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLnRlc3RCaXQgPSBiblRlc3RCaXQ7CiAgICAvLyAocHVibGljKSB0cnVlIGlmZiBudGggYml0IGlzIHNldAogICAgQmlnSW50ZWdlci5wcm90b3R5cGUudGVzdEJpdCA9IGZ1bmN0aW9uIChuKSB7CiAgICAgICAgdmFyIGogPSBNYXRoLmZsb29yKG4gLyB0aGlzLkRCKTsKICAgICAgICBpZiAoaiA+PSB0aGlzLnQpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLnMgIT0gMCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoKHRoaXNbal0gJiAoMSA8PCAobiAlIHRoaXMuREIpKSkgIT0gMCk7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuc2V0Qml0ID0gYm5TZXRCaXQ7CiAgICAvLyAocHVibGljKSB0aGlzIHwgKDE8PG4pCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5zZXRCaXQgPSBmdW5jdGlvbiAobikgewogICAgICAgIHJldHVybiB0aGlzLmNoYW5nZUJpdChuLCBvcF9vcik7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuY2xlYXJCaXQgPSBibkNsZWFyQml0OwogICAgLy8gKHB1YmxpYykgdGhpcyAmIH4oMTw8bikKICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLmNsZWFyQml0ID0gZnVuY3Rpb24gKG4pIHsKICAgICAgICByZXR1cm4gdGhpcy5jaGFuZ2VCaXQobiwgb3BfYW5kbm90KTsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5mbGlwQml0ID0gYm5GbGlwQml0OwogICAgLy8gKHB1YmxpYykgdGhpcyBeICgxPDxuKQogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuZmxpcEJpdCA9IGZ1bmN0aW9uIChuKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2hhbmdlQml0KG4sIG9wX3hvcik7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuYWRkID0gYm5BZGQ7CiAgICAvLyAocHVibGljKSB0aGlzICsgYQogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgciA9IG5iaSgpOwogICAgICAgIHRoaXMuYWRkVG8oYSwgcik7CiAgICAgICAgcmV0dXJuIHI7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuc3VidHJhY3QgPSBiblN1YnRyYWN0OwogICAgLy8gKHB1YmxpYykgdGhpcyAtIGEKICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLnN1YnRyYWN0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgciA9IG5iaSgpOwogICAgICAgIHRoaXMuc3ViVG8oYSwgcik7CiAgICAgICAgcmV0dXJuIHI7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUubXVsdGlwbHkgPSBibk11bHRpcGx5OwogICAgLy8gKHB1YmxpYykgdGhpcyAqIGEKICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLm11bHRpcGx5ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgciA9IG5iaSgpOwogICAgICAgIHRoaXMubXVsdGlwbHlUbyhhLCByKTsKICAgICAgICByZXR1cm4gcjsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5kaXZpZGUgPSBibkRpdmlkZTsKICAgIC8vIChwdWJsaWMpIHRoaXMgLyBhCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5kaXZpZGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciByID0gbmJpKCk7CiAgICAgICAgdGhpcy5kaXZSZW1UbyhhLCByLCBudWxsKTsKICAgICAgICByZXR1cm4gcjsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5yZW1haW5kZXIgPSBiblJlbWFpbmRlcjsKICAgIC8vIChwdWJsaWMpIHRoaXMgJSBhCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5yZW1haW5kZXIgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciByID0gbmJpKCk7CiAgICAgICAgdGhpcy5kaXZSZW1UbyhhLCBudWxsLCByKTsKICAgICAgICByZXR1cm4gcjsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5kaXZpZGVBbmRSZW1haW5kZXIgPSBibkRpdmlkZUFuZFJlbWFpbmRlcjsKICAgIC8vIChwdWJsaWMpIFt0aGlzL2EsdGhpcyVhXQogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuZGl2aWRlQW5kUmVtYWluZGVyID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgcSA9IG5iaSgpOwogICAgICAgIHZhciByID0gbmJpKCk7CiAgICAgICAgdGhpcy5kaXZSZW1UbyhhLCBxLCByKTsKICAgICAgICByZXR1cm4gW3EsIHJdOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLm1vZFBvdyA9IGJuTW9kUG93OwogICAgLy8gKHB1YmxpYykgdGhpc15lICUgbSAoSEFDIDE0Ljg1KQogICAgQmlnSW50ZWdlci5wcm90b3R5cGUubW9kUG93ID0gZnVuY3Rpb24gKGUsIG0pIHsKICAgICAgICB2YXIgaSA9IGUuYml0TGVuZ3RoKCk7CiAgICAgICAgdmFyIGs7CiAgICAgICAgdmFyIHIgPSBuYnYoMSk7CiAgICAgICAgdmFyIHo7CiAgICAgICAgaWYgKGkgPD0gMCkgewogICAgICAgICAgICByZXR1cm4gcjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoaSA8IDE4KSB7CiAgICAgICAgICAgIGsgPSAxOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChpIDwgNDgpIHsKICAgICAgICAgICAgayA9IDM7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGkgPCAxNDQpIHsKICAgICAgICAgICAgayA9IDQ7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGkgPCA3NjgpIHsKICAgICAgICAgICAgayA9IDU7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBrID0gNjsKICAgICAgICB9CiAgICAgICAgaWYgKGkgPCA4KSB7CiAgICAgICAgICAgIHogPSBuZXcgQ2xhc3NpYyhtKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAobS5pc0V2ZW4oKSkgewogICAgICAgICAgICB6ID0gbmV3IEJhcnJldHQobSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB6ID0gbmV3IE1vbnRnb21lcnkobSk7CiAgICAgICAgfQogICAgICAgIC8vIHByZWNvbXB1dGF0aW9uCiAgICAgICAgdmFyIGcgPSBbXTsKICAgICAgICB2YXIgbiA9IDM7CiAgICAgICAgdmFyIGsxID0gayAtIDE7CiAgICAgICAgdmFyIGttID0gKDEgPDwgaykgLSAxOwogICAgICAgIGdbMV0gPSB6LmNvbnZlcnQodGhpcyk7CiAgICAgICAgaWYgKGsgPiAxKSB7CiAgICAgICAgICAgIHZhciBnMiA9IG5iaSgpOwogICAgICAgICAgICB6LnNxclRvKGdbMV0sIGcyKTsKICAgICAgICAgICAgd2hpbGUgKG4gPD0ga20pIHsKICAgICAgICAgICAgICAgIGdbbl0gPSBuYmkoKTsKICAgICAgICAgICAgICAgIHoubXVsVG8oZzIsIGdbbiAtIDJdLCBnW25dKTsKICAgICAgICAgICAgICAgIG4gKz0gMjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgaiA9IGUudCAtIDE7CiAgICAgICAgdmFyIHc7CiAgICAgICAgdmFyIGlzMSA9IHRydWU7CiAgICAgICAgdmFyIHIyID0gbmJpKCk7CiAgICAgICAgdmFyIHQ7CiAgICAgICAgaSA9IG5iaXRzKGVbal0pIC0gMTsKICAgICAgICB3aGlsZSAoaiA+PSAwKSB7CiAgICAgICAgICAgIGlmIChpID49IGsxKSB7CiAgICAgICAgICAgICAgICB3ID0gKGVbal0gPj4gKGkgLSBrMSkpICYga207CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB3ID0gKGVbal0gJiAoKDEgPDwgKGkgKyAxKSkgLSAxKSkgPDwgKGsxIC0gaSk7CiAgICAgICAgICAgICAgICBpZiAoaiA+IDApIHsKICAgICAgICAgICAgICAgICAgICB3IHw9IGVbaiAtIDFdID4+ICh0aGlzLkRCICsgaSAtIGsxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBuID0gazsKICAgICAgICAgICAgd2hpbGUgKCh3ICYgMSkgPT0gMCkgewogICAgICAgICAgICAgICAgdyA+Pj0gMTsKICAgICAgICAgICAgICAgIC0tbjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKGkgLT0gbikgPCAwKSB7CiAgICAgICAgICAgICAgICBpICs9IHRoaXMuREI7CiAgICAgICAgICAgICAgICAtLWo7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlzMSkgeyAvLyByZXQgPT0gMSwgZG9uJ3QgYm90aGVyIHNxdWFyaW5nIG9yIG11bHRpcGx5aW5nIGl0CiAgICAgICAgICAgICAgICBnW3ddLmNvcHlUbyhyKTsKICAgICAgICAgICAgICAgIGlzMSA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgd2hpbGUgKG4gPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgei5zcXJUbyhyLCByMik7CiAgICAgICAgICAgICAgICAgICAgei5zcXJUbyhyMiwgcik7CiAgICAgICAgICAgICAgICAgICAgbiAtPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG4gPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgei5zcXJUbyhyLCByMik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0ID0gcjsKICAgICAgICAgICAgICAgICAgICByID0gcjI7CiAgICAgICAgICAgICAgICAgICAgcjIgPSB0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgei5tdWxUbyhyMiwgZ1t3XSwgcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2hpbGUgKGogPj0gMCAmJiAoZVtqXSAmICgxIDw8IGkpKSA9PSAwKSB7CiAgICAgICAgICAgICAgICB6LnNxclRvKHIsIHIyKTsKICAgICAgICAgICAgICAgIHQgPSByOwogICAgICAgICAgICAgICAgciA9IHIyOwogICAgICAgICAgICAgICAgcjIgPSB0OwogICAgICAgICAgICAgICAgaWYgKC0taSA8IDApIHsKICAgICAgICAgICAgICAgICAgICBpID0gdGhpcy5EQiAtIDE7CiAgICAgICAgICAgICAgICAgICAgLS1qOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB6LnJldmVydChyKTsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5tb2RJbnZlcnNlID0gYm5Nb2RJbnZlcnNlOwogICAgLy8gKHB1YmxpYykgMS90aGlzICUgbSAoSEFDIDE0LjYxKQogICAgQmlnSW50ZWdlci5wcm90b3R5cGUubW9kSW52ZXJzZSA9IGZ1bmN0aW9uIChtKSB7CiAgICAgICAgdmFyIGFjID0gbS5pc0V2ZW4oKTsKICAgICAgICBpZiAoKHRoaXMuaXNFdmVuKCkgJiYgYWMpIHx8IG0uc2lnbnVtKCkgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gQmlnSW50ZWdlci5aRVJPOwogICAgICAgIH0KICAgICAgICB2YXIgdSA9IG0uY2xvbmUoKTsKICAgICAgICB2YXIgdiA9IHRoaXMuY2xvbmUoKTsKICAgICAgICB2YXIgYSA9IG5idigxKTsKICAgICAgICB2YXIgYiA9IG5idigwKTsKICAgICAgICB2YXIgYyA9IG5idigwKTsKICAgICAgICB2YXIgZCA9IG5idigxKTsKICAgICAgICB3aGlsZSAodS5zaWdudW0oKSAhPSAwKSB7CiAgICAgICAgICAgIHdoaWxlICh1LmlzRXZlbigpKSB7CiAgICAgICAgICAgICAgICB1LnJTaGlmdFRvKDEsIHUpOwogICAgICAgICAgICAgICAgaWYgKGFjKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFhLmlzRXZlbigpIHx8ICFiLmlzRXZlbigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGEuYWRkVG8odGhpcywgYSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGIuc3ViVG8obSwgYik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGEuclNoaWZ0VG8oMSwgYSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmICghYi5pc0V2ZW4oKSkgewogICAgICAgICAgICAgICAgICAgIGIuc3ViVG8obSwgYik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBiLnJTaGlmdFRvKDEsIGIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdoaWxlICh2LmlzRXZlbigpKSB7CiAgICAgICAgICAgICAgICB2LnJTaGlmdFRvKDEsIHYpOwogICAgICAgICAgICAgICAgaWYgKGFjKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjLmlzRXZlbigpIHx8ICFkLmlzRXZlbigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGMuYWRkVG8odGhpcywgYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGQuc3ViVG8obSwgZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGMuclNoaWZ0VG8oMSwgYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmICghZC5pc0V2ZW4oKSkgewogICAgICAgICAgICAgICAgICAgIGQuc3ViVG8obSwgZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkLnJTaGlmdFRvKDEsIGQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh1LmNvbXBhcmVUbyh2KSA+PSAwKSB7CiAgICAgICAgICAgICAgICB1LnN1YlRvKHYsIHUpOwogICAgICAgICAgICAgICAgaWYgKGFjKSB7CiAgICAgICAgICAgICAgICAgICAgYS5zdWJUbyhjLCBhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGIuc3ViVG8oZCwgYik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB2LnN1YlRvKHUsIHYpOwogICAgICAgICAgICAgICAgaWYgKGFjKSB7CiAgICAgICAgICAgICAgICAgICAgYy5zdWJUbyhhLCBjKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGQuc3ViVG8oYiwgZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHYuY29tcGFyZVRvKEJpZ0ludGVnZXIuT05FKSAhPSAwKSB7CiAgICAgICAgICAgIHJldHVybiBCaWdJbnRlZ2VyLlpFUk87CiAgICAgICAgfQogICAgICAgIGlmIChkLmNvbXBhcmVUbyhtKSA+PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBkLnN1YnRyYWN0KG0pOwogICAgICAgIH0KICAgICAgICBpZiAoZC5zaWdudW0oKSA8IDApIHsKICAgICAgICAgICAgZC5hZGRUbyhtLCBkKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBkOwogICAgICAgIH0KICAgICAgICBpZiAoZC5zaWdudW0oKSA8IDApIHsKICAgICAgICAgICAgcmV0dXJuIGQuYWRkKG0pOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgfQogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLnBvdyA9IGJuUG93OwogICAgLy8gKHB1YmxpYykgdGhpc15lCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5wb3cgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIHJldHVybiB0aGlzLmV4cChlLCBuZXcgTnVsbEV4cCgpKTsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5nY2QgPSBibkdDRDsKICAgIC8vIChwdWJsaWMpIGdjZCh0aGlzLGEpIChIQUMgMTQuNTQpCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5nY2QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciB4ID0gKHRoaXMucyA8IDApID8gdGhpcy5uZWdhdGUoKSA6IHRoaXMuY2xvbmUoKTsKICAgICAgICB2YXIgeSA9IChhLnMgPCAwKSA/IGEubmVnYXRlKCkgOiBhLmNsb25lKCk7CiAgICAgICAgaWYgKHguY29tcGFyZVRvKHkpIDwgMCkgewogICAgICAgICAgICB2YXIgdCA9IHg7CiAgICAgICAgICAgIHggPSB5OwogICAgICAgICAgICB5ID0gdDsKICAgICAgICB9CiAgICAgICAgdmFyIGkgPSB4LmdldExvd2VzdFNldEJpdCgpOwogICAgICAgIHZhciBnID0geS5nZXRMb3dlc3RTZXRCaXQoKTsKICAgICAgICBpZiAoZyA8IDApIHsKICAgICAgICAgICAgcmV0dXJuIHg7CiAgICAgICAgfQogICAgICAgIGlmIChpIDwgZykgewogICAgICAgICAgICBnID0gaTsKICAgICAgICB9CiAgICAgICAgaWYgKGcgPiAwKSB7CiAgICAgICAgICAgIHguclNoaWZ0VG8oZywgeCk7CiAgICAgICAgICAgIHkuclNoaWZ0VG8oZywgeSk7CiAgICAgICAgfQogICAgICAgIHdoaWxlICh4LnNpZ251bSgpID4gMCkgewogICAgICAgICAgICBpZiAoKGkgPSB4LmdldExvd2VzdFNldEJpdCgpKSA+IDApIHsKICAgICAgICAgICAgICAgIHguclNoaWZ0VG8oaSwgeCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKChpID0geS5nZXRMb3dlc3RTZXRCaXQoKSkgPiAwKSB7CiAgICAgICAgICAgICAgICB5LnJTaGlmdFRvKGksIHkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh4LmNvbXBhcmVUbyh5KSA+PSAwKSB7CiAgICAgICAgICAgICAgICB4LnN1YlRvKHksIHgpOwogICAgICAgICAgICAgICAgeC5yU2hpZnRUbygxLCB4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHkuc3ViVG8oeCwgeSk7CiAgICAgICAgICAgICAgICB5LnJTaGlmdFRvKDEsIHkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChnID4gMCkgewogICAgICAgICAgICB5LmxTaGlmdFRvKGcsIHkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4geTsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5pc1Byb2JhYmxlUHJpbWUgPSBibklzUHJvYmFibGVQcmltZTsKICAgIC8vIChwdWJsaWMpIHRlc3QgcHJpbWFsaXR5IHdpdGggY2VydGFpbnR5ID49IDEtLjVedAogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuaXNQcm9iYWJsZVByaW1lID0gZnVuY3Rpb24gKHQpIHsKICAgICAgICB2YXIgaTsKICAgICAgICB2YXIgeCA9IHRoaXMuYWJzKCk7CiAgICAgICAgaWYgKHgudCA9PSAxICYmIHhbMF0gPD0gbG93cHJpbWVzW2xvd3ByaW1lcy5sZW5ndGggLSAxXSkgewogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbG93cHJpbWVzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICBpZiAoeFswXSA9PSBsb3dwcmltZXNbaV0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICh4LmlzRXZlbigpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaSA9IDE7CiAgICAgICAgd2hpbGUgKGkgPCBsb3dwcmltZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBtID0gbG93cHJpbWVzW2ldOwogICAgICAgICAgICB2YXIgaiA9IGkgKyAxOwogICAgICAgICAgICB3aGlsZSAoaiA8IGxvd3ByaW1lcy5sZW5ndGggJiYgbSA8IGxwbGltKSB7CiAgICAgICAgICAgICAgICBtICo9IGxvd3ByaW1lc1tqKytdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG0gPSB4Lm1vZEludChtKTsKICAgICAgICAgICAgd2hpbGUgKGkgPCBqKSB7CiAgICAgICAgICAgICAgICBpZiAobSAlIGxvd3ByaW1lc1tpKytdID09IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHgubWlsbGVyUmFiaW4odCk7CiAgICB9OwogICAgLy8jZW5kcmVnaW9uIFBVQkxJQwogICAgLy8jcmVnaW9uIFBST1RFQ1RFRAogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuY29weVRvID0gYm5wQ29weVRvOwogICAgLy8gKHByb3RlY3RlZCkgY29weSB0aGlzIHRvIHIKICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLmNvcHlUbyA9IGZ1bmN0aW9uIChyKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMudCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgIHJbaV0gPSB0aGlzW2ldOwogICAgICAgIH0KICAgICAgICByLnQgPSB0aGlzLnQ7CiAgICAgICAgci5zID0gdGhpcy5zOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLmZyb21JbnQgPSBibnBGcm9tSW50OwogICAgLy8gKHByb3RlY3RlZCkgc2V0IGZyb20gaW50ZWdlciB2YWx1ZSB4LCAtRFYgPD0geCA8IERWCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5mcm9tSW50ID0gZnVuY3Rpb24gKHgpIHsKICAgICAgICB0aGlzLnQgPSAxOwogICAgICAgIHRoaXMucyA9ICh4IDwgMCkgPyAtMSA6IDA7CiAgICAgICAgaWYgKHggPiAwKSB7CiAgICAgICAgICAgIHRoaXNbMF0gPSB4OwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICh4IDwgLTEpIHsKICAgICAgICAgICAgdGhpc1swXSA9IHggKyB0aGlzLkRWOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdGhpcy50ID0gMDsKICAgICAgICB9CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuZnJvbVN0cmluZyA9IGJucEZyb21TdHJpbmc7CiAgICAvLyAocHJvdGVjdGVkKSBzZXQgZnJvbSBzdHJpbmcgYW5kIHJhZGl4CiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5mcm9tU3RyaW5nID0gZnVuY3Rpb24gKHMsIGIpIHsKICAgICAgICB2YXIgazsKICAgICAgICBpZiAoYiA9PSAxNikgewogICAgICAgICAgICBrID0gNDsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoYiA9PSA4KSB7CiAgICAgICAgICAgIGsgPSAzOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChiID09IDI1NikgewogICAgICAgICAgICBrID0gODsKICAgICAgICAgICAgLyogYnl0ZSBhcnJheSAqLwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChiID09IDIpIHsKICAgICAgICAgICAgayA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGIgPT0gMzIpIHsKICAgICAgICAgICAgayA9IDU7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGIgPT0gNCkgewogICAgICAgICAgICBrID0gMjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZnJvbVJhZGl4KHMsIGIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMudCA9IDA7CiAgICAgICAgdGhpcy5zID0gMDsKICAgICAgICB2YXIgaSA9IHMubGVuZ3RoOwogICAgICAgIHZhciBtaSA9IGZhbHNlOwogICAgICAgIHZhciBzaCA9IDA7CiAgICAgICAgd2hpbGUgKC0taSA+PSAwKSB7CiAgICAgICAgICAgIHZhciB4ID0gKGsgPT0gOCkgPyAoK3NbaV0pICYgMHhmZiA6IGludEF0KHMsIGkpOwogICAgICAgICAgICBpZiAoeCA8IDApIHsKICAgICAgICAgICAgICAgIGlmIChzLmNoYXJBdChpKSA9PSAiLSIpIHsKICAgICAgICAgICAgICAgICAgICBtaSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBtaSA9IGZhbHNlOwogICAgICAgICAgICBpZiAoc2ggPT0gMCkgewogICAgICAgICAgICAgICAgdGhpc1t0aGlzLnQrK10gPSB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHNoICsgayA+IHRoaXMuREIpIHsKICAgICAgICAgICAgICAgIHRoaXNbdGhpcy50IC0gMV0gfD0gKHggJiAoKDEgPDwgKHRoaXMuREIgLSBzaCkpIC0gMSkpIDw8IHNoOwogICAgICAgICAgICAgICAgdGhpc1t0aGlzLnQrK10gPSAoeCA+PiAodGhpcy5EQiAtIHNoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzW3RoaXMudCAtIDFdIHw9IHggPDwgc2g7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2ggKz0gazsKICAgICAgICAgICAgaWYgKHNoID49IHRoaXMuREIpIHsKICAgICAgICAgICAgICAgIHNoIC09IHRoaXMuREI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGsgPT0gOCAmJiAoKCtzWzBdKSAmIDB4ODApICE9IDApIHsKICAgICAgICAgICAgdGhpcy5zID0gLTE7CiAgICAgICAgICAgIGlmIChzaCA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXNbdGhpcy50IC0gMV0gfD0gKCgxIDw8ICh0aGlzLkRCIC0gc2gpKSAtIDEpIDw8IHNoOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuY2xhbXAoKTsKICAgICAgICBpZiAobWkpIHsKICAgICAgICAgICAgQmlnSW50ZWdlci5aRVJPLnN1YlRvKHRoaXMsIHRoaXMpOwogICAgICAgIH0KICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5jbGFtcCA9IGJucENsYW1wOwogICAgLy8gKHByb3RlY3RlZCkgY2xhbXAgb2ZmIGV4Y2VzcyBoaWdoIHdvcmRzCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5jbGFtcCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYyA9IHRoaXMucyAmIHRoaXMuRE07CiAgICAgICAgd2hpbGUgKHRoaXMudCA+IDAgJiYgdGhpc1t0aGlzLnQgLSAxXSA9PSBjKSB7CiAgICAgICAgICAgIC0tdGhpcy50OwogICAgICAgIH0KICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5kbFNoaWZ0VG8gPSBibnBETFNoaWZ0VG87CiAgICAvLyAocHJvdGVjdGVkKSByID0gdGhpcyA8PCBuKkRCCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5kbFNoaWZ0VG8gPSBmdW5jdGlvbiAobiwgcikgewogICAgICAgIHZhciBpOwogICAgICAgIGZvciAoaSA9IHRoaXMudCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgIHJbaSArIG5dID0gdGhpc1tpXTsKICAgICAgICB9CiAgICAgICAgZm9yIChpID0gbiAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgICAgICAgIHJbaV0gPSAwOwogICAgICAgIH0KICAgICAgICByLnQgPSB0aGlzLnQgKyBuOwogICAgICAgIHIucyA9IHRoaXMuczsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5kclNoaWZ0VG8gPSBibnBEUlNoaWZ0VG87CiAgICAvLyAocHJvdGVjdGVkKSByID0gdGhpcyA+PiBuKkRCCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5kclNoaWZ0VG8gPSBmdW5jdGlvbiAobiwgcikgewogICAgICAgIGZvciAodmFyIGkgPSBuOyBpIDwgdGhpcy50OyArK2kpIHsKICAgICAgICAgICAgcltpIC0gbl0gPSB0aGlzW2ldOwogICAgICAgIH0KICAgICAgICByLnQgPSBNYXRoLm1heCh0aGlzLnQgLSBuLCAwKTsKICAgICAgICByLnMgPSB0aGlzLnM7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUubFNoaWZ0VG8gPSBibnBMU2hpZnRUbzsKICAgIC8vIChwcm90ZWN0ZWQpIHIgPSB0aGlzIDw8IG4KICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLmxTaGlmdFRvID0gZnVuY3Rpb24gKG4sIHIpIHsKICAgICAgICB2YXIgYnMgPSBuICUgdGhpcy5EQjsKICAgICAgICB2YXIgY2JzID0gdGhpcy5EQiAtIGJzOwogICAgICAgIHZhciBibSA9ICgxIDw8IGNicykgLSAxOwogICAgICAgIHZhciBkcyA9IE1hdGguZmxvb3IobiAvIHRoaXMuREIpOwogICAgICAgIHZhciBjID0gKHRoaXMucyA8PCBicykgJiB0aGlzLkRNOwogICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnQgLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgICByW2kgKyBkcyArIDFdID0gKHRoaXNbaV0gPj4gY2JzKSB8IGM7CiAgICAgICAgICAgIGMgPSAodGhpc1tpXSAmIGJtKSA8PCBiczsKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaSA9IGRzIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgcltpXSA9IDA7CiAgICAgICAgfQogICAgICAgIHJbZHNdID0gYzsKICAgICAgICByLnQgPSB0aGlzLnQgKyBkcyArIDE7CiAgICAgICAgci5zID0gdGhpcy5zOwogICAgICAgIHIuY2xhbXAoKTsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5yU2hpZnRUbyA9IGJucFJTaGlmdFRvOwogICAgLy8gKHByb3RlY3RlZCkgciA9IHRoaXMgPj4gbgogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuclNoaWZ0VG8gPSBmdW5jdGlvbiAobiwgcikgewogICAgICAgIHIucyA9IHRoaXMuczsKICAgICAgICB2YXIgZHMgPSBNYXRoLmZsb29yKG4gLyB0aGlzLkRCKTsKICAgICAgICBpZiAoZHMgPj0gdGhpcy50KSB7CiAgICAgICAgICAgIHIudCA9IDA7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIGJzID0gbiAlIHRoaXMuREI7CiAgICAgICAgdmFyIGNicyA9IHRoaXMuREIgLSBiczsKICAgICAgICB2YXIgYm0gPSAoMSA8PCBicykgLSAxOwogICAgICAgIHJbMF0gPSB0aGlzW2RzXSA+PiBiczsKICAgICAgICBmb3IgKHZhciBpID0gZHMgKyAxOyBpIDwgdGhpcy50OyArK2kpIHsKICAgICAgICAgICAgcltpIC0gZHMgLSAxXSB8PSAodGhpc1tpXSAmIGJtKSA8PCBjYnM7CiAgICAgICAgICAgIHJbaSAtIGRzXSA9IHRoaXNbaV0gPj4gYnM7CiAgICAgICAgfQogICAgICAgIGlmIChicyA+IDApIHsKICAgICAgICAgICAgclt0aGlzLnQgLSBkcyAtIDFdIHw9ICh0aGlzLnMgJiBibSkgPDwgY2JzOwogICAgICAgIH0KICAgICAgICByLnQgPSB0aGlzLnQgLSBkczsKICAgICAgICByLmNsYW1wKCk7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuc3ViVG8gPSBibnBTdWJUbzsKICAgIC8vIChwcm90ZWN0ZWQpIHIgPSB0aGlzIC0gYQogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuc3ViVG8gPSBmdW5jdGlvbiAoYSwgcikgewogICAgICAgIHZhciBpID0gMDsKICAgICAgICB2YXIgYyA9IDA7CiAgICAgICAgdmFyIG0gPSBNYXRoLm1pbihhLnQsIHRoaXMudCk7CiAgICAgICAgd2hpbGUgKGkgPCBtKSB7CiAgICAgICAgICAgIGMgKz0gdGhpc1tpXSAtIGFbaV07CiAgICAgICAgICAgIHJbaSsrXSA9IGMgJiB0aGlzLkRNOwogICAgICAgICAgICBjID4+PSB0aGlzLkRCOwogICAgICAgIH0KICAgICAgICBpZiAoYS50IDwgdGhpcy50KSB7CiAgICAgICAgICAgIGMgLT0gYS5zOwogICAgICAgICAgICB3aGlsZSAoaSA8IHRoaXMudCkgewogICAgICAgICAgICAgICAgYyArPSB0aGlzW2ldOwogICAgICAgICAgICAgICAgcltpKytdID0gYyAmIHRoaXMuRE07CiAgICAgICAgICAgICAgICBjID4+PSB0aGlzLkRCOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGMgKz0gdGhpcy5zOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgYyArPSB0aGlzLnM7CiAgICAgICAgICAgIHdoaWxlIChpIDwgYS50KSB7CiAgICAgICAgICAgICAgICBjIC09IGFbaV07CiAgICAgICAgICAgICAgICByW2krK10gPSBjICYgdGhpcy5ETTsKICAgICAgICAgICAgICAgIGMgPj49IHRoaXMuREI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYyAtPSBhLnM7CiAgICAgICAgfQogICAgICAgIHIucyA9IChjIDwgMCkgPyAtMSA6IDA7CiAgICAgICAgaWYgKGMgPCAtMSkgewogICAgICAgICAgICByW2krK10gPSB0aGlzLkRWICsgYzsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoYyA+IDApIHsKICAgICAgICAgICAgcltpKytdID0gYzsKICAgICAgICB9CiAgICAgICAgci50ID0gaTsKICAgICAgICByLmNsYW1wKCk7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUubXVsdGlwbHlUbyA9IGJucE11bHRpcGx5VG87CiAgICAvLyAocHJvdGVjdGVkKSByID0gdGhpcyAqIGEsIHIgIT0gdGhpcyxhIChIQUMgMTQuMTIpCiAgICAvLyAidGhpcyIgc2hvdWxkIGJlIHRoZSBsYXJnZXIgb25lIGlmIGFwcHJvcHJpYXRlLgogICAgQmlnSW50ZWdlci5wcm90b3R5cGUubXVsdGlwbHlUbyA9IGZ1bmN0aW9uIChhLCByKSB7CiAgICAgICAgdmFyIHggPSB0aGlzLmFicygpOwogICAgICAgIHZhciB5ID0gYS5hYnMoKTsKICAgICAgICB2YXIgaSA9IHgudDsKICAgICAgICByLnQgPSBpICsgeS50OwogICAgICAgIHdoaWxlICgtLWkgPj0gMCkgewogICAgICAgICAgICByW2ldID0gMDsKICAgICAgICB9CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHkudDsgKytpKSB7CiAgICAgICAgICAgIHJbaSArIHgudF0gPSB4LmFtKDAsIHlbaV0sIHIsIGksIDAsIHgudCk7CiAgICAgICAgfQogICAgICAgIHIucyA9IDA7CiAgICAgICAgci5jbGFtcCgpOwogICAgICAgIGlmICh0aGlzLnMgIT0gYS5zKSB7CiAgICAgICAgICAgIEJpZ0ludGVnZXIuWkVSTy5zdWJUbyhyLCByKTsKICAgICAgICB9CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuc3F1YXJlVG8gPSBibnBTcXVhcmVUbzsKICAgIC8vIChwcm90ZWN0ZWQpIHIgPSB0aGlzXjIsIHIgIT0gdGhpcyAoSEFDIDE0LjE2KQogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuc3F1YXJlVG8gPSBmdW5jdGlvbiAocikgewogICAgICAgIHZhciB4ID0gdGhpcy5hYnMoKTsKICAgICAgICB2YXIgaSA9IHIudCA9IDIgKiB4LnQ7CiAgICAgICAgd2hpbGUgKC0taSA+PSAwKSB7CiAgICAgICAgICAgIHJbaV0gPSAwOwogICAgICAgIH0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgeC50IC0gMTsgKytpKSB7CiAgICAgICAgICAgIHZhciBjID0geC5hbShpLCB4W2ldLCByLCAyICogaSwgMCwgMSk7CiAgICAgICAgICAgIGlmICgocltpICsgeC50XSArPSB4LmFtKGkgKyAxLCAyICogeFtpXSwgciwgMiAqIGkgKyAxLCBjLCB4LnQgLSBpIC0gMSkpID49IHguRFYpIHsKICAgICAgICAgICAgICAgIHJbaSArIHgudF0gLT0geC5EVjsKICAgICAgICAgICAgICAgIHJbaSArIHgudCArIDFdID0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoci50ID4gMCkgewogICAgICAgICAgICByW3IudCAtIDFdICs9IHguYW0oaSwgeFtpXSwgciwgMiAqIGksIDAsIDEpOwogICAgICAgIH0KICAgICAgICByLnMgPSAwOwogICAgICAgIHIuY2xhbXAoKTsKICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5kaXZSZW1UbyA9IGJucERpdlJlbVRvOwogICAgLy8gKHByb3RlY3RlZCkgZGl2aWRlIHRoaXMgYnkgbSwgcXVvdGllbnQgYW5kIHJlbWFpbmRlciB0byBxLCByIChIQUMgMTQuMjApCiAgICAvLyByICE9IHEsIHRoaXMgIT0gbS4gIHEgb3IgciBtYXkgYmUgbnVsbC4KICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLmRpdlJlbVRvID0gZnVuY3Rpb24gKG0sIHEsIHIpIHsKICAgICAgICB2YXIgcG0gPSBtLmFicygpOwogICAgICAgIGlmIChwbS50IDw9IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgcHQgPSB0aGlzLmFicygpOwogICAgICAgIGlmIChwdC50IDwgcG0udCkgewogICAgICAgICAgICBpZiAocSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBxLmZyb21JbnQoMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgdGhpcy5jb3B5VG8ocik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAociA9PSBudWxsKSB7CiAgICAgICAgICAgIHIgPSBuYmkoKTsKICAgICAgICB9CiAgICAgICAgdmFyIHkgPSBuYmkoKTsKICAgICAgICB2YXIgdHMgPSB0aGlzLnM7CiAgICAgICAgdmFyIG1zID0gbS5zOwogICAgICAgIHZhciBuc2ggPSB0aGlzLkRCIC0gbmJpdHMocG1bcG0udCAtIDFdKTsgLy8gbm9ybWFsaXplIG1vZHVsdXMKICAgICAgICBpZiAobnNoID4gMCkgewogICAgICAgICAgICBwbS5sU2hpZnRUbyhuc2gsIHkpOwogICAgICAgICAgICBwdC5sU2hpZnRUbyhuc2gsIHIpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcG0uY29weVRvKHkpOwogICAgICAgICAgICBwdC5jb3B5VG8ocik7CiAgICAgICAgfQogICAgICAgIHZhciB5cyA9IHkudDsKICAgICAgICB2YXIgeTAgPSB5W3lzIC0gMV07CiAgICAgICAgaWYgKHkwID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgeXQgPSB5MCAqICgxIDw8IHRoaXMuRjEpICsgKCh5cyA+IDEpID8geVt5cyAtIDJdID4+IHRoaXMuRjIgOiAwKTsKICAgICAgICB2YXIgZDEgPSB0aGlzLkZWIC8geXQ7CiAgICAgICAgdmFyIGQyID0gKDEgPDwgdGhpcy5GMSkgLyB5dDsKICAgICAgICB2YXIgZSA9IDEgPDwgdGhpcy5GMjsKICAgICAgICB2YXIgaSA9IHIudDsKICAgICAgICB2YXIgaiA9IGkgLSB5czsKICAgICAgICB2YXIgdCA9IChxID09IG51bGwpID8gbmJpKCkgOiBxOwogICAgICAgIHkuZGxTaGlmdFRvKGosIHQpOwogICAgICAgIGlmIChyLmNvbXBhcmVUbyh0KSA+PSAwKSB7CiAgICAgICAgICAgIHJbci50KytdID0gMTsKICAgICAgICAgICAgci5zdWJUbyh0LCByKTsKICAgICAgICB9CiAgICAgICAgQmlnSW50ZWdlci5PTkUuZGxTaGlmdFRvKHlzLCB0KTsKICAgICAgICB0LnN1YlRvKHksIHkpOyAvLyAibmVnYXRpdmUiIHkgc28gd2UgY2FuIHJlcGxhY2Ugc3ViIHdpdGggYW0gbGF0ZXIKICAgICAgICB3aGlsZSAoeS50IDwgeXMpIHsKICAgICAgICAgICAgeVt5LnQrK10gPSAwOwogICAgICAgIH0KICAgICAgICB3aGlsZSAoLS1qID49IDApIHsKICAgICAgICAgICAgLy8gRXN0aW1hdGUgcXVvdGllbnQgZGlnaXQKICAgICAgICAgICAgdmFyIHFkID0gKHJbLS1pXSA9PSB5MCkgPyB0aGlzLkRNIDogTWF0aC5mbG9vcihyW2ldICogZDEgKyAocltpIC0gMV0gKyBlKSAqIGQyKTsKICAgICAgICAgICAgaWYgKChyW2ldICs9IHkuYW0oMCwgcWQsIHIsIGosIDAsIHlzKSkgPCBxZCkgeyAvLyBUcnkgaXQgb3V0CiAgICAgICAgICAgICAgICB5LmRsU2hpZnRUbyhqLCB0KTsKICAgICAgICAgICAgICAgIHIuc3ViVG8odCwgcik7CiAgICAgICAgICAgICAgICB3aGlsZSAocltpXSA8IC0tcWQpIHsKICAgICAgICAgICAgICAgICAgICByLnN1YlRvKHQsIHIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChxICE9IG51bGwpIHsKICAgICAgICAgICAgci5kclNoaWZ0VG8oeXMsIHEpOwogICAgICAgICAgICBpZiAodHMgIT0gbXMpIHsKICAgICAgICAgICAgICAgIEJpZ0ludGVnZXIuWkVSTy5zdWJUbyhxLCBxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByLnQgPSB5czsKICAgICAgICByLmNsYW1wKCk7CiAgICAgICAgaWYgKG5zaCA+IDApIHsKICAgICAgICAgICAgci5yU2hpZnRUbyhuc2gsIHIpOwogICAgICAgIH0gLy8gRGVub3JtYWxpemUgcmVtYWluZGVyCiAgICAgICAgaWYgKHRzIDwgMCkgewogICAgICAgICAgICBCaWdJbnRlZ2VyLlpFUk8uc3ViVG8ociwgcik7CiAgICAgICAgfQogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLmludkRpZ2l0ID0gYm5wSW52RGlnaXQ7CiAgICAvLyAocHJvdGVjdGVkKSByZXR1cm4gIi0xL3RoaXMgJSAyXkRCIjsgdXNlZnVsIGZvciBNb250LiByZWR1Y3Rpb24KICAgIC8vIGp1c3RpZmljYXRpb246CiAgICAvLyAgICAgICAgIHh5ID09IDEgKG1vZCBtKQogICAgLy8gICAgICAgICB4eSA9ICAxK2ttCiAgICAvLyAgIHh5KDIteHkpID0gKDEra20pKDEta20pCiAgICAvLyB4W3koMi14eSldID0gMS1rXjJtXjIKICAgIC8vIHhbeSgyLXh5KV0gPT0gMSAobW9kIG1eMikKICAgIC8vIGlmIHkgaXMgMS94IG1vZCBtLCB0aGVuIHkoMi14eSkgaXMgMS94IG1vZCBtXjIKICAgIC8vIHNob3VsZCByZWR1Y2UgeCBhbmQgeSgyLXh5KSBieSBtXjIgYXQgZWFjaCBzdGVwIHRvIGtlZXAgc2l6ZSBib3VuZGVkLgogICAgLy8gSlMgbXVsdGlwbHkgIm92ZXJmbG93cyIgZGlmZmVyZW50bHkgZnJvbSBDL0MrKywgc28gY2FyZSBpcyBuZWVkZWQgaGVyZS4KICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLmludkRpZ2l0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0aGlzLnQgPCAxKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICB2YXIgeCA9IHRoaXNbMF07CiAgICAgICAgaWYgKCh4ICYgMSkgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgdmFyIHkgPSB4ICYgMzsgLy8geSA9PSAxL3ggbW9kIDJeMgogICAgICAgIHkgPSAoeSAqICgyIC0gKHggJiAweGYpICogeSkpICYgMHhmOyAvLyB5ID09IDEveCBtb2QgMl40CiAgICAgICAgeSA9ICh5ICogKDIgLSAoeCAmIDB4ZmYpICogeSkpICYgMHhmZjsgLy8geSA9PSAxL3ggbW9kIDJeOAogICAgICAgIHkgPSAoeSAqICgyIC0gKCgoeCAmIDB4ZmZmZikgKiB5KSAmIDB4ZmZmZikpKSAmIDB4ZmZmZjsgLy8geSA9PSAxL3ggbW9kIDJeMTYKICAgICAgICAvLyBsYXN0IHN0ZXAgLSBjYWxjdWxhdGUgaW52ZXJzZSBtb2QgRFYgZGlyZWN0bHk7CiAgICAgICAgLy8gYXNzdW1lcyAxNiA8IERCIDw9IDMyIGFuZCBhc3N1bWVzIGFiaWxpdHkgdG8gaGFuZGxlIDQ4LWJpdCBpbnRzCiAgICAgICAgeSA9ICh5ICogKDIgLSB4ICogeSAlIHRoaXMuRFYpKSAlIHRoaXMuRFY7IC8vIHkgPT0gMS94IG1vZCAyXmRiaXRzCiAgICAgICAgLy8gd2UgcmVhbGx5IHdhbnQgdGhlIG5lZ2F0aXZlIGludmVyc2UsIGFuZCAtRFYgPCB5IDwgRFYKICAgICAgICByZXR1cm4gKHkgPiAwKSA/IHRoaXMuRFYgLSB5IDogLXk7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuaXNFdmVuID0gYm5wSXNFdmVuOwogICAgLy8gKHByb3RlY3RlZCkgdHJ1ZSBpZmYgdGhpcyBpcyBldmVuCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5pc0V2ZW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICgodGhpcy50ID4gMCkgPyAodGhpc1swXSAmIDEpIDogdGhpcy5zKSA9PSAwOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLmV4cCA9IGJucEV4cDsKICAgIC8vIChwcm90ZWN0ZWQpIHRoaXNeZSwgZSA8IDJeMzIsIGRvaW5nIHNxciBhbmQgbXVsIHdpdGggInIiIChIQUMgMTQuNzkpCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5leHAgPSBmdW5jdGlvbiAoZSwgeikgewogICAgICAgIGlmIChlID4gMHhmZmZmZmZmZiB8fCBlIDwgMSkgewogICAgICAgICAgICByZXR1cm4gQmlnSW50ZWdlci5PTkU7CiAgICAgICAgfQogICAgICAgIHZhciByID0gbmJpKCk7CiAgICAgICAgdmFyIHIyID0gbmJpKCk7CiAgICAgICAgdmFyIGcgPSB6LmNvbnZlcnQodGhpcyk7CiAgICAgICAgdmFyIGkgPSBuYml0cyhlKSAtIDE7CiAgICAgICAgZy5jb3B5VG8ocik7CiAgICAgICAgd2hpbGUgKC0taSA+PSAwKSB7CiAgICAgICAgICAgIHouc3FyVG8ociwgcjIpOwogICAgICAgICAgICBpZiAoKGUgJiAoMSA8PCBpKSkgPiAwKSB7CiAgICAgICAgICAgICAgICB6Lm11bFRvKHIyLCBnLCByKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gcjsKICAgICAgICAgICAgICAgIHIgPSByMjsKICAgICAgICAgICAgICAgIHIyID0gdDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gei5yZXZlcnQocik7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuY2h1bmtTaXplID0gYm5wQ2h1bmtTaXplOwogICAgLy8gKHByb3RlY3RlZCkgcmV0dXJuIHggcy50LiByXnggPCBEVgogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuY2h1bmtTaXplID0gZnVuY3Rpb24gKHIpIHsKICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLkxOMiAqIHRoaXMuREIgLyBNYXRoLmxvZyhyKSk7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUudG9SYWRpeCA9IGJucFRvUmFkaXg7CiAgICAvLyAocHJvdGVjdGVkKSBjb252ZXJ0IHRvIHJhZGl4IHN0cmluZwogICAgQmlnSW50ZWdlci5wcm90b3R5cGUudG9SYWRpeCA9IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgaWYgKGIgPT0gbnVsbCkgewogICAgICAgICAgICBiID0gMTA7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnNpZ251bSgpID09IDAgfHwgYiA8IDIgfHwgYiA+IDM2KSB7CiAgICAgICAgICAgIHJldHVybiAiMCI7CiAgICAgICAgfQogICAgICAgIHZhciBjcyA9IHRoaXMuY2h1bmtTaXplKGIpOwogICAgICAgIHZhciBhID0gTWF0aC5wb3coYiwgY3MpOwogICAgICAgIHZhciBkID0gbmJ2KGEpOwogICAgICAgIHZhciB5ID0gbmJpKCk7CiAgICAgICAgdmFyIHogPSBuYmkoKTsKICAgICAgICB2YXIgciA9ICIiOwogICAgICAgIHRoaXMuZGl2UmVtVG8oZCwgeSwgeik7CiAgICAgICAgd2hpbGUgKHkuc2lnbnVtKCkgPiAwKSB7CiAgICAgICAgICAgIHIgPSAoYSArIHouaW50VmFsdWUoKSkudG9TdHJpbmcoYikuc3Vic3RyKDEpICsgcjsKICAgICAgICAgICAgeS5kaXZSZW1UbyhkLCB5LCB6KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHouaW50VmFsdWUoKS50b1N0cmluZyhiKSArIHI7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuZnJvbVJhZGl4ID0gYm5wRnJvbVJhZGl4OwogICAgLy8gKHByb3RlY3RlZCkgY29udmVydCBmcm9tIHJhZGl4IHN0cmluZwogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuZnJvbVJhZGl4ID0gZnVuY3Rpb24gKHMsIGIpIHsKICAgICAgICB0aGlzLmZyb21JbnQoMCk7CiAgICAgICAgaWYgKGIgPT0gbnVsbCkgewogICAgICAgICAgICBiID0gMTA7CiAgICAgICAgfQogICAgICAgIHZhciBjcyA9IHRoaXMuY2h1bmtTaXplKGIpOwogICAgICAgIHZhciBkID0gTWF0aC5wb3coYiwgY3MpOwogICAgICAgIHZhciBtaSA9IGZhbHNlOwogICAgICAgIHZhciBqID0gMDsKICAgICAgICB2YXIgdyA9IDA7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIHZhciB4ID0gaW50QXQocywgaSk7CiAgICAgICAgICAgIGlmICh4IDwgMCkgewogICAgICAgICAgICAgICAgaWYgKHMuY2hhckF0KGkpID09ICItIiAmJiB0aGlzLnNpZ251bSgpID09IDApIHsKICAgICAgICAgICAgICAgICAgICBtaSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3ID0gYiAqIHcgKyB4OwogICAgICAgICAgICBpZiAoKytqID49IGNzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRNdWx0aXBseShkKTsKICAgICAgICAgICAgICAgIHRoaXMuZEFkZE9mZnNldCh3LCAwKTsKICAgICAgICAgICAgICAgIGogPSAwOwogICAgICAgICAgICAgICAgdyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGogPiAwKSB7CiAgICAgICAgICAgIHRoaXMuZE11bHRpcGx5KE1hdGgucG93KGIsIGopKTsKICAgICAgICAgICAgdGhpcy5kQWRkT2Zmc2V0KHcsIDApOwogICAgICAgIH0KICAgICAgICBpZiAobWkpIHsKICAgICAgICAgICAgQmlnSW50ZWdlci5aRVJPLnN1YlRvKHRoaXMsIHRoaXMpOwogICAgICAgIH0KICAgIH07CiAgICAvLyBCaWdJbnRlZ2VyLnByb3RvdHlwZS5mcm9tTnVtYmVyID0gYm5wRnJvbU51bWJlcjsKICAgIC8vIChwcm90ZWN0ZWQpIGFsdGVybmF0ZSBjb25zdHJ1Y3RvcgogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuZnJvbU51bWJlciA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgaWYgKCJudW1iZXIiID09IHR5cGVvZiBiKSB7CiAgICAgICAgICAgIC8vIG5ldyBCaWdJbnRlZ2VyKGludCxpbnQsUk5HKQogICAgICAgICAgICBpZiAoYSA8IDIpIHsKICAgICAgICAgICAgICAgIHRoaXMuZnJvbUludCgxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuZnJvbU51bWJlcihhLCBjKTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy50ZXN0Qml0KGEgLSAxKSkgewogICAgICAgICAgICAgICAgICAgIC8vIGZvcmNlIE1TQiBzZXQKICAgICAgICAgICAgICAgICAgICB0aGlzLmJpdHdpc2VUbyhCaWdJbnRlZ2VyLk9ORS5zaGlmdExlZnQoYSAtIDEpLCBvcF9vciwgdGhpcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0V2ZW4oKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZEFkZE9mZnNldCgxLCAwKTsKICAgICAgICAgICAgICAgIH0gLy8gZm9yY2Ugb2RkCiAgICAgICAgICAgICAgICB3aGlsZSAoIXRoaXMuaXNQcm9iYWJsZVByaW1lKGIpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kQWRkT2Zmc2V0KDIsIDApOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmJpdExlbmd0aCgpID4gYSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN1YlRvKEJpZ0ludGVnZXIuT05FLnNoaWZ0TGVmdChhIC0gMSksIHRoaXMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gbmV3IEJpZ0ludGVnZXIoaW50LFJORykKICAgICAgICAgICAgdmFyIHggPSBbXTsKICAgICAgICAgICAgdmFyIHQgPSBhICYgNzsKICAgICAgICAgICAgeC5sZW5ndGggPSAoYSA+PiAzKSArIDE7CiAgICAgICAgICAgIGIubmV4dEJ5dGVzKHgpOwogICAgICAgICAgICBpZiAodCA+IDApIHsKICAgICAgICAgICAgICAgIHhbMF0gJj0gKCgxIDw8IHQpIC0gMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB4WzBdID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmZyb21TdHJpbmcoeCwgMjU2KTsKICAgICAgICB9CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuYml0d2lzZVRvID0gYm5wQml0d2lzZVRvOwogICAgLy8gKHByb3RlY3RlZCkgciA9IHRoaXMgb3AgYSAoYml0d2lzZSkKICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLmJpdHdpc2VUbyA9IGZ1bmN0aW9uIChhLCBvcCwgcikgewogICAgICAgIHZhciBpOwogICAgICAgIHZhciBmOwogICAgICAgIHZhciBtID0gTWF0aC5taW4oYS50LCB0aGlzLnQpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBtOyArK2kpIHsKICAgICAgICAgICAgcltpXSA9IG9wKHRoaXNbaV0sIGFbaV0pOwogICAgICAgIH0KICAgICAgICBpZiAoYS50IDwgdGhpcy50KSB7CiAgICAgICAgICAgIGYgPSBhLnMgJiB0aGlzLkRNOwogICAgICAgICAgICBmb3IgKGkgPSBtOyBpIDwgdGhpcy50OyArK2kpIHsKICAgICAgICAgICAgICAgIHJbaV0gPSBvcCh0aGlzW2ldLCBmKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByLnQgPSB0aGlzLnQ7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBmID0gdGhpcy5zICYgdGhpcy5ETTsKICAgICAgICAgICAgZm9yIChpID0gbTsgaSA8IGEudDsgKytpKSB7CiAgICAgICAgICAgICAgICByW2ldID0gb3AoZiwgYVtpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgci50ID0gYS50OwogICAgICAgIH0KICAgICAgICByLnMgPSBvcCh0aGlzLnMsIGEucyk7CiAgICAgICAgci5jbGFtcCgpOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLmNoYW5nZUJpdCA9IGJucENoYW5nZUJpdDsKICAgIC8vIChwcm90ZWN0ZWQpIHRoaXMgb3AgKDE8PG4pCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5jaGFuZ2VCaXQgPSBmdW5jdGlvbiAobiwgb3ApIHsKICAgICAgICB2YXIgciA9IEJpZ0ludGVnZXIuT05FLnNoaWZ0TGVmdChuKTsKICAgICAgICB0aGlzLmJpdHdpc2VUbyhyLCBvcCwgcik7CiAgICAgICAgcmV0dXJuIHI7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuYWRkVG8gPSBibnBBZGRUbzsKICAgIC8vIChwcm90ZWN0ZWQpIHIgPSB0aGlzICsgYQogICAgQmlnSW50ZWdlci5wcm90b3R5cGUuYWRkVG8gPSBmdW5jdGlvbiAoYSwgcikgewogICAgICAgIHZhciBpID0gMDsKICAgICAgICB2YXIgYyA9IDA7CiAgICAgICAgdmFyIG0gPSBNYXRoLm1pbihhLnQsIHRoaXMudCk7CiAgICAgICAgd2hpbGUgKGkgPCBtKSB7CiAgICAgICAgICAgIGMgKz0gdGhpc1tpXSArIGFbaV07CiAgICAgICAgICAgIHJbaSsrXSA9IGMgJiB0aGlzLkRNOwogICAgICAgICAgICBjID4+PSB0aGlzLkRCOwogICAgICAgIH0KICAgICAgICBpZiAoYS50IDwgdGhpcy50KSB7CiAgICAgICAgICAgIGMgKz0gYS5zOwogICAgICAgICAgICB3aGlsZSAoaSA8IHRoaXMudCkgewogICAgICAgICAgICAgICAgYyArPSB0aGlzW2ldOwogICAgICAgICAgICAgICAgcltpKytdID0gYyAmIHRoaXMuRE07CiAgICAgICAgICAgICAgICBjID4+PSB0aGlzLkRCOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGMgKz0gdGhpcy5zOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgYyArPSB0aGlzLnM7CiAgICAgICAgICAgIHdoaWxlIChpIDwgYS50KSB7CiAgICAgICAgICAgICAgICBjICs9IGFbaV07CiAgICAgICAgICAgICAgICByW2krK10gPSBjICYgdGhpcy5ETTsKICAgICAgICAgICAgICAgIGMgPj49IHRoaXMuREI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYyArPSBhLnM7CiAgICAgICAgfQogICAgICAgIHIucyA9IChjIDwgMCkgPyAtMSA6IDA7CiAgICAgICAgaWYgKGMgPiAwKSB7CiAgICAgICAgICAgIHJbaSsrXSA9IGM7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGMgPCAtMSkgewogICAgICAgICAgICByW2krK10gPSB0aGlzLkRWICsgYzsKICAgICAgICB9CiAgICAgICAgci50ID0gaTsKICAgICAgICByLmNsYW1wKCk7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuZE11bHRpcGx5ID0gYm5wRE11bHRpcGx5OwogICAgLy8gKHByb3RlY3RlZCkgdGhpcyAqPSBuLCB0aGlzID49IDAsIDEgPCBuIDwgRFYKICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLmRNdWx0aXBseSA9IGZ1bmN0aW9uIChuKSB7CiAgICAgICAgdGhpc1t0aGlzLnRdID0gdGhpcy5hbSgwLCBuIC0gMSwgdGhpcywgMCwgMCwgdGhpcy50KTsKICAgICAgICArK3RoaXMudDsKICAgICAgICB0aGlzLmNsYW1wKCk7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUuZEFkZE9mZnNldCA9IGJucERBZGRPZmZzZXQ7CiAgICAvLyAocHJvdGVjdGVkKSB0aGlzICs9IG4gPDwgdyB3b3JkcywgdGhpcyA+PSAwCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5kQWRkT2Zmc2V0ID0gZnVuY3Rpb24gKG4sIHcpIHsKICAgICAgICBpZiAobiA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgd2hpbGUgKHRoaXMudCA8PSB3KSB7CiAgICAgICAgICAgIHRoaXNbdGhpcy50KytdID0gMDsKICAgICAgICB9CiAgICAgICAgdGhpc1t3XSArPSBuOwogICAgICAgIHdoaWxlICh0aGlzW3ddID49IHRoaXMuRFYpIHsKICAgICAgICAgICAgdGhpc1t3XSAtPSB0aGlzLkRWOwogICAgICAgICAgICBpZiAoKyt3ID49IHRoaXMudCkgewogICAgICAgICAgICAgICAgdGhpc1t0aGlzLnQrK10gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgICsrdGhpc1t3XTsKICAgICAgICB9CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUubXVsdGlwbHlMb3dlclRvID0gYm5wTXVsdGlwbHlMb3dlclRvOwogICAgLy8gKHByb3RlY3RlZCkgciA9IGxvd2VyIG4gd29yZHMgb2YgInRoaXMgKiBhIiwgYS50IDw9IG4KICAgIC8vICJ0aGlzIiBzaG91bGQgYmUgdGhlIGxhcmdlciBvbmUgaWYgYXBwcm9wcmlhdGUuCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5tdWx0aXBseUxvd2VyVG8gPSBmdW5jdGlvbiAoYSwgbiwgcikgewogICAgICAgIHZhciBpID0gTWF0aC5taW4odGhpcy50ICsgYS50LCBuKTsKICAgICAgICByLnMgPSAwOyAvLyBhc3N1bWVzIGEsdGhpcyA+PSAwCiAgICAgICAgci50ID0gaTsKICAgICAgICB3aGlsZSAoaSA+IDApIHsKICAgICAgICAgICAgclstLWldID0gMDsKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaiA9IHIudCAtIHRoaXMudDsgaSA8IGo7ICsraSkgewogICAgICAgICAgICByW2kgKyB0aGlzLnRdID0gdGhpcy5hbSgwLCBhW2ldLCByLCBpLCAwLCB0aGlzLnQpOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBqID0gTWF0aC5taW4oYS50LCBuKTsgaSA8IGo7ICsraSkgewogICAgICAgICAgICB0aGlzLmFtKDAsIGFbaV0sIHIsIGksIDAsIG4gLSBpKTsKICAgICAgICB9CiAgICAgICAgci5jbGFtcCgpOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLm11bHRpcGx5VXBwZXJUbyA9IGJucE11bHRpcGx5VXBwZXJUbzsKICAgIC8vIChwcm90ZWN0ZWQpIHIgPSAidGhpcyAqIGEiIHdpdGhvdXQgbG93ZXIgbiB3b3JkcywgbiA+IDAKICAgIC8vICJ0aGlzIiBzaG91bGQgYmUgdGhlIGxhcmdlciBvbmUgaWYgYXBwcm9wcmlhdGUuCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5tdWx0aXBseVVwcGVyVG8gPSBmdW5jdGlvbiAoYSwgbiwgcikgewogICAgICAgIC0tbjsKICAgICAgICB2YXIgaSA9IHIudCA9IHRoaXMudCArIGEudCAtIG47CiAgICAgICAgci5zID0gMDsgLy8gYXNzdW1lcyBhLHRoaXMgPj0gMAogICAgICAgIHdoaWxlICgtLWkgPj0gMCkgewogICAgICAgICAgICByW2ldID0gMDsKICAgICAgICB9CiAgICAgICAgZm9yIChpID0gTWF0aC5tYXgobiAtIHRoaXMudCwgMCk7IGkgPCBhLnQ7ICsraSkgewogICAgICAgICAgICByW3RoaXMudCArIGkgLSBuXSA9IHRoaXMuYW0obiAtIGksIGFbaV0sIHIsIDAsIDAsIHRoaXMudCArIGkgLSBuKTsKICAgICAgICB9CiAgICAgICAgci5jbGFtcCgpOwogICAgICAgIHIuZHJTaGlmdFRvKDEsIHIpOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLm1vZEludCA9IGJucE1vZEludDsKICAgIC8vIChwcm90ZWN0ZWQpIHRoaXMgJSBuLCBuIDwgMl4yNgogICAgQmlnSW50ZWdlci5wcm90b3R5cGUubW9kSW50ID0gZnVuY3Rpb24gKG4pIHsKICAgICAgICBpZiAobiA8PSAwKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICB2YXIgZCA9IHRoaXMuRFYgJSBuOwogICAgICAgIHZhciByID0gKHRoaXMucyA8IDApID8gbiAtIDEgOiAwOwogICAgICAgIGlmICh0aGlzLnQgPiAwKSB7CiAgICAgICAgICAgIGlmIChkID09IDApIHsKICAgICAgICAgICAgICAgIHIgPSB0aGlzWzBdICUgbjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnQgLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgICAgICAgICAgIHIgPSAoZCAqIHIgKyB0aGlzW2ldKSAlIG47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHI7CiAgICB9OwogICAgLy8gQmlnSW50ZWdlci5wcm90b3R5cGUubWlsbGVyUmFiaW4gPSBibnBNaWxsZXJSYWJpbjsKICAgIC8vIChwcm90ZWN0ZWQpIHRydWUgaWYgcHJvYmFibHkgcHJpbWUgKEhBQyA0LjI0LCBNaWxsZXItUmFiaW4pCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5taWxsZXJSYWJpbiA9IGZ1bmN0aW9uICh0KSB7CiAgICAgICAgdmFyIG4xID0gdGhpcy5zdWJ0cmFjdChCaWdJbnRlZ2VyLk9ORSk7CiAgICAgICAgdmFyIGsgPSBuMS5nZXRMb3dlc3RTZXRCaXQoKTsKICAgICAgICBpZiAoayA8PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdmFyIHIgPSBuMS5zaGlmdFJpZ2h0KGspOwogICAgICAgIHQgPSAodCArIDEpID4+IDE7CiAgICAgICAgaWYgKHQgPiBsb3dwcmltZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHQgPSBsb3dwcmltZXMubGVuZ3RoOwogICAgICAgIH0KICAgICAgICB2YXIgYSA9IG5iaSgpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdDsgKytpKSB7CiAgICAgICAgICAgIC8vIFBpY2sgYmFzZXMgYXQgcmFuZG9tLCBpbnN0ZWFkIG9mIHN0YXJ0aW5nIGF0IDIKICAgICAgICAgICAgYS5mcm9tSW50KGxvd3ByaW1lc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBsb3dwcmltZXMubGVuZ3RoKV0pOwogICAgICAgICAgICB2YXIgeSA9IGEubW9kUG93KHIsIHRoaXMpOwogICAgICAgICAgICBpZiAoeS5jb21wYXJlVG8oQmlnSW50ZWdlci5PTkUpICE9IDAgJiYgeS5jb21wYXJlVG8objEpICE9IDApIHsKICAgICAgICAgICAgICAgIHZhciBqID0gMTsKICAgICAgICAgICAgICAgIHdoaWxlIChqKysgPCBrICYmIHkuY29tcGFyZVRvKG4xKSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgeSA9IHkubW9kUG93SW50KDIsIHRoaXMpOwogICAgICAgICAgICAgICAgICAgIGlmICh5LmNvbXBhcmVUbyhCaWdJbnRlZ2VyLk9ORSkgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHkuY29tcGFyZVRvKG4xKSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfTsKICAgIC8vIEJpZ0ludGVnZXIucHJvdG90eXBlLnNxdWFyZSA9IGJuU3F1YXJlOwogICAgLy8gKHB1YmxpYykgdGhpc14yCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5zcXVhcmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHIgPSBuYmkoKTsKICAgICAgICB0aGlzLnNxdWFyZVRvKHIpOwogICAgICAgIHJldHVybiByOwogICAgfTsKICAgIC8vI3JlZ2lvbiBBU1lOQwogICAgLy8gUHVibGljIEFQSSBtZXRob2QKICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLmdjZGEgPSBmdW5jdGlvbiAoYSwgY2FsbGJhY2spIHsKICAgICAgICB2YXIgeCA9ICh0aGlzLnMgPCAwKSA/IHRoaXMubmVnYXRlKCkgOiB0aGlzLmNsb25lKCk7CiAgICAgICAgdmFyIHkgPSAoYS5zIDwgMCkgPyBhLm5lZ2F0ZSgpIDogYS5jbG9uZSgpOwogICAgICAgIGlmICh4LmNvbXBhcmVUbyh5KSA8IDApIHsKICAgICAgICAgICAgdmFyIHQgPSB4OwogICAgICAgICAgICB4ID0geTsKICAgICAgICAgICAgeSA9IHQ7CiAgICAgICAgfQogICAgICAgIHZhciBpID0geC5nZXRMb3dlc3RTZXRCaXQoKTsKICAgICAgICB2YXIgZyA9IHkuZ2V0TG93ZXN0U2V0Qml0KCk7CiAgICAgICAgaWYgKGcgPCAwKSB7CiAgICAgICAgICAgIGNhbGxiYWNrKHgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChpIDwgZykgewogICAgICAgICAgICBnID0gaTsKICAgICAgICB9CiAgICAgICAgaWYgKGcgPiAwKSB7CiAgICAgICAgICAgIHguclNoaWZ0VG8oZywgeCk7CiAgICAgICAgICAgIHkuclNoaWZ0VG8oZywgeSk7CiAgICAgICAgfQogICAgICAgIC8vIFdvcmtob3JzZSBvZiB0aGUgYWxnb3JpdGhtLCBnZXRzIGNhbGxlZCAyMDAgLSA4MDAgdGltZXMgcGVyIDUxMiBiaXQga2V5Z2VuLgogICAgICAgIHZhciBnY2RhMSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKChpID0geC5nZXRMb3dlc3RTZXRCaXQoKSkgPiAwKSB7CiAgICAgICAgICAgICAgICB4LnJTaGlmdFRvKGksIHgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoaSA9IHkuZ2V0TG93ZXN0U2V0Qml0KCkpID4gMCkgewogICAgICAgICAgICAgICAgeS5yU2hpZnRUbyhpLCB5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoeC5jb21wYXJlVG8oeSkgPj0gMCkgewogICAgICAgICAgICAgICAgeC5zdWJUbyh5LCB4KTsKICAgICAgICAgICAgICAgIHguclNoaWZ0VG8oMSwgeCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB5LnN1YlRvKHgsIHkpOwogICAgICAgICAgICAgICAgeS5yU2hpZnRUbygxLCB5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoISh4LnNpZ251bSgpID4gMCkpIHsKICAgICAgICAgICAgICAgIGlmIChnID4gMCkgewogICAgICAgICAgICAgICAgICAgIHkubFNoaWZ0VG8oZywgeSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgY2FsbGJhY2soeSk7IH0sIDApOyAvLyBlc2NhcGUKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZ2NkYTEsIDApOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBzZXRUaW1lb3V0KGdjZGExLCAxMCk7CiAgICB9OwogICAgLy8gKHByb3RlY3RlZCkgYWx0ZXJuYXRlIGNvbnN0cnVjdG9yCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5mcm9tTnVtYmVyQXN5bmMgPSBmdW5jdGlvbiAoYSwgYiwgYywgY2FsbGJhY2spIHsKICAgICAgICBpZiAoIm51bWJlciIgPT0gdHlwZW9mIGIpIHsKICAgICAgICAgICAgaWYgKGEgPCAyKSB7CiAgICAgICAgICAgICAgICB0aGlzLmZyb21JbnQoMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmZyb21OdW1iZXIoYSwgYyk7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMudGVzdEJpdChhIC0gMSkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmJpdHdpc2VUbyhCaWdJbnRlZ2VyLk9ORS5zaGlmdExlZnQoYSAtIDEpLCBvcF9vciwgdGhpcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0V2ZW4oKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZEFkZE9mZnNldCgxLCAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBibnBfMSA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgYm5wZm4xXzEgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgYm5wXzEuZEFkZE9mZnNldCgyLCAwKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYm5wXzEuYml0TGVuZ3RoKCkgPiBhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJucF8xLnN1YlRvKEJpZ0ludGVnZXIuT05FLnNoaWZ0TGVmdChhIC0gMSksIGJucF8xKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGJucF8xLmlzUHJvYmFibGVQcmltZShiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgY2FsbGJhY2soKTsgfSwgMCk7IC8vIGVzY2FwZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChibnBmbjFfMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoYm5wZm4xXzEsIDApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgeCA9IFtdOwogICAgICAgICAgICB2YXIgdCA9IGEgJiA3OwogICAgICAgICAgICB4Lmxlbmd0aCA9IChhID4+IDMpICsgMTsKICAgICAgICAgICAgYi5uZXh0Qnl0ZXMoeCk7CiAgICAgICAgICAgIGlmICh0ID4gMCkgewogICAgICAgICAgICAgICAgeFswXSAmPSAoKDEgPDwgdCkgLSAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHhbMF0gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuZnJvbVN0cmluZyh4LCAyNTYpOwogICAgICAgIH0KICAgIH07CiAgICByZXR1cm4gQmlnSW50ZWdlcjsKfSgpKTsKLy8jcmVnaW9uIFJFRFVDRVJTCi8vI3JlZ2lvbiBOdWxsRXhwCnZhciBOdWxsRXhwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gTnVsbEV4cCgpIHsKICAgIH0KICAgIC8vIE51bGxFeHAucHJvdG90eXBlLmNvbnZlcnQgPSBuTm9wOwogICAgTnVsbEV4cC5wcm90b3R5cGUuY29udmVydCA9IGZ1bmN0aW9uICh4KSB7CiAgICAgICAgcmV0dXJuIHg7CiAgICB9OwogICAgLy8gTnVsbEV4cC5wcm90b3R5cGUucmV2ZXJ0ID0gbk5vcDsKICAgIE51bGxFeHAucHJvdG90eXBlLnJldmVydCA9IGZ1bmN0aW9uICh4KSB7CiAgICAgICAgcmV0dXJuIHg7CiAgICB9OwogICAgLy8gTnVsbEV4cC5wcm90b3R5cGUubXVsVG8gPSBuTXVsVG87CiAgICBOdWxsRXhwLnByb3RvdHlwZS5tdWxUbyA9IGZ1bmN0aW9uICh4LCB5LCByKSB7CiAgICAgICAgeC5tdWx0aXBseVRvKHksIHIpOwogICAgfTsKICAgIC8vIE51bGxFeHAucHJvdG90eXBlLnNxclRvID0gblNxclRvOwogICAgTnVsbEV4cC5wcm90b3R5cGUuc3FyVG8gPSBmdW5jdGlvbiAoeCwgcikgewogICAgICAgIHguc3F1YXJlVG8ocik7CiAgICB9OwogICAgcmV0dXJuIE51bGxFeHA7Cn0oKSk7Ci8vIE1vZHVsYXIgcmVkdWN0aW9uIHVzaW5nICJjbGFzc2ljIiBhbGdvcml0aG0KdmFyIENsYXNzaWMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBDbGFzc2ljKG0pIHsKICAgICAgICB0aGlzLm0gPSBtOwogICAgfQogICAgLy8gQ2xhc3NpYy5wcm90b3R5cGUuY29udmVydCA9IGNDb252ZXJ0OwogICAgQ2xhc3NpYy5wcm90b3R5cGUuY29udmVydCA9IGZ1bmN0aW9uICh4KSB7CiAgICAgICAgaWYgKHgucyA8IDAgfHwgeC5jb21wYXJlVG8odGhpcy5tKSA+PSAwKSB7CiAgICAgICAgICAgIHJldHVybiB4Lm1vZCh0aGlzLm0pOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHg7CiAgICAgICAgfQogICAgfTsKICAgIC8vIENsYXNzaWMucHJvdG90eXBlLnJldmVydCA9IGNSZXZlcnQ7CiAgICBDbGFzc2ljLnByb3RvdHlwZS5yZXZlcnQgPSBmdW5jdGlvbiAoeCkgewogICAgICAgIHJldHVybiB4OwogICAgfTsKICAgIC8vIENsYXNzaWMucHJvdG90eXBlLnJlZHVjZSA9IGNSZWR1Y2U7CiAgICBDbGFzc2ljLnByb3RvdHlwZS5yZWR1Y2UgPSBmdW5jdGlvbiAoeCkgewogICAgICAgIHguZGl2UmVtVG8odGhpcy5tLCBudWxsLCB4KTsKICAgIH07CiAgICAvLyBDbGFzc2ljLnByb3RvdHlwZS5tdWxUbyA9IGNNdWxUbzsKICAgIENsYXNzaWMucHJvdG90eXBlLm11bFRvID0gZnVuY3Rpb24gKHgsIHksIHIpIHsKICAgICAgICB4Lm11bHRpcGx5VG8oeSwgcik7CiAgICAgICAgdGhpcy5yZWR1Y2Uocik7CiAgICB9OwogICAgLy8gQ2xhc3NpYy5wcm90b3R5cGUuc3FyVG8gPSBjU3FyVG87CiAgICBDbGFzc2ljLnByb3RvdHlwZS5zcXJUbyA9IGZ1bmN0aW9uICh4LCByKSB7CiAgICAgICAgeC5zcXVhcmVUbyhyKTsKICAgICAgICB0aGlzLnJlZHVjZShyKTsKICAgIH07CiAgICByZXR1cm4gQ2xhc3NpYzsKfSgpKTsKLy8jZW5kcmVnaW9uCi8vI3JlZ2lvbiBNb250Z29tZXJ5Ci8vIE1vbnRnb21lcnkgcmVkdWN0aW9uCnZhciBNb250Z29tZXJ5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gTW9udGdvbWVyeShtKSB7CiAgICAgICAgdGhpcy5tID0gbTsKICAgICAgICB0aGlzLm1wID0gbS5pbnZEaWdpdCgpOwogICAgICAgIHRoaXMubXBsID0gdGhpcy5tcCAmIDB4N2ZmZjsKICAgICAgICB0aGlzLm1waCA9IHRoaXMubXAgPj4gMTU7CiAgICAgICAgdGhpcy51bSA9ICgxIDw8IChtLkRCIC0gMTUpKSAtIDE7CiAgICAgICAgdGhpcy5tdDIgPSAyICogbS50OwogICAgfQogICAgLy8gTW9udGdvbWVyeS5wcm90b3R5cGUuY29udmVydCA9IG1vbnRDb252ZXJ0OwogICAgLy8geFIgbW9kIG0KICAgIE1vbnRnb21lcnkucHJvdG90eXBlLmNvbnZlcnQgPSBmdW5jdGlvbiAoeCkgewogICAgICAgIHZhciByID0gbmJpKCk7CiAgICAgICAgeC5hYnMoKS5kbFNoaWZ0VG8odGhpcy5tLnQsIHIpOwogICAgICAgIHIuZGl2UmVtVG8odGhpcy5tLCBudWxsLCByKTsKICAgICAgICBpZiAoeC5zIDwgMCAmJiByLmNvbXBhcmVUbyhCaWdJbnRlZ2VyLlpFUk8pID4gMCkgewogICAgICAgICAgICB0aGlzLm0uc3ViVG8ociwgcik7CiAgICAgICAgfQogICAgICAgIHJldHVybiByOwogICAgfTsKICAgIC8vIE1vbnRnb21lcnkucHJvdG90eXBlLnJldmVydCA9IG1vbnRSZXZlcnQ7CiAgICAvLyB4L1IgbW9kIG0KICAgIE1vbnRnb21lcnkucHJvdG90eXBlLnJldmVydCA9IGZ1bmN0aW9uICh4KSB7CiAgICAgICAgdmFyIHIgPSBuYmkoKTsKICAgICAgICB4LmNvcHlUbyhyKTsKICAgICAgICB0aGlzLnJlZHVjZShyKTsKICAgICAgICByZXR1cm4gcjsKICAgIH07CiAgICAvLyBNb250Z29tZXJ5LnByb3RvdHlwZS5yZWR1Y2UgPSBtb250UmVkdWNlOwogICAgLy8geCA9IHgvUiBtb2QgbSAoSEFDIDE0LjMyKQogICAgTW9udGdvbWVyeS5wcm90b3R5cGUucmVkdWNlID0gZnVuY3Rpb24gKHgpIHsKICAgICAgICB3aGlsZSAoeC50IDw9IHRoaXMubXQyKSB7CiAgICAgICAgICAgIC8vIHBhZCB4IHNvIGFtIGhhcyBlbm91Z2ggcm9vbSBsYXRlcgogICAgICAgICAgICB4W3gudCsrXSA9IDA7CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tLnQ7ICsraSkgewogICAgICAgICAgICAvLyBmYXN0ZXIgd2F5IG9mIGNhbGN1bGF0aW5nIHUwID0geFtpXSptcCBtb2QgRFYKICAgICAgICAgICAgdmFyIGogPSB4W2ldICYgMHg3ZmZmOwogICAgICAgICAgICB2YXIgdTAgPSAoaiAqIHRoaXMubXBsICsgKCgoaiAqIHRoaXMubXBoICsgKHhbaV0gPj4gMTUpICogdGhpcy5tcGwpICYgdGhpcy51bSkgPDwgMTUpKSAmIHguRE07CiAgICAgICAgICAgIC8vIHVzZSBhbSB0byBjb21iaW5lIHRoZSBtdWx0aXBseS1zaGlmdC1hZGQgaW50byBvbmUgY2FsbAogICAgICAgICAgICBqID0gaSArIHRoaXMubS50OwogICAgICAgICAgICB4W2pdICs9IHRoaXMubS5hbSgwLCB1MCwgeCwgaSwgMCwgdGhpcy5tLnQpOwogICAgICAgICAgICAvLyBwcm9wYWdhdGUgY2FycnkKICAgICAgICAgICAgd2hpbGUgKHhbal0gPj0geC5EVikgewogICAgICAgICAgICAgICAgeFtqXSAtPSB4LkRWOwogICAgICAgICAgICAgICAgeFsrK2pdKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgeC5jbGFtcCgpOwogICAgICAgIHguZHJTaGlmdFRvKHRoaXMubS50LCB4KTsKICAgICAgICBpZiAoeC5jb21wYXJlVG8odGhpcy5tKSA+PSAwKSB7CiAgICAgICAgICAgIHguc3ViVG8odGhpcy5tLCB4KTsKICAgICAgICB9CiAgICB9OwogICAgLy8gTW9udGdvbWVyeS5wcm90b3R5cGUubXVsVG8gPSBtb250TXVsVG87CiAgICAvLyByID0gInh5L1IgbW9kIG0iOyB4LHkgIT0gcgogICAgTW9udGdvbWVyeS5wcm90b3R5cGUubXVsVG8gPSBmdW5jdGlvbiAoeCwgeSwgcikgewogICAgICAgIHgubXVsdGlwbHlUbyh5LCByKTsKICAgICAgICB0aGlzLnJlZHVjZShyKTsKICAgIH07CiAgICAvLyBNb250Z29tZXJ5LnByb3RvdHlwZS5zcXJUbyA9IG1vbnRTcXJUbzsKICAgIC8vIHIgPSAieF4yL1IgbW9kIG0iOyB4ICE9IHIKICAgIE1vbnRnb21lcnkucHJvdG90eXBlLnNxclRvID0gZnVuY3Rpb24gKHgsIHIpIHsKICAgICAgICB4LnNxdWFyZVRvKHIpOwogICAgICAgIHRoaXMucmVkdWNlKHIpOwogICAgfTsKICAgIHJldHVybiBNb250Z29tZXJ5Owp9KCkpOwovLyNlbmRyZWdpb24gTW9udGdvbWVyeQovLyNyZWdpb24gQmFycmV0dAovLyBCYXJyZXR0IG1vZHVsYXIgcmVkdWN0aW9uCnZhciBCYXJyZXR0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gQmFycmV0dChtKSB7CiAgICAgICAgdGhpcy5tID0gbTsKICAgICAgICAvLyBzZXR1cCBCYXJyZXR0CiAgICAgICAgdGhpcy5yMiA9IG5iaSgpOwogICAgICAgIHRoaXMucTMgPSBuYmkoKTsKICAgICAgICBCaWdJbnRlZ2VyLk9ORS5kbFNoaWZ0VG8oMiAqIG0udCwgdGhpcy5yMik7CiAgICAgICAgdGhpcy5tdSA9IHRoaXMucjIuZGl2aWRlKG0pOwogICAgfQogICAgLy8gQmFycmV0dC5wcm90b3R5cGUuY29udmVydCA9IGJhcnJldHRDb252ZXJ0OwogICAgQmFycmV0dC5wcm90b3R5cGUuY29udmVydCA9IGZ1bmN0aW9uICh4KSB7CiAgICAgICAgaWYgKHgucyA8IDAgfHwgeC50ID4gMiAqIHRoaXMubS50KSB7CiAgICAgICAgICAgIHJldHVybiB4Lm1vZCh0aGlzLm0pOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICh4LmNvbXBhcmVUbyh0aGlzLm0pIDwgMCkgewogICAgICAgICAgICByZXR1cm4geDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciByID0gbmJpKCk7CiAgICAgICAgICAgIHguY29weVRvKHIpOwogICAgICAgICAgICB0aGlzLnJlZHVjZShyKTsKICAgICAgICAgICAgcmV0dXJuIHI7CiAgICAgICAgfQogICAgfTsKICAgIC8vIEJhcnJldHQucHJvdG90eXBlLnJldmVydCA9IGJhcnJldHRSZXZlcnQ7CiAgICBCYXJyZXR0LnByb3RvdHlwZS5yZXZlcnQgPSBmdW5jdGlvbiAoeCkgewogICAgICAgIHJldHVybiB4OwogICAgfTsKICAgIC8vIEJhcnJldHQucHJvdG90eXBlLnJlZHVjZSA9IGJhcnJldHRSZWR1Y2U7CiAgICAvLyB4ID0geCBtb2QgbSAoSEFDIDE0LjQyKQogICAgQmFycmV0dC5wcm90b3R5cGUucmVkdWNlID0gZnVuY3Rpb24gKHgpIHsKICAgICAgICB4LmRyU2hpZnRUbyh0aGlzLm0udCAtIDEsIHRoaXMucjIpOwogICAgICAgIGlmICh4LnQgPiB0aGlzLm0udCArIDEpIHsKICAgICAgICAgICAgeC50ID0gdGhpcy5tLnQgKyAxOwogICAgICAgICAgICB4LmNsYW1wKCk7CiAgICAgICAgfQogICAgICAgIHRoaXMubXUubXVsdGlwbHlVcHBlclRvKHRoaXMucjIsIHRoaXMubS50ICsgMSwgdGhpcy5xMyk7CiAgICAgICAgdGhpcy5tLm11bHRpcGx5TG93ZXJUbyh0aGlzLnEzLCB0aGlzLm0udCArIDEsIHRoaXMucjIpOwogICAgICAgIHdoaWxlICh4LmNvbXBhcmVUbyh0aGlzLnIyKSA8IDApIHsKICAgICAgICAgICAgeC5kQWRkT2Zmc2V0KDEsIHRoaXMubS50ICsgMSk7CiAgICAgICAgfQogICAgICAgIHguc3ViVG8odGhpcy5yMiwgeCk7CiAgICAgICAgd2hpbGUgKHguY29tcGFyZVRvKHRoaXMubSkgPj0gMCkgewogICAgICAgICAgICB4LnN1YlRvKHRoaXMubSwgeCk7CiAgICAgICAgfQogICAgfTsKICAgIC8vIEJhcnJldHQucHJvdG90eXBlLm11bFRvID0gYmFycmV0dE11bFRvOwogICAgLy8gciA9IHgqeSBtb2QgbTsgeCx5ICE9IHIKICAgIEJhcnJldHQucHJvdG90eXBlLm11bFRvID0gZnVuY3Rpb24gKHgsIHksIHIpIHsKICAgICAgICB4Lm11bHRpcGx5VG8oeSwgcik7CiAgICAgICAgdGhpcy5yZWR1Y2Uocik7CiAgICB9OwogICAgLy8gQmFycmV0dC5wcm90b3R5cGUuc3FyVG8gPSBiYXJyZXR0U3FyVG87CiAgICAvLyByID0geF4yIG1vZCBtOyB4ICE9IHIKICAgIEJhcnJldHQucHJvdG90eXBlLnNxclRvID0gZnVuY3Rpb24gKHgsIHIpIHsKICAgICAgICB4LnNxdWFyZVRvKHIpOwogICAgICAgIHRoaXMucmVkdWNlKHIpOwogICAgfTsKICAgIHJldHVybiBCYXJyZXR0Owp9KCkpOwovLyNlbmRyZWdpb24KLy8jZW5kcmVnaW9uIFJFRFVDRVJTCi8vIHJldHVybiBuZXcsIHVuc2V0IEJpZ0ludGVnZXIKZnVuY3Rpb24gbmJpKCkgeyByZXR1cm4gbmV3IEJpZ0ludGVnZXIobnVsbCk7IH0KZnVuY3Rpb24gcGFyc2VCaWdJbnQoc3RyLCByKSB7CiAgICByZXR1cm4gbmV3IEJpZ0ludGVnZXIoc3RyLCByKTsKfQovLyBhbTogQ29tcHV0ZSB3X2ogKz0gKHgqdGhpc19pKSwgcHJvcGFnYXRlIGNhcnJpZXMsCi8vIGMgaXMgaW5pdGlhbCBjYXJyeSwgcmV0dXJucyBmaW5hbCBjYXJyeS4KLy8gYyA8IDMqZHZhbHVlLCB4IDwgMipkdmFsdWUsIHRoaXNfaSA8IGR2YWx1ZQovLyBXZSBuZWVkIHRvIHNlbGVjdCB0aGUgZmFzdGVzdCBvbmUgdGhhdCB3b3JrcyBpbiB0aGlzIGVudmlyb25tZW50LgovLyBhbTE6IHVzZSBhIHNpbmdsZSBtdWx0IGFuZCBkaXZpZGUgdG8gZ2V0IHRoZSBoaWdoIGJpdHMsCi8vIG1heCBkaWdpdCBiaXRzIHNob3VsZCBiZSAyNiBiZWNhdXNlCi8vIG1heCBpbnRlcm5hbCB2YWx1ZSA9IDIqZHZhbHVlXjItMipkdmFsdWUgKDwgMl41MykKZnVuY3Rpb24gYW0xKGksIHgsIHcsIGosIGMsIG4pIHsKICAgIHdoaWxlICgtLW4gPj0gMCkgewogICAgICAgIHZhciB2ID0geCAqIHRoaXNbaSsrXSArIHdbal0gKyBjOwogICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyAweDQwMDAwMDApOwogICAgICAgIHdbaisrXSA9IHYgJiAweDNmZmZmZmY7CiAgICB9CiAgICByZXR1cm4gYzsKfQovLyBhbTIgYXZvaWRzIGEgYmlnIG11bHQtYW5kLWV4dHJhY3QgY29tcGxldGVseS4KLy8gTWF4IGRpZ2l0IGJpdHMgc2hvdWxkIGJlIDw9IDMwIGJlY2F1c2Ugd2UgZG8gYml0d2lzZSBvcHMKLy8gb24gdmFsdWVzIHVwIHRvIDIqaGR2YWx1ZV4yLWhkdmFsdWUtMSAoPCAyXjMxKQpmdW5jdGlvbiBhbTIoaSwgeCwgdywgaiwgYywgbikgewogICAgdmFyIHhsID0geCAmIDB4N2ZmZjsKICAgIHZhciB4aCA9IHggPj4gMTU7CiAgICB3aGlsZSAoLS1uID49IDApIHsKICAgICAgICB2YXIgbCA9IHRoaXNbaV0gJiAweDdmZmY7CiAgICAgICAgdmFyIGggPSB0aGlzW2krK10gPj4gMTU7CiAgICAgICAgdmFyIG0gPSB4aCAqIGwgKyBoICogeGw7CiAgICAgICAgbCA9IHhsICogbCArICgobSAmIDB4N2ZmZikgPDwgMTUpICsgd1tqXSArIChjICYgMHgzZmZmZmZmZik7CiAgICAgICAgYyA9IChsID4+PiAzMCkgKyAobSA+Pj4gMTUpICsgeGggKiBoICsgKGMgPj4+IDMwKTsKICAgICAgICB3W2orK10gPSBsICYgMHgzZmZmZmZmZjsKICAgIH0KICAgIHJldHVybiBjOwp9Ci8vIEFsdGVybmF0ZWx5LCBzZXQgbWF4IGRpZ2l0IGJpdHMgdG8gMjggc2luY2Ugc29tZQovLyBicm93c2VycyBzbG93IGRvd24gd2hlbiBkZWFsaW5nIHdpdGggMzItYml0IG51bWJlcnMuCmZ1bmN0aW9uIGFtMyhpLCB4LCB3LCBqLCBjLCBuKSB7CiAgICB2YXIgeGwgPSB4ICYgMHgzZmZmOwogICAgdmFyIHhoID0geCA+PiAxNDsKICAgIHdoaWxlICgtLW4gPj0gMCkgewogICAgICAgIHZhciBsID0gdGhpc1tpXSAmIDB4M2ZmZjsKICAgICAgICB2YXIgaCA9IHRoaXNbaSsrXSA+PiAxNDsKICAgICAgICB2YXIgbSA9IHhoICogbCArIGggKiB4bDsKICAgICAgICBsID0geGwgKiBsICsgKChtICYgMHgzZmZmKSA8PCAxNCkgKyB3W2pdICsgYzsKICAgICAgICBjID0gKGwgPj4gMjgpICsgKG0gPj4gMTQpICsgeGggKiBoOwogICAgICAgIHdbaisrXSA9IGwgJiAweGZmZmZmZmY7CiAgICB9CiAgICByZXR1cm4gYzsKfQppZiAoal9sbSAmJiAobmF2aWdhdG9yLmFwcE5hbWUgPT0gIk1pY3Jvc29mdCBJbnRlcm5ldCBFeHBsb3JlciIpKSB7CiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5hbSA9IGFtMjsKICAgIGRiaXRzID0gMzA7Cn0KZWxzZSBpZiAoal9sbSAmJiAobmF2aWdhdG9yLmFwcE5hbWUgIT0gIk5ldHNjYXBlIikpIHsKICAgIEJpZ0ludGVnZXIucHJvdG90eXBlLmFtID0gYW0xOwogICAgZGJpdHMgPSAyNjsKfQplbHNlIHsgLy8gTW96aWxsYS9OZXRzY2FwZSBzZWVtcyB0byBwcmVmZXIgYW0zCiAgICBCaWdJbnRlZ2VyLnByb3RvdHlwZS5hbSA9IGFtMzsKICAgIGRiaXRzID0gMjg7Cn0KQmlnSW50ZWdlci5wcm90b3R5cGUuREIgPSBkYml0czsKQmlnSW50ZWdlci5wcm90b3R5cGUuRE0gPSAoKDEgPDwgZGJpdHMpIC0gMSk7CkJpZ0ludGVnZXIucHJvdG90eXBlLkRWID0gKDEgPDwgZGJpdHMpOwp2YXIgQklfRlAgPSA1MjsKQmlnSW50ZWdlci5wcm90b3R5cGUuRlYgPSBNYXRoLnBvdygyLCBCSV9GUCk7CkJpZ0ludGVnZXIucHJvdG90eXBlLkYxID0gQklfRlAgLSBkYml0czsKQmlnSW50ZWdlci5wcm90b3R5cGUuRjIgPSAyICogZGJpdHMgLSBCSV9GUDsKLy8gRGlnaXQgY29udmVyc2lvbnMKdmFyIEJJX1JDID0gW107CnZhciBycjsKdmFyIHZ2OwpyciA9ICIwIi5jaGFyQ29kZUF0KDApOwpmb3IgKHZ2ID0gMDsgdnYgPD0gOTsgKyt2dikgewogICAgQklfUkNbcnIrK10gPSB2djsKfQpyciA9ICJhIi5jaGFyQ29kZUF0KDApOwpmb3IgKHZ2ID0gMTA7IHZ2IDwgMzY7ICsrdnYpIHsKICAgIEJJX1JDW3JyKytdID0gdnY7Cn0KcnIgPSAiQSIuY2hhckNvZGVBdCgwKTsKZm9yICh2diA9IDEwOyB2diA8IDM2OyArK3Z2KSB7CiAgICBCSV9SQ1tycisrXSA9IHZ2Owp9CmZ1bmN0aW9uIGludEF0KHMsIGkpIHsKICAgIHZhciBjID0gQklfUkNbcy5jaGFyQ29kZUF0KGkpXTsKICAgIHJldHVybiAoYyA9PSBudWxsKSA/IC0xIDogYzsKfQovLyByZXR1cm4gYmlnaW50IGluaXRpYWxpemVkIHRvIHZhbHVlCmZ1bmN0aW9uIG5idihpKSB7CiAgICB2YXIgciA9IG5iaSgpOwogICAgci5mcm9tSW50KGkpOwogICAgcmV0dXJuIHI7Cn0KLy8gcmV0dXJucyBiaXQgbGVuZ3RoIG9mIHRoZSBpbnRlZ2VyIHgKZnVuY3Rpb24gbmJpdHMoeCkgewogICAgdmFyIHIgPSAxOwogICAgdmFyIHQ7CiAgICBpZiAoKHQgPSB4ID4+PiAxNikgIT0gMCkgewogICAgICAgIHggPSB0OwogICAgICAgIHIgKz0gMTY7CiAgICB9CiAgICBpZiAoKHQgPSB4ID4+IDgpICE9IDApIHsKICAgICAgICB4ID0gdDsKICAgICAgICByICs9IDg7CiAgICB9CiAgICBpZiAoKHQgPSB4ID4+IDQpICE9IDApIHsKICAgICAgICB4ID0gdDsKICAgICAgICByICs9IDQ7CiAgICB9CiAgICBpZiAoKHQgPSB4ID4+IDIpICE9IDApIHsKICAgICAgICB4ID0gdDsKICAgICAgICByICs9IDI7CiAgICB9CiAgICBpZiAoKHQgPSB4ID4+IDEpICE9IDApIHsKICAgICAgICB4ID0gdDsKICAgICAgICByICs9IDE7CiAgICB9CiAgICByZXR1cm4gcjsKfQovLyAiY29uc3RhbnRzIgpCaWdJbnRlZ2VyLlpFUk8gPSBuYnYoMCk7CkJpZ0ludGVnZXIuT05FID0gbmJ2KDEpOwoKLy8gcHJuZzQuanMgLSB1c2VzIEFyY2ZvdXIgYXMgYSBQUk5HCnZhciBBcmNmb3VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gQXJjZm91cigpIHsKICAgICAgICB0aGlzLmkgPSAwOwogICAgICAgIHRoaXMuaiA9IDA7CiAgICAgICAgdGhpcy5TID0gW107CiAgICB9CiAgICAvLyBBcmNmb3VyLnByb3RvdHlwZS5pbml0ID0gQVJDNGluaXQ7CiAgICAvLyBJbml0aWFsaXplIGFyY2ZvdXIgY29udGV4dCBmcm9tIGtleSwgYW4gYXJyYXkgb2YgaW50cywgZWFjaCBmcm9tIFswLi4yNTVdCiAgICBBcmNmb3VyLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgIHZhciBpOwogICAgICAgIHZhciBqOwogICAgICAgIHZhciB0OwogICAgICAgIGZvciAoaSA9IDA7IGkgPCAyNTY7ICsraSkgewogICAgICAgICAgICB0aGlzLlNbaV0gPSBpOwogICAgICAgIH0KICAgICAgICBqID0gMDsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMjU2OyArK2kpIHsKICAgICAgICAgICAgaiA9IChqICsgdGhpcy5TW2ldICsga2V5W2kgJSBrZXkubGVuZ3RoXSkgJiAyNTU7CiAgICAgICAgICAgIHQgPSB0aGlzLlNbaV07CiAgICAgICAgICAgIHRoaXMuU1tpXSA9IHRoaXMuU1tqXTsKICAgICAgICAgICAgdGhpcy5TW2pdID0gdDsKICAgICAgICB9CiAgICAgICAgdGhpcy5pID0gMDsKICAgICAgICB0aGlzLmogPSAwOwogICAgfTsKICAgIC8vIEFyY2ZvdXIucHJvdG90eXBlLm5leHQgPSBBUkM0bmV4dDsKICAgIEFyY2ZvdXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHQ7CiAgICAgICAgdGhpcy5pID0gKHRoaXMuaSArIDEpICYgMjU1OwogICAgICAgIHRoaXMuaiA9ICh0aGlzLmogKyB0aGlzLlNbdGhpcy5pXSkgJiAyNTU7CiAgICAgICAgdCA9IHRoaXMuU1t0aGlzLmldOwogICAgICAgIHRoaXMuU1t0aGlzLmldID0gdGhpcy5TW3RoaXMual07CiAgICAgICAgdGhpcy5TW3RoaXMual0gPSB0OwogICAgICAgIHJldHVybiB0aGlzLlNbKHQgKyB0aGlzLlNbdGhpcy5pXSkgJiAyNTVdOwogICAgfTsKICAgIHJldHVybiBBcmNmb3VyOwp9KCkpOwovLyBQbHVnIGluIHlvdXIgUk5HIGNvbnN0cnVjdG9yIGhlcmUKZnVuY3Rpb24gcHJuZ19uZXdzdGF0ZSgpIHsKICAgIHJldHVybiBuZXcgQXJjZm91cigpOwp9Ci8vIFBvb2wgc2l6ZSBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgNCBhbmQgZ3JlYXRlciB0aGFuIDMyLgovLyBBbiBhcnJheSBvZiBieXRlcyB0aGUgc2l6ZSBvZiB0aGUgcG9vbCB3aWxsIGJlIHBhc3NlZCB0byBpbml0KCkKdmFyIHJuZ19wc2l6ZSA9IDI1NjsKCi8vIFJhbmRvbSBudW1iZXIgZ2VuZXJhdG9yIC0gcmVxdWlyZXMgYSBQUk5HIGJhY2tlbmQsIGUuZy4gcHJuZzQuanMKdmFyIHJuZ19zdGF0ZTsKdmFyIHJuZ19wb29sID0gbnVsbDsKdmFyIHJuZ19wcHRyOwovLyBJbml0aWFsaXplIHRoZSBwb29sIHdpdGgganVuayBpZiBuZWVkZWQuCmlmIChybmdfcG9vbCA9PSBudWxsKSB7CiAgICBybmdfcG9vbCA9IFtdOwogICAgcm5nX3BwdHIgPSAwOwogICAgdmFyIHQgPSB2b2lkIDA7CiAgICBpZiAod2luZG93LmNyeXB0byAmJiB3aW5kb3cuY3J5cHRvLmdldFJhbmRvbVZhbHVlcykgewogICAgICAgIC8vIEV4dHJhY3QgZW50cm9weSAoMjA0OCBiaXRzKSBmcm9tIFJORyBpZiBhdmFpbGFibGUKICAgICAgICB2YXIgeiA9IG5ldyBVaW50MzJBcnJheSgyNTYpOwogICAgICAgIHdpbmRvdy5jcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKHopOwogICAgICAgIGZvciAodCA9IDA7IHQgPCB6Lmxlbmd0aDsgKyt0KSB7CiAgICAgICAgICAgIHJuZ19wb29sW3JuZ19wcHRyKytdID0gelt0XSAmIDI1NTsKICAgICAgICB9CiAgICB9CiAgICAvLyBVc2UgbW91c2UgZXZlbnRzIGZvciBlbnRyb3B5LCBpZiB3ZSBkbyBub3QgaGF2ZSBlbm91Z2ggZW50cm9weSBieSB0aGUgdGltZQogICAgLy8gd2UgbmVlZCBpdCwgZW50cm9weSB3aWxsIGJlIGdlbmVyYXRlZCBieSBNYXRoLnJhbmRvbS4KICAgIHZhciBvbk1vdXNlTW92ZUxpc3RlbmVyXzEgPSBmdW5jdGlvbiAoZXYpIHsKICAgICAgICB0aGlzLmNvdW50ID0gdGhpcy5jb3VudCB8fCAwOwogICAgICAgIGlmICh0aGlzLmNvdW50ID49IDI1NiB8fCBybmdfcHB0ciA+PSBybmdfcHNpemUpIHsKICAgICAgICAgICAgaWYgKHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgb25Nb3VzZU1vdmVMaXN0ZW5lcl8xLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAod2luZG93LmRldGFjaEV2ZW50KSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuZGV0YWNoRXZlbnQoIm9ubW91c2Vtb3ZlIiwgb25Nb3VzZU1vdmVMaXN0ZW5lcl8xKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBtb3VzZUNvb3JkaW5hdGVzID0gZXYueCArIGV2Lnk7CiAgICAgICAgICAgIHJuZ19wb29sW3JuZ19wcHRyKytdID0gbW91c2VDb29yZGluYXRlcyAmIDI1NTsKICAgICAgICAgICAgdGhpcy5jb3VudCArPSAxOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAvLyBTb21ldGltZXMgRmlyZWZveCB3aWxsIGRlbnkgcGVybWlzc2lvbiB0byBhY2Nlc3MgZXZlbnQgcHJvcGVydGllcyBmb3Igc29tZSByZWFzb24uIElnbm9yZS4KICAgICAgICB9CiAgICB9OwogICAgaWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIG9uTW91c2VNb3ZlTGlzdGVuZXJfMSwgZmFsc2UpOwogICAgfQogICAgZWxzZSBpZiAod2luZG93LmF0dGFjaEV2ZW50KSB7CiAgICAgICAgd2luZG93LmF0dGFjaEV2ZW50KCJvbm1vdXNlbW92ZSIsIG9uTW91c2VNb3ZlTGlzdGVuZXJfMSk7CiAgICB9Cn0KZnVuY3Rpb24gcm5nX2dldF9ieXRlKCkgewogICAgaWYgKHJuZ19zdGF0ZSA9PSBudWxsKSB7CiAgICAgICAgcm5nX3N0YXRlID0gcHJuZ19uZXdzdGF0ZSgpOwogICAgICAgIC8vIEF0IHRoaXMgcG9pbnQsIHdlIG1heSBub3QgaGF2ZSBjb2xsZWN0ZWQgZW5vdWdoIGVudHJvcHkuICBJZiBub3QsIGZhbGwgYmFjayB0byBNYXRoLnJhbmRvbQogICAgICAgIHdoaWxlIChybmdfcHB0ciA8IHJuZ19wc2l6ZSkgewogICAgICAgICAgICB2YXIgcmFuZG9tID0gTWF0aC5mbG9vcig2NTUzNiAqIE1hdGgucmFuZG9tKCkpOwogICAgICAgICAgICBybmdfcG9vbFtybmdfcHB0cisrXSA9IHJhbmRvbSAmIDI1NTsKICAgICAgICB9CiAgICAgICAgcm5nX3N0YXRlLmluaXQocm5nX3Bvb2wpOwogICAgICAgIGZvciAocm5nX3BwdHIgPSAwOyBybmdfcHB0ciA8IHJuZ19wb29sLmxlbmd0aDsgKytybmdfcHB0cikgewogICAgICAgICAgICBybmdfcG9vbFtybmdfcHB0cl0gPSAwOwogICAgICAgIH0KICAgICAgICBybmdfcHB0ciA9IDA7CiAgICB9CiAgICAvLyBUT0RPOiBhbGxvdyByZXNlZWRpbmcgYWZ0ZXIgZmlyc3QgcmVxdWVzdAogICAgcmV0dXJuIHJuZ19zdGF0ZS5uZXh0KCk7Cn0KdmFyIFNlY3VyZVJhbmRvbSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIFNlY3VyZVJhbmRvbSgpIHsKICAgIH0KICAgIFNlY3VyZVJhbmRvbS5wcm90b3R5cGUubmV4dEJ5dGVzID0gZnVuY3Rpb24gKGJhKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiYS5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBiYVtpXSA9IHJuZ19nZXRfYnl0ZSgpOwogICAgICAgIH0KICAgIH07CiAgICByZXR1cm4gU2VjdXJlUmFuZG9tOwp9KCkpOwoKLy8gRGVwZW5kcyBvbiBqc2JuLmpzIGFuZCBybmcuanMKLy8gZnVuY3Rpb24gbGluZWJyayhzLG4pIHsKLy8gICB2YXIgcmV0ID0gIiI7Ci8vICAgdmFyIGkgPSAwOwovLyAgIHdoaWxlKGkgKyBuIDwgcy5sZW5ndGgpIHsKLy8gICAgIHJldCArPSBzLnN1YnN0cmluZyhpLGkrbikgKyAiXG4iOwovLyAgICAgaSArPSBuOwovLyAgIH0KLy8gICByZXR1cm4gcmV0ICsgcy5zdWJzdHJpbmcoaSxzLmxlbmd0aCk7Ci8vIH0KLy8gZnVuY3Rpb24gYnl0ZTJIZXgoYikgewovLyAgIGlmKGIgPCAweDEwKQovLyAgICAgcmV0dXJuICIwIiArIGIudG9TdHJpbmcoMTYpOwovLyAgIGVsc2UKLy8gICAgIHJldHVybiBiLnRvU3RyaW5nKDE2KTsKLy8gfQpmdW5jdGlvbiBwa2NzMXBhZDEocywgbikgewogICAgaWYgKG4gPCBzLmxlbmd0aCArIDIyKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiTWVzc2FnZSB0b28gbG9uZyBmb3IgUlNBIik7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICB2YXIgbGVuID0gbiAtIHMubGVuZ3RoIC0gNjsKICAgIHZhciBmaWxsZXIgPSAiIjsKICAgIGZvciAodmFyIGYgPSAwOyBmIDwgbGVuOyBmICs9IDIpIHsKICAgICAgICBmaWxsZXIgKz0gImZmIjsKICAgIH0KICAgIHZhciBtID0gIjAwMDEiICsgZmlsbGVyICsgIjAwIiArIHM7CiAgICByZXR1cm4gcGFyc2VCaWdJbnQobSwgMTYpOwp9Ci8vIFBLQ1MjMSAodHlwZSAyLCByYW5kb20pIHBhZCBpbnB1dCBzdHJpbmcgcyB0byBuIGJ5dGVzLCBhbmQgcmV0dXJuIGEgYmlnaW50CmZ1bmN0aW9uIHBrY3MxcGFkMihzLCBuKSB7CiAgICBpZiAobiA8IHMubGVuZ3RoICsgMTEpIHsgLy8gVE9ETzogZml4IGZvciB1dGYtOAogICAgICAgIGNvbnNvbGUuZXJyb3IoIk1lc3NhZ2UgdG9vIGxvbmcgZm9yIFJTQSIpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgdmFyIGJhID0gW107CiAgICB2YXIgaSA9IHMubGVuZ3RoIC0gMTsKICAgIHdoaWxlIChpID49IDAgJiYgbiA+IDApIHsKICAgICAgICB2YXIgYyA9IHMuY2hhckNvZGVBdChpLS0pOwogICAgICAgIGlmIChjIDwgMTI4KSB7IC8vIGVuY29kZSB1c2luZyB1dGYtOAogICAgICAgICAgICBiYVstLW5dID0gYzsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoKGMgPiAxMjcpICYmIChjIDwgMjA0OCkpIHsKICAgICAgICAgICAgYmFbLS1uXSA9IChjICYgNjMpIHwgMTI4OwogICAgICAgICAgICBiYVstLW5dID0gKGMgPj4gNikgfCAxOTI7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBiYVstLW5dID0gKGMgJiA2MykgfCAxMjg7CiAgICAgICAgICAgIGJhWy0tbl0gPSAoKGMgPj4gNikgJiA2MykgfCAxMjg7CiAgICAgICAgICAgIGJhWy0tbl0gPSAoYyA+PiAxMikgfCAyMjQ7CiAgICAgICAgfQogICAgfQogICAgYmFbLS1uXSA9IDA7CiAgICB2YXIgcm5nID0gbmV3IFNlY3VyZVJhbmRvbSgpOwogICAgdmFyIHggPSBbXTsKICAgIHdoaWxlIChuID4gMikgeyAvLyByYW5kb20gbm9uLXplcm8gcGFkCiAgICAgICAgeFswXSA9IDA7CiAgICAgICAgd2hpbGUgKHhbMF0gPT0gMCkgewogICAgICAgICAgICBybmcubmV4dEJ5dGVzKHgpOwogICAgICAgIH0KICAgICAgICBiYVstLW5dID0geFswXTsKICAgIH0KICAgIGJhWy0tbl0gPSAyOwogICAgYmFbLS1uXSA9IDA7CiAgICByZXR1cm4gbmV3IEJpZ0ludGVnZXIoYmEpOwp9Ci8vICJlbXB0eSIgUlNBIGtleSBjb25zdHJ1Y3Rvcgp2YXIgUlNBS2V5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gUlNBS2V5KCkgewogICAgICAgIHRoaXMubiA9IG51bGw7CiAgICAgICAgdGhpcy5lID0gMDsKICAgICAgICB0aGlzLmQgPSBudWxsOwogICAgICAgIHRoaXMucCA9IG51bGw7CiAgICAgICAgdGhpcy5xID0gbnVsbDsKICAgICAgICB0aGlzLmRtcDEgPSBudWxsOwogICAgICAgIHRoaXMuZG1xMSA9IG51bGw7CiAgICAgICAgdGhpcy5jb2VmZiA9IG51bGw7CiAgICB9CiAgICAvLyNyZWdpb24gUFJPVEVDVEVECiAgICAvLyBwcm90ZWN0ZWQKICAgIC8vIFJTQUtleS5wcm90b3R5cGUuZG9QdWJsaWMgPSBSU0FEb1B1YmxpYzsKICAgIC8vIFBlcmZvcm0gcmF3IHB1YmxpYyBvcGVyYXRpb24gb24gIngiOiByZXR1cm4geF5lIChtb2QgbikKICAgIFJTQUtleS5wcm90b3R5cGUuZG9QdWJsaWMgPSBmdW5jdGlvbiAoeCkgewogICAgICAgIHJldHVybiB4Lm1vZFBvd0ludCh0aGlzLmUsIHRoaXMubik7CiAgICB9OwogICAgLy8gUlNBS2V5LnByb3RvdHlwZS5kb1ByaXZhdGUgPSBSU0FEb1ByaXZhdGU7CiAgICAvLyBQZXJmb3JtIHJhdyBwcml2YXRlIG9wZXJhdGlvbiBvbiAieCI6IHJldHVybiB4XmQgKG1vZCBuKQogICAgUlNBS2V5LnByb3RvdHlwZS5kb1ByaXZhdGUgPSBmdW5jdGlvbiAoeCkgewogICAgICAgIGlmICh0aGlzLnAgPT0gbnVsbCB8fCB0aGlzLnEgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4geC5tb2RQb3codGhpcy5kLCB0aGlzLm4pOwogICAgICAgIH0KICAgICAgICAvLyBUT0RPOiByZS1jYWxjdWxhdGUgYW55IG1pc3NpbmcgQ1JUIHBhcmFtcwogICAgICAgIHZhciB4cCA9IHgubW9kKHRoaXMucCkubW9kUG93KHRoaXMuZG1wMSwgdGhpcy5wKTsKICAgICAgICB2YXIgeHEgPSB4Lm1vZCh0aGlzLnEpLm1vZFBvdyh0aGlzLmRtcTEsIHRoaXMucSk7CiAgICAgICAgd2hpbGUgKHhwLmNvbXBhcmVUbyh4cSkgPCAwKSB7CiAgICAgICAgICAgIHhwID0geHAuYWRkKHRoaXMucCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB4cC5zdWJ0cmFjdCh4cSkubXVsdGlwbHkodGhpcy5jb2VmZikubW9kKHRoaXMucCkubXVsdGlwbHkodGhpcy5xKS5hZGQoeHEpOwogICAgfTsKICAgIC8vI2VuZHJlZ2lvbiBQUk9URUNURUQKICAgIC8vI3JlZ2lvbiBQVUJMSUMKICAgIC8vIFJTQUtleS5wcm90b3R5cGUuc2V0UHVibGljID0gUlNBU2V0UHVibGljOwogICAgLy8gU2V0IHRoZSBwdWJsaWMga2V5IGZpZWxkcyBOIGFuZCBlIGZyb20gaGV4IHN0cmluZ3MKICAgIFJTQUtleS5wcm90b3R5cGUuc2V0UHVibGljID0gZnVuY3Rpb24gKE4sIEUpIHsKICAgICAgICBpZiAoTiAhPSBudWxsICYmIEUgIT0gbnVsbCAmJiBOLmxlbmd0aCA+IDAgJiYgRS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRoaXMubiA9IHBhcnNlQmlnSW50KE4sIDE2KTsKICAgICAgICAgICAgdGhpcy5lID0gcGFyc2VJbnQoRSwgMTYpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiSW52YWxpZCBSU0EgcHVibGljIGtleSIpOwogICAgICAgIH0KICAgIH07CiAgICAvLyBSU0FLZXkucHJvdG90eXBlLmVuY3J5cHQgPSBSU0FFbmNyeXB0OwogICAgLy8gUmV0dXJuIHRoZSBQS0NTIzEgUlNBIGVuY3J5cHRpb24gb2YgInRleHQiIGFzIGFuIGV2ZW4tbGVuZ3RoIGhleCBzdHJpbmcKICAgIFJTQUtleS5wcm90b3R5cGUuZW5jcnlwdCA9IGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgICAgdmFyIG0gPSBwa2NzMXBhZDIodGV4dCwgKHRoaXMubi5iaXRMZW5ndGgoKSArIDcpID4+IDMpOwogICAgICAgIGlmIChtID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHZhciBjID0gdGhpcy5kb1B1YmxpYyhtKTsKICAgICAgICBpZiAoYyA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICB2YXIgaCA9IGMudG9TdHJpbmcoMTYpOwogICAgICAgIGlmICgoaC5sZW5ndGggJiAxKSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBoOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICIwIiArIGg7CiAgICAgICAgfQogICAgfTsKICAgIC8vIFJTQUtleS5wcm90b3R5cGUuc2V0UHJpdmF0ZSA9IFJTQVNldFByaXZhdGU7CiAgICAvLyBTZXQgdGhlIHByaXZhdGUga2V5IGZpZWxkcyBOLCBlLCBhbmQgZCBmcm9tIGhleCBzdHJpbmdzCiAgICBSU0FLZXkucHJvdG90eXBlLnNldFByaXZhdGUgPSBmdW5jdGlvbiAoTiwgRSwgRCkgewogICAgICAgIGlmIChOICE9IG51bGwgJiYgRSAhPSBudWxsICYmIE4ubGVuZ3RoID4gMCAmJiBFLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdGhpcy5uID0gcGFyc2VCaWdJbnQoTiwgMTYpOwogICAgICAgICAgICB0aGlzLmUgPSBwYXJzZUludChFLCAxNik7CiAgICAgICAgICAgIHRoaXMuZCA9IHBhcnNlQmlnSW50KEQsIDE2KTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkludmFsaWQgUlNBIHByaXZhdGUga2V5Iik7CiAgICAgICAgfQogICAgfTsKICAgIC8vIFJTQUtleS5wcm90b3R5cGUuc2V0UHJpdmF0ZUV4ID0gUlNBU2V0UHJpdmF0ZUV4OwogICAgLy8gU2V0IHRoZSBwcml2YXRlIGtleSBmaWVsZHMgTiwgZSwgZCBhbmQgQ1JUIHBhcmFtcyBmcm9tIGhleCBzdHJpbmdzCiAgICBSU0FLZXkucHJvdG90eXBlLnNldFByaXZhdGVFeCA9IGZ1bmN0aW9uIChOLCBFLCBELCBQLCBRLCBEUCwgRFEsIEMpIHsKICAgICAgICBpZiAoTiAhPSBudWxsICYmIEUgIT0gbnVsbCAmJiBOLmxlbmd0aCA+IDAgJiYgRS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRoaXMubiA9IHBhcnNlQmlnSW50KE4sIDE2KTsKICAgICAgICAgICAgdGhpcy5lID0gcGFyc2VJbnQoRSwgMTYpOwogICAgICAgICAgICB0aGlzLmQgPSBwYXJzZUJpZ0ludChELCAxNik7CiAgICAgICAgICAgIHRoaXMucCA9IHBhcnNlQmlnSW50KFAsIDE2KTsKICAgICAgICAgICAgdGhpcy5xID0gcGFyc2VCaWdJbnQoUSwgMTYpOwogICAgICAgICAgICB0aGlzLmRtcDEgPSBwYXJzZUJpZ0ludChEUCwgMTYpOwogICAgICAgICAgICB0aGlzLmRtcTEgPSBwYXJzZUJpZ0ludChEUSwgMTYpOwogICAgICAgICAgICB0aGlzLmNvZWZmID0gcGFyc2VCaWdJbnQoQywgMTYpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiSW52YWxpZCBSU0EgcHJpdmF0ZSBrZXkiKTsKICAgICAgICB9CiAgICB9OwogICAgLy8gUlNBS2V5LnByb3RvdHlwZS5nZW5lcmF0ZSA9IFJTQUdlbmVyYXRlOwogICAgLy8gR2VuZXJhdGUgYSBuZXcgcmFuZG9tIHByaXZhdGUga2V5IEIgYml0cyBsb25nLCB1c2luZyBwdWJsaWMgZXhwdCBFCiAgICBSU0FLZXkucHJvdG90eXBlLmdlbmVyYXRlID0gZnVuY3Rpb24gKEIsIEUpIHsKICAgICAgICB2YXIgcm5nID0gbmV3IFNlY3VyZVJhbmRvbSgpOwogICAgICAgIHZhciBxcyA9IEIgPj4gMTsKICAgICAgICB0aGlzLmUgPSBwYXJzZUludChFLCAxNik7CiAgICAgICAgdmFyIGVlID0gbmV3IEJpZ0ludGVnZXIoRSwgMTYpOwogICAgICAgIGZvciAoOzspIHsKICAgICAgICAgICAgZm9yICg7OykgewogICAgICAgICAgICAgICAgdGhpcy5wID0gbmV3IEJpZ0ludGVnZXIoQiAtIHFzLCAxLCBybmcpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMucC5zdWJ0cmFjdChCaWdJbnRlZ2VyLk9ORSkuZ2NkKGVlKS5jb21wYXJlVG8oQmlnSW50ZWdlci5PTkUpID09IDAgJiYgdGhpcy5wLmlzUHJvYmFibGVQcmltZSgxMCkpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgICAgICB0aGlzLnEgPSBuZXcgQmlnSW50ZWdlcihxcywgMSwgcm5nKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnEuc3VidHJhY3QoQmlnSW50ZWdlci5PTkUpLmdjZChlZSkuY29tcGFyZVRvKEJpZ0ludGVnZXIuT05FKSA9PSAwICYmIHRoaXMucS5pc1Byb2JhYmxlUHJpbWUoMTApKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMucC5jb21wYXJlVG8odGhpcy5xKSA8PSAwKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IHRoaXMucDsKICAgICAgICAgICAgICAgIHRoaXMucCA9IHRoaXMucTsKICAgICAgICAgICAgICAgIHRoaXMucSA9IHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHAxID0gdGhpcy5wLnN1YnRyYWN0KEJpZ0ludGVnZXIuT05FKTsKICAgICAgICAgICAgdmFyIHExID0gdGhpcy5xLnN1YnRyYWN0KEJpZ0ludGVnZXIuT05FKTsKICAgICAgICAgICAgdmFyIHBoaSA9IHAxLm11bHRpcGx5KHExKTsKICAgICAgICAgICAgaWYgKHBoaS5nY2QoZWUpLmNvbXBhcmVUbyhCaWdJbnRlZ2VyLk9ORSkgPT0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5uID0gdGhpcy5wLm11bHRpcGx5KHRoaXMucSk7CiAgICAgICAgICAgICAgICB0aGlzLmQgPSBlZS5tb2RJbnZlcnNlKHBoaSk7CiAgICAgICAgICAgICAgICB0aGlzLmRtcDEgPSB0aGlzLmQubW9kKHAxKTsKICAgICAgICAgICAgICAgIHRoaXMuZG1xMSA9IHRoaXMuZC5tb2QocTEpOwogICAgICAgICAgICAgICAgdGhpcy5jb2VmZiA9IHRoaXMucS5tb2RJbnZlcnNlKHRoaXMucCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICAvLyBSU0FLZXkucHJvdG90eXBlLmRlY3J5cHQgPSBSU0FEZWNyeXB0OwogICAgLy8gUmV0dXJuIHRoZSBQS0NTIzEgUlNBIGRlY3J5cHRpb24gb2YgImN0ZXh0Ii4KICAgIC8vICJjdGV4dCIgaXMgYW4gZXZlbi1sZW5ndGggaGV4IHN0cmluZyBhbmQgdGhlIG91dHB1dCBpcyBhIHBsYWluIHN0cmluZy4KICAgIFJTQUtleS5wcm90b3R5cGUuZGVjcnlwdCA9IGZ1bmN0aW9uIChjdGV4dCkgewogICAgICAgIHZhciBjID0gcGFyc2VCaWdJbnQoY3RleHQsIDE2KTsKICAgICAgICB2YXIgbSA9IHRoaXMuZG9Qcml2YXRlKGMpOwogICAgICAgIGlmIChtID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwa2NzMXVucGFkMihtLCAodGhpcy5uLmJpdExlbmd0aCgpICsgNykgPj4gMyk7CiAgICB9OwogICAgLy8gR2VuZXJhdGUgYSBuZXcgcmFuZG9tIHByaXZhdGUga2V5IEIgYml0cyBsb25nLCB1c2luZyBwdWJsaWMgZXhwdCBFCiAgICBSU0FLZXkucHJvdG90eXBlLmdlbmVyYXRlQXN5bmMgPSBmdW5jdGlvbiAoQiwgRSwgY2FsbGJhY2spIHsKICAgICAgICB2YXIgcm5nID0gbmV3IFNlY3VyZVJhbmRvbSgpOwogICAgICAgIHZhciBxcyA9IEIgPj4gMTsKICAgICAgICB0aGlzLmUgPSBwYXJzZUludChFLCAxNik7CiAgICAgICAgdmFyIGVlID0gbmV3IEJpZ0ludGVnZXIoRSwgMTYpOwogICAgICAgIHZhciByc2EgPSB0aGlzOwogICAgICAgIC8vIFRoZXNlIGZ1bmN0aW9ucyBoYXZlIG5vbi1kZXNjcmlwdCBuYW1lcyBiZWNhdXNlIHRoZXkgd2VyZSBvcmlnaW5hbGx5IGZvcig7OykgbG9vcHMuCiAgICAgICAgLy8gSSBkb24ndCBrbm93IGFib3V0IGNyeXB0b2dyYXBoeSB0byBnaXZlIHRoZW0gYmV0dGVyIG5hbWVzIHRoYW4gbG9vcDEtNC4KICAgICAgICB2YXIgbG9vcDEgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBsb29wNCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChyc2EucC5jb21wYXJlVG8ocnNhLnEpIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IHJzYS5wOwogICAgICAgICAgICAgICAgICAgIHJzYS5wID0gcnNhLnE7CiAgICAgICAgICAgICAgICAgICAgcnNhLnEgPSB0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHAxID0gcnNhLnAuc3VidHJhY3QoQmlnSW50ZWdlci5PTkUpOwogICAgICAgICAgICAgICAgdmFyIHExID0gcnNhLnEuc3VidHJhY3QoQmlnSW50ZWdlci5PTkUpOwogICAgICAgICAgICAgICAgdmFyIHBoaSA9IHAxLm11bHRpcGx5KHExKTsKICAgICAgICAgICAgICAgIGlmIChwaGkuZ2NkKGVlKS5jb21wYXJlVG8oQmlnSW50ZWdlci5PTkUpID09IDApIHsKICAgICAgICAgICAgICAgICAgICByc2EubiA9IHJzYS5wLm11bHRpcGx5KHJzYS5xKTsKICAgICAgICAgICAgICAgICAgICByc2EuZCA9IGVlLm1vZEludmVyc2UocGhpKTsKICAgICAgICAgICAgICAgICAgICByc2EuZG1wMSA9IHJzYS5kLm1vZChwMSk7CiAgICAgICAgICAgICAgICAgICAgcnNhLmRtcTEgPSByc2EuZC5tb2QocTEpOwogICAgICAgICAgICAgICAgICAgIHJzYS5jb2VmZiA9IHJzYS5xLm1vZEludmVyc2UocnNhLnApOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBjYWxsYmFjaygpOyB9LCAwKTsgLy8gZXNjYXBlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvb3AxLCAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGxvb3AzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcnNhLnEgPSBuYmkoKTsKICAgICAgICAgICAgICAgIHJzYS5xLmZyb21OdW1iZXJBc3luYyhxcywgMSwgcm5nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcnNhLnEuc3VidHJhY3QoQmlnSW50ZWdlci5PTkUpLmdjZGEoZWUsIGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyLmNvbXBhcmVUbyhCaWdJbnRlZ2VyLk9ORSkgPT0gMCAmJiByc2EucS5pc1Byb2JhYmxlUHJpbWUoMTApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvb3A0LCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQobG9vcDMsIDApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGxvb3AyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcnNhLnAgPSBuYmkoKTsKICAgICAgICAgICAgICAgIHJzYS5wLmZyb21OdW1iZXJBc3luYyhCIC0gcXMsIDEsIHJuZywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHJzYS5wLnN1YnRyYWN0KEJpZ0ludGVnZXIuT05FKS5nY2RhKGVlLCBmdW5jdGlvbiAocikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoci5jb21wYXJlVG8oQmlnSW50ZWdlci5PTkUpID09IDAgJiYgcnNhLnAuaXNQcm9iYWJsZVByaW1lKDEwKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChsb29wMywgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvb3AyLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHNldFRpbWVvdXQobG9vcDIsIDApOwogICAgICAgIH07CiAgICAgICAgc2V0VGltZW91dChsb29wMSwgMCk7CiAgICB9OwogICAgUlNBS2V5LnByb3RvdHlwZS5zaWduID0gZnVuY3Rpb24gKHRleHQsIGRpZ2VzdE1ldGhvZCwgZGlnZXN0TmFtZSkgewogICAgICAgIHZhciBoZWFkZXIgPSBnZXREaWdlc3RIZWFkZXIoZGlnZXN0TmFtZSk7CiAgICAgICAgdmFyIGRpZ2VzdCA9IGhlYWRlciArIGRpZ2VzdE1ldGhvZCh0ZXh0KS50b1N0cmluZygpOwogICAgICAgIHZhciBtID0gcGtjczFwYWQxKGRpZ2VzdCwgdGhpcy5uLmJpdExlbmd0aCgpIC8gNCk7CiAgICAgICAgaWYgKG0gPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdmFyIGMgPSB0aGlzLmRvUHJpdmF0ZShtKTsKICAgICAgICBpZiAoYyA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICB2YXIgaCA9IGMudG9TdHJpbmcoMTYpOwogICAgICAgIGlmICgoaC5sZW5ndGggJiAxKSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBoOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICIwIiArIGg7CiAgICAgICAgfQogICAgfTsKICAgIFJTQUtleS5wcm90b3R5cGUudmVyaWZ5ID0gZnVuY3Rpb24gKHRleHQsIHNpZ25hdHVyZSwgZGlnZXN0TWV0aG9kKSB7CiAgICAgICAgdmFyIGMgPSBwYXJzZUJpZ0ludChzaWduYXR1cmUsIDE2KTsKICAgICAgICB2YXIgbSA9IHRoaXMuZG9QdWJsaWMoYyk7CiAgICAgICAgaWYgKG0gPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdmFyIHVucGFkZGVkID0gbS50b1N0cmluZygxNikucmVwbGFjZSgvXjFmKzAwLywgIiIpOwogICAgICAgIHZhciBkaWdlc3QgPSByZW1vdmVEaWdlc3RIZWFkZXIodW5wYWRkZWQpOwogICAgICAgIHJldHVybiBkaWdlc3QgPT0gZGlnZXN0TWV0aG9kKHRleHQpLnRvU3RyaW5nKCk7CiAgICB9OwogICAgcmV0dXJuIFJTQUtleTsKfSgpKTsKLy8gVW5kbyBQS0NTIzEgKHR5cGUgMiwgcmFuZG9tKSBwYWRkaW5nIGFuZCwgaWYgdmFsaWQsIHJldHVybiB0aGUgcGxhaW50ZXh0CmZ1bmN0aW9uIHBrY3MxdW5wYWQyKGQsIG4pIHsKICAgIHZhciBiID0gZC50b0J5dGVBcnJheSgpOwogICAgdmFyIGkgPSAwOwogICAgd2hpbGUgKGkgPCBiLmxlbmd0aCAmJiBiW2ldID09IDApIHsKICAgICAgICArK2k7CiAgICB9CiAgICBpZiAoYi5sZW5ndGggLSBpICE9IG4gLSAxIHx8IGJbaV0gIT0gMikgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgKytpOwogICAgd2hpbGUgKGJbaV0gIT0gMCkgewogICAgICAgIGlmICgrK2kgPj0gYi5sZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQogICAgdmFyIHJldCA9ICIiOwogICAgd2hpbGUgKCsraSA8IGIubGVuZ3RoKSB7CiAgICAgICAgdmFyIGMgPSBiW2ldICYgMjU1OwogICAgICAgIGlmIChjIDwgMTI4KSB7IC8vIHV0Zi04IGRlY29kZQogICAgICAgICAgICByZXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoKGMgPiAxOTEpICYmIChjIDwgMjI0KSkgewogICAgICAgICAgICByZXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAzMSkgPDwgNikgfCAoYltpICsgMV0gJiA2MykpOwogICAgICAgICAgICArK2k7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAxNSkgPDwgMTIpIHwgKChiW2kgKyAxXSAmIDYzKSA8PCA2KSB8IChiW2kgKyAyXSAmIDYzKSk7CiAgICAgICAgICAgIGkgKz0gMjsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gcmV0Owp9Ci8vIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMzNDQ3I3BhZ2UtNDMKdmFyIERJR0VTVF9IRUFERVJTID0gewogICAgbWQyOiAiMzAyMDMwMGMwNjA4MmE4NjQ4ODZmNzBkMDIwMjA1MDAwNDEwIiwKICAgIG1kNTogIjMwMjAzMDBjMDYwODJhODY0ODg2ZjcwZDAyMDUwNTAwMDQxMCIsCiAgICBzaGExOiAiMzAyMTMwMDkwNjA1MmIwZTAzMDIxYTA1MDAwNDE0IiwKICAgIHNoYTIyNDogIjMwMmQzMDBkMDYwOTYwODY0ODAxNjUwMzA0MDIwNDA1MDAwNDFjIiwKICAgIHNoYTI1NjogIjMwMzEzMDBkMDYwOTYwODY0ODAxNjUwMzA0MDIwMTA1MDAwNDIwIiwKICAgIHNoYTM4NDogIjMwNDEzMDBkMDYwOTYwODY0ODAxNjUwMzA0MDIwMjA1MDAwNDMwIiwKICAgIHNoYTUxMjogIjMwNTEzMDBkMDYwOTYwODY0ODAxNjUwMzA0MDIwMzA1MDAwNDQwIiwKICAgIHJpcGVtZDE2MDogIjMwMjEzMDA5MDYwNTJiMjQwMzAyMDEwNTAwMDQxNCIsCn07CmZ1bmN0aW9uIGdldERpZ2VzdEhlYWRlcihuYW1lKSB7CiAgICByZXR1cm4gRElHRVNUX0hFQURFUlNbbmFtZV0gfHwgIiI7Cn0KZnVuY3Rpb24gcmVtb3ZlRGlnZXN0SGVhZGVyKHN0cikgewogICAgZm9yICh2YXIgbmFtZV8xIGluIERJR0VTVF9IRUFERVJTKSB7CiAgICAgICAgaWYgKERJR0VTVF9IRUFERVJTLmhhc093blByb3BlcnR5KG5hbWVfMSkpIHsKICAgICAgICAgICAgdmFyIGhlYWRlciA9IERJR0VTVF9IRUFERVJTW25hbWVfMV07CiAgICAgICAgICAgIHZhciBsZW4gPSBoZWFkZXIubGVuZ3RoOwogICAgICAgICAgICBpZiAoc3RyLnN1YnN0cigwLCBsZW4pID09IGhlYWRlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIHN0ci5zdWJzdHIobGVuKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBzdHI7Cn0KLy8gUmV0dXJuIHRoZSBQS0NTIzEgUlNBIGVuY3J5cHRpb24gb2YgInRleHQiIGFzIGEgQmFzZTY0LWVuY29kZWQgc3RyaW5nCi8vIGZ1bmN0aW9uIFJTQUVuY3J5cHRCNjQodGV4dCkgewovLyAgdmFyIGggPSB0aGlzLmVuY3J5cHQodGV4dCk7Ci8vICBpZihoKSByZXR1cm4gaGV4MmI2NChoKTsgZWxzZSByZXR1cm4gbnVsbDsKLy8gfQovLyBwdWJsaWMKLy8gUlNBS2V5LnByb3RvdHlwZS5lbmNyeXB0X2I2NCA9IFJTQUVuY3J5cHRCNjQ7CgovKiEKQ29weXJpZ2h0IChjKSAyMDExLCBZYWhvbyEgSW5jLiBBbGwgcmlnaHRzIHJlc2VydmVkLgpDb2RlIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0QgTGljZW5zZToKaHR0cDovL2RldmVsb3Blci55YWhvby5jb20veXVpL2xpY2Vuc2UuaHRtbAp2ZXJzaW9uOiAyLjkuMAoqLwp2YXIgWUFIT08gPSB7fTsKWUFIT08ubGFuZyA9IHsKICAgIC8qKgogICAgICogVXRpbGl0eSB0byBzZXQgdXAgdGhlIHByb3RvdHlwZSwgY29uc3RydWN0b3IgYW5kIHN1cGVyY2xhc3MgcHJvcGVydGllcyB0bwogICAgICogc3VwcG9ydCBhbiBpbmhlcml0YW5jZSBzdHJhdGVneSB0aGF0IGNhbiBjaGFpbiBjb25zdHJ1Y3RvcnMgYW5kIG1ldGhvZHMuCiAgICAgKiBTdGF0aWMgbWVtYmVycyB3aWxsIG5vdCBiZSBpbmhlcml0ZWQuCiAgICAgKgogICAgICogQG1ldGhvZCBleHRlbmQKICAgICAqIEBzdGF0aWMKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHN1YmMgICB0aGUgb2JqZWN0IHRvIG1vZGlmeQogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gc3VwZXJjIHRoZSBvYmplY3QgdG8gaW5oZXJpdAogICAgICogQHBhcmFtIHtPYmplY3R9IG92ZXJyaWRlcyAgYWRkaXRpb25hbCBwcm9wZXJ0aWVzL21ldGhvZHMgdG8gYWRkIHRvIHRoZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJjbGFzcyBwcm90b3R5cGUuICBUaGVzZSB3aWxsIG92ZXJyaWRlIHRoZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGluZyBpdGVtcyBvYnRhaW5lZCBmcm9tIHRoZSBzdXBlcmNsYXNzCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHByZXNlbnQuCiAgICAgKi8KICAgIGV4dGVuZDogZnVuY3Rpb24oc3ViYywgc3VwZXJjLCBvdmVycmlkZXMpIHsKICAgICAgICBpZiAoISBzdXBlcmMgfHwgISBzdWJjKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiWUFIT08ubGFuZy5leHRlbmQgZmFpbGVkLCBwbGVhc2UgY2hlY2sgdGhhdCAiICsKICAgICAgICAgICAgICAgICJhbGwgZGVwZW5kZW5jaWVzIGFyZSBpbmNsdWRlZC4iKTsKICAgICAgICB9CgogICAgICAgIHZhciBGID0gZnVuY3Rpb24oKSB7fTsKICAgICAgICBGLnByb3RvdHlwZSA9IHN1cGVyYy5wcm90b3R5cGU7CiAgICAgICAgc3ViYy5wcm90b3R5cGUgPSBuZXcgRigpOwogICAgICAgIHN1YmMucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gc3ViYzsKICAgICAgICBzdWJjLnN1cGVyY2xhc3MgPSBzdXBlcmMucHJvdG90eXBlOwoKICAgICAgICBpZiAoc3VwZXJjLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9PSBPYmplY3QucHJvdG90eXBlLmNvbnN0cnVjdG9yKSB7CiAgICAgICAgICAgIHN1cGVyYy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBzdXBlcmM7CiAgICAgICAgfQoKICAgICAgICBpZiAob3ZlcnJpZGVzKSB7CiAgICAgICAgICAgIHZhciBpOwogICAgICAgICAgICBmb3IgKGkgaW4gb3ZlcnJpZGVzKSB7CiAgICAgICAgICAgICAgICBzdWJjLnByb3RvdHlwZVtpXSA9IG92ZXJyaWRlc1tpXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLyoKICAgICAgICAgICAgICogSUUgd2lsbCBub3QgZW51bWVyYXRlIG5hdGl2ZSBmdW5jdGlvbnMgaW4gYSBkZXJpdmVkIG9iamVjdCBldmVuIGlmIHRoZQogICAgICAgICAgICAgKiBmdW5jdGlvbiB3YXMgb3ZlcnJpZGRlbi4gIFRoaXMgaXMgYSB3b3JrYXJvdW5kIGZvciBzcGVjaWZpYyBmdW5jdGlvbnMKICAgICAgICAgICAgICogd2UgY2FyZSBhYm91dCBvbiB0aGUgT2JqZWN0IHByb3RvdHlwZS4KICAgICAgICAgICAgICogQHByb3BlcnR5IF9JRUVudW1GaXgKICAgICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gciAgdGhlIG9iamVjdCB0byByZWNlaXZlIHRoZSBhdWdtZW50YXRpb24KICAgICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcyAgdGhlIG9iamVjdCB0aGF0IHN1cHBsaWVzIHRoZSBwcm9wZXJ0aWVzIHRvIGF1Z21lbnQKICAgICAgICAgICAgICogQHN0YXRpYwogICAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgdmFyIF9JRUVudW1GaXggPSBmdW5jdGlvbigpIHt9LAogICAgICAgICAgICAgICAgQUREID0gWyJ0b1N0cmluZyIsICJ2YWx1ZU9mIl07CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoL01TSUUvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHsKICAgICAgICAgICAgICAgICAgICBfSUVFbnVtRml4ID0gZnVuY3Rpb24ociwgcykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgQURELmxlbmd0aDsgaSA9IGkgKyAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm5hbWUgPSBBRERbaV0sIGYgPSBzW2ZuYW1lXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZiA9PT0gJ2Z1bmN0aW9uJyAmJiBmICE9IE9iamVjdC5wcm90b3R5cGVbZm5hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcltmbmFtZV0gPSBmOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHt9ICAgICAgICAgICAgX0lFRW51bUZpeChzdWJjLnByb3RvdHlwZSwgb3ZlcnJpZGVzKTsKICAgICAgICB9CiAgICB9Cn07CgovKiBhc24xLTEuMC4xMy5qcyAoYykgMjAxMy0yMDE3IEtlbmppIFVydXNoaW1hIHwga2p1ci5naXRodWIuY29tL2pzcnNhc2lnbi9saWNlbnNlCiAqLwoKLyoqCiAqIEBmaWxlT3ZlcnZpZXcKICogQG5hbWUgYXNuMS0xLjAuanMKICogQGF1dGhvciBLZW5qaSBVcnVzaGltYSBrZW5qaS51cnVzaGltYUBnbWFpbC5jb20KICogQHZlcnNpb24gYXNuMSAxLjAuMTMgKDIwMTctSnVuLTAyKQogKiBAc2luY2UganNyc2FzaWduIDIuMQogKiBAbGljZW5zZSA8YSBocmVmPSJodHRwczovL2tqdXIuZ2l0aHViLmlvL2pzcnNhc2lnbi9saWNlbnNlLyI+TUlUIExpY2Vuc2U8L2E+CiAqLwoKLyoqCiAqIGtqdXIncyBjbGFzcyBsaWJyYXJ5IG5hbWUgc3BhY2UKICogPHA+CiAqIFRoaXMgbmFtZSBzcGFjZSBwcm92aWRlcyBmb2xsb3dpbmcgbmFtZSBzcGFjZXM6CiAqIDx1bD4KICogPGxpPntAbGluayBLSlVSLmFzbjF9IC0gQVNOLjEgcHJpbWl0aXZlIGhleGFkZWNpbWFsIGVuY29kZXI8L2xpPgogKiA8bGk+e0BsaW5rIEtKVVIuYXNuMS54NTA5fSAtIEFTTi4xIHN0cnVjdHVyZSBmb3IgWC41MDkgY2VydGlmaWNhdGUgYW5kIENSTDwvbGk+CiAqIDxsaT57QGxpbmsgS0pVUi5jcnlwdG99IC0gSmF2YSBDcnlwdG9ncmFwaGljIEV4dGVuc2lvbihKQ0UpIHN0eWxlIE1lc3NhZ2VEaWdlc3QvU2lnbmF0dXJlCiAqIGNsYXNzIGFuZCB1dGlsaXRpZXM8L2xpPgogKiA8L3VsPgogKiA8L3A+CiAqIE5PVEU6IFBsZWFzZSBpZ25vcmUgbWV0aG9kIHN1bW1hcnkgYW5kIGRvY3VtZW50IG9mIHRoaXMgbmFtZXNwYWNlLiBUaGlzIGNhdXNlZCBieSBhIGJ1ZyBvZiBqc2RvYzIuCiAqIEBuYW1lIEtKVVIKICogQG5hbWVzcGFjZSBranVyJ3MgY2xhc3MgbGlicmFyeSBuYW1lIHNwYWNlCiAqLwp2YXIgS0pVUiA9IHt9OwoKLyoqCiAqIGtqdXIncyBBU04uMSBjbGFzcyBsaWJyYXJ5IG5hbWUgc3BhY2UKICogPHA+CiAqIFRoaXMgaXMgSVRVLVQgWC42OTAgQVNOLjEgREVSIGVuY29kZXIgY2xhc3MgbGlicmFyeSBhbmQKICogY2xhc3Mgc3RydWN0dXJlIGFuZCBtZXRob2RzIGlzIHZlcnkgc2ltaWxhciB0bwogKiBvcmcuYm91bmN5Y2FzdGxlLmFzbjEgcGFja2FnZSBvZgogKiB3ZWxsIGtub3duIEJvdW5jeUNhc2x0ZSBDcnlwdG9ncmFwaHkgTGlicmFyeS4KICogPGg0PlBST1ZJRElORyBBU04uMSBQUklNSVRJVkVTPC9oND4KICogSGVyZSBhcmUgQVNOLjEgREVSIHByaW1pdGl2ZSBjbGFzc2VzLgogKiA8dWw+CiAqIDxsaT4weDAxIHtAbGluayBLSlVSLmFzbjEuREVSQm9vbGVhbn08L2xpPgogKiA8bGk+MHgwMiB7QGxpbmsgS0pVUi5hc24xLkRFUkludGVnZXJ9PC9saT4KICogPGxpPjB4MDMge0BsaW5rIEtKVVIuYXNuMS5ERVJCaXRTdHJpbmd9PC9saT4KICogPGxpPjB4MDQge0BsaW5rIEtKVVIuYXNuMS5ERVJPY3RldFN0cmluZ308L2xpPgogKiA8bGk+MHgwNSB7QGxpbmsgS0pVUi5hc24xLkRFUk51bGx9PC9saT4KICogPGxpPjB4MDYge0BsaW5rIEtKVVIuYXNuMS5ERVJPYmplY3RJZGVudGlmaWVyfTwvbGk+CiAqIDxsaT4weDBhIHtAbGluayBLSlVSLmFzbjEuREVSRW51bWVyYXRlZH08L2xpPgogKiA8bGk+MHgwYyB7QGxpbmsgS0pVUi5hc24xLkRFUlVURjhTdHJpbmd9PC9saT4KICogPGxpPjB4MTIge0BsaW5rIEtKVVIuYXNuMS5ERVJOdW1lcmljU3RyaW5nfTwvbGk+CiAqIDxsaT4weDEzIHtAbGluayBLSlVSLmFzbjEuREVSUHJpbnRhYmxlU3RyaW5nfTwvbGk+CiAqIDxsaT4weDE0IHtAbGluayBLSlVSLmFzbjEuREVSVGVsZXRleFN0cmluZ308L2xpPgogKiA8bGk+MHgxNiB7QGxpbmsgS0pVUi5hc24xLkRFUklBNVN0cmluZ308L2xpPgogKiA8bGk+MHgxNyB7QGxpbmsgS0pVUi5hc24xLkRFUlVUQ1RpbWV9PC9saT4KICogPGxpPjB4MTgge0BsaW5rIEtKVVIuYXNuMS5ERVJHZW5lcmFsaXplZFRpbWV9PC9saT4KICogPGxpPjB4MzAge0BsaW5rIEtKVVIuYXNuMS5ERVJTZXF1ZW5jZX08L2xpPgogKiA8bGk+MHgzMSB7QGxpbmsgS0pVUi5hc24xLkRFUlNldH08L2xpPgogKiA8L3VsPgogKiA8aDQ+T1RIRVIgQVNOLjEgQ0xBU1NFUzwvaDQ+CiAqIDx1bD4KICogPGxpPntAbGluayBLSlVSLmFzbjEuQVNOMU9iamVjdH08L2xpPgogKiA8bGk+e0BsaW5rIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFN0cmluZ308L2xpPgogKiA8bGk+e0BsaW5rIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFRpbWV9PC9saT4KICogPGxpPntAbGluayBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJ1Y3R1cmVkfTwvbGk+CiAqIDxsaT57QGxpbmsgS0pVUi5hc24xLkRFUlRhZ2dlZE9iamVjdH08L2xpPgogKiA8L3VsPgogKiA8aDQ+U1VCIE5BTUUgU1BBQ0VTPC9oND4KICogPHVsPgogKiA8bGk+e0BsaW5rIEtKVVIuYXNuMS5jYWRlc30gLSBDQWRFUyBsb25nIHRlcm0gc2lnbmF0dXJlIGZvcm1hdDwvbGk+CiAqIDxsaT57QGxpbmsgS0pVUi5hc24xLmNtc30gLSBDcnlwdG9ncmFwaGljIE1lc3NhZ2UgU3ludGF4PC9saT4KICogPGxpPntAbGluayBLSlVSLmFzbjEuY3NyfSAtIENlcnRpZmljYXRlIFNpZ25pbmcgUmVxdWVzdCAoQ1NSL1BLQ1MjMTApPC9saT4KICogPGxpPntAbGluayBLSlVSLmFzbjEudHNwfSAtIFJGQyAzMTYxIFRpbWVzdGFtcGluZyBQcm90b2NvbCBGb3JtYXQ8L2xpPgogKiA8bGk+e0BsaW5rIEtKVVIuYXNuMS54NTA5fSAtIFJGQyA1MjgwIFguNTA5IGNlcnRpZmljYXRlIGFuZCBDUkw8L2xpPgogKiA8L3VsPgogKiA8L3A+CiAqIE5PVEU6IFBsZWFzZSBpZ25vcmUgbWV0aG9kIHN1bW1hcnkgYW5kIGRvY3VtZW50IG9mIHRoaXMgbmFtZXNwYWNlLgogKiBUaGlzIGNhdXNlZCBieSBhIGJ1ZyBvZiBqc2RvYzIuCiAqIEBuYW1lIEtKVVIuYXNuMQogKiBAbmFtZXNwYWNlCiAqLwppZiAodHlwZW9mIEtKVVIuYXNuMSA9PSAidW5kZWZpbmVkIiB8fCAhS0pVUi5hc24xKSBLSlVSLmFzbjEgPSB7fTsKCi8qKgogKiBBU04xIHV0aWxpdGllcyBjbGFzcwogKiBAbmFtZSBLSlVSLmFzbjEuQVNOMVV0aWwKICogQGNsYXNzIEFTTjEgdXRpbGl0aWVzIGNsYXNzCiAqIEBzaW5jZSBhc24xIDEuMC4yCiAqLwpLSlVSLmFzbjEuQVNOMVV0aWwgPSBuZXcgZnVuY3Rpb24oKSB7CiAgICB0aGlzLmludGVnZXJUb0J5dGVIZXggPSBmdW5jdGlvbihpKSB7CiAgICAgICAgdmFyIGggPSBpLnRvU3RyaW5nKDE2KTsKICAgICAgICBpZiAoKGgubGVuZ3RoICUgMikgPT0gMSkgaCA9ICcwJyArIGg7CiAgICAgICAgcmV0dXJuIGg7CiAgICB9OwogICAgdGhpcy5iaWdJbnRUb01pblR3b3NDb21wbGVtZW50c0hleCA9IGZ1bmN0aW9uKGJpZ0ludGVnZXJWYWx1ZSkgewogICAgICAgIHZhciBoID0gYmlnSW50ZWdlclZhbHVlLnRvU3RyaW5nKDE2KTsKICAgICAgICBpZiAoaC5zdWJzdHIoMCwgMSkgIT0gJy0nKSB7CiAgICAgICAgICAgIGlmIChoLmxlbmd0aCAlIDIgPT0gMSkgewogICAgICAgICAgICAgICAgaCA9ICcwJyArIGg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoISBoLm1hdGNoKC9eWzAtN10vKSkgewogICAgICAgICAgICAgICAgICAgIGggPSAnMDAnICsgaDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBoUG9zID0gaC5zdWJzdHIoMSk7CiAgICAgICAgICAgIHZhciB4b3JMZW4gPSBoUG9zLmxlbmd0aDsKICAgICAgICAgICAgaWYgKHhvckxlbiAlIDIgPT0gMSkgewogICAgICAgICAgICAgICAgeG9yTGVuICs9IDE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoISBoLm1hdGNoKC9eWzAtN10vKSkgewogICAgICAgICAgICAgICAgICAgIHhvckxlbiArPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBoTWFzayA9ICcnOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHhvckxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBoTWFzayArPSAnZic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGJpTWFzayA9IG5ldyBCaWdJbnRlZ2VyKGhNYXNrLCAxNik7CiAgICAgICAgICAgIHZhciBiaU5lZyA9IGJpTWFzay54b3IoYmlnSW50ZWdlclZhbHVlKS5hZGQoQmlnSW50ZWdlci5PTkUpOwogICAgICAgICAgICBoID0gYmlOZWcudG9TdHJpbmcoMTYpLnJlcGxhY2UoL14tLywgJycpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaDsKICAgIH07CiAgICAvKioKICAgICAqIGdldCBQRU0gc3RyaW5nIGZyb20gaGV4YWRlY2ltYWwgZGF0YSBhbmQgaGVhZGVyIHN0cmluZwogICAgICogQG5hbWUgZ2V0UEVNU3RyaW5nRnJvbUhleAogICAgICogQG1lbWJlck9mIEtKVVIuYXNuMS5BU04xVXRpbAogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZGF0YUhleCBoZXhhZGVjaW1hbCBzdHJpbmcgb2YgUEVNIGJvZHkKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwZW1IZWFkZXIgUEVNIGhlYWRlciBzdHJpbmcgKGV4LiAnUlNBIFBSSVZBVEUgS0VZJykKICAgICAqIEByZXR1cm4ge1N0cmluZ30gUEVNIGZvcm1hdHRlZCBzdHJpbmcgb2YgaW5wdXQgZGF0YQogICAgICogQGRlc2NyaXB0aW9uCiAgICAgKiBUaGlzIG1ldGhvZCBjb252ZXJ0cyBhIGhleGFkZWNpbWFsIHN0cmluZyB0byBhIFBFTSBzdHJpbmcgd2l0aAogICAgICogYSBzcGVjaWZpZWQgaGVhZGVyLiBJdHMgbGluZSBicmVhayB3aWxsIGJlIENSTEYoIlxyXG4iKS4KICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgcGVtICA9IEtKVVIuYXNuMS5BU04xVXRpbC5nZXRQRU1TdHJpbmdGcm9tSGV4KCc2MTYxNjEnLCAnUlNBIFBSSVZBVEUgS0VZJyk7CiAgICAgKiAvLyB2YWx1ZSBvZiBwZW0gd2lsbCBiZToKICAgICAqIC0tLS0tQkVHSU4gUFJJVkFURSBLRVktLS0tLQogICAgICogWVdGaAogICAgICogLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLQogICAgICovCiAgICB0aGlzLmdldFBFTVN0cmluZ0Zyb21IZXggPSBmdW5jdGlvbihkYXRhSGV4LCBwZW1IZWFkZXIpIHsKICAgICAgICByZXR1cm4gaGV4dG9wZW0oZGF0YUhleCwgcGVtSGVhZGVyKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBnZW5lcmF0ZSBBU04xT2JqZWN0IHNwZWNpZmVkIGJ5IEpTT04gcGFyYW1ldGVycwogICAgICogQG5hbWUgbmV3T2JqZWN0CiAgICAgKiBAbWVtYmVyT2YgS0pVUi5hc24xLkFTTjFVdGlsCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBwYXJhbSB7QXJyYXl9IHBhcmFtIEpTT04gcGFyYW1ldGVyIHRvIGdlbmVyYXRlIEFTTjFPYmplY3QKICAgICAqIEByZXR1cm4ge0tKVVIuYXNuMS5BU04xT2JqZWN0fSBnZW5lcmF0ZWQgb2JqZWN0CiAgICAgKiBAc2luY2UgYXNuMSAxLjAuMwogICAgICogQGRlc2NyaXB0aW9uCiAgICAgKiBnZW5lcmF0ZSBhbnkgQVNOMU9iamVjdCBzcGVjaWZpZWQgYnkgSlNPTiBwYXJhbQogICAgICogaW5jbHVkaW5nIEFTTi4xIHByaW1pdGl2ZSBvciBzdHJ1Y3R1cmVkLgogICAgICogR2VuZXJhbGx5ICdwYXJhbScgY2FuIGJlIGRlc2NyaWJlZCBhcyBmb2xsb3dzOgogICAgICogPGJsb2NrcXVvdGU+CiAgICAgKiB7VFlQRS1PRi1BU05PQko6IEFTTjFPQkotUEFSQU1FVEVSfQogICAgICogPC9ibG9ja3F1b3RlPgogICAgICogJ1RZUEUtT0YtQVNOMU9CSicgY2FuIGJlIG9uZSBvZiBmb2xsb3dpbmcgc3ltYm9sczoKICAgICAqIDx1bD4KICAgICAqIDxsaT4nYm9vbCcgLSBERVJCb29sZWFuPC9saT4KICAgICAqIDxsaT4naW50JyAtIERFUkludGVnZXI8L2xpPgogICAgICogPGxpPidiaXRzdHInIC0gREVSQml0U3RyaW5nPC9saT4KICAgICAqIDxsaT4nb2N0c3RyJyAtIERFUk9jdGV0U3RyaW5nPC9saT4KICAgICAqIDxsaT4nbnVsbCcgLSBERVJOdWxsPC9saT4KICAgICAqIDxsaT4nb2lkJyAtIERFUk9iamVjdElkZW50aWZpZXI8L2xpPgogICAgICogPGxpPidlbnVtJyAtIERFUkVudW1lcmF0ZWQ8L2xpPgogICAgICogPGxpPid1dGY4c3RyJyAtIERFUlVURjhTdHJpbmc8L2xpPgogICAgICogPGxpPidudW1zdHInIC0gREVSTnVtZXJpY1N0cmluZzwvbGk+CiAgICAgKiA8bGk+J3BybnN0cicgLSBERVJQcmludGFibGVTdHJpbmc8L2xpPgogICAgICogPGxpPid0ZWxzdHInIC0gREVSVGVsZXRleFN0cmluZzwvbGk+CiAgICAgKiA8bGk+J2lhNXN0cicgLSBERVJJQTVTdHJpbmc8L2xpPgogICAgICogPGxpPid1dGN0aW1lJyAtIERFUlVUQ1RpbWU8L2xpPgogICAgICogPGxpPidnZW50aW1lJyAtIERFUkdlbmVyYWxpemVkVGltZTwvbGk+CiAgICAgKiA8bGk+J3NlcScgLSBERVJTZXF1ZW5jZTwvbGk+CiAgICAgKiA8bGk+J3NldCcgLSBERVJTZXQ8L2xpPgogICAgICogPGxpPid0YWcnIC0gREVSVGFnZ2VkT2JqZWN0PC9saT4KICAgICAqIDwvdWw+CiAgICAgKiBAZXhhbXBsZQogICAgICogbmV3T2JqZWN0KHsncHJuc3RyJzogJ2FhYSd9KTsKICAgICAqIG5ld09iamVjdCh7J3NlcSc6IFt7J2ludCc6IDN9LCB7J3BybnN0cic6ICdhYWEnfV19KQogICAgICogLy8gQVNOLjEgVGFnZ2VkIE9iamVjdAogICAgICogbmV3T2JqZWN0KHsndGFnJzogeyd0YWcnOiAnYTEnLAogICAgICogICAgICAgICAgICAgICAgICAgICdleHBsaWNpdCc6IHRydWUsCiAgICAgKiAgICAgICAgICAgICAgICAgICAgJ29iaic6IHsnc2VxJzogW3snaW50JzogM30sIHsncHJuc3RyJzogJ2FhYSd9XX19fSk7CiAgICAgKiAvLyBtb3JlIHNpbXBsZSByZXByZXNlbnRhdGlvbiBvZiBBU04uMSBUYWdnZWQgT2JqZWN0CiAgICAgKiBuZXdPYmplY3Qoeyd0YWcnOiBbJ2ExJywKICAgICAqICAgICAgICAgICAgICAgICAgICB0cnVlLAogICAgICogICAgICAgICAgICAgICAgICAgIHsnc2VxJzogWwogICAgICogICAgICAgICAgICAgICAgICAgICAgeydpbnQnOiAzfSwKICAgICAqICAgICAgICAgICAgICAgICAgICAgIHsncHJuc3RyJzogJ2FhYSd9XX0KICAgICAqICAgICAgICAgICAgICAgICAgIF19KTsKICAgICAqLwogICAgdGhpcy5uZXdPYmplY3QgPSBmdW5jdGlvbihwYXJhbSkgewogICAgICAgIHZhciBfS0pVUiA9IEtKVVIsCiAgICAgICAgICAgIF9LSlVSX2FzbjEgPSBfS0pVUi5hc24xLAogICAgICAgICAgICBfREVSQm9vbGVhbiA9IF9LSlVSX2FzbjEuREVSQm9vbGVhbiwKICAgICAgICAgICAgX0RFUkludGVnZXIgPSBfS0pVUl9hc24xLkRFUkludGVnZXIsCiAgICAgICAgICAgIF9ERVJCaXRTdHJpbmcgPSBfS0pVUl9hc24xLkRFUkJpdFN0cmluZywKICAgICAgICAgICAgX0RFUk9jdGV0U3RyaW5nID0gX0tKVVJfYXNuMS5ERVJPY3RldFN0cmluZywKICAgICAgICAgICAgX0RFUk51bGwgPSBfS0pVUl9hc24xLkRFUk51bGwsCiAgICAgICAgICAgIF9ERVJPYmplY3RJZGVudGlmaWVyID0gX0tKVVJfYXNuMS5ERVJPYmplY3RJZGVudGlmaWVyLAogICAgICAgICAgICBfREVSRW51bWVyYXRlZCA9IF9LSlVSX2FzbjEuREVSRW51bWVyYXRlZCwKICAgICAgICAgICAgX0RFUlVURjhTdHJpbmcgPSBfS0pVUl9hc24xLkRFUlVURjhTdHJpbmcsCiAgICAgICAgICAgIF9ERVJOdW1lcmljU3RyaW5nID0gX0tKVVJfYXNuMS5ERVJOdW1lcmljU3RyaW5nLAogICAgICAgICAgICBfREVSUHJpbnRhYmxlU3RyaW5nID0gX0tKVVJfYXNuMS5ERVJQcmludGFibGVTdHJpbmcsCiAgICAgICAgICAgIF9ERVJUZWxldGV4U3RyaW5nID0gX0tKVVJfYXNuMS5ERVJUZWxldGV4U3RyaW5nLAogICAgICAgICAgICBfREVSSUE1U3RyaW5nID0gX0tKVVJfYXNuMS5ERVJJQTVTdHJpbmcsCiAgICAgICAgICAgIF9ERVJVVENUaW1lID0gX0tKVVJfYXNuMS5ERVJVVENUaW1lLAogICAgICAgICAgICBfREVSR2VuZXJhbGl6ZWRUaW1lID0gX0tKVVJfYXNuMS5ERVJHZW5lcmFsaXplZFRpbWUsCiAgICAgICAgICAgIF9ERVJTZXF1ZW5jZSA9IF9LSlVSX2FzbjEuREVSU2VxdWVuY2UsCiAgICAgICAgICAgIF9ERVJTZXQgPSBfS0pVUl9hc24xLkRFUlNldCwKICAgICAgICAgICAgX0RFUlRhZ2dlZE9iamVjdCA9IF9LSlVSX2FzbjEuREVSVGFnZ2VkT2JqZWN0LAogICAgICAgICAgICBfbmV3T2JqZWN0ID0gX0tKVVJfYXNuMS5BU04xVXRpbC5uZXdPYmplY3Q7CgogICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMocGFyYW0pOwogICAgICAgIGlmIChrZXlzLmxlbmd0aCAhPSAxKQogICAgICAgICAgICB0aHJvdyAia2V5IG9mIHBhcmFtIHNoYWxsIGJlIG9ubHkgb25lLiI7CiAgICAgICAgdmFyIGtleSA9IGtleXNbMF07CgogICAgICAgIGlmICgiOmJvb2w6aW50OmJpdHN0cjpvY3RzdHI6bnVsbDpvaWQ6ZW51bTp1dGY4c3RyOm51bXN0cjpwcm5zdHI6dGVsc3RyOmlhNXN0cjp1dGN0aW1lOmdlbnRpbWU6c2VxOnNldDp0YWc6Ii5pbmRleE9mKCI6IiArIGtleSArICI6IikgPT0gLTEpCiAgICAgICAgICAgIHRocm93ICJ1bmRlZmluZWQga2V5OiAiICsga2V5OwoKICAgICAgICBpZiAoa2V5ID09ICJib29sIikgICAgcmV0dXJuIG5ldyBfREVSQm9vbGVhbihwYXJhbVtrZXldKTsKICAgICAgICBpZiAoa2V5ID09ICJpbnQiKSAgICAgcmV0dXJuIG5ldyBfREVSSW50ZWdlcihwYXJhbVtrZXldKTsKICAgICAgICBpZiAoa2V5ID09ICJiaXRzdHIiKSAgcmV0dXJuIG5ldyBfREVSQml0U3RyaW5nKHBhcmFtW2tleV0pOwogICAgICAgIGlmIChrZXkgPT0gIm9jdHN0ciIpICByZXR1cm4gbmV3IF9ERVJPY3RldFN0cmluZyhwYXJhbVtrZXldKTsKICAgICAgICBpZiAoa2V5ID09ICJudWxsIikgICAgcmV0dXJuIG5ldyBfREVSTnVsbChwYXJhbVtrZXldKTsKICAgICAgICBpZiAoa2V5ID09ICJvaWQiKSAgICAgcmV0dXJuIG5ldyBfREVST2JqZWN0SWRlbnRpZmllcihwYXJhbVtrZXldKTsKICAgICAgICBpZiAoa2V5ID09ICJlbnVtIikgICAgcmV0dXJuIG5ldyBfREVSRW51bWVyYXRlZChwYXJhbVtrZXldKTsKICAgICAgICBpZiAoa2V5ID09ICJ1dGY4c3RyIikgcmV0dXJuIG5ldyBfREVSVVRGOFN0cmluZyhwYXJhbVtrZXldKTsKICAgICAgICBpZiAoa2V5ID09ICJudW1zdHIiKSAgcmV0dXJuIG5ldyBfREVSTnVtZXJpY1N0cmluZyhwYXJhbVtrZXldKTsKICAgICAgICBpZiAoa2V5ID09ICJwcm5zdHIiKSAgcmV0dXJuIG5ldyBfREVSUHJpbnRhYmxlU3RyaW5nKHBhcmFtW2tleV0pOwogICAgICAgIGlmIChrZXkgPT0gInRlbHN0ciIpICByZXR1cm4gbmV3IF9ERVJUZWxldGV4U3RyaW5nKHBhcmFtW2tleV0pOwogICAgICAgIGlmIChrZXkgPT0gImlhNXN0ciIpICByZXR1cm4gbmV3IF9ERVJJQTVTdHJpbmcocGFyYW1ba2V5XSk7CiAgICAgICAgaWYgKGtleSA9PSAidXRjdGltZSIpIHJldHVybiBuZXcgX0RFUlVUQ1RpbWUocGFyYW1ba2V5XSk7CiAgICAgICAgaWYgKGtleSA9PSAiZ2VudGltZSIpIHJldHVybiBuZXcgX0RFUkdlbmVyYWxpemVkVGltZShwYXJhbVtrZXldKTsKCiAgICAgICAgaWYgKGtleSA9PSAic2VxIikgewogICAgICAgICAgICB2YXIgcGFyYW1MaXN0ID0gcGFyYW1ba2V5XTsKICAgICAgICAgICAgdmFyIGEgPSBbXTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJhbUxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBhc24xT2JqID0gX25ld09iamVjdChwYXJhbUxpc3RbaV0pOwogICAgICAgICAgICAgICAgYS5wdXNoKGFzbjFPYmopOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuZXcgX0RFUlNlcXVlbmNlKHsnYXJyYXknOiBhfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoa2V5ID09ICJzZXQiKSB7CiAgICAgICAgICAgIHZhciBwYXJhbUxpc3QgPSBwYXJhbVtrZXldOwogICAgICAgICAgICB2YXIgYSA9IFtdOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcmFtTGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIGFzbjFPYmogPSBfbmV3T2JqZWN0KHBhcmFtTGlzdFtpXSk7CiAgICAgICAgICAgICAgICBhLnB1c2goYXNuMU9iaik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ldyBfREVSU2V0KHsnYXJyYXknOiBhfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoa2V5ID09ICJ0YWciKSB7CiAgICAgICAgICAgIHZhciB0YWdQYXJhbSA9IHBhcmFtW2tleV07CiAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodGFnUGFyYW0pID09PSAnW29iamVjdCBBcnJheV0nICYmCiAgICAgICAgICAgICAgICB0YWdQYXJhbS5sZW5ndGggPT0gMykgewogICAgICAgICAgICAgICAgdmFyIG9iaiA9IF9uZXdPYmplY3QodGFnUGFyYW1bMl0pOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBfREVSVGFnZ2VkT2JqZWN0KHt0YWc6IHRhZ1BhcmFtWzBdLAogICAgICAgICAgICAgICAgICAgIGV4cGxpY2l0OiB0YWdQYXJhbVsxXSwKICAgICAgICAgICAgICAgICAgICBvYmo6IG9ian0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIG5ld1BhcmFtID0ge307CiAgICAgICAgICAgICAgICBpZiAodGFnUGFyYW0uZXhwbGljaXQgIT09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgICAgICBuZXdQYXJhbS5leHBsaWNpdCA9IHRhZ1BhcmFtLmV4cGxpY2l0OwogICAgICAgICAgICAgICAgaWYgKHRhZ1BhcmFtLnRhZyAhPT0gdW5kZWZpbmVkKQogICAgICAgICAgICAgICAgICAgIG5ld1BhcmFtLnRhZyA9IHRhZ1BhcmFtLnRhZzsKICAgICAgICAgICAgICAgIGlmICh0YWdQYXJhbS5vYmogPT09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgICAgICB0aHJvdyAib2JqIHNoYWxsIGJlIHNwZWNpZmllZCBmb3IgJ3RhZycuIjsKICAgICAgICAgICAgICAgIG5ld1BhcmFtLm9iaiA9IF9uZXdPYmplY3QodGFnUGFyYW0ub2JqKTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgX0RFUlRhZ2dlZE9iamVjdChuZXdQYXJhbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogZ2V0IGVuY29kZWQgaGV4YWRlY2ltYWwgc3RyaW5nIG9mIEFTTjFPYmplY3Qgc3BlY2lmZWQgYnkgSlNPTiBwYXJhbWV0ZXJzCiAgICAgKiBAbmFtZSBqc29uVG9BU04xSEVYCiAgICAgKiBAbWVtYmVyT2YgS0pVUi5hc24xLkFTTjFVdGlsCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBwYXJhbSB7QXJyYXl9IHBhcmFtIEpTT04gcGFyYW1ldGVyIHRvIGdlbmVyYXRlIEFTTjFPYmplY3QKICAgICAqIEByZXR1cm4gaGV4YWRlY2ltYWwgc3RyaW5nIG9mIEFTTjFPYmplY3QKICAgICAqIEBzaW5jZSBhc24xIDEuMC40CiAgICAgKiBAZGVzY3JpcHRpb24KICAgICAqIEFzIGZvciBBU04uMSBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgSlNPTiBvYmplY3QsCiAgICAgKiBwbGVhc2Ugc2VlIHtAbGluayBuZXdPYmplY3R9LgogICAgICogQGV4YW1wbGUKICAgICAqIGpzb25Ub0FTTjFIRVgoeydwcm5zdHInOiAnYWFhJ30pOwogICAgICovCiAgICB0aGlzLmpzb25Ub0FTTjFIRVggPSBmdW5jdGlvbihwYXJhbSkgewogICAgICAgIHZhciBhc24xT2JqID0gdGhpcy5uZXdPYmplY3QocGFyYW0pOwogICAgICAgIHJldHVybiBhc24xT2JqLmdldEVuY29kZWRIZXgoKTsKICAgIH07Cn07CgovKioKICogZ2V0IGRvdCBub3RlZCBvaWQgbnVtYmVyIHN0cmluZyBmcm9tIGhleGFkZWNpbWFsIHZhbHVlIG9mIE9JRAogKiBAbmFtZSBvaWRIZXhUb0ludAogKiBAbWVtYmVyT2YgS0pVUi5hc24xLkFTTjFVdGlsCiAqIEBmdW5jdGlvbgogKiBAcGFyYW0ge1N0cmluZ30gaGV4IGhleGFkZWNpbWFsIHZhbHVlIG9mIG9iamVjdCBpZGVudGlmaWVyCiAqIEByZXR1cm4ge1N0cmluZ30gZG90IG5vdGVkIHN0cmluZyBvZiBvYmplY3QgaWRlbnRpZmllcgogKiBAc2luY2UganNyc2FzaWduIDQuOC4zIGFzbjEgMS4wLjcKICogQGRlc2NyaXB0aW9uCiAqIFRoaXMgc3RhdGljIG1ldGhvZCBjb252ZXJ0cyBmcm9tIGhleGFkZWNpbWFsIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZgogKiBBU04uMSB2YWx1ZSBvZiBvYmplY3QgaWRlbnRpZmllciB0byBvaWQgbnVtYmVyIHN0cmluZy4KICogQGV4YW1wbGUKICogS0pVUi5hc24xLkFTTjFVdGlsLm9pZEhleFRvSW50KCc1NTA0MDYnKSAmcmFycjsgIjIuNS40LjYiCiAqLwpLSlVSLmFzbjEuQVNOMVV0aWwub2lkSGV4VG9JbnQgPSBmdW5jdGlvbihoZXgpIHsKICAgIHZhciBzID0gIiI7CiAgICB2YXIgaTAxID0gcGFyc2VJbnQoaGV4LnN1YnN0cigwLCAyKSwgMTYpOwogICAgdmFyIGkwID0gTWF0aC5mbG9vcihpMDEgLyA0MCk7CiAgICB2YXIgaTEgPSBpMDEgJSA0MDsKICAgIHZhciBzID0gaTAgKyAiLiIgKyBpMTsKCiAgICB2YXIgYmluYnVmID0gIiI7CiAgICBmb3IgKHZhciBpID0gMjsgaSA8IGhleC5sZW5ndGg7IGkgKz0gMikgewogICAgICAgIHZhciB2YWx1ZSA9IHBhcnNlSW50KGhleC5zdWJzdHIoaSwgMiksIDE2KTsKICAgICAgICB2YXIgYmluID0gKCIwMDAwMDAwMCIgKyB2YWx1ZS50b1N0cmluZygyKSkuc2xpY2UoLSA4KTsKICAgICAgICBiaW5idWYgPSBiaW5idWYgKyBiaW4uc3Vic3RyKDEsIDcpOwogICAgICAgIGlmIChiaW4uc3Vic3RyKDAsIDEpID09ICIwIikgewogICAgICAgICAgICB2YXIgYmkgPSBuZXcgQmlnSW50ZWdlcihiaW5idWYsIDIpOwogICAgICAgICAgICBzID0gcyArICIuIiArIGJpLnRvU3RyaW5nKDEwKTsKICAgICAgICAgICAgYmluYnVmID0gIiI7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHM7Cn07CgovKioKICogZ2V0IGhleGFkZWNpbWFsIHZhbHVlIG9mIG9iamVjdCBpZGVudGlmaWVyIGZyb20gZG90IG5vdGVkIG9pZCB2YWx1ZQogKiBAbmFtZSBvaWRJbnRUb0hleAogKiBAbWVtYmVyT2YgS0pVUi5hc24xLkFTTjFVdGlsCiAqIEBmdW5jdGlvbgogKiBAcGFyYW0ge1N0cmluZ30gb2lkU3RyaW5nIGRvdCBub3RlZCBzdHJpbmcgb2Ygb2JqZWN0IGlkZW50aWZpZXIKICogQHJldHVybiB7U3RyaW5nfSBoZXhhZGVjaW1hbCB2YWx1ZSBvZiBvYmplY3QgaWRlbnRpZmllcgogKiBAc2luY2UganNyc2FzaWduIDQuOC4zIGFzbjEgMS4wLjcKICogQGRlc2NyaXB0aW9uCiAqIFRoaXMgc3RhdGljIG1ldGhvZCBjb252ZXJ0cyBmcm9tIG9iamVjdCBpZGVudGlmaWVyIHZhbHVlIHN0cmluZy4KICogdG8gaGV4YWRlY2ltYWwgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGl0LgogKiBAZXhhbXBsZQogKiBLSlVSLmFzbjEuQVNOMVV0aWwub2lkSW50VG9IZXgoIjIuNS40LjYiKSAmcmFycjsgIjU1MDQwNiIKICovCktKVVIuYXNuMS5BU04xVXRpbC5vaWRJbnRUb0hleCA9IGZ1bmN0aW9uKG9pZFN0cmluZykgewogICAgdmFyIGl0b3ggPSBmdW5jdGlvbihpKSB7CiAgICAgICAgdmFyIGggPSBpLnRvU3RyaW5nKDE2KTsKICAgICAgICBpZiAoaC5sZW5ndGggPT0gMSkgaCA9ICcwJyArIGg7CiAgICAgICAgcmV0dXJuIGg7CiAgICB9OwoKICAgIHZhciByb2lkdG94ID0gZnVuY3Rpb24ocm9pZCkgewogICAgICAgIHZhciBoID0gJyc7CiAgICAgICAgdmFyIGJpID0gbmV3IEJpZ0ludGVnZXIocm9pZCwgMTApOwogICAgICAgIHZhciBiID0gYmkudG9TdHJpbmcoMik7CiAgICAgICAgdmFyIHBhZExlbiA9IDcgLSBiLmxlbmd0aCAlIDc7CiAgICAgICAgaWYgKHBhZExlbiA9PSA3KSBwYWRMZW4gPSAwOwogICAgICAgIHZhciBiUGFkID0gJyc7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYWRMZW47IGkrKykgYlBhZCArPSAnMCc7CiAgICAgICAgYiA9IGJQYWQgKyBiOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYi5sZW5ndGggLSAxOyBpICs9IDcpIHsKICAgICAgICAgICAgdmFyIGI4ID0gYi5zdWJzdHIoaSwgNyk7CiAgICAgICAgICAgIGlmIChpICE9IGIubGVuZ3RoIC0gNykgYjggPSAnMScgKyBiODsKICAgICAgICAgICAgaCArPSBpdG94KHBhcnNlSW50KGI4LCAyKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBoOwogICAgfTsKCiAgICBpZiAoISBvaWRTdHJpbmcubWF0Y2goL15bMC05Ll0rJC8pKSB7CiAgICAgICAgdGhyb3cgIm1hbGZvcm1lZCBvaWQgc3RyaW5nOiAiICsgb2lkU3RyaW5nOwogICAgfQogICAgdmFyIGggPSAnJzsKICAgIHZhciBhID0gb2lkU3RyaW5nLnNwbGl0KCcuJyk7CiAgICB2YXIgaTAgPSBwYXJzZUludChhWzBdKSAqIDQwICsgcGFyc2VJbnQoYVsxXSk7CiAgICBoICs9IGl0b3goaTApOwogICAgYS5zcGxpY2UoMCwgMik7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBoICs9IHJvaWR0b3goYVtpXSk7CiAgICB9CiAgICByZXR1cm4gaDsKfTsKCgovLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgovLyAgQWJzdHJhY3QgQVNOLjEgQ2xhc3NlcwovLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCi8qKgogKiBiYXNlIGNsYXNzIGZvciBBU04uMSBERVIgZW5jb2RlciBvYmplY3QKICogQG5hbWUgS0pVUi5hc24xLkFTTjFPYmplY3QKICogQGNsYXNzIGJhc2UgY2xhc3MgZm9yIEFTTi4xIERFUiBlbmNvZGVyIG9iamVjdAogKiBAcHJvcGVydHkge0Jvb2xlYW59IGlzTW9kaWZpZWQgZmxhZyB3aGV0aGVyIGludGVybmFsIGRhdGEgd2FzIGNoYW5nZWQKICogQHByb3BlcnR5IHtTdHJpbmd9IGhUTFYgaGV4YWRlY2ltYWwgc3RyaW5nIG9mIEFTTi4xIFRMVgogKiBAcHJvcGVydHkge1N0cmluZ30gaFQgaGV4YWRlY2ltYWwgc3RyaW5nIG9mIEFTTi4xIFRMViB0YWcoVCkKICogQHByb3BlcnR5IHtTdHJpbmd9IGhMIGhleGFkZWNpbWFsIHN0cmluZyBvZiBBU04uMSBUTFYgbGVuZ3RoKEwpCiAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBoViBoZXhhZGVjaW1hbCBzdHJpbmcgb2YgQVNOLjEgVExWIHZhbHVlKFYpCiAqIEBkZXNjcmlwdGlvbgogKi8KS0pVUi5hc24xLkFTTjFPYmplY3QgPSBmdW5jdGlvbigpIHsKICAgIHZhciBoViA9ICcnOwoKICAgIC8qKgogICAgICogZ2V0IGhleGFkZWNpbWFsIEFTTi4xIFRMViBsZW5ndGgoTCkgYnl0ZXMgZnJvbSBUTFYgdmFsdWUoVikKICAgICAqIEBuYW1lIGdldExlbmd0aEhleEZyb21WYWx1ZQogICAgICogQG1lbWJlck9mIEtKVVIuYXNuMS5BU04xT2JqZWN0IwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGhleGFkZWNpbWFsIHN0cmluZyBvZiBBU04uMSBUTFYgbGVuZ3RoKEwpCiAgICAgKi8KICAgIHRoaXMuZ2V0TGVuZ3RoSGV4RnJvbVZhbHVlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmhWID09ICJ1bmRlZmluZWQiIHx8IHRoaXMuaFYgPT0gbnVsbCkgewogICAgICAgICAgICB0aHJvdyAidGhpcy5oViBpcyBudWxsIG9yIHVuZGVmaW5lZC4iOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5oVi5sZW5ndGggJSAyID09IDEpIHsKICAgICAgICAgICAgdGhyb3cgInZhbHVlIGhleCBtdXN0IGJlIGV2ZW4gbGVuZ3RoOiBuPSIgKyBoVi5sZW5ndGggKyAiLHY9IiArIHRoaXMuaFY7CiAgICAgICAgfQogICAgICAgIHZhciBuID0gdGhpcy5oVi5sZW5ndGggLyAyOwogICAgICAgIHZhciBoTiA9IG4udG9TdHJpbmcoMTYpOwogICAgICAgIGlmIChoTi5sZW5ndGggJSAyID09IDEpIHsKICAgICAgICAgICAgaE4gPSAiMCIgKyBoTjsKICAgICAgICB9CiAgICAgICAgaWYgKG4gPCAxMjgpIHsKICAgICAgICAgICAgcmV0dXJuIGhOOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBoTmxlbiA9IGhOLmxlbmd0aCAvIDI7CiAgICAgICAgICAgIGlmIChoTmxlbiA+IDE1KSB7CiAgICAgICAgICAgICAgICB0aHJvdyAiQVNOLjEgbGVuZ3RoIHRvbyBsb25nIHRvIHJlcHJlc2VudCBieSA4eDogbiA9ICIgKyBuLnRvU3RyaW5nKDE2KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgaGVhZCA9IDEyOCArIGhObGVuOwogICAgICAgICAgICByZXR1cm4gaGVhZC50b1N0cmluZygxNikgKyBoTjsKICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogZ2V0IGhleGFkZWNpbWFsIHN0cmluZyBvZiBBU04uMSBUTFYgYnl0ZXMKICAgICAqIEBuYW1lIGdldEVuY29kZWRIZXgKICAgICAqIEBtZW1iZXJPZiBLSlVSLmFzbjEuQVNOMU9iamVjdCMKICAgICAqIEBmdW5jdGlvbgogICAgICogQHJldHVybiB7U3RyaW5nfSBoZXhhZGVjaW1hbCBzdHJpbmcgb2YgQVNOLjEgVExWCiAgICAgKi8KICAgIHRoaXMuZ2V0RW5jb2RlZEhleCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICh0aGlzLmhUTFYgPT0gbnVsbCB8fCB0aGlzLmlzTW9kaWZpZWQpIHsKICAgICAgICAgICAgdGhpcy5oViA9IHRoaXMuZ2V0RnJlc2hWYWx1ZUhleCgpOwogICAgICAgICAgICB0aGlzLmhMID0gdGhpcy5nZXRMZW5ndGhIZXhGcm9tVmFsdWUoKTsKICAgICAgICAgICAgdGhpcy5oVExWID0gdGhpcy5oVCArIHRoaXMuaEwgKyB0aGlzLmhWOwogICAgICAgICAgICB0aGlzLmlzTW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICAgICAgLy9hbGVydCgiZmlyc3QgdGltZTogIiArIHRoaXMuaFRMVik7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmhUTFY7CiAgICB9OwoKICAgIC8qKgogICAgICogZ2V0IGhleGFkZWNpbWFsIHN0cmluZyBvZiBBU04uMSBUTFYgdmFsdWUoVikgYnl0ZXMKICAgICAqIEBuYW1lIGdldFZhbHVlSGV4CiAgICAgKiBAbWVtYmVyT2YgS0pVUi5hc24xLkFTTjFPYmplY3QjCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEByZXR1cm4ge1N0cmluZ30gaGV4YWRlY2ltYWwgc3RyaW5nIG9mIEFTTi4xIFRMViB2YWx1ZShWKSBieXRlcwogICAgICovCiAgICB0aGlzLmdldFZhbHVlSGV4ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5nZXRFbmNvZGVkSGV4KCk7CiAgICAgICAgcmV0dXJuIHRoaXMuaFY7CiAgICB9OwoKICAgIHRoaXMuZ2V0RnJlc2hWYWx1ZUhleCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiAnJzsKICAgIH07Cn07CgovLyA9PSBCRUdJTiBERVJBYnN0cmFjdFN0cmluZyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLyoqCiAqIGJhc2UgY2xhc3MgZm9yIEFTTi4xIERFUiBzdHJpbmcgY2xhc3NlcwogKiBAbmFtZSBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJpbmcKICogQGNsYXNzIGJhc2UgY2xhc3MgZm9yIEFTTi4xIERFUiBzdHJpbmcgY2xhc3NlcwogKiBAcGFyYW0ge0FycmF5fSBwYXJhbXMgYXNzb2NpYXRpdmUgYXJyYXkgb2YgcGFyYW1ldGVycyAoZXguIHsnc3RyJzogJ2FhYSd9KQogKiBAcHJvcGVydHkge1N0cmluZ30gcyBpbnRlcm5hbCBzdHJpbmcgb2YgdmFsdWUKICogQGV4dGVuZHMgS0pVUi5hc24xLkFTTjFPYmplY3QKICogQGRlc2NyaXB0aW9uCiAqIDxici8+CiAqIEFzIGZvciBhcmd1bWVudCAncGFyYW1zJyBmb3IgY29uc3RydWN0b3IsIHlvdSBjYW4gc3BlY2lmeSBvbmUgb2YKICogZm9sbG93aW5nIHByb3BlcnRpZXM6CiAqIDx1bD4KICogPGxpPnN0ciAtIHNwZWNpZnkgaW5pdGlhbCBBU04uMSB2YWx1ZShWKSBieSBhIHN0cmluZzwvbGk+CiAqIDxsaT5oZXggLSBzcGVjaWZ5IGluaXRpYWwgQVNOLjEgdmFsdWUoVikgYnkgYSBoZXhhZGVjaW1hbCBzdHJpbmc8L2xpPgogKiA8L3VsPgogKiBOT1RFOiAncGFyYW1zJyBjYW4gYmUgb21pdHRlZC4KICovCktKVVIuYXNuMS5ERVJBYnN0cmFjdFN0cmluZyA9IGZ1bmN0aW9uKHBhcmFtcykgewogICAgS0pVUi5hc24xLkRFUkFic3RyYWN0U3RyaW5nLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzKTsKCiAgICAvKioKICAgICAqIGdldCBzdHJpbmcgdmFsdWUgb2YgdGhpcyBzdHJpbmcgb2JqZWN0CiAgICAgKiBAbmFtZSBnZXRTdHJpbmcKICAgICAqIEBtZW1iZXJPZiBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJpbmcjCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEByZXR1cm4ge1N0cmluZ30gc3RyaW5nIHZhbHVlIG9mIHRoaXMgc3RyaW5nIG9iamVjdAogICAgICovCiAgICB0aGlzLmdldFN0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnM7CiAgICB9OwoKICAgIC8qKgogICAgICogc2V0IHZhbHVlIGJ5IGEgc3RyaW5nCiAgICAgKiBAbmFtZSBzZXRTdHJpbmcKICAgICAqIEBtZW1iZXJPZiBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJpbmcjCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuZXdTIHZhbHVlIGJ5IGEgc3RyaW5nIHRvIHNldAogICAgICovCiAgICB0aGlzLnNldFN0cmluZyA9IGZ1bmN0aW9uKG5ld1MpIHsKICAgICAgICB0aGlzLmhUTFYgPSBudWxsOwogICAgICAgIHRoaXMuaXNNb2RpZmllZCA9IHRydWU7CiAgICAgICAgdGhpcy5zID0gbmV3UzsKICAgICAgICB0aGlzLmhWID0gc3RvaGV4KHRoaXMucyk7CiAgICB9OwoKICAgIC8qKgogICAgICogc2V0IHZhbHVlIGJ5IGEgaGV4YWRlY2ltYWwgc3RyaW5nCiAgICAgKiBAbmFtZSBzZXRTdHJpbmdIZXgKICAgICAqIEBtZW1iZXJPZiBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJpbmcjCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuZXdIZXhTdHJpbmcgdmFsdWUgYnkgYSBoZXhhZGVjaW1hbCBzdHJpbmcgdG8gc2V0CiAgICAgKi8KICAgIHRoaXMuc2V0U3RyaW5nSGV4ID0gZnVuY3Rpb24obmV3SGV4U3RyaW5nKSB7CiAgICAgICAgdGhpcy5oVExWID0gbnVsbDsKICAgICAgICB0aGlzLmlzTW9kaWZpZWQgPSB0cnVlOwogICAgICAgIHRoaXMucyA9IG51bGw7CiAgICAgICAgdGhpcy5oViA9IG5ld0hleFN0cmluZzsKICAgIH07CgogICAgdGhpcy5nZXRGcmVzaFZhbHVlSGV4ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaFY7CiAgICB9OwoKICAgIGlmICh0eXBlb2YgcGFyYW1zICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgaWYgKHR5cGVvZiBwYXJhbXMgPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgdGhpcy5zZXRTdHJpbmcocGFyYW1zKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBwYXJhbXNbJ3N0ciddICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIHRoaXMuc2V0U3RyaW5nKHBhcmFtc1snc3RyJ10pOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHBhcmFtc1snaGV4J10gIT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgdGhpcy5zZXRTdHJpbmdIZXgocGFyYW1zWydoZXgnXSk7CiAgICAgICAgfQogICAgfQp9OwpZQUhPTy5sYW5nLmV4dGVuZChLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJpbmcsIEtKVVIuYXNuMS5BU04xT2JqZWN0KTsKLy8gPT0gRU5EICAgREVSQWJzdHJhY3RTdHJpbmcgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgovLyA9PSBCRUdJTiBERVJBYnN0cmFjdFRpbWUgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLyoqCiAqIGJhc2UgY2xhc3MgZm9yIEFTTi4xIERFUiBHZW5lcmFsaXplZC9VVENUaW1lIGNsYXNzCiAqIEBuYW1lIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFRpbWUKICogQGNsYXNzIGJhc2UgY2xhc3MgZm9yIEFTTi4xIERFUiBHZW5lcmFsaXplZC9VVENUaW1lIGNsYXNzCiAqIEBwYXJhbSB7QXJyYXl9IHBhcmFtcyBhc3NvY2lhdGl2ZSBhcnJheSBvZiBwYXJhbWV0ZXJzIChleC4geydzdHInOiAnMTMwNDMwMjM1OTU5Wid9KQogKiBAZXh0ZW5kcyBLSlVSLmFzbjEuQVNOMU9iamVjdAogKiBAZGVzY3JpcHRpb24KICogQHNlZSBLSlVSLmFzbjEuQVNOMU9iamVjdCAtIHN1cGVyY2xhc3MKICovCktKVVIuYXNuMS5ERVJBYnN0cmFjdFRpbWUgPSBmdW5jdGlvbihwYXJhbXMpIHsKICAgIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFRpbWUuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMpOwoKICAgIC8vIC0tLSBQUklWQVRFIE1FVEhPRFMgLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIHRoaXMubG9jYWxEYXRlVG9VVEMgPSBmdW5jdGlvbihkKSB7CiAgICAgICAgdXRjID0gZC5nZXRUaW1lKCkgKyAoZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwogICAgICAgIHZhciB1dGNEYXRlID0gbmV3IERhdGUodXRjKTsKICAgICAgICByZXR1cm4gdXRjRGF0ZTsKICAgIH07CgogICAgLyoKICAgICAqIGZvcm1hdCBkYXRlIHN0cmluZyBieSBEYXRhIG9iamVjdAogICAgICogQG5hbWUgZm9ybWF0RGF0ZQogICAgICogQG1lbWJlck9mIEtKVVIuYXNuMS5BYnN0cmFjdFRpbWU7CiAgICAgKiBAcGFyYW0ge0RhdGV9IGRhdGVPYmplY3QKICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlICd1dGMnIG9yICdnZW4nCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHdpdGhNaWxsaXMgZmxhZyBmb3Igd2l0aCBtaWxsaXNlY3Rpb25zIG9yIG5vdAogICAgICogQGRlc2NyaXB0aW9uCiAgICAgKiAnd2l0aE1pbGxpcycgZmxhZyBpcyBzdXBwb3J0ZWQgZnJvbSBhc24xIDEuMC42LgogICAgICovCiAgICB0aGlzLmZvcm1hdERhdGUgPSBmdW5jdGlvbihkYXRlT2JqZWN0LCB0eXBlLCB3aXRoTWlsbGlzKSB7CiAgICAgICAgdmFyIHBhZCA9IHRoaXMuemVyb1BhZGRpbmc7CiAgICAgICAgdmFyIGQgPSB0aGlzLmxvY2FsRGF0ZVRvVVRDKGRhdGVPYmplY3QpOwogICAgICAgIHZhciB5ZWFyID0gU3RyaW5nKGQuZ2V0RnVsbFllYXIoKSk7CiAgICAgICAgaWYgKHR5cGUgPT0gJ3V0YycpIHllYXIgPSB5ZWFyLnN1YnN0cigyLCAyKTsKICAgICAgICB2YXIgbW9udGggPSBwYWQoU3RyaW5nKGQuZ2V0TW9udGgoKSArIDEpLCAyKTsKICAgICAgICB2YXIgZGF5ID0gcGFkKFN0cmluZyhkLmdldERhdGUoKSksIDIpOwogICAgICAgIHZhciBob3VyID0gcGFkKFN0cmluZyhkLmdldEhvdXJzKCkpLCAyKTsKICAgICAgICB2YXIgbWluID0gcGFkKFN0cmluZyhkLmdldE1pbnV0ZXMoKSksIDIpOwogICAgICAgIHZhciBzZWMgPSBwYWQoU3RyaW5nKGQuZ2V0U2Vjb25kcygpKSwgMik7CiAgICAgICAgdmFyIHMgPSB5ZWFyICsgbW9udGggKyBkYXkgKyBob3VyICsgbWluICsgc2VjOwogICAgICAgIGlmICh3aXRoTWlsbGlzID09PSB0cnVlKSB7CiAgICAgICAgICAgIHZhciBtaWxsaXMgPSBkLmdldE1pbGxpc2Vjb25kcygpOwogICAgICAgICAgICBpZiAobWlsbGlzICE9IDApIHsKICAgICAgICAgICAgICAgIHZhciBzTWlsbGlzID0gcGFkKFN0cmluZyhtaWxsaXMpLCAzKTsKICAgICAgICAgICAgICAgIHNNaWxsaXMgPSBzTWlsbGlzLnJlcGxhY2UoL1swXSskLywgIiIpOwogICAgICAgICAgICAgICAgcyA9IHMgKyAiLiIgKyBzTWlsbGlzOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzICsgIloiOwogICAgfTsKCiAgICB0aGlzLnplcm9QYWRkaW5nID0gZnVuY3Rpb24ocywgbGVuKSB7CiAgICAgICAgaWYgKHMubGVuZ3RoID49IGxlbikgcmV0dXJuIHM7CiAgICAgICAgcmV0dXJuIG5ldyBBcnJheShsZW4gLSBzLmxlbmd0aCArIDEpLmpvaW4oJzAnKSArIHM7CiAgICB9OwoKICAgIC8vIC0tLSBQVUJMSUMgTUVUSE9EUyAtLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgLyoqCiAgICAgKiBnZXQgc3RyaW5nIHZhbHVlIG9mIHRoaXMgc3RyaW5nIG9iamVjdAogICAgICogQG5hbWUgZ2V0U3RyaW5nCiAgICAgKiBAbWVtYmVyT2YgS0pVUi5hc24xLkRFUkFic3RyYWN0VGltZSMKICAgICAqIEBmdW5jdGlvbgogICAgICogQHJldHVybiB7U3RyaW5nfSBzdHJpbmcgdmFsdWUgb2YgdGhpcyB0aW1lIG9iamVjdAogICAgICovCiAgICB0aGlzLmdldFN0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnM7CiAgICB9OwoKICAgIC8qKgogICAgICogc2V0IHZhbHVlIGJ5IGEgc3RyaW5nCiAgICAgKiBAbmFtZSBzZXRTdHJpbmcKICAgICAqIEBtZW1iZXJPZiBLSlVSLmFzbjEuREVSQWJzdHJhY3RUaW1lIwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmV3UyB2YWx1ZSBieSBhIHN0cmluZyB0byBzZXQgc3VjaCBsaWtlICIxMzA0MzAyMzU5NTlaIgogICAgICovCiAgICB0aGlzLnNldFN0cmluZyA9IGZ1bmN0aW9uKG5ld1MpIHsKICAgICAgICB0aGlzLmhUTFYgPSBudWxsOwogICAgICAgIHRoaXMuaXNNb2RpZmllZCA9IHRydWU7CiAgICAgICAgdGhpcy5zID0gbmV3UzsKICAgICAgICB0aGlzLmhWID0gc3RvaGV4KG5ld1MpOwogICAgfTsKCiAgICAvKioKICAgICAqIHNldCB2YWx1ZSBieSBhIERhdGUgb2JqZWN0CiAgICAgKiBAbmFtZSBzZXRCeURhdGVWYWx1ZQogICAgICogQG1lbWJlck9mIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFRpbWUjCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBwYXJhbSB7SW50ZWdlcn0geWVhciB5ZWFyIG9mIGRhdGUgKGV4LiAyMDEzKQogICAgICogQHBhcmFtIHtJbnRlZ2VyfSBtb250aCBtb250aCBvZiBkYXRlIGJldHdlZW4gMSBhbmQgMTIgKGV4LiAxMikKICAgICAqIEBwYXJhbSB7SW50ZWdlcn0gZGF5IGRheSBvZiBtb250aAogICAgICogQHBhcmFtIHtJbnRlZ2VyfSBob3VyIGhvdXJzIG9mIGRhdGUKICAgICAqIEBwYXJhbSB7SW50ZWdlcn0gbWluIG1pbnV0ZXMgb2YgZGF0ZQogICAgICogQHBhcmFtIHtJbnRlZ2VyfSBzZWMgc2Vjb25kcyBvZiBkYXRlCiAgICAgKi8KICAgIHRoaXMuc2V0QnlEYXRlVmFsdWUgPSBmdW5jdGlvbih5ZWFyLCBtb250aCwgZGF5LCBob3VyLCBtaW4sIHNlYykgewogICAgICAgIHZhciBkYXRlT2JqZWN0ID0gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgbW9udGggLSAxLCBkYXksIGhvdXIsIG1pbiwgc2VjLCAwKSk7CiAgICAgICAgdGhpcy5zZXRCeURhdGUoZGF0ZU9iamVjdCk7CiAgICB9OwoKICAgIHRoaXMuZ2V0RnJlc2hWYWx1ZUhleCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmhWOwogICAgfTsKfTsKWUFIT08ubGFuZy5leHRlbmQoS0pVUi5hc24xLkRFUkFic3RyYWN0VGltZSwgS0pVUi5hc24xLkFTTjFPYmplY3QpOwovLyA9PSBFTkQgICBERVJBYnN0cmFjdFRpbWUgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCi8vID09IEJFR0lOIERFUkFic3RyYWN0U3RydWN0dXJlZCA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovKioKICogYmFzZSBjbGFzcyBmb3IgQVNOLjEgREVSIHN0cnVjdHVyZWQgY2xhc3MKICogQG5hbWUgS0pVUi5hc24xLkRFUkFic3RyYWN0U3RydWN0dXJlZAogKiBAY2xhc3MgYmFzZSBjbGFzcyBmb3IgQVNOLjEgREVSIHN0cnVjdHVyZWQgY2xhc3MKICogQHByb3BlcnR5IHtBcnJheX0gYXNuMUFycmF5IGludGVybmFsIGFycmF5IG9mIEFTTjFPYmplY3QKICogQGV4dGVuZHMgS0pVUi5hc24xLkFTTjFPYmplY3QKICogQGRlc2NyaXB0aW9uCiAqIEBzZWUgS0pVUi5hc24xLkFTTjFPYmplY3QgLSBzdXBlcmNsYXNzCiAqLwpLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJ1Y3R1cmVkID0gZnVuY3Rpb24ocGFyYW1zKSB7CiAgICBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJpbmcuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMpOwoKICAgIC8qKgogICAgICogc2V0IHZhbHVlIGJ5IGFycmF5IG9mIEFTTjFPYmplY3QKICAgICAqIEBuYW1lIHNldEJ5QVNOMU9iamVjdEFycmF5CiAgICAgKiBAbWVtYmVyT2YgS0pVUi5hc24xLkRFUkFic3RyYWN0U3RydWN0dXJlZCMKICAgICAqIEBmdW5jdGlvbgogICAgICogQHBhcmFtIHthcnJheX0gYXNuMU9iamVjdEFycmF5IGFycmF5IG9mIEFTTjFPYmplY3QgdG8gc2V0CiAgICAgKi8KICAgIHRoaXMuc2V0QnlBU04xT2JqZWN0QXJyYXkgPSBmdW5jdGlvbihhc24xT2JqZWN0QXJyYXkpIHsKICAgICAgICB0aGlzLmhUTFYgPSBudWxsOwogICAgICAgIHRoaXMuaXNNb2RpZmllZCA9IHRydWU7CiAgICAgICAgdGhpcy5hc24xQXJyYXkgPSBhc24xT2JqZWN0QXJyYXk7CiAgICB9OwoKICAgIC8qKgogICAgICogYXBwZW5kIGFuIEFTTjFPYmplY3QgdG8gaW50ZXJuYWwgYXJyYXkKICAgICAqIEBuYW1lIGFwcGVuZEFTTjFPYmplY3QKICAgICAqIEBtZW1iZXJPZiBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJ1Y3R1cmVkIwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0ge0FTTjFPYmplY3R9IGFzbjFPYmplY3QgdG8gYWRkCiAgICAgKi8KICAgIHRoaXMuYXBwZW5kQVNOMU9iamVjdCA9IGZ1bmN0aW9uKGFzbjFPYmplY3QpIHsKICAgICAgICB0aGlzLmhUTFYgPSBudWxsOwogICAgICAgIHRoaXMuaXNNb2RpZmllZCA9IHRydWU7CiAgICAgICAgdGhpcy5hc24xQXJyYXkucHVzaChhc24xT2JqZWN0KTsKICAgIH07CgogICAgdGhpcy5hc24xQXJyYXkgPSBuZXcgQXJyYXkoKTsKICAgIGlmICh0eXBlb2YgcGFyYW1zICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgaWYgKHR5cGVvZiBwYXJhbXNbJ2FycmF5J10gIT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgdGhpcy5hc24xQXJyYXkgPSBwYXJhbXNbJ2FycmF5J107CiAgICAgICAgfQogICAgfQp9OwpZQUhPTy5sYW5nLmV4dGVuZChLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJ1Y3R1cmVkLCBLSlVSLmFzbjEuQVNOMU9iamVjdCk7CgoKLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKLy8gIEFTTi4xIE9iamVjdCBDbGFzc2VzCi8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCgovLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgovKioKICogY2xhc3MgZm9yIEFTTi4xIERFUiBCb29sZWFuCiAqIEBuYW1lIEtKVVIuYXNuMS5ERVJCb29sZWFuCiAqIEBjbGFzcyBjbGFzcyBmb3IgQVNOLjEgREVSIEJvb2xlYW4KICogQGV4dGVuZHMgS0pVUi5hc24xLkFTTjFPYmplY3QKICogQGRlc2NyaXB0aW9uCiAqIEBzZWUgS0pVUi5hc24xLkFTTjFPYmplY3QgLSBzdXBlcmNsYXNzCiAqLwpLSlVSLmFzbjEuREVSQm9vbGVhbiA9IGZ1bmN0aW9uKCkgewogICAgS0pVUi5hc24xLkRFUkJvb2xlYW4uc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMpOwogICAgdGhpcy5oVCA9ICIwMSI7CiAgICB0aGlzLmhUTFYgPSAiMDEwMWZmIjsKfTsKWUFIT08ubGFuZy5leHRlbmQoS0pVUi5hc24xLkRFUkJvb2xlYW4sIEtKVVIuYXNuMS5BU04xT2JqZWN0KTsKCi8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi8qKgogKiBjbGFzcyBmb3IgQVNOLjEgREVSIEludGVnZXIKICogQG5hbWUgS0pVUi5hc24xLkRFUkludGVnZXIKICogQGNsYXNzIGNsYXNzIGZvciBBU04uMSBERVIgSW50ZWdlcgogKiBAZXh0ZW5kcyBLSlVSLmFzbjEuQVNOMU9iamVjdAogKiBAZGVzY3JpcHRpb24KICogPGJyLz4KICogQXMgZm9yIGFyZ3VtZW50ICdwYXJhbXMnIGZvciBjb25zdHJ1Y3RvciwgeW91IGNhbiBzcGVjaWZ5IG9uZSBvZgogKiBmb2xsb3dpbmcgcHJvcGVydGllczoKICogPHVsPgogKiA8bGk+aW50IC0gc3BlY2lmeSBpbml0aWFsIEFTTi4xIHZhbHVlKFYpIGJ5IGludGVnZXIgdmFsdWU8L2xpPgogKiA8bGk+YmlnaW50IC0gc3BlY2lmeSBpbml0aWFsIEFTTi4xIHZhbHVlKFYpIGJ5IEJpZ0ludGVnZXIgb2JqZWN0PC9saT4KICogPGxpPmhleCAtIHNwZWNpZnkgaW5pdGlhbCBBU04uMSB2YWx1ZShWKSBieSBhIGhleGFkZWNpbWFsIHN0cmluZzwvbGk+CiAqIDwvdWw+CiAqIE5PVEU6ICdwYXJhbXMnIGNhbiBiZSBvbWl0dGVkLgogKi8KS0pVUi5hc24xLkRFUkludGVnZXIgPSBmdW5jdGlvbihwYXJhbXMpIHsKICAgIEtKVVIuYXNuMS5ERVJJbnRlZ2VyLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzKTsKICAgIHRoaXMuaFQgPSAiMDIiOwoKICAgIC8qKgogICAgICogc2V0IHZhbHVlIGJ5IFRvbSBXdSdzIEJpZ0ludGVnZXIgb2JqZWN0CiAgICAgKiBAbmFtZSBzZXRCeUJpZ0ludGVnZXIKICAgICAqIEBtZW1iZXJPZiBLSlVSLmFzbjEuREVSSW50ZWdlciMKICAgICAqIEBmdW5jdGlvbgogICAgICogQHBhcmFtIHtCaWdJbnRlZ2VyfSBiaWdJbnRlZ2VyVmFsdWUgdG8gc2V0CiAgICAgKi8KICAgIHRoaXMuc2V0QnlCaWdJbnRlZ2VyID0gZnVuY3Rpb24oYmlnSW50ZWdlclZhbHVlKSB7CiAgICAgICAgdGhpcy5oVExWID0gbnVsbDsKICAgICAgICB0aGlzLmlzTW9kaWZpZWQgPSB0cnVlOwogICAgICAgIHRoaXMuaFYgPSBLSlVSLmFzbjEuQVNOMVV0aWwuYmlnSW50VG9NaW5Ud29zQ29tcGxlbWVudHNIZXgoYmlnSW50ZWdlclZhbHVlKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBzZXQgdmFsdWUgYnkgaW50ZWdlciB2YWx1ZQogICAgICogQG5hbWUgc2V0QnlJbnRlZ2VyCiAgICAgKiBAbWVtYmVyT2YgS0pVUi5hc24xLkRFUkludGVnZXIKICAgICAqIEBmdW5jdGlvbgogICAgICogQHBhcmFtIHtJbnRlZ2VyfSBpbnRlZ2VyIHZhbHVlIHRvIHNldAogICAgICovCiAgICB0aGlzLnNldEJ5SW50ZWdlciA9IGZ1bmN0aW9uKGludFZhbHVlKSB7CiAgICAgICAgdmFyIGJpID0gbmV3IEJpZ0ludGVnZXIoU3RyaW5nKGludFZhbHVlKSwgMTApOwogICAgICAgIHRoaXMuc2V0QnlCaWdJbnRlZ2VyKGJpKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBzZXQgdmFsdWUgYnkgaW50ZWdlciB2YWx1ZQogICAgICogQG5hbWUgc2V0VmFsdWVIZXgKICAgICAqIEBtZW1iZXJPZiBLSlVSLmFzbjEuREVSSW50ZWdlciMKICAgICAqIEBmdW5jdGlvbgogICAgICogQHBhcmFtIHtTdHJpbmd9IGhleGFkZWNpbWFsIHN0cmluZyBvZiBpbnRlZ2VyIHZhbHVlCiAgICAgKiBAZGVzY3JpcHRpb24KICAgICAqIDxici8+CiAgICAgKiBOT1RFOiBWYWx1ZSBzaGFsbCBiZSByZXByZXNlbnRlZCBieSBtaW5pbXVtIG9jdGV0IGxlbmd0aCBvZgogICAgICogdHdvJ3MgY29tcGxlbWVudCByZXByZXNlbnRhdGlvbi4KICAgICAqIEBleGFtcGxlCiAgICAgKiBuZXcgS0pVUi5hc24xLkRFUkludGVnZXIoMTIzKTsKICAgICAqIG5ldyBLSlVSLmFzbjEuREVSSW50ZWdlcih7J2ludCc6IDEyM30pOwogICAgICogbmV3IEtKVVIuYXNuMS5ERVJJbnRlZ2VyKHsnaGV4JzogJzFmYWQnfSk7CiAgICAgKi8KICAgIHRoaXMuc2V0VmFsdWVIZXggPSBmdW5jdGlvbihuZXdIZXhTdHJpbmcpIHsKICAgICAgICB0aGlzLmhWID0gbmV3SGV4U3RyaW5nOwogICAgfTsKCiAgICB0aGlzLmdldEZyZXNoVmFsdWVIZXggPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5oVjsKICAgIH07CgogICAgaWYgKHR5cGVvZiBwYXJhbXMgIT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBpZiAodHlwZW9mIHBhcmFtc1snYmlnaW50J10gIT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgdGhpcy5zZXRCeUJpZ0ludGVnZXIocGFyYW1zWydiaWdpbnQnXSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcGFyYW1zWydpbnQnXSAhPSAidW5kZWZpbmVkIikgewogICAgICAgICAgICB0aGlzLnNldEJ5SW50ZWdlcihwYXJhbXNbJ2ludCddKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBwYXJhbXMgPT0gIm51bWJlciIpIHsKICAgICAgICAgICAgdGhpcy5zZXRCeUludGVnZXIocGFyYW1zKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBwYXJhbXNbJ2hleCddICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWVIZXgocGFyYW1zWydoZXgnXSk7CiAgICAgICAgfQogICAgfQp9OwpZQUhPTy5sYW5nLmV4dGVuZChLSlVSLmFzbjEuREVSSW50ZWdlciwgS0pVUi5hc24xLkFTTjFPYmplY3QpOwoKLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKLyoqCiAqIGNsYXNzIGZvciBBU04uMSBERVIgZW5jb2RlZCBCaXRTdHJpbmcgcHJpbWl0aXZlCiAqIEBuYW1lIEtKVVIuYXNuMS5ERVJCaXRTdHJpbmcKICogQGNsYXNzIGNsYXNzIGZvciBBU04uMSBERVIgZW5jb2RlZCBCaXRTdHJpbmcgcHJpbWl0aXZlCiAqIEBleHRlbmRzIEtKVVIuYXNuMS5BU04xT2JqZWN0CiAqIEBkZXNjcmlwdGlvbgogKiA8YnIvPgogKiBBcyBmb3IgYXJndW1lbnQgJ3BhcmFtcycgZm9yIGNvbnN0cnVjdG9yLCB5b3UgY2FuIHNwZWNpZnkgb25lIG9mCiAqIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogKiA8dWw+CiAqIDxsaT5iaW4gLSBzcGVjaWZ5IGJpbmFyeSBzdHJpbmcgKGV4LiAnMTAxMTEnKTwvbGk+CiAqIDxsaT5hcnJheSAtIHNwZWNpZnkgYXJyYXkgb2YgYm9vbGVhbiAoZXguIFt0cnVlLGZhbHNlLHRydWUsdHJ1ZV0pPC9saT4KICogPGxpPmhleCAtIHNwZWNpZnkgaGV4YWRlY2ltYWwgc3RyaW5nIG9mIEFTTi4xIHZhbHVlKFYpIGluY2x1ZGluZyB1bnVzZWQgYml0czwvbGk+CiAqIDxsaT5vYmogLSBzcGVjaWZ5IHtAbGluayBLSlVSLmFzbjEuQVNOMVV0aWwubmV3T2JqZWN0fQogKiBhcmd1bWVudCBmb3IgIkJpdFN0cmluZyBlbmNhcHN1bGF0ZXMiIHN0cnVjdHVyZS48L2xpPgogKiA8L3VsPgogKiBOT1RFMTogJ3BhcmFtcycgY2FuIGJlIG9taXR0ZWQuPGJyLz4KICogTk9URTI6ICdvYmonIHBhcmFtZXRlciBoYXZlIGJlZW4gc3VwcG9ydGVkIHNpbmNlCiAqIGFzbjEgMS4wLjExLCBqc3JzYXNpZ24gNi4xLjEgKDIwMTYtU2VwLTI1KS48YnIvPgogKiBAZXhhbXBsZQogKiAvLyBkZWZhdWx0IGNvbnN0cnVjdG9yCiAqIG8gPSBuZXcgS0pVUi5hc24xLkRFUkJpdFN0cmluZygpOwogKiAvLyBpbml0aWFsaXplIHdpdGggYmluYXJ5IHN0cmluZwogKiBvID0gbmV3IEtKVVIuYXNuMS5ERVJCaXRTdHJpbmcoe2JpbjogIjEwMTEifSk7CiAqIC8vIGluaXRpYWxpemUgd2l0aCBib29sZWFuIGFycmF5CiAqIG8gPSBuZXcgS0pVUi5hc24xLkRFUkJpdFN0cmluZyh7YXJyYXk6IFt0cnVlLGZhbHNlLHRydWUsdHJ1ZV19KTsKICogLy8gaW5pdGlhbGl6ZSB3aXRoIGhleGFkZWNpbWFsIHN0cmluZyAoMDQgaXMgdW51c2VkIGJpdHMpCiAqIG8gPSBuZXcgS0pVUi5hc24xLkRFUk9jdGV0U3RyaW5nKHtoZXg6ICIwNGJhYzAifSk7CiAqIC8vIGluaXRpYWxpemUgd2l0aCBBU04xVXRpbC5uZXdPYmplY3QgYXJndW1lbnQgZm9yIGVuY2Fwc3VsYXRlZAogKiBvID0gbmV3IEtKVVIuYXNuMS5ERVJCaXRTdHJpbmcoe29iajoge3NlcTogW3tpbnQ6IDN9LCB7cHJuc3RyOiAnYWFhJ31dfX0pOwogKiAvLyBhYm92ZSBnZW5lcmF0ZXMgYSBBU04uMSBkYXRhIGxpa2UgdGhpczoKICogLy8gQklUIFNUUklORywgZW5jYXBzdWxhdGVzIHsKICogLy8gICBTRVFVRU5DRSB7CiAqIC8vICAgICBJTlRFR0VSIDMKICogLy8gICAgIFByaW50YWJsZVN0cmluZyAnYWFhJwogKiAvLyAgICAgfQogKiAvLyAgIH0KICovCktKVVIuYXNuMS5ERVJCaXRTdHJpbmcgPSBmdW5jdGlvbihwYXJhbXMpIHsKICAgIGlmIChwYXJhbXMgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgcGFyYW1zLm9iaiAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICB2YXIgbyA9IEtKVVIuYXNuMS5BU04xVXRpbC5uZXdPYmplY3QocGFyYW1zLm9iaik7CiAgICAgICAgcGFyYW1zLmhleCA9ICIwMCIgKyBvLmdldEVuY29kZWRIZXgoKTsKICAgIH0KICAgIEtKVVIuYXNuMS5ERVJCaXRTdHJpbmcuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMpOwogICAgdGhpcy5oVCA9ICIwMyI7CgogICAgLyoqCiAgICAgKiBzZXQgQVNOLjEgdmFsdWUoVikgYnkgYSBoZXhhZGVjaW1hbCBzdHJpbmcgaW5jbHVkaW5nIHVudXNlZCBiaXRzCiAgICAgKiBAbmFtZSBzZXRIZXhWYWx1ZUluY2x1ZGluZ1VudXNlZEJpdHMKICAgICAqIEBtZW1iZXJPZiBLSlVSLmFzbjEuREVSQml0U3RyaW5nIwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmV3SGV4U3RyaW5nSW5jbHVkaW5nVW51c2VkQml0cwogICAgICovCiAgICB0aGlzLnNldEhleFZhbHVlSW5jbHVkaW5nVW51c2VkQml0cyA9IGZ1bmN0aW9uKG5ld0hleFN0cmluZ0luY2x1ZGluZ1VudXNlZEJpdHMpIHsKICAgICAgICB0aGlzLmhUTFYgPSBudWxsOwogICAgICAgIHRoaXMuaXNNb2RpZmllZCA9IHRydWU7CiAgICAgICAgdGhpcy5oViA9IG5ld0hleFN0cmluZ0luY2x1ZGluZ1VudXNlZEJpdHM7CiAgICB9OwoKICAgIC8qKgogICAgICogc2V0IEFTTi4xIHZhbHVlKFYpIGJ5IHVudXNlZCBiaXQgYW5kIGhleGFkZWNpbWFsIHN0cmluZyBvZiB2YWx1ZQogICAgICogQG5hbWUgc2V0VW51c2VkQml0c0FuZEhleFZhbHVlCiAgICAgKiBAbWVtYmVyT2YgS0pVUi5hc24xLkRFUkJpdFN0cmluZyMKICAgICAqIEBmdW5jdGlvbgogICAgICogQHBhcmFtIHtJbnRlZ2VyfSB1bnVzZWRCaXRzCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaFZhbHVlCiAgICAgKi8KICAgIHRoaXMuc2V0VW51c2VkQml0c0FuZEhleFZhbHVlID0gZnVuY3Rpb24odW51c2VkQml0cywgaFZhbHVlKSB7CiAgICAgICAgaWYgKHVudXNlZEJpdHMgPCAwIHx8IDcgPCB1bnVzZWRCaXRzKSB7CiAgICAgICAgICAgIHRocm93ICJ1bnVzZWQgYml0cyBzaGFsbCBiZSBmcm9tIDAgdG8gNzogdSA9ICIgKyB1bnVzZWRCaXRzOwogICAgICAgIH0KICAgICAgICB2YXIgaFVudXNlZEJpdHMgPSAiMCIgKyB1bnVzZWRCaXRzOwogICAgICAgIHRoaXMuaFRMViA9IG51bGw7CiAgICAgICAgdGhpcy5pc01vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB0aGlzLmhWID0gaFVudXNlZEJpdHMgKyBoVmFsdWU7CiAgICB9OwoKICAgIC8qKgogICAgICogc2V0IEFTTi4xIERFUiBCaXRTdHJpbmcgYnkgYmluYXJ5IHN0cmluZzxici8+CiAgICAgKiBAbmFtZSBzZXRCeUJpbmFyeVN0cmluZwogICAgICogQG1lbWJlck9mIEtKVVIuYXNuMS5ERVJCaXRTdHJpbmcjCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBiaW5hcnlTdHJpbmcgYmluYXJ5IHZhbHVlIHN0cmluZyAoaS5lLiAnMTAxMTEnKQogICAgICogQGRlc2NyaXB0aW9uCiAgICAgKiBJdHMgdW51c2VkIGJpdHMgd2lsbCBiZSBjYWxjdWxhdGVkIGF1dG9tYXRpY2FsbHkgYnkgbGVuZ3RoIG9mCiAgICAgKiAnYmluYXJ5VmFsdWUnLiA8YnIvPgogICAgICogTk9URTogVHJhaWxpbmcgemVyb3MgJzAnIHdpbGwgYmUgaWdub3JlZC4KICAgICAqIEBleGFtcGxlCiAgICAgKiBvID0gbmV3IEtKVVIuYXNuMS5ERVJCaXRTdHJpbmcoKTsKICAgICAqIG8uc2V0QnlCb29sZWFuQXJyYXkoIjAxMDExIik7CiAgICAgKi8KICAgIHRoaXMuc2V0QnlCaW5hcnlTdHJpbmcgPSBmdW5jdGlvbihiaW5hcnlTdHJpbmcpIHsKICAgICAgICBiaW5hcnlTdHJpbmcgPSBiaW5hcnlTdHJpbmcucmVwbGFjZSgvMCskLywgJycpOwogICAgICAgIHZhciB1bnVzZWRCaXRzID0gOCAtIGJpbmFyeVN0cmluZy5sZW5ndGggJSA4OwogICAgICAgIGlmICh1bnVzZWRCaXRzID09IDgpIHVudXNlZEJpdHMgPSAwOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IHVudXNlZEJpdHM7IGkrKykgewogICAgICAgICAgICBiaW5hcnlTdHJpbmcgKz0gJzAnOwogICAgICAgIH0KICAgICAgICB2YXIgaCA9ICcnOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYmluYXJ5U3RyaW5nLmxlbmd0aCAtIDE7IGkgKz0gOCkgewogICAgICAgICAgICB2YXIgYiA9IGJpbmFyeVN0cmluZy5zdWJzdHIoaSwgOCk7CiAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQoYiwgMikudG9TdHJpbmcoMTYpOwogICAgICAgICAgICBpZiAoeC5sZW5ndGggPT0gMSkgeCA9ICcwJyArIHg7CiAgICAgICAgICAgIGggKz0geDsKICAgICAgICB9CiAgICAgICAgdGhpcy5oVExWID0gbnVsbDsKICAgICAgICB0aGlzLmlzTW9kaWZpZWQgPSB0cnVlOwogICAgICAgIHRoaXMuaFYgPSAnMCcgKyB1bnVzZWRCaXRzICsgaDsKICAgIH07CgogICAgLyoqCiAgICAgKiBzZXQgQVNOLjEgVExWIHZhbHVlKFYpIGJ5IGFuIGFycmF5IG9mIGJvb2xlYW48YnIvPgogICAgICogQG5hbWUgc2V0QnlCb29sZWFuQXJyYXkKICAgICAqIEBtZW1iZXJPZiBLSlVSLmFzbjEuREVSQml0U3RyaW5nIwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0ge2FycmF5fSBib29sZWFuQXJyYXkgYXJyYXkgb2YgYm9vbGVhbiAoZXguIFt0cnVlLCBmYWxzZSwgdHJ1ZV0pCiAgICAgKiBAZGVzY3JpcHRpb24KICAgICAqIE5PVEU6IFRyYWlsaW5nIGZhbHNlcyB3aWxsIGJlIGlnbm9yZWQgaW4gdGhlIEFTTi4xIERFUiBPYmplY3QuCiAgICAgKiBAZXhhbXBsZQogICAgICogbyA9IG5ldyBLSlVSLmFzbjEuREVSQml0U3RyaW5nKCk7CiAgICAgKiBvLnNldEJ5Qm9vbGVhbkFycmF5KFtmYWxzZSwgdHJ1ZSwgZmFsc2UsIHRydWUsIHRydWVdKTsKICAgICAqLwogICAgdGhpcy5zZXRCeUJvb2xlYW5BcnJheSA9IGZ1bmN0aW9uKGJvb2xlYW5BcnJheSkgewogICAgICAgIHZhciBzID0gJyc7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBib29sZWFuQXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGJvb2xlYW5BcnJheVtpXSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICBzICs9ICcxJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHMgKz0gJzAnOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuc2V0QnlCaW5hcnlTdHJpbmcocyk7CiAgICB9OwoKICAgIC8qKgogICAgICogZ2VuZXJhdGUgYW4gYXJyYXkgb2YgZmFsc2VzIHdpdGggc3BlY2lmaWVkIGxlbmd0aDxici8+CiAgICAgKiBAbmFtZSBuZXdGYWxzZUFycmF5CiAgICAgKiBAbWVtYmVyT2YgS0pVUi5hc24xLkRFUkJpdFN0cmluZwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0ge0ludGVnZXJ9IG5MZW5ndGggbGVuZ3RoIG9mIGFycmF5IHRvIGdlbmVyYXRlCiAgICAgKiBAcmV0dXJuIHthcnJheX0gYXJyYXkgb2YgYm9vbGVhbiBmYWxzZXMKICAgICAqIEBkZXNjcmlwdGlvbgogICAgICogVGhpcyBzdGF0aWMgbWV0aG9kIG1heSBiZSB1c2VmdWwgdG8gaW5pdGlhbGl6ZSBib29sZWFuIGFycmF5LgogICAgICogQGV4YW1wbGUKICAgICAqIG8gPSBuZXcgS0pVUi5hc24xLkRFUkJpdFN0cmluZygpOwogICAgICogby5uZXdGYWxzZUFycmF5KDMpICZyYXJyOyBbZmFsc2UsIGZhbHNlLCBmYWxzZV0KICAgICAqLwogICAgdGhpcy5uZXdGYWxzZUFycmF5ID0gZnVuY3Rpb24obkxlbmd0aCkgewogICAgICAgIHZhciBhID0gbmV3IEFycmF5KG5MZW5ndGgpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbkxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGFbaV0gPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGE7CiAgICB9OwoKICAgIHRoaXMuZ2V0RnJlc2hWYWx1ZUhleCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmhWOwogICAgfTsKCiAgICBpZiAodHlwZW9mIHBhcmFtcyAhPSAidW5kZWZpbmVkIikgewogICAgICAgIGlmICh0eXBlb2YgcGFyYW1zID09ICJzdHJpbmciICYmIHBhcmFtcy50b0xvd2VyQ2FzZSgpLm1hdGNoKC9eWzAtOWEtZl0rJC8pKSB7CiAgICAgICAgICAgIHRoaXMuc2V0SGV4VmFsdWVJbmNsdWRpbmdVbnVzZWRCaXRzKHBhcmFtcyk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcGFyYW1zWydoZXgnXSAhPSAidW5kZWZpbmVkIikgewogICAgICAgICAgICB0aGlzLnNldEhleFZhbHVlSW5jbHVkaW5nVW51c2VkQml0cyhwYXJhbXNbJ2hleCddKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBwYXJhbXNbJ2JpbiddICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIHRoaXMuc2V0QnlCaW5hcnlTdHJpbmcocGFyYW1zWydiaW4nXSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcGFyYW1zWydhcnJheSddICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIHRoaXMuc2V0QnlCb29sZWFuQXJyYXkocGFyYW1zWydhcnJheSddKTsKICAgICAgICB9CiAgICB9Cn07CllBSE9PLmxhbmcuZXh0ZW5kKEtKVVIuYXNuMS5ERVJCaXRTdHJpbmcsIEtKVVIuYXNuMS5BU04xT2JqZWN0KTsKCi8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi8qKgogKiBjbGFzcyBmb3IgQVNOLjEgREVSIE9jdGV0U3RyaW5nPGJyLz4KICogQG5hbWUgS0pVUi5hc24xLkRFUk9jdGV0U3RyaW5nCiAqIEBjbGFzcyBjbGFzcyBmb3IgQVNOLjEgREVSIE9jdGV0U3RyaW5nCiAqIEBwYXJhbSB7QXJyYXl9IHBhcmFtcyBhc3NvY2lhdGl2ZSBhcnJheSBvZiBwYXJhbWV0ZXJzIChleC4geydzdHInOiAnYWFhJ30pCiAqIEBleHRlbmRzIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFN0cmluZwogKiBAZGVzY3JpcHRpb24KICogVGhpcyBjbGFzcyBwcm92aWRlcyBBU04uMSBPY3RldFN0cmluZyBzaW1wbGUgdHlwZS48YnIvPgogKiBTdXBwb3J0ZWQgInBhcmFtcyIgYXR0cmlidXRlcyBhcmU6CiAqIDx1bD4KICogPGxpPnN0ciAtIHRvIHNldCBhIHN0cmluZyBhcyBhIHZhbHVlPC9saT4KICogPGxpPmhleCAtIHRvIHNldCBhIGhleGFkZWNpbWFsIHN0cmluZyBhcyBhIHZhbHVlPC9saT4KICogPGxpPm9iaiAtIHRvIHNldCBhIGVuY2Fwc3VsYXRlZCBBU04uMSB2YWx1ZSBieSBKU09OIG9iamVjdAogKiB3aGljaCBpcyBkZWZpbmVkIGluIHtAbGluayBLSlVSLmFzbjEuQVNOMVV0aWwubmV3T2JqZWN0fTwvbGk+CiAqIDwvdWw+CiAqIE5PVEU6IEEgcGFyYW1ldGVyICdvYmonIGhhdmUgYmVlbiBzdXBwb3J0ZWQKICogZm9yICJPQ1RFVCBTVFJJTkcsIGVuY2Fwc3VsYXRlcyIgc3RydWN0dXJlLgogKiBzaW5jZSBhc24xIDEuMC4xMSwganNyc2FzaWduIDYuMS4xICgyMDE2LVNlcC0yNSkuCiAqIEBzZWUgS0pVUi5hc24xLkRFUkFic3RyYWN0U3RyaW5nIC0gc3VwZXJjbGFzcwogKiBAZXhhbXBsZQogKiAvLyBkZWZhdWx0IGNvbnN0cnVjdG9yCiAqIG8gPSBuZXcgS0pVUi5hc24xLkRFUk9jdGV0U3RyaW5nKCk7CiAqIC8vIGluaXRpYWxpemUgd2l0aCBzdHJpbmcKICogbyA9IG5ldyBLSlVSLmFzbjEuREVST2N0ZXRTdHJpbmcoe3N0cjogImFhYSJ9KTsKICogLy8gaW5pdGlhbGl6ZSB3aXRoIGhleGFkZWNpbWFsIHN0cmluZwogKiBvID0gbmV3IEtKVVIuYXNuMS5ERVJPY3RldFN0cmluZyh7aGV4OiAiNjE2MTYxIn0pOwogKiAvLyBpbml0aWFsaXplIHdpdGggQVNOMVV0aWwubmV3T2JqZWN0IGFyZ3VtZW50CiAqIG8gPSBuZXcgS0pVUi5hc24xLkRFUk9jdGV0U3RyaW5nKHtvYmo6IHtzZXE6IFt7aW50OiAzfSwge3BybnN0cjogJ2FhYSd9XX19KTsKICogLy8gYWJvdmUgZ2VuZXJhdGVzIGEgQVNOLjEgZGF0YSBsaWtlIHRoaXM6CiAqIC8vIE9DVEVUIFNUUklORywgZW5jYXBzdWxhdGVzIHsKICogLy8gICBTRVFVRU5DRSB7CiAqIC8vICAgICBJTlRFR0VSIDMKICogLy8gICAgIFByaW50YWJsZVN0cmluZyAnYWFhJwogKiAvLyAgICAgfQogKiAvLyAgIH0KICovCktKVVIuYXNuMS5ERVJPY3RldFN0cmluZyA9IGZ1bmN0aW9uKHBhcmFtcykgewogICAgaWYgKHBhcmFtcyAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBwYXJhbXMub2JqICE9PSAidW5kZWZpbmVkIikgewogICAgICAgIHZhciBvID0gS0pVUi5hc24xLkFTTjFVdGlsLm5ld09iamVjdChwYXJhbXMub2JqKTsKICAgICAgICBwYXJhbXMuaGV4ID0gby5nZXRFbmNvZGVkSGV4KCk7CiAgICB9CiAgICBLSlVSLmFzbjEuREVST2N0ZXRTdHJpbmcuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIHBhcmFtcyk7CiAgICB0aGlzLmhUID0gIjA0IjsKfTsKWUFIT08ubGFuZy5leHRlbmQoS0pVUi5hc24xLkRFUk9jdGV0U3RyaW5nLCBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJpbmcpOwoKLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKLyoqCiAqIGNsYXNzIGZvciBBU04uMSBERVIgTnVsbAogKiBAbmFtZSBLSlVSLmFzbjEuREVSTnVsbAogKiBAY2xhc3MgY2xhc3MgZm9yIEFTTi4xIERFUiBOdWxsCiAqIEBleHRlbmRzIEtKVVIuYXNuMS5BU04xT2JqZWN0CiAqIEBkZXNjcmlwdGlvbgogKiBAc2VlIEtKVVIuYXNuMS5BU04xT2JqZWN0IC0gc3VwZXJjbGFzcwogKi8KS0pVUi5hc24xLkRFUk51bGwgPSBmdW5jdGlvbigpIHsKICAgIEtKVVIuYXNuMS5ERVJOdWxsLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzKTsKICAgIHRoaXMuaFQgPSAiMDUiOwogICAgdGhpcy5oVExWID0gIjA1MDAiOwp9OwpZQUhPTy5sYW5nLmV4dGVuZChLSlVSLmFzbjEuREVSTnVsbCwgS0pVUi5hc24xLkFTTjFPYmplY3QpOwoKLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKLyoqCiAqIGNsYXNzIGZvciBBU04uMSBERVIgT2JqZWN0SWRlbnRpZmllcgogKiBAbmFtZSBLSlVSLmFzbjEuREVST2JqZWN0SWRlbnRpZmllcgogKiBAY2xhc3MgY2xhc3MgZm9yIEFTTi4xIERFUiBPYmplY3RJZGVudGlmaWVyCiAqIEBwYXJhbSB7QXJyYXl9IHBhcmFtcyBhc3NvY2lhdGl2ZSBhcnJheSBvZiBwYXJhbWV0ZXJzIChleC4geydvaWQnOiAnMi41LjQuNSd9KQogKiBAZXh0ZW5kcyBLSlVSLmFzbjEuQVNOMU9iamVjdAogKiBAZGVzY3JpcHRpb24KICogPGJyLz4KICogQXMgZm9yIGFyZ3VtZW50ICdwYXJhbXMnIGZvciBjb25zdHJ1Y3RvciwgeW91IGNhbiBzcGVjaWZ5IG9uZSBvZgogKiBmb2xsb3dpbmcgcHJvcGVydGllczoKICogPHVsPgogKiA8bGk+b2lkIC0gc3BlY2lmeSBpbml0aWFsIEFTTi4xIHZhbHVlKFYpIGJ5IGEgb2lkIHN0cmluZyAoZXguIDIuNS40LjEzKTwvbGk+CiAqIDxsaT5oZXggLSBzcGVjaWZ5IGluaXRpYWwgQVNOLjEgdmFsdWUoVikgYnkgYSBoZXhhZGVjaW1hbCBzdHJpbmc8L2xpPgogKiA8L3VsPgogKiBOT1RFOiAncGFyYW1zJyBjYW4gYmUgb21pdHRlZC4KICovCktKVVIuYXNuMS5ERVJPYmplY3RJZGVudGlmaWVyID0gZnVuY3Rpb24ocGFyYW1zKSB7CiAgICB2YXIgaXRveCA9IGZ1bmN0aW9uKGkpIHsKICAgICAgICB2YXIgaCA9IGkudG9TdHJpbmcoMTYpOwogICAgICAgIGlmIChoLmxlbmd0aCA9PSAxKSBoID0gJzAnICsgaDsKICAgICAgICByZXR1cm4gaDsKICAgIH07CiAgICB2YXIgcm9pZHRveCA9IGZ1bmN0aW9uKHJvaWQpIHsKICAgICAgICB2YXIgaCA9ICcnOwogICAgICAgIHZhciBiaSA9IG5ldyBCaWdJbnRlZ2VyKHJvaWQsIDEwKTsKICAgICAgICB2YXIgYiA9IGJpLnRvU3RyaW5nKDIpOwogICAgICAgIHZhciBwYWRMZW4gPSA3IC0gYi5sZW5ndGggJSA3OwogICAgICAgIGlmIChwYWRMZW4gPT0gNykgcGFkTGVuID0gMDsKICAgICAgICB2YXIgYlBhZCA9ICcnOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFkTGVuOyBpKyspIGJQYWQgKz0gJzAnOwogICAgICAgIGIgPSBiUGFkICsgYjsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGIubGVuZ3RoIC0gMTsgaSArPSA3KSB7CiAgICAgICAgICAgIHZhciBiOCA9IGIuc3Vic3RyKGksIDcpOwogICAgICAgICAgICBpZiAoaSAhPSBiLmxlbmd0aCAtIDcpIGI4ID0gJzEnICsgYjg7CiAgICAgICAgICAgIGggKz0gaXRveChwYXJzZUludChiOCwgMikpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaDsKICAgIH07CgogICAgS0pVUi5hc24xLkRFUk9iamVjdElkZW50aWZpZXIuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMpOwogICAgdGhpcy5oVCA9ICIwNiI7CgogICAgLyoqCiAgICAgKiBzZXQgdmFsdWUgYnkgYSBoZXhhZGVjaW1hbCBzdHJpbmcKICAgICAqIEBuYW1lIHNldFZhbHVlSGV4CiAgICAgKiBAbWVtYmVyT2YgS0pVUi5hc24xLkRFUk9iamVjdElkZW50aWZpZXIjCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuZXdIZXhTdHJpbmcgaGV4YWRlY2ltYWwgdmFsdWUgb2YgT0lEIGJ5dGVzCiAgICAgKi8KICAgIHRoaXMuc2V0VmFsdWVIZXggPSBmdW5jdGlvbihuZXdIZXhTdHJpbmcpIHsKICAgICAgICB0aGlzLmhUTFYgPSBudWxsOwogICAgICAgIHRoaXMuaXNNb2RpZmllZCA9IHRydWU7CiAgICAgICAgdGhpcy5zID0gbnVsbDsKICAgICAgICB0aGlzLmhWID0gbmV3SGV4U3RyaW5nOwogICAgfTsKCiAgICAvKioKICAgICAqIHNldCB2YWx1ZSBieSBhIE9JRCBzdHJpbmc8YnIvPgogICAgICogQG5hbWUgc2V0VmFsdWVPaWRTdHJpbmcKICAgICAqIEBtZW1iZXJPZiBLSlVSLmFzbjEuREVST2JqZWN0SWRlbnRpZmllciMKICAgICAqIEBmdW5jdGlvbgogICAgICogQHBhcmFtIHtTdHJpbmd9IG9pZFN0cmluZyBPSUQgc3RyaW5nIChleC4gMi41LjQuMTMpCiAgICAgKiBAZXhhbXBsZQogICAgICogbyA9IG5ldyBLSlVSLmFzbjEuREVST2JqZWN0SWRlbnRpZmllcigpOwogICAgICogby5zZXRWYWx1ZU9pZFN0cmluZygiMi41LjQuMTMiKTsKICAgICAqLwogICAgdGhpcy5zZXRWYWx1ZU9pZFN0cmluZyA9IGZ1bmN0aW9uKG9pZFN0cmluZykgewogICAgICAgIGlmICghIG9pZFN0cmluZy5tYXRjaCgvXlswLTkuXSskLykpIHsKICAgICAgICAgICAgdGhyb3cgIm1hbGZvcm1lZCBvaWQgc3RyaW5nOiAiICsgb2lkU3RyaW5nOwogICAgICAgIH0KICAgICAgICB2YXIgaCA9ICcnOwogICAgICAgIHZhciBhID0gb2lkU3RyaW5nLnNwbGl0KCcuJyk7CiAgICAgICAgdmFyIGkwID0gcGFyc2VJbnQoYVswXSkgKiA0MCArIHBhcnNlSW50KGFbMV0pOwogICAgICAgIGggKz0gaXRveChpMCk7CiAgICAgICAgYS5zcGxpY2UoMCwgMik7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGggKz0gcm9pZHRveChhW2ldKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5oVExWID0gbnVsbDsKICAgICAgICB0aGlzLmlzTW9kaWZpZWQgPSB0cnVlOwogICAgICAgIHRoaXMucyA9IG51bGw7CiAgICAgICAgdGhpcy5oViA9IGg7CiAgICB9OwoKICAgIC8qKgogICAgICogc2V0IHZhbHVlIGJ5IGEgT0lEIG5hbWUKICAgICAqIEBuYW1lIHNldFZhbHVlTmFtZQogICAgICogQG1lbWJlck9mIEtKVVIuYXNuMS5ERVJPYmplY3RJZGVudGlmaWVyIwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gb2lkTmFtZSBPSUQgbmFtZSAoZXguICdzZXJ2ZXJBdXRoJykKICAgICAqIEBzaW5jZSAxLjAuMQogICAgICogQGRlc2NyaXB0aW9uCiAgICAgKiBPSUQgbmFtZSBzaGFsbCBiZSBkZWZpbmVkIGluICdLSlVSLmFzbjEueDUwOS5PSUQubmFtZTJvaWRMaXN0Jy4KICAgICAqIE90aGVyd2lzZSByYWlzZSBlcnJvci4KICAgICAqIEBleGFtcGxlCiAgICAgKiBvID0gbmV3IEtKVVIuYXNuMS5ERVJPYmplY3RJZGVudGlmaWVyKCk7CiAgICAgKiBvLnNldFZhbHVlTmFtZSgic2VydmVyQXV0aCIpOwogICAgICovCiAgICB0aGlzLnNldFZhbHVlTmFtZSA9IGZ1bmN0aW9uKG9pZE5hbWUpIHsKICAgICAgICB2YXIgb2lkID0gS0pVUi5hc24xLng1MDkuT0lELm5hbWUyb2lkKG9pZE5hbWUpOwogICAgICAgIGlmIChvaWQgIT09ICcnKSB7CiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWVPaWRTdHJpbmcob2lkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyAiREVST2JqZWN0SWRlbnRpZmllciBvaWROYW1lIHVuZGVmaW5lZDogIiArIG9pZE5hbWU7CiAgICAgICAgfQogICAgfTsKCiAgICB0aGlzLmdldEZyZXNoVmFsdWVIZXggPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5oVjsKICAgIH07CgogICAgaWYgKHBhcmFtcyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKHR5cGVvZiBwYXJhbXMgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGlmIChwYXJhbXMubWF0Y2goL15bMC0yXS5bMC05Ll0rJC8pKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlT2lkU3RyaW5nKHBhcmFtcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlTmFtZShwYXJhbXMpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChwYXJhbXMub2lkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZU9pZFN0cmluZyhwYXJhbXMub2lkKTsKICAgICAgICB9IGVsc2UgaWYgKHBhcmFtcy5oZXggIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aGlzLnNldFZhbHVlSGV4KHBhcmFtcy5oZXgpOwogICAgICAgIH0gZWxzZSBpZiAocGFyYW1zLm5hbWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aGlzLnNldFZhbHVlTmFtZShwYXJhbXMubmFtZSk7CiAgICAgICAgfQogICAgfQp9OwpZQUhPTy5sYW5nLmV4dGVuZChLSlVSLmFzbjEuREVST2JqZWN0SWRlbnRpZmllciwgS0pVUi5hc24xLkFTTjFPYmplY3QpOwoKLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKLyoqCiAqIGNsYXNzIGZvciBBU04uMSBERVIgRW51bWVyYXRlZAogKiBAbmFtZSBLSlVSLmFzbjEuREVSRW51bWVyYXRlZAogKiBAY2xhc3MgY2xhc3MgZm9yIEFTTi4xIERFUiBFbnVtZXJhdGVkCiAqIEBleHRlbmRzIEtKVVIuYXNuMS5BU04xT2JqZWN0CiAqIEBkZXNjcmlwdGlvbgogKiA8YnIvPgogKiBBcyBmb3IgYXJndW1lbnQgJ3BhcmFtcycgZm9yIGNvbnN0cnVjdG9yLCB5b3UgY2FuIHNwZWNpZnkgb25lIG9mCiAqIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogKiA8dWw+CiAqIDxsaT5pbnQgLSBzcGVjaWZ5IGluaXRpYWwgQVNOLjEgdmFsdWUoVikgYnkgaW50ZWdlciB2YWx1ZTwvbGk+CiAqIDxsaT5oZXggLSBzcGVjaWZ5IGluaXRpYWwgQVNOLjEgdmFsdWUoVikgYnkgYSBoZXhhZGVjaW1hbCBzdHJpbmc8L2xpPgogKiA8L3VsPgogKiBOT1RFOiAncGFyYW1zJyBjYW4gYmUgb21pdHRlZC4KICogQGV4YW1wbGUKICogbmV3IEtKVVIuYXNuMS5ERVJFbnVtZXJhdGVkKDEyMyk7CiAqIG5ldyBLSlVSLmFzbjEuREVSRW51bWVyYXRlZCh7aW50OiAxMjN9KTsKICogbmV3IEtKVVIuYXNuMS5ERVJFbnVtZXJhdGVkKHtoZXg6ICcxZmFkJ30pOwogKi8KS0pVUi5hc24xLkRFUkVudW1lcmF0ZWQgPSBmdW5jdGlvbihwYXJhbXMpIHsKICAgIEtKVVIuYXNuMS5ERVJFbnVtZXJhdGVkLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzKTsKICAgIHRoaXMuaFQgPSAiMGEiOwoKICAgIC8qKgogICAgICogc2V0IHZhbHVlIGJ5IFRvbSBXdSdzIEJpZ0ludGVnZXIgb2JqZWN0CiAgICAgKiBAbmFtZSBzZXRCeUJpZ0ludGVnZXIKICAgICAqIEBtZW1iZXJPZiBLSlVSLmFzbjEuREVSRW51bWVyYXRlZCMKICAgICAqIEBmdW5jdGlvbgogICAgICogQHBhcmFtIHtCaWdJbnRlZ2VyfSBiaWdJbnRlZ2VyVmFsdWUgdG8gc2V0CiAgICAgKi8KICAgIHRoaXMuc2V0QnlCaWdJbnRlZ2VyID0gZnVuY3Rpb24oYmlnSW50ZWdlclZhbHVlKSB7CiAgICAgICAgdGhpcy5oVExWID0gbnVsbDsKICAgICAgICB0aGlzLmlzTW9kaWZpZWQgPSB0cnVlOwogICAgICAgIHRoaXMuaFYgPSBLSlVSLmFzbjEuQVNOMVV0aWwuYmlnSW50VG9NaW5Ud29zQ29tcGxlbWVudHNIZXgoYmlnSW50ZWdlclZhbHVlKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBzZXQgdmFsdWUgYnkgaW50ZWdlciB2YWx1ZQogICAgICogQG5hbWUgc2V0QnlJbnRlZ2VyCiAgICAgKiBAbWVtYmVyT2YgS0pVUi5hc24xLkRFUkVudW1lcmF0ZWQjCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBwYXJhbSB7SW50ZWdlcn0gaW50ZWdlciB2YWx1ZSB0byBzZXQKICAgICAqLwogICAgdGhpcy5zZXRCeUludGVnZXIgPSBmdW5jdGlvbihpbnRWYWx1ZSkgewogICAgICAgIHZhciBiaSA9IG5ldyBCaWdJbnRlZ2VyKFN0cmluZyhpbnRWYWx1ZSksIDEwKTsKICAgICAgICB0aGlzLnNldEJ5QmlnSW50ZWdlcihiaSk7CiAgICB9OwoKICAgIC8qKgogICAgICogc2V0IHZhbHVlIGJ5IGludGVnZXIgdmFsdWUKICAgICAqIEBuYW1lIHNldFZhbHVlSGV4CiAgICAgKiBAbWVtYmVyT2YgS0pVUi5hc24xLkRFUkVudW1lcmF0ZWQjCiAgICAgKiBAZnVuY3Rpb24KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBoZXhhZGVjaW1hbCBzdHJpbmcgb2YgaW50ZWdlciB2YWx1ZQogICAgICogQGRlc2NyaXB0aW9uCiAgICAgKiA8YnIvPgogICAgICogTk9URTogVmFsdWUgc2hhbGwgYmUgcmVwcmVzZW50ZWQgYnkgbWluaW11bSBvY3RldCBsZW5ndGggb2YKICAgICAqIHR3bydzIGNvbXBsZW1lbnQgcmVwcmVzZW50YXRpb24uCiAgICAgKi8KICAgIHRoaXMuc2V0VmFsdWVIZXggPSBmdW5jdGlvbihuZXdIZXhTdHJpbmcpIHsKICAgICAgICB0aGlzLmhWID0gbmV3SGV4U3RyaW5nOwogICAgfTsKCiAgICB0aGlzLmdldEZyZXNoVmFsdWVIZXggPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5oVjsKICAgIH07CgogICAgaWYgKHR5cGVvZiBwYXJhbXMgIT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBpZiAodHlwZW9mIHBhcmFtc1snaW50J10gIT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgdGhpcy5zZXRCeUludGVnZXIocGFyYW1zWydpbnQnXSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcGFyYW1zID09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIHRoaXMuc2V0QnlJbnRlZ2VyKHBhcmFtcyk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcGFyYW1zWydoZXgnXSAhPSAidW5kZWZpbmVkIikgewogICAgICAgICAgICB0aGlzLnNldFZhbHVlSGV4KHBhcmFtc1snaGV4J10pOwogICAgICAgIH0KICAgIH0KfTsKWUFIT08ubGFuZy5leHRlbmQoS0pVUi5hc24xLkRFUkVudW1lcmF0ZWQsIEtKVVIuYXNuMS5BU04xT2JqZWN0KTsKCi8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi8qKgogKiBjbGFzcyBmb3IgQVNOLjEgREVSIFVURjhTdHJpbmcKICogQG5hbWUgS0pVUi5hc24xLkRFUlVURjhTdHJpbmcKICogQGNsYXNzIGNsYXNzIGZvciBBU04uMSBERVIgVVRGOFN0cmluZwogKiBAcGFyYW0ge0FycmF5fSBwYXJhbXMgYXNzb2NpYXRpdmUgYXJyYXkgb2YgcGFyYW1ldGVycyAoZXguIHsnc3RyJzogJ2FhYSd9KQogKiBAZXh0ZW5kcyBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJpbmcKICogQGRlc2NyaXB0aW9uCiAqIEBzZWUgS0pVUi5hc24xLkRFUkFic3RyYWN0U3RyaW5nIC0gc3VwZXJjbGFzcwogKi8KS0pVUi5hc24xLkRFUlVURjhTdHJpbmcgPSBmdW5jdGlvbihwYXJhbXMpIHsKICAgIEtKVVIuYXNuMS5ERVJVVEY4U3RyaW5nLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzLCBwYXJhbXMpOwogICAgdGhpcy5oVCA9ICIwYyI7Cn07CllBSE9PLmxhbmcuZXh0ZW5kKEtKVVIuYXNuMS5ERVJVVEY4U3RyaW5nLCBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJpbmcpOwoKLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKLyoqCiAqIGNsYXNzIGZvciBBU04uMSBERVIgTnVtZXJpY1N0cmluZwogKiBAbmFtZSBLSlVSLmFzbjEuREVSTnVtZXJpY1N0cmluZwogKiBAY2xhc3MgY2xhc3MgZm9yIEFTTi4xIERFUiBOdW1lcmljU3RyaW5nCiAqIEBwYXJhbSB7QXJyYXl9IHBhcmFtcyBhc3NvY2lhdGl2ZSBhcnJheSBvZiBwYXJhbWV0ZXJzIChleC4geydzdHInOiAnYWFhJ30pCiAqIEBleHRlbmRzIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFN0cmluZwogKiBAZGVzY3JpcHRpb24KICogQHNlZSBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJpbmcgLSBzdXBlcmNsYXNzCiAqLwpLSlVSLmFzbjEuREVSTnVtZXJpY1N0cmluZyA9IGZ1bmN0aW9uKHBhcmFtcykgewogICAgS0pVUi5hc24xLkRFUk51bWVyaWNTdHJpbmcuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIHBhcmFtcyk7CiAgICB0aGlzLmhUID0gIjEyIjsKfTsKWUFIT08ubGFuZy5leHRlbmQoS0pVUi5hc24xLkRFUk51bWVyaWNTdHJpbmcsIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFN0cmluZyk7CgovLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgovKioKICogY2xhc3MgZm9yIEFTTi4xIERFUiBQcmludGFibGVTdHJpbmcKICogQG5hbWUgS0pVUi5hc24xLkRFUlByaW50YWJsZVN0cmluZwogKiBAY2xhc3MgY2xhc3MgZm9yIEFTTi4xIERFUiBQcmludGFibGVTdHJpbmcKICogQHBhcmFtIHtBcnJheX0gcGFyYW1zIGFzc29jaWF0aXZlIGFycmF5IG9mIHBhcmFtZXRlcnMgKGV4LiB7J3N0cic6ICdhYWEnfSkKICogQGV4dGVuZHMgS0pVUi5hc24xLkRFUkFic3RyYWN0U3RyaW5nCiAqIEBkZXNjcmlwdGlvbgogKiBAc2VlIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFN0cmluZyAtIHN1cGVyY2xhc3MKICovCktKVVIuYXNuMS5ERVJQcmludGFibGVTdHJpbmcgPSBmdW5jdGlvbihwYXJhbXMpIHsKICAgIEtKVVIuYXNuMS5ERVJQcmludGFibGVTdHJpbmcuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIHBhcmFtcyk7CiAgICB0aGlzLmhUID0gIjEzIjsKfTsKWUFIT08ubGFuZy5leHRlbmQoS0pVUi5hc24xLkRFUlByaW50YWJsZVN0cmluZywgS0pVUi5hc24xLkRFUkFic3RyYWN0U3RyaW5nKTsKCi8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi8qKgogKiBjbGFzcyBmb3IgQVNOLjEgREVSIFRlbGV0ZXhTdHJpbmcKICogQG5hbWUgS0pVUi5hc24xLkRFUlRlbGV0ZXhTdHJpbmcKICogQGNsYXNzIGNsYXNzIGZvciBBU04uMSBERVIgVGVsZXRleFN0cmluZwogKiBAcGFyYW0ge0FycmF5fSBwYXJhbXMgYXNzb2NpYXRpdmUgYXJyYXkgb2YgcGFyYW1ldGVycyAoZXguIHsnc3RyJzogJ2FhYSd9KQogKiBAZXh0ZW5kcyBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJpbmcKICogQGRlc2NyaXB0aW9uCiAqIEBzZWUgS0pVUi5hc24xLkRFUkFic3RyYWN0U3RyaW5nIC0gc3VwZXJjbGFzcwogKi8KS0pVUi5hc24xLkRFUlRlbGV0ZXhTdHJpbmcgPSBmdW5jdGlvbihwYXJhbXMpIHsKICAgIEtKVVIuYXNuMS5ERVJUZWxldGV4U3RyaW5nLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzLCBwYXJhbXMpOwogICAgdGhpcy5oVCA9ICIxNCI7Cn07CllBSE9PLmxhbmcuZXh0ZW5kKEtKVVIuYXNuMS5ERVJUZWxldGV4U3RyaW5nLCBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJpbmcpOwoKLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKLyoqCiAqIGNsYXNzIGZvciBBU04uMSBERVIgSUE1U3RyaW5nCiAqIEBuYW1lIEtKVVIuYXNuMS5ERVJJQTVTdHJpbmcKICogQGNsYXNzIGNsYXNzIGZvciBBU04uMSBERVIgSUE1U3RyaW5nCiAqIEBwYXJhbSB7QXJyYXl9IHBhcmFtcyBhc3NvY2lhdGl2ZSBhcnJheSBvZiBwYXJhbWV0ZXJzIChleC4geydzdHInOiAnYWFhJ30pCiAqIEBleHRlbmRzIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFN0cmluZwogKiBAZGVzY3JpcHRpb24KICogQHNlZSBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJpbmcgLSBzdXBlcmNsYXNzCiAqLwpLSlVSLmFzbjEuREVSSUE1U3RyaW5nID0gZnVuY3Rpb24ocGFyYW1zKSB7CiAgICBLSlVSLmFzbjEuREVSSUE1U3RyaW5nLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzLCBwYXJhbXMpOwogICAgdGhpcy5oVCA9ICIxNiI7Cn07CllBSE9PLmxhbmcuZXh0ZW5kKEtKVVIuYXNuMS5ERVJJQTVTdHJpbmcsIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFN0cmluZyk7CgovLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgovKioKICogY2xhc3MgZm9yIEFTTi4xIERFUiBVVENUaW1lCiAqIEBuYW1lIEtKVVIuYXNuMS5ERVJVVENUaW1lCiAqIEBjbGFzcyBjbGFzcyBmb3IgQVNOLjEgREVSIFVUQ1RpbWUKICogQHBhcmFtIHtBcnJheX0gcGFyYW1zIGFzc29jaWF0aXZlIGFycmF5IG9mIHBhcmFtZXRlcnMgKGV4LiB7J3N0cic6ICcxMzA0MzAyMzU5NTlaJ30pCiAqIEBleHRlbmRzIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFRpbWUKICogQGRlc2NyaXB0aW9uCiAqIDxici8+CiAqIEFzIGZvciBhcmd1bWVudCAncGFyYW1zJyBmb3IgY29uc3RydWN0b3IsIHlvdSBjYW4gc3BlY2lmeSBvbmUgb2YKICogZm9sbG93aW5nIHByb3BlcnRpZXM6CiAqIDx1bD4KICogPGxpPnN0ciAtIHNwZWNpZnkgaW5pdGlhbCBBU04uMSB2YWx1ZShWKSBieSBhIHN0cmluZyAoZXguJzEzMDQzMDIzNTk1OVonKTwvbGk+CiAqIDxsaT5oZXggLSBzcGVjaWZ5IGluaXRpYWwgQVNOLjEgdmFsdWUoVikgYnkgYSBoZXhhZGVjaW1hbCBzdHJpbmc8L2xpPgogKiA8bGk+ZGF0ZSAtIHNwZWNpZnkgRGF0ZSBvYmplY3QuPC9saT4KICogPC91bD4KICogTk9URTogJ3BhcmFtcycgY2FuIGJlIG9taXR0ZWQuCiAqIDxoND5FWEFNUExFUzwvaDQ+CiAqIEBleGFtcGxlCiAqIGQxID0gbmV3IEtKVVIuYXNuMS5ERVJVVENUaW1lKCk7CiAqIGQxLnNldFN0cmluZygnMTMwNDMwMTI1OTU5WicpOwogKgogKiBkMiA9IG5ldyBLSlVSLmFzbjEuREVSVVRDVGltZSh7J3N0cic6ICcxMzA0MzAxMjU5NTlaJ30pOwogKiBkMyA9IG5ldyBLSlVSLmFzbjEuREVSVVRDVGltZSh7J2RhdGUnOiBuZXcgRGF0ZShEYXRlLlVUQygyMDE1LCAwLCAzMSwgMCwgMCwgMCwgMCkpfSk7CiAqIGQ0ID0gbmV3IEtKVVIuYXNuMS5ERVJVVENUaW1lKCcxMzA0MzAxMjU5NTlaJyk7CiAqLwpLSlVSLmFzbjEuREVSVVRDVGltZSA9IGZ1bmN0aW9uKHBhcmFtcykgewogICAgS0pVUi5hc24xLkRFUlVUQ1RpbWUuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIHBhcmFtcyk7CiAgICB0aGlzLmhUID0gIjE3IjsKCiAgICAvKioKICAgICAqIHNldCB2YWx1ZSBieSBhIERhdGUgb2JqZWN0PGJyLz4KICAgICAqIEBuYW1lIHNldEJ5RGF0ZQogICAgICogQG1lbWJlck9mIEtKVVIuYXNuMS5ERVJVVENUaW1lIwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0ge0RhdGV9IGRhdGVPYmplY3QgRGF0ZSBvYmplY3QgdG8gc2V0IEFTTi4xIHZhbHVlKFYpCiAgICAgKiBAZXhhbXBsZQogICAgICogbyA9IG5ldyBLSlVSLmFzbjEuREVSVVRDVGltZSgpOwogICAgICogby5zZXRCeURhdGUobmV3IERhdGUoIjIwMTYvMTIvMzEiKSk7CiAgICAgKi8KICAgIHRoaXMuc2V0QnlEYXRlID0gZnVuY3Rpb24oZGF0ZU9iamVjdCkgewogICAgICAgIHRoaXMuaFRMViA9IG51bGw7CiAgICAgICAgdGhpcy5pc01vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB0aGlzLmRhdGUgPSBkYXRlT2JqZWN0OwogICAgICAgIHRoaXMucyA9IHRoaXMuZm9ybWF0RGF0ZSh0aGlzLmRhdGUsICd1dGMnKTsKICAgICAgICB0aGlzLmhWID0gc3RvaGV4KHRoaXMucyk7CiAgICB9OwoKICAgIHRoaXMuZ2V0RnJlc2hWYWx1ZUhleCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICh0eXBlb2YgdGhpcy5kYXRlID09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB0aGlzLnMgPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgdGhpcy5kYXRlID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgdGhpcy5zID0gdGhpcy5mb3JtYXREYXRlKHRoaXMuZGF0ZSwgJ3V0YycpOwogICAgICAgICAgICB0aGlzLmhWID0gc3RvaGV4KHRoaXMucyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmhWOwogICAgfTsKCiAgICBpZiAocGFyYW1zICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAocGFyYW1zLnN0ciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMuc2V0U3RyaW5nKHBhcmFtcy5zdHIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHBhcmFtcyA9PSAic3RyaW5nIiAmJiBwYXJhbXMubWF0Y2goL15bMC05XXsxMn1aJC8pKSB7CiAgICAgICAgICAgIHRoaXMuc2V0U3RyaW5nKHBhcmFtcyk7CiAgICAgICAgfSBlbHNlIGlmIChwYXJhbXMuaGV4ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhpcy5zZXRTdHJpbmdIZXgocGFyYW1zLmhleCk7CiAgICAgICAgfSBlbHNlIGlmIChwYXJhbXMuZGF0ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMuc2V0QnlEYXRlKHBhcmFtcy5kYXRlKTsKICAgICAgICB9CiAgICB9Cn07CllBSE9PLmxhbmcuZXh0ZW5kKEtKVVIuYXNuMS5ERVJVVENUaW1lLCBLSlVSLmFzbjEuREVSQWJzdHJhY3RUaW1lKTsKCi8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi8qKgogKiBjbGFzcyBmb3IgQVNOLjEgREVSIEdlbmVyYWxpemVkVGltZQogKiBAbmFtZSBLSlVSLmFzbjEuREVSR2VuZXJhbGl6ZWRUaW1lCiAqIEBjbGFzcyBjbGFzcyBmb3IgQVNOLjEgREVSIEdlbmVyYWxpemVkVGltZQogKiBAcGFyYW0ge0FycmF5fSBwYXJhbXMgYXNzb2NpYXRpdmUgYXJyYXkgb2YgcGFyYW1ldGVycyAoZXguIHsnc3RyJzogJzIwMTMwNDMwMjM1OTU5Wid9KQogKiBAcHJvcGVydHkge0Jvb2xlYW59IHdpdGhNaWxsaXMgZmxhZyB0byBzaG93IG1pbGxpc2Vjb25kcyBvciBub3QKICogQGV4dGVuZHMgS0pVUi5hc24xLkRFUkFic3RyYWN0VGltZQogKiBAZGVzY3JpcHRpb24KICogPGJyLz4KICogQXMgZm9yIGFyZ3VtZW50ICdwYXJhbXMnIGZvciBjb25zdHJ1Y3RvciwgeW91IGNhbiBzcGVjaWZ5IG9uZSBvZgogKiBmb2xsb3dpbmcgcHJvcGVydGllczoKICogPHVsPgogKiA8bGk+c3RyIC0gc3BlY2lmeSBpbml0aWFsIEFTTi4xIHZhbHVlKFYpIGJ5IGEgc3RyaW5nIChleC4nMjAxMzA0MzAyMzU5NTlaJyk8L2xpPgogKiA8bGk+aGV4IC0gc3BlY2lmeSBpbml0aWFsIEFTTi4xIHZhbHVlKFYpIGJ5IGEgaGV4YWRlY2ltYWwgc3RyaW5nPC9saT4KICogPGxpPmRhdGUgLSBzcGVjaWZ5IERhdGUgb2JqZWN0LjwvbGk+CiAqIDxsaT5taWxsaXMgLSBzcGVjaWZ5IGZsYWcgdG8gc2hvdyBtaWxsaXNlY29uZHMgKGZyb20gMS4wLjYpPC9saT4KICogPC91bD4KICogTk9URTE6ICdwYXJhbXMnIGNhbiBiZSBvbWl0dGVkLgogKiBOT1RFMjogJ3dpdGhNaWxsaXMnIHByb3BlcnR5IGlzIHN1cHBvcnRlZCBmcm9tIGFzbjEgMS4wLjYuCiAqLwpLSlVSLmFzbjEuREVSR2VuZXJhbGl6ZWRUaW1lID0gZnVuY3Rpb24ocGFyYW1zKSB7CiAgICBLSlVSLmFzbjEuREVSR2VuZXJhbGl6ZWRUaW1lLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzLCBwYXJhbXMpOwogICAgdGhpcy5oVCA9ICIxOCI7CiAgICB0aGlzLndpdGhNaWxsaXMgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIHNldCB2YWx1ZSBieSBhIERhdGUgb2JqZWN0CiAgICAgKiBAbmFtZSBzZXRCeURhdGUKICAgICAqIEBtZW1iZXJPZiBLSlVSLmFzbjEuREVSR2VuZXJhbGl6ZWRUaW1lIwogICAgICogQGZ1bmN0aW9uCiAgICAgKiBAcGFyYW0ge0RhdGV9IGRhdGVPYmplY3QgRGF0ZSBvYmplY3QgdG8gc2V0IEFTTi4xIHZhbHVlKFYpCiAgICAgKiBAZXhhbXBsZQogICAgICogV2hlbiB5b3Ugc3BlY2lmeSBVVEMgdGltZSwgdXNlICdEYXRlLlVUQycgbWV0aG9kIGxpa2UgdGhpczo8YnIvPgogICAgICogbzEgPSBuZXcgREVSVVRDVGltZSgpOwogICAgICogbzEuc2V0QnlEYXRlKGRhdGUpOwogICAgICoKICAgICAqIGRhdGUgPSBuZXcgRGF0ZShEYXRlLlVUQygyMDE1LCAwLCAzMSwgMjMsIDU5LCA1OSwgMCkpOyAjMjAxNUpBTjMxIDIzOjU5OjU5CiAgICAgKi8KICAgIHRoaXMuc2V0QnlEYXRlID0gZnVuY3Rpb24oZGF0ZU9iamVjdCkgewogICAgICAgIHRoaXMuaFRMViA9IG51bGw7CiAgICAgICAgdGhpcy5pc01vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB0aGlzLmRhdGUgPSBkYXRlT2JqZWN0OwogICAgICAgIHRoaXMucyA9IHRoaXMuZm9ybWF0RGF0ZSh0aGlzLmRhdGUsICdnZW4nLCB0aGlzLndpdGhNaWxsaXMpOwogICAgICAgIHRoaXMuaFYgPSBzdG9oZXgodGhpcy5zKTsKICAgIH07CgogICAgdGhpcy5nZXRGcmVzaFZhbHVlSGV4ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKHRoaXMuZGF0ZSA9PT0gdW5kZWZpbmVkICYmIHRoaXMucyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMuZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgIHRoaXMucyA9IHRoaXMuZm9ybWF0RGF0ZSh0aGlzLmRhdGUsICdnZW4nLCB0aGlzLndpdGhNaWxsaXMpOwogICAgICAgICAgICB0aGlzLmhWID0gc3RvaGV4KHRoaXMucyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmhWOwogICAgfTsKCiAgICBpZiAocGFyYW1zICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAocGFyYW1zLnN0ciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMuc2V0U3RyaW5nKHBhcmFtcy5zdHIpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHBhcmFtcyA9PSAic3RyaW5nIiAmJiBwYXJhbXMubWF0Y2goL15bMC05XXsxNH1aJC8pKSB7CiAgICAgICAgICAgIHRoaXMuc2V0U3RyaW5nKHBhcmFtcyk7CiAgICAgICAgfSBlbHNlIGlmIChwYXJhbXMuaGV4ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhpcy5zZXRTdHJpbmdIZXgocGFyYW1zLmhleCk7CiAgICAgICAgfSBlbHNlIGlmIChwYXJhbXMuZGF0ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMuc2V0QnlEYXRlKHBhcmFtcy5kYXRlKTsKICAgICAgICB9CiAgICAgICAgaWYgKHBhcmFtcy5taWxsaXMgPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy53aXRoTWlsbGlzID0gdHJ1ZTsKICAgICAgICB9CiAgICB9Cn07CllBSE9PLmxhbmcuZXh0ZW5kKEtKVVIuYXNuMS5ERVJHZW5lcmFsaXplZFRpbWUsIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFRpbWUpOwoKLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKLyoqCiAqIGNsYXNzIGZvciBBU04uMSBERVIgU2VxdWVuY2UKICogQG5hbWUgS0pVUi5hc24xLkRFUlNlcXVlbmNlCiAqIEBjbGFzcyBjbGFzcyBmb3IgQVNOLjEgREVSIFNlcXVlbmNlCiAqIEBleHRlbmRzIEtKVVIuYXNuMS5ERVJBYnN0cmFjdFN0cnVjdHVyZWQKICogQGRlc2NyaXB0aW9uCiAqIDxici8+CiAqIEFzIGZvciBhcmd1bWVudCAncGFyYW1zJyBmb3IgY29uc3RydWN0b3IsIHlvdSBjYW4gc3BlY2lmeSBvbmUgb2YKICogZm9sbG93aW5nIHByb3BlcnRpZXM6CiAqIDx1bD4KICogPGxpPmFycmF5IC0gc3BlY2lmeSBhcnJheSBvZiBBU04xT2JqZWN0IHRvIHNldCBlbGVtZW50cyBvZiBjb250ZW50PC9saT4KICogPC91bD4KICogTk9URTogJ3BhcmFtcycgY2FuIGJlIG9taXR0ZWQuCiAqLwpLSlVSLmFzbjEuREVSU2VxdWVuY2UgPSBmdW5jdGlvbihwYXJhbXMpIHsKICAgIEtKVVIuYXNuMS5ERVJTZXF1ZW5jZS5zdXBlcmNsYXNzLmNvbnN0cnVjdG9yLmNhbGwodGhpcywgcGFyYW1zKTsKICAgIHRoaXMuaFQgPSAiMzAiOwogICAgdGhpcy5nZXRGcmVzaFZhbHVlSGV4ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGggPSAnJzsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYXNuMUFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBhc24xT2JqID0gdGhpcy5hc24xQXJyYXlbaV07CiAgICAgICAgICAgIGggKz0gYXNuMU9iai5nZXRFbmNvZGVkSGV4KCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuaFYgPSBoOwogICAgICAgIHJldHVybiB0aGlzLmhWOwogICAgfTsKfTsKWUFIT08ubGFuZy5leHRlbmQoS0pVUi5hc24xLkRFUlNlcXVlbmNlLCBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJ1Y3R1cmVkKTsKCi8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi8qKgogKiBjbGFzcyBmb3IgQVNOLjEgREVSIFNldAogKiBAbmFtZSBLSlVSLmFzbjEuREVSU2V0CiAqIEBjbGFzcyBjbGFzcyBmb3IgQVNOLjEgREVSIFNldAogKiBAZXh0ZW5kcyBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJ1Y3R1cmVkCiAqIEBkZXNjcmlwdGlvbgogKiA8YnIvPgogKiBBcyBmb3IgYXJndW1lbnQgJ3BhcmFtcycgZm9yIGNvbnN0cnVjdG9yLCB5b3UgY2FuIHNwZWNpZnkgb25lIG9mCiAqIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogKiA8dWw+CiAqIDxsaT5hcnJheSAtIHNwZWNpZnkgYXJyYXkgb2YgQVNOMU9iamVjdCB0byBzZXQgZWxlbWVudHMgb2YgY29udGVudDwvbGk+CiAqIDxsaT5zb3J0ZmxhZyAtIGZsYWcgZm9yIHNvcnQgKGRlZmF1bHQ6IHRydWUpLiBBU04uMSBCRVIgaXMgbm90IHNvcnRlZCBpbiAnU0VUIE9GJy48L2xpPgogKiA8L3VsPgogKiBOT1RFMTogJ3BhcmFtcycgY2FuIGJlIG9taXR0ZWQuPGJyLz4KICogTk9URTI6IHNvcnRmbGFnIGlzIHN1cHBvcnRlZCBzaW5jZSAxLjAuNS4KICovCktKVVIuYXNuMS5ERVJTZXQgPSBmdW5jdGlvbihwYXJhbXMpIHsKICAgIEtKVVIuYXNuMS5ERVJTZXQuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIHBhcmFtcyk7CiAgICB0aGlzLmhUID0gIjMxIjsKICAgIHRoaXMuc29ydEZsYWcgPSB0cnVlOyAvLyBpdGVtIHNoYWxsIGJlIHNvcnRlZCBvbmx5IGluIEFTTi4xIERFUgogICAgdGhpcy5nZXRGcmVzaFZhbHVlSGV4ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGEgPSBuZXcgQXJyYXkoKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYXNuMUFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBhc24xT2JqID0gdGhpcy5hc24xQXJyYXlbaV07CiAgICAgICAgICAgIGEucHVzaChhc24xT2JqLmdldEVuY29kZWRIZXgoKSk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnNvcnRGbGFnID09IHRydWUpIGEuc29ydCgpOwogICAgICAgIHRoaXMuaFYgPSBhLmpvaW4oJycpOwogICAgICAgIHJldHVybiB0aGlzLmhWOwogICAgfTsKCiAgICBpZiAodHlwZW9mIHBhcmFtcyAhPSAidW5kZWZpbmVkIikgewogICAgICAgIGlmICh0eXBlb2YgcGFyYW1zLnNvcnRmbGFnICE9ICJ1bmRlZmluZWQiICYmCiAgICAgICAgICAgIHBhcmFtcy5zb3J0ZmxhZyA9PSBmYWxzZSkKICAgICAgICAgICAgdGhpcy5zb3J0RmxhZyA9IGZhbHNlOwogICAgfQp9OwpZQUhPTy5sYW5nLmV4dGVuZChLSlVSLmFzbjEuREVSU2V0LCBLSlVSLmFzbjEuREVSQWJzdHJhY3RTdHJ1Y3R1cmVkKTsKCi8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi8qKgogKiBjbGFzcyBmb3IgQVNOLjEgREVSIFRhZ2dlZE9iamVjdAogKiBAbmFtZSBLSlVSLmFzbjEuREVSVGFnZ2VkT2JqZWN0CiAqIEBjbGFzcyBjbGFzcyBmb3IgQVNOLjEgREVSIFRhZ2dlZE9iamVjdAogKiBAZXh0ZW5kcyBLSlVSLmFzbjEuQVNOMU9iamVjdAogKiBAZGVzY3JpcHRpb24KICogPGJyLz4KICogUGFyYW1ldGVyICd0YWdOb05leCcgaXMgQVNOLjEgdGFnKFQpIHZhbHVlIGZvciB0aGlzIG9iamVjdC4KICogRm9yIGV4YW1wbGUsIGlmIHlvdSBmaW5kICdbMV0nIHRhZyBpbiBhIEFTTi4xIGR1bXAsCiAqICd0YWdOb0hleCcgd2lsbCBiZSAnYTEnLgogKiA8YnIvPgogKiBBcyBmb3Igb3B0aW9uYWwgYXJndW1lbnQgJ3BhcmFtcycgZm9yIGNvbnN0cnVjdG9yLCB5b3UgY2FuIHNwZWNpZnkgKkFOWSogb2YKICogZm9sbG93aW5nIHByb3BlcnRpZXM6CiAqIDx1bD4KICogPGxpPmV4cGxpY2l0IC0gc3BlY2lmeSB0cnVlIGlmIHRoaXMgaXMgZXhwbGljaXQgdGFnIG90aGVyd2lzZSBmYWxzZQogKiAgICAgKGRlZmF1bHQgaXMgJ3RydWUnKS48L2xpPgogKiA8bGk+dGFnIC0gc3BlY2lmeSB0YWcgKGRlZmF1bHQgaXMgJ2EwJyB3aGljaCBtZWFucyBbMF0pPC9saT4KICogPGxpPm9iaiAtIHNwZWNpZnkgQVNOMU9iamVjdCB3aGljaCBpcyB0YWdnZWQ8L2xpPgogKiA8L3VsPgogKiBAZXhhbXBsZQogKiBkMSA9IG5ldyBLSlVSLmFzbjEuREVSVVRGOFN0cmluZyh7J3N0cic6J2EnfSk7CiAqIGQyID0gbmV3IEtKVVIuYXNuMS5ERVJUYWdnZWRPYmplY3QoeydvYmonOiBkMX0pOwogKiBoZXggPSBkMi5nZXRFbmNvZGVkSGV4KCk7CiAqLwpLSlVSLmFzbjEuREVSVGFnZ2VkT2JqZWN0ID0gZnVuY3Rpb24ocGFyYW1zKSB7CiAgICBLSlVSLmFzbjEuREVSVGFnZ2VkT2JqZWN0LnN1cGVyY2xhc3MuY29uc3RydWN0b3IuY2FsbCh0aGlzKTsKICAgIHRoaXMuaFQgPSAiYTAiOwogICAgdGhpcy5oViA9ICcnOwogICAgdGhpcy5pc0V4cGxpY2l0ID0gdHJ1ZTsKICAgIHRoaXMuYXNuMU9iamVjdCA9IG51bGw7CgogICAgLyoqCiAgICAgKiBzZXQgdmFsdWUgYnkgYW4gQVNOMU9iamVjdAogICAgICogQG5hbWUgc2V0U3RyaW5nCiAgICAgKiBAbWVtYmVyT2YgS0pVUi5hc24xLkRFUlRhZ2dlZE9iamVjdCMKICAgICAqIEBmdW5jdGlvbgogICAgICogQHBhcmFtIHtCb29sZWFufSBpc0V4cGxpY2l0RmxhZyBmbGFnIGZvciBleHBsaWNpdC9pbXBsaWNpdCB0YWcKICAgICAqIEBwYXJhbSB7SW50ZWdlcn0gdGFnTm9IZXggaGV4YWRlY2ltYWwgc3RyaW5nIG9mIEFTTi4xIHRhZwogICAgICogQHBhcmFtIHtBU04xT2JqZWN0fSBhc24xT2JqZWN0IEFTTi4xIHRvIGVuY2Fwc3VsYXRlCiAgICAgKi8KICAgIHRoaXMuc2V0QVNOMU9iamVjdCA9IGZ1bmN0aW9uKGlzRXhwbGljaXRGbGFnLCB0YWdOb0hleCwgYXNuMU9iamVjdCkgewogICAgICAgIHRoaXMuaFQgPSB0YWdOb0hleDsKICAgICAgICB0aGlzLmlzRXhwbGljaXQgPSBpc0V4cGxpY2l0RmxhZzsKICAgICAgICB0aGlzLmFzbjFPYmplY3QgPSBhc24xT2JqZWN0OwogICAgICAgIGlmICh0aGlzLmlzRXhwbGljaXQpIHsKICAgICAgICAgICAgdGhpcy5oViA9IHRoaXMuYXNuMU9iamVjdC5nZXRFbmNvZGVkSGV4KCk7CiAgICAgICAgICAgIHRoaXMuaFRMViA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuaXNNb2RpZmllZCA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5oViA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuaFRMViA9IGFzbjFPYmplY3QuZ2V0RW5jb2RlZEhleCgpOwogICAgICAgICAgICB0aGlzLmhUTFYgPSB0aGlzLmhUTFYucmVwbGFjZSgvXi4uLywgdGFnTm9IZXgpOwogICAgICAgICAgICB0aGlzLmlzTW9kaWZpZWQgPSBmYWxzZTsKICAgICAgICB9CiAgICB9OwoKICAgIHRoaXMuZ2V0RnJlc2hWYWx1ZUhleCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmhWOwogICAgfTsKCiAgICBpZiAodHlwZW9mIHBhcmFtcyAhPSAidW5kZWZpbmVkIikgewogICAgICAgIGlmICh0eXBlb2YgcGFyYW1zWyd0YWcnXSAhPSAidW5kZWZpbmVkIikgewogICAgICAgICAgICB0aGlzLmhUID0gcGFyYW1zWyd0YWcnXTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBwYXJhbXNbJ2V4cGxpY2l0J10gIT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgdGhpcy5pc0V4cGxpY2l0ID0gcGFyYW1zWydleHBsaWNpdCddOwogICAgICAgIH0KICAgICAgICBpZiAodHlwZW9mIHBhcmFtc1snb2JqJ10gIT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgdGhpcy5hc24xT2JqZWN0ID0gcGFyYW1zWydvYmonXTsKICAgICAgICAgICAgdGhpcy5zZXRBU04xT2JqZWN0KHRoaXMuaXNFeHBsaWNpdCwgdGhpcy5oVCwgdGhpcy5hc24xT2JqZWN0KTsKICAgICAgICB9CiAgICB9Cn07CllBSE9PLmxhbmcuZXh0ZW5kKEtKVVIuYXNuMS5ERVJUYWdnZWRPYmplY3QsIEtKVVIuYXNuMS5BU04xT2JqZWN0KTsKCi8qKgogKiBDcmVhdGUgYSBuZXcgSlNFbmNyeXB0UlNBS2V5IHRoYXQgZXh0ZW5kcyBUb20gV3UncyBSU0Ega2V5IG9iamVjdC4KICogVGhpcyBvYmplY3QgaXMganVzdCBhIGRlY29yYXRvciBmb3IgcGFyc2luZyB0aGUga2V5IHBhcmFtZXRlcgogKiBAcGFyYW0ge3N0cmluZ3xPYmplY3R9IGtleSAtIFRoZSBrZXkgaW4gc3RyaW5nIGZvcm1hdCwgb3IgYW4gb2JqZWN0IGNvbnRhaW5pbmcKICogdGhlIHBhcmFtZXRlcnMgbmVlZGVkIHRvIGJ1aWxkIGEgUlNBS2V5IG9iamVjdC4KICogQGNvbnN0cnVjdG9yCiAqLwp2YXIgSlNFbmNyeXB0UlNBS2V5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgX19leHRlbmRzKEpTRW5jcnlwdFJTQUtleSwgX3N1cGVyKTsKICAgIGZ1bmN0aW9uIEpTRW5jcnlwdFJTQUtleShrZXkpIHsKICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzOwogICAgICAgIC8vIENhbGwgdGhlIHN1cGVyIGNvbnN0cnVjdG9yLgogICAgICAgIC8vICBSU0FLZXkuY2FsbCh0aGlzKTsKICAgICAgICAvLyBJZiBhIGtleSBrZXkgd2FzIHByb3ZpZGVkLgogICAgICAgIGlmIChrZXkpIHsKICAgICAgICAgICAgLy8gSWYgdGhpcyBpcyBhIHN0cmluZy4uLgogICAgICAgICAgICBpZiAodHlwZW9mIGtleSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgIF90aGlzLnBhcnNlS2V5KGtleSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoSlNFbmNyeXB0UlNBS2V5Lmhhc1ByaXZhdGVLZXlQcm9wZXJ0eShrZXkpIHx8CiAgICAgICAgICAgICAgICBKU0VuY3J5cHRSU0FLZXkuaGFzUHVibGljS2V5UHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgICAgLy8gU2V0IHRoZSB2YWx1ZXMgZm9yIHRoZSBrZXkuCiAgICAgICAgICAgICAgICBfdGhpcy5wYXJzZVByb3BlcnRpZXNGcm9tKGtleSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF90aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNZXRob2QgdG8gcGFyc2UgYSBwZW0gZW5jb2RlZCBzdHJpbmcgY29udGFpbmluZyBib3RoIGEgcHVibGljIG9yIHByaXZhdGUga2V5LgogICAgICogVGhlIG1ldGhvZCB3aWxsIHRyYW5zbGF0ZSB0aGUgcGVtIGVuY29kZWQgc3RyaW5nIGluIGEgZGVyIGVuY29kZWQgc3RyaW5nIGFuZAogICAgICogd2lsbCBwYXJzZSBwcml2YXRlIGtleSBhbmQgcHVibGljIGtleSBwYXJhbWV0ZXJzLiBUaGlzIG1ldGhvZCBhY2NlcHRzIHB1YmxpYyBrZXkKICAgICAqIGluIHRoZSByc2FlbmNyeXB0aW9uIHBrY3MgIzEgZm9ybWF0IChvaWQ6IDEuMi44NDAuMTEzNTQ5LjEuMS4xKS4KICAgICAqCiAgICAgKiBAdG9kbyBDaGVjayBob3cgbWFueSByc2EgZm9ybWF0cyB1c2UgdGhlIHNhbWUgZm9ybWF0IG9mIHBrY3MgIzEuCiAgICAgKgogICAgICogVGhlIGZvcm1hdCBpcyBkZWZpbmVkIGFzOgogICAgICogUHVibGljS2V5SW5mbyA6Oj0gU0VRVUVOQ0UgewogICAgICogICBhbGdvcml0aG0gICAgICAgQWxnb3JpdGhtSWRlbnRpZmllciwKICAgICAqICAgUHVibGljS2V5ICAgICAgIEJJVCBTVFJJTkcKICAgICAqIH0KICAgICAqIFdoZXJlIEFsZ29yaXRobUlkZW50aWZpZXIgaXM6CiAgICAgKiBBbGdvcml0aG1JZGVudGlmaWVyIDo6PSBTRVFVRU5DRSB7CiAgICAgKiAgIGFsZ29yaXRobSAgICAgICBPQkpFQ1QgSURFTlRJRklFUiwgICAgIHRoZSBPSUQgb2YgdGhlIGVuYyBhbGdvcml0aG0KICAgICAqICAgcGFyYW1ldGVycyAgICAgIEFOWSBERUZJTkVEIEJZIGFsZ29yaXRobSBPUFRJT05BTCAoTlVMTCBmb3IgUEtDUyAjMSkKICAgICAqIH0KICAgICAqIGFuZCBQdWJsaWNLZXkgaXMgYSBTRVFVRU5DRSBlbmNhcHN1bGF0ZWQgaW4gYSBCSVQgU1RSSU5HCiAgICAgKiBSU0FQdWJsaWNLZXkgOjo9IFNFUVVFTkNFIHsKICAgICAqICAgbW9kdWx1cyAgICAgICAgICAgSU5URUdFUiwgIC0tIG4KICAgICAqICAgcHVibGljRXhwb25lbnQgICAgSU5URUdFUiAgIC0tIGUKICAgICAqIH0KICAgICAqIGl0J3MgcG9zc2libGUgdG8gZXhhbWluZSB0aGUgc3RydWN0dXJlIG9mIHRoZSBrZXlzIG9idGFpbmVkIGZyb20gb3BlbnNzbCB1c2luZwogICAgICogYW4gYXNuLjEgZHVtcGVyIGFzIHRoZSBvbmUgdXNlZCBoZXJlIHRvIHBhcnNlIHRoZSBjb21wb25lbnRzOiBodHRwOi8vbGFwby5pdC9hc24xanMvCiAgICAgKiBAYXJndW1lbnQge3N0cmluZ30gcGVtIHRoZSBwZW0gZW5jb2RlZCBzdHJpbmcsIGNhbiBpbmNsdWRlIHRoZSBCRUdJTi9FTkQgaGVhZGVyL2Zvb3RlcgogICAgICogQHByaXZhdGUKICAgICAqLwogICAgSlNFbmNyeXB0UlNBS2V5LnByb3RvdHlwZS5wYXJzZUtleSA9IGZ1bmN0aW9uIChwZW0pIHsKICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgbW9kdWx1cyA9IDA7CiAgICAgICAgICAgIHZhciBwdWJsaWNfZXhwb25lbnQgPSAwOwogICAgICAgICAgICB2YXIgcmVIZXggPSAvXlxzKig/OlswLTlBLUZhLWZdWzAtOUEtRmEtZl1ccyopKyQvOwogICAgICAgICAgICB2YXIgZGVyID0gcmVIZXgudGVzdChwZW0pID8gSGV4LmRlY29kZShwZW0pIDogQmFzZTY0LnVuYXJtb3IocGVtKTsKICAgICAgICAgICAgdmFyIGFzbjEgPSBBU04xLmRlY29kZShkZXIpOwogICAgICAgICAgICAvLyBGaXhlcyBhIGJ1ZyB3aXRoIE9wZW5TU0wgMS4wKyBwcml2YXRlIGtleXMKICAgICAgICAgICAgaWYgKGFzbjEuc3ViLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgYXNuMSA9IGFzbjEuc3ViWzJdLnN1YlswXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXNuMS5zdWIubGVuZ3RoID09PSA5KSB7CiAgICAgICAgICAgICAgICAvLyBQYXJzZSB0aGUgcHJpdmF0ZSBrZXkuCiAgICAgICAgICAgICAgICBtb2R1bHVzID0gYXNuMS5zdWJbMV0uZ2V0SGV4U3RyaW5nVmFsdWUoKTsgLy8gYmlnaW50CiAgICAgICAgICAgICAgICB0aGlzLm4gPSBwYXJzZUJpZ0ludChtb2R1bHVzLCAxNik7CiAgICAgICAgICAgICAgICBwdWJsaWNfZXhwb25lbnQgPSBhc24xLnN1YlsyXS5nZXRIZXhTdHJpbmdWYWx1ZSgpOyAvLyBpbnQKICAgICAgICAgICAgICAgIHRoaXMuZSA9IHBhcnNlSW50KHB1YmxpY19leHBvbmVudCwgMTYpOwogICAgICAgICAgICAgICAgdmFyIHByaXZhdGVfZXhwb25lbnQgPSBhc24xLnN1YlszXS5nZXRIZXhTdHJpbmdWYWx1ZSgpOyAvLyBiaWdpbnQKICAgICAgICAgICAgICAgIHRoaXMuZCA9IHBhcnNlQmlnSW50KHByaXZhdGVfZXhwb25lbnQsIDE2KTsKICAgICAgICAgICAgICAgIHZhciBwcmltZTEgPSBhc24xLnN1Yls0XS5nZXRIZXhTdHJpbmdWYWx1ZSgpOyAvLyBiaWdpbnQKICAgICAgICAgICAgICAgIHRoaXMucCA9IHBhcnNlQmlnSW50KHByaW1lMSwgMTYpOwogICAgICAgICAgICAgICAgdmFyIHByaW1lMiA9IGFzbjEuc3ViWzVdLmdldEhleFN0cmluZ1ZhbHVlKCk7IC8vIGJpZ2ludAogICAgICAgICAgICAgICAgdGhpcy5xID0gcGFyc2VCaWdJbnQocHJpbWUyLCAxNik7CiAgICAgICAgICAgICAgICB2YXIgZXhwb25lbnQxID0gYXNuMS5zdWJbNl0uZ2V0SGV4U3RyaW5nVmFsdWUoKTsgLy8gYmlnaW50CiAgICAgICAgICAgICAgICB0aGlzLmRtcDEgPSBwYXJzZUJpZ0ludChleHBvbmVudDEsIDE2KTsKICAgICAgICAgICAgICAgIHZhciBleHBvbmVudDIgPSBhc24xLnN1Yls3XS5nZXRIZXhTdHJpbmdWYWx1ZSgpOyAvLyBiaWdpbnQKICAgICAgICAgICAgICAgIHRoaXMuZG1xMSA9IHBhcnNlQmlnSW50KGV4cG9uZW50MiwgMTYpOwogICAgICAgICAgICAgICAgdmFyIGNvZWZmaWNpZW50ID0gYXNuMS5zdWJbOF0uZ2V0SGV4U3RyaW5nVmFsdWUoKTsgLy8gYmlnaW50CiAgICAgICAgICAgICAgICB0aGlzLmNvZWZmID0gcGFyc2VCaWdJbnQoY29lZmZpY2llbnQsIDE2KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChhc24xLnN1Yi5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgIC8vIFBhcnNlIHRoZSBwdWJsaWMga2V5LgogICAgICAgICAgICAgICAgdmFyIGJpdF9zdHJpbmcgPSBhc24xLnN1YlsxXTsKICAgICAgICAgICAgICAgIHZhciBzZXF1ZW5jZSA9IGJpdF9zdHJpbmcuc3ViWzBdOwogICAgICAgICAgICAgICAgbW9kdWx1cyA9IHNlcXVlbmNlLnN1YlswXS5nZXRIZXhTdHJpbmdWYWx1ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5uID0gcGFyc2VCaWdJbnQobW9kdWx1cywgMTYpOwogICAgICAgICAgICAgICAgcHVibGljX2V4cG9uZW50ID0gc2VxdWVuY2Uuc3ViWzFdLmdldEhleFN0cmluZ1ZhbHVlKCk7CiAgICAgICAgICAgICAgICB0aGlzLmUgPSBwYXJzZUludChwdWJsaWNfZXhwb25lbnQsIDE2KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBUcmFuc2xhdGUgcnNhIHBhcmFtZXRlcnMgaW4gYSBoZXggZW5jb2RlZCBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSByc2Ega2V5LgogICAgICoKICAgICAqIFRoZSB0cmFuc2xhdGlvbiBmb2xsb3cgdGhlIEFTTi4xIG5vdGF0aW9uIDoKICAgICAqIFJTQVByaXZhdGVLZXkgOjo9IFNFUVVFTkNFIHsKICAgICAqICAgdmVyc2lvbiAgICAgICAgICAgVmVyc2lvbiwKICAgICAqICAgbW9kdWx1cyAgICAgICAgICAgSU5URUdFUiwgIC0tIG4KICAgICAqICAgcHVibGljRXhwb25lbnQgICAgSU5URUdFUiwgIC0tIGUKICAgICAqICAgcHJpdmF0ZUV4cG9uZW50ICAgSU5URUdFUiwgIC0tIGQKICAgICAqICAgcHJpbWUxICAgICAgICAgICAgSU5URUdFUiwgIC0tIHAKICAgICAqICAgcHJpbWUyICAgICAgICAgICAgSU5URUdFUiwgIC0tIHEKICAgICAqICAgZXhwb25lbnQxICAgICAgICAgSU5URUdFUiwgIC0tIGQgbW9kIChwMSkKICAgICAqICAgZXhwb25lbnQyICAgICAgICAgSU5URUdFUiwgIC0tIGQgbW9kIChxLTEpCiAgICAgKiAgIGNvZWZmaWNpZW50ICAgICAgIElOVEVHRVIsICAtLSAoaW52ZXJzZSBvZiBxKSBtb2QgcAogICAgICogfQogICAgICogQHJldHVybnMge3N0cmluZ30gIERFUiBFbmNvZGVkIFN0cmluZyByZXByZXNlbnRpbmcgdGhlIHJzYSBwcml2YXRlIGtleQogICAgICogQHByaXZhdGUKICAgICAqLwogICAgSlNFbmNyeXB0UlNBS2V5LnByb3RvdHlwZS5nZXRQcml2YXRlQmFzZUtleSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgb3B0aW9ucyA9IHsKICAgICAgICAgICAgYXJyYXk6IFsKICAgICAgICAgICAgICAgIG5ldyBLSlVSLmFzbjEuREVSSW50ZWdlcih7IGludDogMCB9KSwKICAgICAgICAgICAgICAgIG5ldyBLSlVSLmFzbjEuREVSSW50ZWdlcih7IGJpZ2ludDogdGhpcy5uIH0pLAogICAgICAgICAgICAgICAgbmV3IEtKVVIuYXNuMS5ERVJJbnRlZ2VyKHsgaW50OiB0aGlzLmUgfSksCiAgICAgICAgICAgICAgICBuZXcgS0pVUi5hc24xLkRFUkludGVnZXIoeyBiaWdpbnQ6IHRoaXMuZCB9KSwKICAgICAgICAgICAgICAgIG5ldyBLSlVSLmFzbjEuREVSSW50ZWdlcih7IGJpZ2ludDogdGhpcy5wIH0pLAogICAgICAgICAgICAgICAgbmV3IEtKVVIuYXNuMS5ERVJJbnRlZ2VyKHsgYmlnaW50OiB0aGlzLnEgfSksCiAgICAgICAgICAgICAgICBuZXcgS0pVUi5hc24xLkRFUkludGVnZXIoeyBiaWdpbnQ6IHRoaXMuZG1wMSB9KSwKICAgICAgICAgICAgICAgIG5ldyBLSlVSLmFzbjEuREVSSW50ZWdlcih7IGJpZ2ludDogdGhpcy5kbXExIH0pLAogICAgICAgICAgICAgICAgbmV3IEtKVVIuYXNuMS5ERVJJbnRlZ2VyKHsgYmlnaW50OiB0aGlzLmNvZWZmIH0pCiAgICAgICAgICAgIF0KICAgICAgICB9OwogICAgICAgIHZhciBzZXEgPSBuZXcgS0pVUi5hc24xLkRFUlNlcXVlbmNlKG9wdGlvbnMpOwogICAgICAgIHJldHVybiBzZXEuZ2V0RW5jb2RlZEhleCgpOwogICAgfTsKICAgIC8qKgogICAgICogYmFzZTY0IChwZW0pIGVuY29kZWQgdmVyc2lvbiBvZiB0aGUgREVSIGVuY29kZWQgcmVwcmVzZW50YXRpb24KICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IHBlbSBlbmNvZGVkIHJlcHJlc2VudGF0aW9uIHdpdGhvdXQgaGVhZGVyIGFuZCBmb290ZXIKICAgICAqIEBwdWJsaWMKICAgICAqLwogICAgSlNFbmNyeXB0UlNBS2V5LnByb3RvdHlwZS5nZXRQcml2YXRlQmFzZUtleUI2NCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gaGV4MmI2NCh0aGlzLmdldFByaXZhdGVCYXNlS2V5KCkpOwogICAgfTsKICAgIC8qKgogICAgICogVHJhbnNsYXRlIHJzYSBwYXJhbWV0ZXJzIGluIGEgaGV4IGVuY29kZWQgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgcnNhIHB1YmxpYyBrZXkuCiAgICAgKiBUaGUgcmVwcmVzZW50YXRpb24gZm9sbG93IHRoZSBBU04uMSBub3RhdGlvbiA6CiAgICAgKiBQdWJsaWNLZXlJbmZvIDo6PSBTRVFVRU5DRSB7CiAgICAgKiAgIGFsZ29yaXRobSAgICAgICBBbGdvcml0aG1JZGVudGlmaWVyLAogICAgICogICBQdWJsaWNLZXkgICAgICAgQklUIFNUUklORwogICAgICogfQogICAgICogV2hlcmUgQWxnb3JpdGhtSWRlbnRpZmllciBpczoKICAgICAqIEFsZ29yaXRobUlkZW50aWZpZXIgOjo9IFNFUVVFTkNFIHsKICAgICAqICAgYWxnb3JpdGhtICAgICAgIE9CSkVDVCBJREVOVElGSUVSLCAgICAgdGhlIE9JRCBvZiB0aGUgZW5jIGFsZ29yaXRobQogICAgICogICBwYXJhbWV0ZXJzICAgICAgQU5ZIERFRklORUQgQlkgYWxnb3JpdGhtIE9QVElPTkFMIChOVUxMIGZvciBQS0NTICMxKQogICAgICogfQogICAgICogYW5kIFB1YmxpY0tleSBpcyBhIFNFUVVFTkNFIGVuY2Fwc3VsYXRlZCBpbiBhIEJJVCBTVFJJTkcKICAgICAqIFJTQVB1YmxpY0tleSA6Oj0gU0VRVUVOQ0UgewogICAgICogICBtb2R1bHVzICAgICAgICAgICBJTlRFR0VSLCAgLS0gbgogICAgICogICBwdWJsaWNFeHBvbmVudCAgICBJTlRFR0VSICAgLS0gZQogICAgICogfQogICAgICogQHJldHVybnMge3N0cmluZ30gREVSIEVuY29kZWQgU3RyaW5nIHJlcHJlc2VudGluZyB0aGUgcnNhIHB1YmxpYyBrZXkKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIEpTRW5jcnlwdFJTQUtleS5wcm90b3R5cGUuZ2V0UHVibGljQmFzZUtleSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZmlyc3Rfc2VxdWVuY2UgPSBuZXcgS0pVUi5hc24xLkRFUlNlcXVlbmNlKHsKICAgICAgICAgICAgYXJyYXk6IFsKICAgICAgICAgICAgICAgIG5ldyBLSlVSLmFzbjEuREVST2JqZWN0SWRlbnRpZmllcih7IG9pZDogIjEuMi44NDAuMTEzNTQ5LjEuMS4xIiB9KSwKICAgICAgICAgICAgICAgIG5ldyBLSlVSLmFzbjEuREVSTnVsbCgpCiAgICAgICAgICAgIF0KICAgICAgICB9KTsKICAgICAgICB2YXIgc2Vjb25kX3NlcXVlbmNlID0gbmV3IEtKVVIuYXNuMS5ERVJTZXF1ZW5jZSh7CiAgICAgICAgICAgIGFycmF5OiBbCiAgICAgICAgICAgICAgICBuZXcgS0pVUi5hc24xLkRFUkludGVnZXIoeyBiaWdpbnQ6IHRoaXMubiB9KSwKICAgICAgICAgICAgICAgIG5ldyBLSlVSLmFzbjEuREVSSW50ZWdlcih7IGludDogdGhpcy5lIH0pCiAgICAgICAgICAgIF0KICAgICAgICB9KTsKICAgICAgICB2YXIgYml0X3N0cmluZyA9IG5ldyBLSlVSLmFzbjEuREVSQml0U3RyaW5nKHsKICAgICAgICAgICAgaGV4OiAiMDAiICsgc2Vjb25kX3NlcXVlbmNlLmdldEVuY29kZWRIZXgoKQogICAgICAgIH0pOwogICAgICAgIHZhciBzZXEgPSBuZXcgS0pVUi5hc24xLkRFUlNlcXVlbmNlKHsKICAgICAgICAgICAgYXJyYXk6IFsKICAgICAgICAgICAgICAgIGZpcnN0X3NlcXVlbmNlLAogICAgICAgICAgICAgICAgYml0X3N0cmluZwogICAgICAgICAgICBdCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHNlcS5nZXRFbmNvZGVkSGV4KCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBiYXNlNjQgKHBlbSkgZW5jb2RlZCB2ZXJzaW9uIG9mIHRoZSBERVIgZW5jb2RlZCByZXByZXNlbnRhdGlvbgogICAgICogQHJldHVybnMge3N0cmluZ30gcGVtIGVuY29kZWQgcmVwcmVzZW50YXRpb24gd2l0aG91dCBoZWFkZXIgYW5kIGZvb3RlcgogICAgICogQHB1YmxpYwogICAgICovCiAgICBKU0VuY3J5cHRSU0FLZXkucHJvdG90eXBlLmdldFB1YmxpY0Jhc2VLZXlCNjQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGhleDJiNjQodGhpcy5nZXRQdWJsaWNCYXNlS2V5KCkpOwogICAgfTsKICAgIC8qKgogICAgICogd3JhcCB0aGUgc3RyaW5nIGluIGJsb2NrIG9mIHdpZHRoIGNoYXJzLiBUaGUgZGVmYXVsdCB2YWx1ZSBmb3IgcnNhIGtleXMgaXMgNjQKICAgICAqIGNoYXJhY3RlcnMuCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyIHRoZSBwZW0gZW5jb2RlZCBzdHJpbmcgd2l0aG91dCBoZWFkZXIgYW5kIGZvb3RlcgogICAgICogQHBhcmFtIHtOdW1iZXJ9IFt3aWR0aD02NF0gLSB0aGUgbGVuZ3RoIHRoZSBzdHJpbmcgaGFzIHRvIGJlIHdyYXBwZWQgYXQKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICAgKiBAcHJpdmF0ZQogICAgICovCiAgICBKU0VuY3J5cHRSU0FLZXkud29yZHdyYXAgPSBmdW5jdGlvbiAoc3RyLCB3aWR0aCkgewogICAgICAgIHdpZHRoID0gd2lkdGggfHwgNjQ7CiAgICAgICAgaWYgKCFzdHIpIHsKICAgICAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgICB9CiAgICAgICAgdmFyIHJlZ2V4ID0gIiguezEsIiArIHdpZHRoICsgIn0pKCArfCRcbj8pfCguezEsIiArIHdpZHRoICsgIn0pIjsKICAgICAgICByZXR1cm4gc3RyLm1hdGNoKFJlZ0V4cChyZWdleCwgImciKSkuam9pbigiXG4iKTsKICAgIH07CiAgICAvKioKICAgICAqIFJldHJpZXZlIHRoZSBwZW0gZW5jb2RlZCBwcml2YXRlIGtleQogICAgICogQHJldHVybnMge3N0cmluZ30gdGhlIHBlbSBlbmNvZGVkIHByaXZhdGUga2V5IHdpdGggaGVhZGVyL2Zvb3RlcgogICAgICogQHB1YmxpYwogICAgICovCiAgICBKU0VuY3J5cHRSU0FLZXkucHJvdG90eXBlLmdldFByaXZhdGVLZXkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGtleSA9ICItLS0tLUJFR0lOIFJTQSBQUklWQVRFIEtFWS0tLS0tXG4iOwogICAgICAgIGtleSArPSBKU0VuY3J5cHRSU0FLZXkud29yZHdyYXAodGhpcy5nZXRQcml2YXRlQmFzZUtleUI2NCgpKSArICJcbiI7CiAgICAgICAga2V5ICs9ICItLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLSI7CiAgICAgICAgcmV0dXJuIGtleTsKICAgIH07CiAgICAvKioKICAgICAqIFJldHJpZXZlIHRoZSBwZW0gZW5jb2RlZCBwdWJsaWMga2V5CiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSB0aGUgcGVtIGVuY29kZWQgcHVibGljIGtleSB3aXRoIGhlYWRlci9mb290ZXIKICAgICAqIEBwdWJsaWMKICAgICAqLwogICAgSlNFbmNyeXB0UlNBS2V5LnByb3RvdHlwZS5nZXRQdWJsaWNLZXkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGtleSA9ICItLS0tLUJFR0lOIFBVQkxJQyBLRVktLS0tLVxuIjsKICAgICAgICBrZXkgKz0gSlNFbmNyeXB0UlNBS2V5LndvcmR3cmFwKHRoaXMuZ2V0UHVibGljQmFzZUtleUI2NCgpKSArICJcbiI7CiAgICAgICAga2V5ICs9ICItLS0tLUVORCBQVUJMSUMgS0VZLS0tLS0iOwogICAgICAgIHJldHVybiBrZXk7CiAgICB9OwogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgb2JqZWN0IGNvbnRhaW5zIHRoZSBuZWNlc3NhcnkgcGFyYW1ldGVycyB0byBwb3B1bGF0ZSB0aGUgcnNhIG1vZHVsdXMKICAgICAqIGFuZCBwdWJsaWMgZXhwb25lbnQgcGFyYW1ldGVycy4KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqPXt9XSAtIEFuIG9iamVjdCB0aGF0IG1heSBjb250YWluIHRoZSB0d28gcHVibGljIGtleQogICAgICogcGFyYW1ldGVycwogICAgICogQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhlIG9iamVjdCBjb250YWlucyBib3RoIHRoZSBtb2R1bHVzIGFuZCB0aGUgcHVibGljIGV4cG9uZW50CiAgICAgKiBwcm9wZXJ0aWVzIChuIGFuZCBlKQogICAgICogQHRvZG8gY2hlY2sgZm9yIHR5cGVzIG9mIG4gYW5kIGUuIE4gc2hvdWxkIGJlIGEgcGFyc2VhYmxlIGJpZ0ludCBvYmplY3QsIEUgc2hvdWxkCiAgICAgKiBiZSBhIHBhcnNlYWJsZSBpbnRlZ2VyIG51bWJlcgogICAgICogQHByaXZhdGUKICAgICAqLwogICAgSlNFbmNyeXB0UlNBS2V5Lmhhc1B1YmxpY0tleVByb3BlcnR5ID0gZnVuY3Rpb24gKG9iaikgewogICAgICAgIG9iaiA9IG9iaiB8fCB7fTsKICAgICAgICByZXR1cm4gKG9iai5oYXNPd25Qcm9wZXJ0eSgibiIpICYmCiAgICAgICAgICAgIG9iai5oYXNPd25Qcm9wZXJ0eSgiZSIpKTsKICAgIH07CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBvYmplY3QgY29udGFpbnMgQUxMIHRoZSBwYXJhbWV0ZXJzIG9mIGFuIFJTQSBrZXkuCiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29iaj17fV0gLSBBbiBvYmplY3QgdGhhdCBtYXkgY29udGFpbiBuaW5lIHJzYSBrZXkKICAgICAqIHBhcmFtZXRlcnMKICAgICAqIEByZXR1cm5zIHtib29sZWFufSB0cnVlIGlmIHRoZSBvYmplY3QgY29udGFpbnMgYWxsIHRoZSBwYXJhbWV0ZXJzIG5lZWRlZAogICAgICogQHRvZG8gY2hlY2sgZm9yIHR5cGVzIG9mIHRoZSBwYXJhbWV0ZXJzIGFsbCB0aGUgcGFyYW1ldGVycyBidXQgdGhlIHB1YmxpYyBleHBvbmVudAogICAgICogc2hvdWxkIGJlIHBhcnNlYWJsZSBiaWdpbnQgb2JqZWN0cywgdGhlIHB1YmxpYyBleHBvbmVudCBzaG91bGQgYmUgYSBwYXJzZWFibGUgaW50ZWdlciBudW1iZXIKICAgICAqIEBwcml2YXRlCiAgICAgKi8KICAgIEpTRW5jcnlwdFJTQUtleS5oYXNQcml2YXRlS2V5UHJvcGVydHkgPSBmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgb2JqID0gb2JqIHx8IHt9OwogICAgICAgIHJldHVybiAob2JqLmhhc093blByb3BlcnR5KCJuIikgJiYKICAgICAgICAgICAgb2JqLmhhc093blByb3BlcnR5KCJlIikgJiYKICAgICAgICAgICAgb2JqLmhhc093blByb3BlcnR5KCJkIikgJiYKICAgICAgICAgICAgb2JqLmhhc093blByb3BlcnR5KCJwIikgJiYKICAgICAgICAgICAgb2JqLmhhc093blByb3BlcnR5KCJxIikgJiYKICAgICAgICAgICAgb2JqLmhhc093blByb3BlcnR5KCJkbXAxIikgJiYKICAgICAgICAgICAgb2JqLmhhc093blByb3BlcnR5KCJkbXExIikgJiYKICAgICAgICAgICAgb2JqLmhhc093blByb3BlcnR5KCJjb2VmZiIpKTsKICAgIH07CiAgICAvKioKICAgICAqIFBhcnNlIHRoZSBwcm9wZXJ0aWVzIG9mIG9iaiBpbiB0aGUgY3VycmVudCByc2Egb2JqZWN0LiBPYmogc2hvdWxkIEFUIExFQVNUCiAgICAgKiBpbmNsdWRlIHRoZSBtb2R1bHVzIGFuZCBwdWJsaWMgZXhwb25lbnQgKG4sIGUpIHBhcmFtZXRlcnMuCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqIC0gdGhlIG9iamVjdCBjb250YWluaW5nIHJzYSBwYXJhbWV0ZXJzCiAgICAgKiBAcHJpdmF0ZQogICAgICovCiAgICBKU0VuY3J5cHRSU0FLZXkucHJvdG90eXBlLnBhcnNlUHJvcGVydGllc0Zyb20gPSBmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgdGhpcy5uID0gb2JqLm47CiAgICAgICAgdGhpcy5lID0gb2JqLmU7CiAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eSgiZCIpKSB7CiAgICAgICAgICAgIHRoaXMuZCA9IG9iai5kOwogICAgICAgICAgICB0aGlzLnAgPSBvYmoucDsKICAgICAgICAgICAgdGhpcy5xID0gb2JqLnE7CiAgICAgICAgICAgIHRoaXMuZG1wMSA9IG9iai5kbXAxOwogICAgICAgICAgICB0aGlzLmRtcTEgPSBvYmouZG1xMTsKICAgICAgICAgICAgdGhpcy5jb2VmZiA9IG9iai5jb2VmZjsKICAgICAgICB9CiAgICB9OwogICAgcmV0dXJuIEpTRW5jcnlwdFJTQUtleTsKfShSU0FLZXkpKTsKCi8qKgogKgogKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnMgPSB7fV0gLSBBbiBvYmplY3QgdG8gY3VzdG9taXplIEpTRW5jcnlwdCBiZWhhdmlvdXIKICogcG9zc2libGUgcGFyYW1ldGVycyBhcmU6CiAqIC0gZGVmYXVsdF9rZXlfc2l6ZSAgICAgICAge251bWJlcn0gIGRlZmF1bHQ6IDEwMjQgdGhlIGtleSBzaXplIGluIGJpdAogKiAtIGRlZmF1bHRfcHVibGljX2V4cG9uZW50IHtzdHJpbmd9ICBkZWZhdWx0OiAnMDEwMDAxJyB0aGUgaGV4YWRlY2ltYWwgcmVwcmVzZW50YXRpb24gb2YgdGhlIHB1YmxpYyBleHBvbmVudAogKiAtIGxvZyAgICAgICAgICAgICAgICAgICAgIHtib29sZWFufSBkZWZhdWx0OiBmYWxzZSB3aGV0aGVyIGxvZyB3YXJuL2Vycm9yIG9yIG5vdAogKiBAY29uc3RydWN0b3IKICovCnZhciBKU0VuY3J5cHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBKU0VuY3J5cHQob3B0aW9ucykgewogICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgIHRoaXMuZGVmYXVsdF9rZXlfc2l6ZSA9IHBhcnNlSW50KG9wdGlvbnMuZGVmYXVsdF9rZXlfc2l6ZSwgMTApIHx8IDEwMjQ7CiAgICAgICAgdGhpcy5kZWZhdWx0X3B1YmxpY19leHBvbmVudCA9IG9wdGlvbnMuZGVmYXVsdF9wdWJsaWNfZXhwb25lbnQgfHwgIjAxMDAwMSI7IC8vIDY1NTM3IGRlZmF1bHQgb3BlbnNzbCBwdWJsaWMgZXhwb25lbnQgZm9yIHJzYSBrZXkgdHlwZQogICAgICAgIHRoaXMubG9nID0gb3B0aW9ucy5sb2cgfHwgZmFsc2U7CiAgICAgICAgLy8gVGhlIHByaXZhdGUgYW5kIHB1YmxpYyBrZXkuCiAgICAgICAgdGhpcy5rZXkgPSBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBNZXRob2QgdG8gc2V0IHRoZSByc2Ega2V5IHBhcmFtZXRlciAob25lIG1ldGhvZCBpcyBlbm91Z2ggdG8gc2V0IGJvdGggdGhlIHB1YmxpYwogICAgICogYW5kIHRoZSBwcml2YXRlIGtleSwgc2luY2UgdGhlIHByaXZhdGUga2V5IGNvbnRhaW5zIHRoZSBwdWJsaWMga2V5IHBhcmFtZW50ZXJzKQogICAgICogTG9nIGEgd2FybmluZyBpZiBsb2dzIGFyZSBlbmFibGVkCiAgICAgKiBAcGFyYW0ge09iamVjdHxzdHJpbmd9IGtleSB0aGUgcGVtIGVuY29kZWQgc3RyaW5nIG9yIGFuIG9iamVjdCAod2l0aCBvciB3aXRob3V0IGhlYWRlci9mb290ZXIpCiAgICAgKiBAcHVibGljCiAgICAgKi8KICAgIEpTRW5jcnlwdC5wcm90b3R5cGUuc2V0S2V5ID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgIGlmICh0aGlzLmxvZyAmJiB0aGlzLmtleSkgewogICAgICAgICAgICBjb25zb2xlLndhcm4oIkEga2V5IHdhcyBhbHJlYWR5IHNldCwgb3ZlcnJpZGluZyBleGlzdGluZy4iKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5rZXkgPSBuZXcgSlNFbmNyeXB0UlNBS2V5KGtleSk7CiAgICB9OwogICAgLyoqCiAgICAgKiBQcm94eSBtZXRob2QgZm9yIHNldEtleSwgZm9yIGFwaSBjb21wYXRpYmlsaXR5CiAgICAgKiBAc2VlIHNldEtleQogICAgICogQHB1YmxpYwogICAgICovCiAgICBKU0VuY3J5cHQucHJvdG90eXBlLnNldFByaXZhdGVLZXkgPSBmdW5jdGlvbiAocHJpdmtleSkgewogICAgICAgIC8vIENyZWF0ZSB0aGUga2V5LgogICAgICAgIHRoaXMuc2V0S2V5KHByaXZrZXkpOwogICAgfTsKICAgIC8qKgogICAgICogUHJveHkgbWV0aG9kIGZvciBzZXRLZXksIGZvciBhcGkgY29tcGF0aWJpbGl0eQogICAgICogQHNlZSBzZXRLZXkKICAgICAqIEBwdWJsaWMKICAgICAqLwogICAgSlNFbmNyeXB0LnByb3RvdHlwZS5zZXRQdWJsaWNLZXkgPSBmdW5jdGlvbiAocHVia2V5KSB7CiAgICAgICAgLy8gU2V0cyB0aGUgcHVibGljIGtleS4KICAgICAgICB0aGlzLnNldEtleShwdWJrZXkpOwogICAgfTsKICAgIC8qKgogICAgICogUHJveHkgbWV0aG9kIGZvciBSU0FLZXkgb2JqZWN0J3MgZGVjcnlwdCwgZGVjcnlwdCB0aGUgc3RyaW5nIHVzaW5nIHRoZSBwcml2YXRlCiAgICAgKiBjb21wb25lbnRzIG9mIHRoZSByc2Ega2V5IG9iamVjdC4gTm90ZSB0aGF0IGlmIHRoZSBvYmplY3Qgd2FzIG5vdCBzZXQgd2lsbCBiZSBjcmVhdGVkCiAgICAgKiBvbiB0aGUgZmx5IChieSB0aGUgZ2V0S2V5IG1ldGhvZCkgdXNpbmcgdGhlIHBhcmFtZXRlcnMgcGFzc2VkIGluIHRoZSBKU0VuY3J5cHQgY29uc3RydWN0b3IKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgYmFzZTY0IGVuY29kZWQgY3J5cHRlZCBzdHJpbmcgdG8gZGVjcnlwdAogICAgICogQHJldHVybiB7c3RyaW5nfSB0aGUgZGVjcnlwdGVkIHN0cmluZwogICAgICogQHB1YmxpYwogICAgICovCiAgICBKU0VuY3J5cHQucHJvdG90eXBlLmRlY3J5cHQgPSBmdW5jdGlvbiAoc3RyKSB7CiAgICAgICAgLy8gUmV0dXJuIHRoZSBkZWNyeXB0ZWQgc3RyaW5nLgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEtleSgpLmRlY3J5cHQoYjY0dG9oZXgoc3RyKSk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChleCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogUHJveHkgbWV0aG9kIGZvciBSU0FLZXkgb2JqZWN0J3MgZW5jcnlwdCwgZW5jcnlwdCB0aGUgc3RyaW5nIHVzaW5nIHRoZSBwdWJsaWMKICAgICAqIGNvbXBvbmVudHMgb2YgdGhlIHJzYSBrZXkgb2JqZWN0LiBOb3RlIHRoYXQgaWYgdGhlIG9iamVjdCB3YXMgbm90IHNldCB3aWxsIGJlIGNyZWF0ZWQKICAgICAqIG9uIHRoZSBmbHkgKGJ5IHRoZSBnZXRLZXkgbWV0aG9kKSB1c2luZyB0aGUgcGFyYW1ldGVycyBwYXNzZWQgaW4gdGhlIEpTRW5jcnlwdCBjb25zdHJ1Y3RvcgogICAgICogQHBhcmFtIHtzdHJpbmd9IHN0ciB0aGUgc3RyaW5nIHRvIGVuY3J5cHQKICAgICAqIEByZXR1cm4ge3N0cmluZ30gdGhlIGVuY3J5cHRlZCBzdHJpbmcgZW5jb2RlZCBpbiBiYXNlNjQKICAgICAqIEBwdWJsaWMKICAgICAqLwogICAgSlNFbmNyeXB0LnByb3RvdHlwZS5lbmNyeXB0ID0gZnVuY3Rpb24gKHN0cikgewogICAgICAgIC8vIFJldHVybiB0aGUgZW5jcnlwdGVkIHN0cmluZy4KICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gaGV4MmI2NCh0aGlzLmdldEtleSgpLmVuY3J5cHQoc3RyKSk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChleCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogUHJveHkgbWV0aG9kIGZvciBSU0FLZXkgb2JqZWN0J3Mgc2lnbi4KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgdGhlIHN0cmluZyB0byBzaWduCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBkaWdlc3RNZXRob2QgaGFzaCBtZXRob2QKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBkaWdlc3ROYW1lIHRoZSBuYW1lIG9mIHRoZSBoYXNoIGFsZ29yaXRobQogICAgICogQHJldHVybiB7c3RyaW5nfSB0aGUgc2lnbmF0dXJlIGVuY29kZWQgaW4gYmFzZTY0CiAgICAgKiBAcHVibGljCiAgICAgKi8KICAgIEpTRW5jcnlwdC5wcm90b3R5cGUuc2lnbiA9IGZ1bmN0aW9uIChzdHIsIGRpZ2VzdE1ldGhvZCwgZGlnZXN0TmFtZSkgewogICAgICAgIC8vIHJldHVybiB0aGUgUlNBIHNpZ25hdHVyZSBvZiAnc3RyJyBpbiAnaGV4JyBmb3JtYXQuCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGhleDJiNjQodGhpcy5nZXRLZXkoKS5zaWduKHN0ciwgZGlnZXN0TWV0aG9kLCBkaWdlc3ROYW1lKSk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChleCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfTsKICAgIC8qKgogICAgICogUHJveHkgbWV0aG9kIGZvciBSU0FLZXkgb2JqZWN0J3MgdmVyaWZ5LgogICAgICogQHBhcmFtIHtzdHJpbmd9IHN0ciB0aGUgc3RyaW5nIHRvIHZlcmlmeQogICAgICogQHBhcmFtIHtzdHJpbmd9IHNpZ25hdHVyZSB0aGUgc2lnbmF0dXJlIGVuY29kZWQgaW4gYmFzZTY0IHRvIGNvbXBhcmUgdGhlIHN0cmluZyB0bwogICAgICogQHBhcmFtIHtmdW5jdGlvbn0gZGlnZXN0TWV0aG9kIGhhc2ggbWV0aG9kCiAgICAgKiBAcmV0dXJuIHtib29sZWFufSB3aGV0aGVyIHRoZSBkYXRhIGFuZCBzaWduYXR1cmUgbWF0Y2gKICAgICAqIEBwdWJsaWMKICAgICAqLwogICAgSlNFbmNyeXB0LnByb3RvdHlwZS52ZXJpZnkgPSBmdW5jdGlvbiAoc3RyLCBzaWduYXR1cmUsIGRpZ2VzdE1ldGhvZCkgewogICAgICAgIC8vIFJldHVybiB0aGUgZGVjcnlwdGVkICdkaWdlc3QnIG9mIHRoZSBzaWduYXR1cmUuCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0S2V5KCkudmVyaWZ5KHN0ciwgYjY0dG9oZXgoc2lnbmF0dXJlKSwgZGlnZXN0TWV0aG9kKTsKICAgICAgICB9CiAgICAgICAgY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9OwogICAgLyoqCiAgICAgKiBHZXR0ZXIgZm9yIHRoZSBjdXJyZW50IEpTRW5jcnlwdFJTQUtleSBvYmplY3QuIElmIGl0IGRvZXNuJ3QgZXhpc3RzIGEgbmV3IG9iamVjdAogICAgICogd2lsbCBiZSBjcmVhdGVkIGFuZCByZXR1cm5lZAogICAgICogQHBhcmFtIHtjYWxsYmFja30gW2NiXSB0aGUgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIGlmIHdlIHdhbnQgdGhlIGtleSB0byBiZSBnZW5lcmF0ZWQKICAgICAqIGluIGFuIGFzeW5jIGZhc2hpb24KICAgICAqIEByZXR1cm5zIHtKU0VuY3J5cHRSU0FLZXl9IHRoZSBKU0VuY3J5cHRSU0FLZXkgb2JqZWN0CiAgICAgKiBAcHVibGljCiAgICAgKi8KICAgIEpTRW5jcnlwdC5wcm90b3R5cGUuZ2V0S2V5ID0gZnVuY3Rpb24gKGNiKSB7CiAgICAgICAgLy8gT25seSBjcmVhdGUgbmV3IGlmIGl0IGRvZXMgbm90IGV4aXN0LgogICAgICAgIGlmICghdGhpcy5rZXkpIHsKICAgICAgICAgICAgLy8gR2V0IGEgbmV3IHByaXZhdGUga2V5LgogICAgICAgICAgICB0aGlzLmtleSA9IG5ldyBKU0VuY3J5cHRSU0FLZXkoKTsKICAgICAgICAgICAgaWYgKGNiICYmIHt9LnRvU3RyaW5nLmNhbGwoY2IpID09PSAiW29iamVjdCBGdW5jdGlvbl0iKSB7CiAgICAgICAgICAgICAgICB0aGlzLmtleS5nZW5lcmF0ZUFzeW5jKHRoaXMuZGVmYXVsdF9rZXlfc2l6ZSwgdGhpcy5kZWZhdWx0X3B1YmxpY19leHBvbmVudCwgY2IpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIEdlbmVyYXRlIHRoZSBrZXkuCiAgICAgICAgICAgIHRoaXMua2V5LmdlbmVyYXRlKHRoaXMuZGVmYXVsdF9rZXlfc2l6ZSwgdGhpcy5kZWZhdWx0X3B1YmxpY19leHBvbmVudCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmtleTsKICAgIH07CiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHBlbSBlbmNvZGVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBwcml2YXRlIGtleQogICAgICogSWYgdGhlIGtleSBkb2Vzbid0IGV4aXN0cyBhIG5ldyBrZXkgd2lsbCBiZSBjcmVhdGVkCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBwZW0gZW5jb2RlZCByZXByZXNlbnRhdGlvbiBvZiB0aGUgcHJpdmF0ZSBrZXkgV0lUSCBoZWFkZXIgYW5kIGZvb3RlcgogICAgICogQHB1YmxpYwogICAgICovCiAgICBKU0VuY3J5cHQucHJvdG90eXBlLmdldFByaXZhdGVLZXkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gUmV0dXJuIHRoZSBwcml2YXRlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMga2V5LgogICAgICAgIHJldHVybiB0aGlzLmdldEtleSgpLmdldFByaXZhdGVLZXkoKTsKICAgIH07CiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHBlbSBlbmNvZGVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBwcml2YXRlIGtleQogICAgICogSWYgdGhlIGtleSBkb2Vzbid0IGV4aXN0cyBhIG5ldyBrZXkgd2lsbCBiZSBjcmVhdGVkCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBwZW0gZW5jb2RlZCByZXByZXNlbnRhdGlvbiBvZiB0aGUgcHJpdmF0ZSBrZXkgV0lUSE9VVCBoZWFkZXIgYW5kIGZvb3RlcgogICAgICogQHB1YmxpYwogICAgICovCiAgICBKU0VuY3J5cHQucHJvdG90eXBlLmdldFByaXZhdGVLZXlCNjQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gUmV0dXJuIHRoZSBwcml2YXRlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMga2V5LgogICAgICAgIHJldHVybiB0aGlzLmdldEtleSgpLmdldFByaXZhdGVCYXNlS2V5QjY0KCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBwZW0gZW5jb2RlZCByZXByZXNlbnRhdGlvbiBvZiB0aGUgcHVibGljIGtleQogICAgICogSWYgdGhlIGtleSBkb2Vzbid0IGV4aXN0cyBhIG5ldyBrZXkgd2lsbCBiZSBjcmVhdGVkCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBwZW0gZW5jb2RlZCByZXByZXNlbnRhdGlvbiBvZiB0aGUgcHVibGljIGtleSBXSVRIIGhlYWRlciBhbmQgZm9vdGVyCiAgICAgKiBAcHVibGljCiAgICAgKi8KICAgIEpTRW5jcnlwdC5wcm90b3R5cGUuZ2V0UHVibGljS2V5ID0gZnVuY3Rpb24gKCkgewogICAgICAgIC8vIFJldHVybiB0aGUgcHJpdmF0ZSByZXByZXNlbnRhdGlvbiBvZiB0aGlzIGtleS4KICAgICAgICByZXR1cm4gdGhpcy5nZXRLZXkoKS5nZXRQdWJsaWNLZXkoKTsKICAgIH07CiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHBlbSBlbmNvZGVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBwdWJsaWMga2V5CiAgICAgKiBJZiB0aGUga2V5IGRvZXNuJ3QgZXhpc3RzIGEgbmV3IGtleSB3aWxsIGJlIGNyZWF0ZWQKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IHBlbSBlbmNvZGVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBwdWJsaWMga2V5IFdJVEhPVVQgaGVhZGVyIGFuZCBmb290ZXIKICAgICAqIEBwdWJsaWMKICAgICAqLwogICAgSlNFbmNyeXB0LnByb3RvdHlwZS5nZXRQdWJsaWNLZXlCNjQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gUmV0dXJuIHRoZSBwcml2YXRlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMga2V5LgogICAgICAgIHJldHVybiB0aGlzLmdldEtleSgpLmdldFB1YmxpY0Jhc2VLZXlCNjQoKTsKICAgIH07CiAgICBKU0VuY3J5cHQudmVyc2lvbiA9ICIzLjAuMC1yYy4xIjsKICAgIHJldHVybiBKU0VuY3J5cHQ7Cn0oKSk7Cgp3aW5kb3cuSlNFbmNyeXB0ID0gSlNFbmNyeXB0OwoKZXhwb3J0cy5KU0VuY3J5cHQgPSBKU0VuY3J5cHQ7CmV4cG9ydHMuZGVmYXVsdCA9IEpTRW5jcnlwdDsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7Cgp9KSkpOwoKPC9zY3JpcHQ+CjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KdmFyIG1vY2hham9lYm9vayA9ICIiOwp2YXIgQ2hhcHRlckNvdW50ID0gMDsKdmFyIHByaXZrZXkgPSAiIjsKdmFyIHNpZ25rZXkgPSAiIjsKdmFyIGtleW9rID0gZmFsc2U7Cjwvc2NyaXB0Pgo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+CmZ1bmN0aW9uIHB1YnByaWtleSgpCnsKICAgIHNpZ25rZXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2lnbnB1YmtleSIpOwogICAgcHJpdmtleSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcml2a2V5Iik7CiAgICBzaG93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNob3ciKTsKICAgIGhlbHAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaGVscCIpOwogICAgaWYgKHNpZ25wdWJrZXkudmFsdWUubGVuZ3RoIDwgMTAwIHx8IHByaXZrZXkudmFsdWUubGVuZ3RoIDwgMTAwKQogICAgewogICAgICAgIHNpZ25wdWJrZXkuc3R5bGUudmlzaWJpbGl0eSA9ICJ2aXNpYmxlIjsKICAgICAgICBwcml2a2V5LnN0eWxlLnZpc2liaWxpdHkgPSAidmlzaWJsZSI7CiAgICAgICAgc2hvdy5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICAgICAgaGVscC5zdHlsZS52aXNpYmlsaXR5ID0gInZpc2libGUiOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHNpZ25wdWJrZXkuc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwogICAgICAgIHByaXZrZXkuc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwogICAgICAgIHNpZ25wdWJrZXkuc3R5bGUuaGVpZ2h0ID0gMDsKICAgICAgICBwcml2a2V5LnN0eWxlLmhlaWdodCA9IDA7CiAgICAgICAgaGVscC5zdHlsZS5oZWlnaHQgPSAwOwogICAgICAgIHNob3cuc3R5bGUudmlzaWJpbGl0eSA9ICJ2aXNpYmxlIjsKICAgICAgICBoZWxwLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKICAgICAgICBzaWducHVia2V5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNpZ25wdWJrZXkiKTsKICAgICAgICBwcml2a2V5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByaXZrZXkiKTsKICAgICAgICBzaG93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNob3ciKTsKICAgICAgICBrZXlvayA9IHRydWU7CiAgICB9Cn0KCmZ1bmN0aW9uIGdldENoYXB0ZXIoKQp7CiAgICBjb25zb2xlLmluZm8oQ2hhcHRlckNvdW50ICsgJyzlvIDlp4tSU0Hop6Plr4Ys5rKh5pyJ56Gs5Lu25pSv5oyB77yMdmVyeSBzbG9377yM6YCf5bqm5Lya5b6I5oWi44CCJyk7CiAgICBpZiAoQ2hhcHRlckNvdW50IDwgbW9jaGFqb2Vib29rLkVDaGFwdGVycy5sZW5ndGgpCiAgICB7CiAgICAgICAgdmFyIGV0ZXh0ID0gbW9jaGFqb2Vib29rLkVDaGFwdGVyc1tDaGFwdGVyQ291bnRdLkV0ZXh0OwogICAgICAgIHZhciBla2V5aXYgPSBtb2NoYWpvZWJvb2suRUNoYXB0ZXJzW0NoYXB0ZXJDb3VudF0uRWtleTsKICAgICAgICB2YXIgZXNpZ24gPSBtb2NoYWpvZWJvb2suRUNoYXB0ZXJzW0NoYXB0ZXJDb3VudF0uRXNpZ247CiAgICAgICAgdmFyIGRlY3J5cHQgPSBuZXcgSlNFbmNyeXB0KCk7CiAgICAgICAgZGVjcnlwdC5zZXRQcml2YXRlS2V5KHByaXZrZXkudmFsdWUpOwogICAgICAgIHZhciBrZXlpdiA9IGRlY3J5cHQuZGVjcnlwdChla2V5aXYpOwogICAgICAgIGlmIChrZXlpdiA9PSBudWxsIHx8IGtleWl2ID09IGZhbHNlKQogICAgICAgIHsKICAgICAgICAgICAgYWxlcnQoJ1JzYeino+WvhlNvbWV0aGluZyB3ZW50IHdyb25nLi4uLicpOwogICAgICAgIH0KICAgICAgICB2YXIgYXJyID0ga2V5aXYuc3BsaXQoJywnKTsKICAgICAgICB2YXIga2V5ID0gQ3J5cHRvSlMuZW5jLkJhc2U2NC5wYXJzZShhcnJbMF0pOwogICAgICAgIHZhciBpdiA9IENyeXB0b0pTLmVuYy5CYXNlNjQucGFyc2UoYXJyWzFdKTsKICAgICAgICBpZiAoa2V5ID09IG51bGwgfHwgaXYgPT0gbnVsbCkKICAgICAgICB7CiAgICAgICAgICAgIGFsZXJ0KCdrZXkgaXYgZXJyb3IuLi4uJyk7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7fQogICAgICAgIHZhciB0ZXh0ID0gQ3J5cHRvSlMuQUVTLmRlY3J5cHQoZXRleHQsIGtleSwKICAgICAgICB7CiAgICAgICAgICAgIGl2OiBpdiwKICAgICAgICAgICAgbW9kZTogQ3J5cHRvSlMubW9kZS5DQkMsCiAgICAgICAgICAgIHBhZGRpbmc6IENyeXB0b0pTLnBhZC5Qa2NzNwogICAgICAgIH0pOwogICAgICAgIHRleHQgPSB0ZXh0LnRvU3RyaW5nKENyeXB0b0pTLmVuYy5VdGY4KTsKICAgICAgICB2YXIgc2lnbiA9IENyeXB0b0pTLkFFUy5kZWNyeXB0KGVzaWduLCBrZXksCiAgICAgICAgewogICAgICAgICAgICBpdjogaXYsCiAgICAgICAgICAgIG1vZGU6IENyeXB0b0pTLm1vZGUuQ0JDLAogICAgICAgICAgICBwYWRkaW5nOiBDcnlwdG9KUy5wYWQuUGtjczcKICAgICAgICB9KTsKICAgICAgICBzaWduID0gc2lnbi50b1N0cmluZyhDcnlwdG9KUy5lbmMuVXRmOCk7CiAgICAgICAgdmFyIHZlcmlmeSA9IG5ldyBKU0VuY3J5cHQoKTsKICAgICAgICB2ZXJpZnkuc2V0UHVibGljS2V5KHNpZ25rZXkudmFsdWUpOwogICAgICAgIHZhciB2ZXJpZmllZCA9IHZlcmlmeS52ZXJpZnkodGV4dCwgc2lnbiwgQ3J5cHRvSlMuU0hBNTEyKTsKICAgICAgICBpZiAodmVyaWZpZWQpCiAgICAgICAgewogICAgICAgICAgICBtb2NoYWpvZWJvb2suQ2hhcHRlcnNbQ2hhcHRlckNvdW50XSA9IEpTT04ucGFyc2UodGV4dCk7CiAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhtb2NoYWpvZWJvb2suQ2hhcHRlcnNbQ2hhcHRlckNvdW50XSk7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIGFsZXJ0KCdTb21ldGhpbmcgd2VudCB3cm9uZy4uLi4nKTsKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIEdldEJvb2soKQp7CgkJbW9jaGFqb2Vib29rID0gIiI7CgkJbW9jaGFqb2Vib29rID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVib29rIikudmFsdWU7CgkJbW9jaGFqb2Vib29rID0gSlNPTi5wYXJzZShtb2NoYWpvZWJvb2spOwoJCW1vY2hham9lYm9vay5DaGFwdGVycyA9IG5ldyBBcnJheShtb2NoYWpvZWJvb2suRUNoYXB0ZXJzLmxlbmd0aCk7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByaXZrZXkiKS52YWx1ZT1DcnlwdG9KUy5lbmMuQmFzZTY0LnBhcnNlKG1vY2hham9lYm9vay5Pd25lclByaUtleSkudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLlV0ZjgpOwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzaWducHVia2V5IikudmFsdWUgPSBDcnlwdG9KUy5lbmMuQmFzZTY0LnBhcnNlKG1vY2hham9lYm9vay5QdWJsaXNoZXJQdWJLZXkpLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5VdGY4KTsKCQlwcml2a2V5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByaXZrZXkiKS52YWx1ZTsKCQlzaWdua2V5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNpZ25wdWJrZXkiKS52YWx1ZTsKCQlpZiAocHJpdmtleS5sZW5ndGggPCAxMDApIHJldHVybjsKCQlwdWJwcmlrZXkoKTsKfQoKZnVuY3Rpb24gZ2V0RG9jdW1lbnRUb3AoKQp7CiAgICB2YXIgc2Nyb2xsVG9wID0gMCwKICAgICAgICBib2R5U2Nyb2xsVG9wID0gMCwKICAgICAgICBkb2N1bWVudFNjcm9sbFRvcCA9IDA7CiAgICBpZiAoZG9jdW1lbnQuYm9keSkKICAgIHsKICAgICAgICBib2R5U2Nyb2xsVG9wID0gZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7CiAgICB9CiAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KQogICAgewogICAgICAgIGRvY3VtZW50U2Nyb2xsVG9wID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDsKICAgIH0KICAgIHNjcm9sbFRvcCA9IChib2R5U2Nyb2xsVG9wIC0gZG9jdW1lbnRTY3JvbGxUb3AgPiAwKSA/IGJvZHlTY3JvbGxUb3AgOiBkb2N1bWVudFNjcm9sbFRvcDsKICAgIHJldHVybiBzY3JvbGxUb3A7Cn0KCmZ1bmN0aW9uIGdldFdpbmRvd0hlaWdodCgpCnsKICAgIHZhciB3aW5kb3dIZWlnaHQgPSAwOwogICAgaWYgKGRvY3VtZW50LmNvbXBhdE1vZGUgPT0gIkNTUzFDb21wYXQiKQogICAgewogICAgICAgIHdpbmRvd0hlaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgd2luZG93SGVpZ2h0ID0gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQ7CiAgICB9CiAgICByZXR1cm4gd2luZG93SGVpZ2h0Owp9CgpmdW5jdGlvbiBnZXRTY3JvbGxIZWlnaHQoKQp7CiAgICB2YXIgc2Nyb2xsSGVpZ2h0ID0gMCwKICAgICAgICBib2R5U2Nyb2xsSGVpZ2h0ID0gMCwKICAgICAgICBkb2N1bWVudFNjcm9sbEhlaWdodCA9IDA7CiAgICBpZiAoZG9jdW1lbnQuYm9keSkKICAgIHsKICAgICAgICBib2R5U2Nyb2xsSGVpZ2h0ID0gZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQ7CiAgICB9CiAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KQogICAgewogICAgICAgIGRvY3VtZW50U2Nyb2xsSGVpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodDsKICAgIH0KICAgIHNjcm9sbEhlaWdodCA9IChib2R5U2Nyb2xsSGVpZ2h0IC0gZG9jdW1lbnRTY3JvbGxIZWlnaHQgPiAwKSA/IGJvZHlTY3JvbGxIZWlnaHQgOiBkb2N1bWVudFNjcm9sbEhlaWdodDsKICAgIHJldHVybiBzY3JvbGxIZWlnaHQ7Cn0KLy9qcyDojrflj5blvZPliY3ml7bpl7QKZnVuY3Rpb24gZm5EYXRlKCkKewogICAgdmFyIG9EaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGltZSIpOwogICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpOwogICAgdmFyIHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7IC8v5b2T5YmN5bm05Lu9CiAgICB2YXIgbW9udGggPSBkYXRlLmdldE1vbnRoKCk7IC8v5b2T5YmN5pyI5Lu9CiAgICB2YXIgZGF0YSA9IGRhdGUuZ2V0RGF0ZSgpOyAvL+WkqQogICAgdmFyIGhvdXJzID0gZGF0ZS5nZXRIb3VycygpOyAvL+Wwj+aXtgogICAgdmFyIG1pbnV0ZSA9IGRhdGUuZ2V0TWludXRlcygpOyAvL+WIhgogICAgdmFyIHNlY29uZCA9IGRhdGUuZ2V0U2Vjb25kcygpOyAvL+enkgogICAgdmFyIHRpbWUgPSB5ZWFyICsgIi0iICsgZm5XKChtb250aCArIDEpKSArICItIiArIGZuVyhkYXRhKSArICIgIiArIGZuVyhob3VycykgKyAiOiIgKyBmblcobWludXRlKSArICI6IiArIGZuVyhzZWNvbmQpOwogICAgcmV0dXJuIHRpbWU7Cn0KCmZ1bmN0aW9uIGZuVyhzdHIpCnsKICAgIHZhciBudW07CiAgICBzdHIgPj0gMTAgPyBudW0gPSBzdHIgOiBudW0gPSAiMCIgKyBzdHI7CiAgICByZXR1cm4gbnVtOwp9CgpmdW5jdGlvbiBzaG93bG9hZChldmVudCkKewogICAgdmFyIGxvYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibG9hZGluZyIpOwogICAgbG9hZC5zdHlsZS52aXNpYmlsaXR5ID0gInZpc2libGUiOwogICAgc2V0VGltZW91dChhZGREYXRhLCA1MCwgZXZlbnQpOwp9CgpmdW5jdGlvbiBhZGREYXRhKGV2ZW50KQp7CiAgICBpZiAoIWtleW9rKSByZXR1cm47CiAgICB2YXIgc2NyZWVuSGVpZ2h0ID0gZ2V0V2luZG93SGVpZ2h0KCk7CiAgICB2YXIgQ2hhcHRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJDaGFwdGVyIik7CiAgICB2YXIgcmVhZGVyQ291bnQgPSAwOwogICAgdmFyIHRleHRIZWlnaHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiRGl2Q2hhcHRlcnMiKS5vZmZzZXRIZWlnaHQ7CiAgICBkbyB7CiAgICAgICAgaWYgKENoYXB0ZXJDb3VudCA8IG1vY2hham9lYm9vay5DaGFwdGVycy5sZW5ndGgpCiAgICAgICAgewogICAgICAgICAgICBnZXRDaGFwdGVyKCk7CiAgICAgICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgdmFyIHR4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInAiKTsKICAgICAgICAgICAgdHh0LmNsYXNzTmFtZSA9ICdBdXRob3InOwogICAgICAgICAgICB0eHQuaW5uZXJIVE1MID0gbW9jaGFqb2Vib29rLkNoYXB0ZXJzW0NoYXB0ZXJDb3VudF0uVGltZSArICI8L2JyPiIgKyBtb2NoYWpvZWJvb2suQ2hhcHRlcnNbQ2hhcHRlckNvdW50XS5UZXh0OwogICAgICAgICAgICBkaXYuYWxpZ24gPSAicmlnaHQiOwogICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQodHh0KTsKICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInAiKSk7CiAgICAgICAgICAgIENoYXB0ZXIuYXBwZW5kQ2hpbGQoZGl2KTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtb2NoYWpvZWJvb2suQ2hhcHRlcnNbQ2hhcHRlckNvdW50XS5SZWFkZXJzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZXh0SGVpZ2h0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIkRpdkNoYXB0ZXJzIikub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICAgICAgc2NyZWVuSGVpZ2h0ID0gZ2V0V2luZG93SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICAgICAgICB2YXIgdHh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOwogICAgICAgICAgICAgICAgdHh0LmNsYXNzTmFtZSA9ICdyZWFkJzsKICAgICAgICAgICAgICAgIHR4dC5pbm5lckhUTUwgPSBtb2NoYWpvZWJvb2suQ2hhcHRlcnNbQ2hhcHRlckNvdW50XS5SZWFkZXJzW2ldLk5hbWUgKyAiOiIgKyBtb2NoYWpvZWJvb2suQ2hhcHRlcnNbQ2hhcHRlckNvdW50XS5SZWFkZXJzW2ldLlJlcGx5ICsgIjwvYnI+IiArIG1vY2hham9lYm9vay5DaGFwdGVyc1tDaGFwdGVyQ291bnRdLlJlYWRlcnNbaV0uVGltZTsKICAgICAgICAgICAgICAgIGRpdi5hbGlnbiA9ICJsZWZ0IjsKICAgICAgICAgICAgICAgIGRpdi5hcHBlbmRDaGlsZCh0eHQpOwogICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInAiKSk7CiAgICAgICAgICAgICAgICBDaGFwdGVyLmFwcGVuZENoaWxkKGRpdik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICB2YXIgdHh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOwogICAgICAgICAgICB0eHQuY2xhc3NOYW1lID0gJ0F1dGhvcic7CiAgICAgICAgICAgIHR4dC5pbm5lckhUTUwgPSAi5rKh5pyJ5YaF5a655LqG44CCIiArICI8L2JyPiIgKyAi5rKh5pyJ5YaF5a655LqG44CCIjsKICAgICAgICAgICAgZGl2LmFsaWduID0gImxlZnQiOwogICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQodHh0KTsKICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInAiKSk7CiAgICAgICAgICAgIENoYXB0ZXIuYXBwZW5kQ2hpbGQoZGl2KTsKICAgICAgICB9CiAgICAgICAgQ2hhcHRlckNvdW50Kys7CiAgICAgICAgdGV4dEhlaWdodCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJEaXZDaGFwdGVycyIpLm9mZnNldEhlaWdodDsKICAgIH0gd2hpbGUgKHRleHRIZWlnaHQgPCBzY3JlZW5IZWlnaHQpCiAgICB2YXIgbG9hZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2FkaW5nIik7CiAgICBsb2FkLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKfQp3aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKQp7CiAgICBwdWJwcmlrZXkoKTsKICAgIEdldEJvb2soKTsKICAgIHZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIkNoYXB0ZXJzaGVhZCIpOwogICAgaGVhZC5pbm5lckhUTUwgPSAiPHAgYWxpZ24gPSdjZW50ZXInID4iICsgbW9jaGFqb2Vib29rLlRpdGxlICsgIjwvcD4iICsgIjxwIGFsaWduID0ncmlnaHQnID4iICsgbW9jaGFqb2Vib29rLkF1dGhvck5hbWUgKyAiPC9wPiI7CiAgICBoZWFkLnN0eWxlLmFsaWduID0gImNlbnRlciI7CiAgICBkb2N1bWVudC50aXRsZSA9IG1vY2hham9lYm9vay5BdXRob3JOYW1lICsgIi0tLSIgKyBtb2NoYWpvZWJvb2suVGl0bGU7CiAgICBkb2N1bWVudC5ib2R5LnNjcm9sbEludG9WaWV3KCk7Cn0Kd2luZG93Lm9uc2Nyb2xsID0gZnVuY3Rpb24oKQp7CiAgICBpZiAoZ2V0U2Nyb2xsSGVpZ2h0KCkgPD0gZ2V0V2luZG93SGVpZ2h0KCkgKyBnZXREb2N1bWVudFRvcCgpKQogICAgewogICAgICAgIHNob3dsb2FkKCk7CiAgICB9Cn0Kd2luZG93Lm9uY2xpY2sgPSBmdW5jdGlvbihldmVudCkKewogICAgaWYgKCFrZXlvaykgcmV0dXJuOwogICAgaWYgKGdldFNjcm9sbEhlaWdodCgpIDw9IGdldFdpbmRvd0hlaWdodCgpICsgZ2V0RG9jdW1lbnRUb3AoKSkKICAgIHsKICAgICAgICBwdWJwcmlrZXkoKTsKICAgICAgICBzaG93bG9hZChldmVudCk7CiAgICB9Cn0KPC9zY3JpcHQ+Cg==</value>
  </data>
  <data name="Template_Info" xml:space="preserve">
    <value>ewogICAgIkF1dGhvck5hbWUiOiAi5LiJ6K+t5rKrIiwKICAgICJBdXRob3JQdWJLZXkiOiAicHVia2V5IiwKCSJQdWJsaXNoZXJQdWJLZXkiOiJMUzB0TFMxQ1JVZEpUaUJRVlVKTVNVTWdTMFZaTFMwdExTMEtUVWxKUWtscVFVNUNaMnR4YUd0cFJ6bDNNRUpCVVVWR1FVRlBRMEZST0VGTlNVbENRMmRMUTBGUlJVRnpjbVpJY21kalYyNWpNMHQzZDAwMWJWQklkUXBtTDA1UVVWaFNjRmcxTWtjek9HbFZOekozSzNoaWRqVk5URUZvWjNaU2EweGxSRFpxYzBaYVFVSkROblJSTkZkS1QxWlFSelozU0dOUVIzZEVNM0JYQ21aNEszTk1hMnBCZUV3MFRWZGFOek5rVlVsTVMwSm5PVXN2U1V4V2RuWlRaRGhSWjBWaWRtOWFiVmxqUVVkSWRYSnZORWM0ZUhRd1JscHRWemhJVERNS1RsRm1OVEJzVldWT1VWa3hSa2xSS3l0eVZXNWxTRVpqTHpCYVNtaGtWakZ4T0RBemFGcFZSR00zYVVKSGJreENXalp1WjIxUlVHRlhiSEJNY25kYWN3cE5lRk12S3l0bVNXaE5jbEkyTVdZemNuaDFVazVPVjBadmRUY3lObWhrV0VKQ1FYcGpORWhDYzFKTk5uUm1OV05TVFRWT2J6aEthMDFZYVM5d1RHSldDbkpvUmpsamVtdE9ZbmhpTUdOQ09GWjZhak4zUkdFMVZUSlRVMU55WjJaNGNGRlFLek12YVhVd1RFcEpUbkZGVkVsa2RXUTBNV3g0Um1KWVNHMTNOek1LU0ZGSlJFRlJRVUlLTFMwdExTMUZUa1FnVUZWQ1RFbERJRXRGV1MwdExTMHRDZz09IiwKICAgICJQcm9kdWNlck5hbWUiOiAibW9jaGFqb2UiLAogICAgIlByb2R1Y3Rpb25Tb2Z0d2FyZSI6ICJPdWF0VGlhbllhSHRtbE1ha2VyIHYxLjAiLAogICAgIk93bmVyTmFtZSI6ICJmdW4iLAogICAgIk93bmVyUHJpS2V5IjogIkxTMHRMUzFDUlVkSlRpQlFVa2xXUVZSRklFdEZXUzB0TFMwdENrMUpTVVYyZDBsQ1FVUkJUa0puYTNGb2EybEhPWGN3UWtGUlJVWkJRVk5EUWt0cmQyZG5VMnhCWjBWQlFXOUpRa0ZSUkV4clYweDJWSFp2UldWcmRuSUtPVGx3Tms1UU1XWmxXRzVxYWtNek5HTkVWbGR2VjJsYVNVUm5ZbHBTVW5RemMySkpSVTgxTjNOSE9WbHpTV1V4WjFwNFdVVk1TVEI2V0RWVFUxa3phd3BMYjBFMmN6VnBhMHRMTDFadWNsZE9PR040UnpSUVVHRjNMMmt4UVdWTmNtdFNXakpTTjJKak9HSTRibll6YUZsdU4xaFhabmxEY1c4MVkyRTRURlpFQ2xwcFpFRkJSMmd3WXpjM2ExcEJkVGswT0hNMGEwSjNRVXhyY201Qk5WUlNURE0zTDBaSmJqZEdiVFpqV0dSSmMwaG5VVmQ1TTFkaFYzRlJhV0V5U0hNS1ZHRmhVbU5UUWtoVFpFeDZlVVJPVDBKRWNESlNhSFpEZGk5TE5HRk5abXcyZUVwWEwwTnpVM0ZMUmxFeWMzUmlkbmhFWW5oWU1taFBUSGRzUkVWcFFRcFVZV3BPVm1KM1kyNXJObnBOY0VSR2IybHBVbTVVVW5aNFNFbGxkVWRzTVRGaGN6Vm5iR3BsVDNsVVZUQldiblV4ZWs5eGJWQjNSblIzVmpkbFlsQndDbkpIVmsxallrOXdRV2ROUWtGQlJVTm5aMFZDUVV0cFMwMXdUbGh1UVVKb1JVMU1TbUp2VjBodll5dFBWRGRDY0hWNFdHRk5VVGhOYWtGR1ltWTFhVThLTURVNGVuUjJhV3h5UVRKVlVXeDJNM0pEVWtkeWVEZHhheXRFVERCcE5XMHpObVJ6TWsxWVFrNUVkVlo0UWpkc1ZFRlBPV3RvWlUwek9XcGpUQ3R2VGdwTFpuaEZTRFJxUjFRd2QxZHBkVVp3TUZWWWRURlRjRWRFZEVjMGNEYzJVMVpGUkRsTWNtNDJia2xFZERRM2NFMWhjbmhLUVZaU1VGaENPVFpPUjBkWENsSXlaazR5TTNCTEsxVlhabmRUUlVwTFNuRlpUbVI1ZW1kU1JsaGxiMHg1ZEVSbmJ6bEZOR0p1V1VJMVltZzBZbkIzVUdKNVExUjJRMEZ0TDJ4TGRpOEthelJEYzBFMGNuTjVhRU5vWWtoSVlYTnhVMjVRVDNoUldXUjNSMWt4V1hGMFYzTkpTMUZDTnl0dVRXWTFkV042WjJnM1JuQjNNbFUwV1dObVEwbG9TQW94UVhGYVNrTldkSEZzTDFWMlprTjJObXBrVHpKM05HSjJlamRIWTI1dWJrb3pMM0ZoTjBWcVpXaEZRMmRaUlVFMlMxZEdSMUZTV1ZCbVJVeFFSbXA0Q205UVV6SnVjWGhXTjBOSGJsRnNWbmxWV0hwWmR6Z3dhMUJSYWtsT1kyOXVWVzkwYUV0TFlYSnFjR0ZuZEdaNGRVbEpTV3N4VlZGUVEzSjBVbkozWWxBS01GUlBSSFo1WnpnNGFqQTRZVnBuVms5QlJuUktXRTVaYmxGek0wTmtLeXR2UTBoV056SnNkVXBhVUhKeFYyUmpOMWsyVTFkWVJreFJlSGx4VjFkMGFBcDNibWxHVERVME5IaGpWV016TUVGamJGZHhaV1JSY2tWM2JXTkRaMWxGUVRSQlEyTjRjVE54U0hSMFN6ZDFlVXhLTVZGbWJHVTJSa0pqZGk4MEsxTTJDa3BuWmtwWU56UkZURTlJTW1FMFRXMVBVa04wZUZOR1dIVkpVMVI2U0hkeU15dHJWekJyWjJkRFpVSjBNRWhzVG1WMVpscHZWRmx2TjFvMGRtNXhNbFlLTVd4NVFUUXhWRGR3TkZJMVluVkRWR3hSTDBrNGVWVnNWR2w1TWtOemNIRnVhVFkxTTBkNFlrc3hkVTFHYTI5cVNVbHBkR2xOY0VaNFFXSktPWGxCWmdwd1YxbEJhVzl0TjNJeU9FTm5XVUZPYlRCcGNXbDFaVU5VSzNaQ1ZITTFja0pKVkRsNVRWTktkQzl2Y0ZablowZHVaeXR5WlM4NFNHeDBSRzB6U0dweENsTm1ObGgxZHk5RWJXbHRlVWQ0TlhoNGEzSlVUV3hVVXpSMGRraExaRmhVZGxocFUwbEpPVmc1TlRkc05tbEJjbXN5U0Vnd0wxRXhNSGxqV0RZM09HZ0tZa2hyZG5SSVNHUjJjMWxGZEZkbWJ5dFFTekJUYmpCR1dYUk1VSGRuYTBseU4xaFRZME5YVURRMVVuQjBhakF4ZFM5UGFXdHpkWEJPZDB0Q1oxRkRNZ3BYUTJ4SVNHMXRORUp4Um1kRWVGSlVlRzl2Vkhaa09YaFZXbWRVYUhGNk1YRnNPRVl6YVU0NUsyTTVhbmMxV1VrelFXWnZjMlpUTjJ0emFsSnhOemN6Q21aalNVUkhXVEZxU0U1MWJqSnBZakZTZFd0Rk56VmhkbTQxV2paSlEyOWhTSEZGV1RkaFVWSjNTMmQwVm5kcmMxUllXWGxZSzIxWVZYQlJOa0Z1TlRZS1JpdFdZV2h4V2sxcVJFSnJUVXRQV25Bd2JFVlZaM2R4ZGpkQlIzbEtTMkZVU1dScFVIazJWMXAzUzBKblVVTndkbFpEYjJWbmFHWTBRa0pPUmpKNGNncE5UV3BWUVNzME9HczFOMDl2TDNKU2IybFliVmRNVldGM1JtczFiVTFIU0VNd05tbzJTbGx5U0ZwMmRUTnJWVlZXVUZwalZuQm5VREpFZWxKUVFWbG1DamszWlVaUlNqQjZiak41YkdGMFoycGpaVE5ZVlhKUVkwRlhZMUZQZDNGVGFtczJjRzAyU1hOTGQzSXdUblZOYzA4dlEwMXlRelpWYlVKRU9UTXpWbFFLSzB0V1RuRm9PVEpaS3pWU1FuVkhSbVp2YzFGQk9FTlhkMUU5UFFvdExTMHRMVVZPUkNCUVVrbFdRVlJGSUV0RldTMHRMUzB0Q2c9PSIsCiAgICAiQ29uZmlnIjogIjEiLAogICAgIlRpdGxlIjogIlvlj7PlsrjmloflrZdd5pqX5oGL55u05aWz5a2m5aa555qE5pel5a2QIiwKICAgICJJbnRyb2R1Y3Rpb24iOiAidmFsdWUiLAogICAgIkNoYXB0ZXJzTnVtYmVyIjogInZhbHVlIgkKfQ==</value>
  </data>
</root>