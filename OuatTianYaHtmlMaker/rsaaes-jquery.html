<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>
			JavaScript RSA Encryption
		</title>
		<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js">
		</script>
		<script src=" https://cdn.jsdelivr.net/npm/crypto-js@4.0.0/crypto-js.js">
		</script>
		<script src="https://cdn.jsdelivr.net/npm/jsencrypt@3.0.0-rc.1/bin/jsencrypt.js">
		</script>
		<script type="text/javascript">
			// Call this code when the page is done loading.
			$(function() {
				$('#input').text("This is a test ! 这是一个测试 ！" + Date());
				// Run a quick encryption/decryption when they click.
				$('#rsaaes').click(function() {
					var etext = 'TVHvRRaEuElYykFdc8LCDE63hu41nKSRZBRNb70/NBIN6LeXNFLqdWeTpRzWp76J';
					var ekeyiv = 'dsb6TjETQpilRyJtT7HeX7Tj+LTL2jNgYK7pPy1qFrP6R5hpCzNGgDrQ5BHN2DKTJSekehn5gXZteOucfbhen2BW/TC6cSUpStrIhF724Dupy9zU0acqz9VSPyevKQ3FlFzAJt7NZoc3hMWekD2mq7xKQJ0cVqh8XidOlV/WesU3l+XR87u+0tEW4StTXFBtU0BKMXcHiaA12CM/5BsqUJ7NuO6EGjK5vQ3jKsv2wU9OVts6Qgyo9/Hmgk4Ftea/UoICQv+yAZcxCTGAmxMjlxuG4LRpZNFWlQRVBr7CuWH5Uj7ChhvXRChqVsW++Y5Xf0C8loWZepDFBC7JPos9qw3hWwkToReH85ElsHRWnWYYNQVoGM3VZ7akAdvEFC8Fo/ygGVyAsssoo/RjL35Rhwe3/vrhhXWzedDzcjPMhOkb5PA08ck3tiglkgMJZcOqnoWCmSFyx6jsAggWtXoond+YQGJ4iR/xLrr8/Fo5K/8KtX+nvpqYOPux3xCVwL5MePePj4LuPPVRGHtbjVKnJquf5vY+yVwGFbzoU1ViJGpG2G/PvzAhJ3ZdzGuWkkTp3KeZ1oQHkoSCBp4BKzI0Mi64NI5EAW4vODs/kI4VLiZiTYU7btTOhcyjnZWElZkOd5CcUXGPJyIPRkAY1sPDc+zV8bodTxXAr51teM32Odw=';
					var decrypt = new JSEncrypt();
					decrypt.setPrivateKey($('#privkey').val());
					var keyiv = decrypt.decrypt(ekeyiv);
					if (keyiv == null) {
						alert('Rsa解密Something went wrong....');
					}
					var arr = keyiv.split(',');
					var key = CryptoJS.enc.Base64.parse(arr[0]);
					var iv = CryptoJS.enc.Base64.parse(arr[1]);
					if (key == null || iv == null) {
						alert('key iv error....');
					}

					var text = CryptoJS.AES.decrypt(etext, key, {
						iv: iv,
						mode: CryptoJS.mode.CBC,
						padding: CryptoJS.pad.Pkcs7
					});
					text = text.toString(CryptoJS.enc.Utf8);
					alert(text);

				});
				$('#testme').click(function() {

					var key = CryptoJS.enc.Base64.parse('a2V5aXNrZXkqKioqKioqKioqKioqKioqKioqKioqKio=');
					var iv = CryptoJS.enc.Base64.parse('aXZpc2l2KioqKioqKioqKg==');
					var text = $('#input').val();
					var etext = CryptoJS.AES.encrypt(text, key, {
						iv: iv,
						mode: CryptoJS.mode.CBC,
						padding: CryptoJS.pad.Pkcs7
					});

					if (etext != null) alert("aes encrypt Ok. " + etext.toString().length);
					else alert("encrypt Error.");

					etext = etext.toString();
					// Encrypt with the public key...
					var encrypt = new JSEncrypt();
					encrypt.setPublicKey($('#pubkey').val());

					var encrypted = encrypt.encrypt(etext);
					if (!encrypted) alert("rsa encrypt Error. mybe key length needs 4096.");
					if (encrypted.length > 0) alert("rsa encrypt Ok. " + encrypted.toString().length);

					// Decrypt with the private key...
					var decrypt = new JSEncrypt();
					decrypt.setPrivateKey($('#privkey').val());
					var uncrypted = decrypt.decrypt(encrypted);

					// Now a simple check to see if the round-trip worked.
					if (uncrypted == etext) {
						alert('Rsa解密工作正常。');
					} else {
						alert('Rsa解密Something went wrong....');
					}
					etext = uncrypted;

					text = CryptoJS.AES.decrypt(etext, key, {
						iv: iv,
						mode: CryptoJS.mode.CBC,
						padding: CryptoJS.pad.Pkcs7
					});
					text = text.toString(CryptoJS.enc.Utf8);
					if (text != null) alert("decrypt Ok. " + text.length);
					else alert("decrypt Error.");
					alert(text);

					var sign = new JSEncrypt();
					sign.setPrivateKey($('#privkey').val());
					var signature = sign.sign($('#input').val(), CryptoJS.SHA256, "sha256");
					// Verify with the public key...
					var verify = new JSEncrypt();
					verify.setPublicKey($('#pubkey').val());
					var verified = verify.verify($('#input').val(), signature, CryptoJS.SHA256);

					// Now a simple check to see if the round-trip worked.
					if (verified) {
						alert('签字验证正常');
					} else {
						alert('Something went wrong....');
					}
				});
			});
		</script>
	</head>
	<body>
		<label for="privkey">
			Private Key
		</label>
		<br/>
		<textarea id="privkey" rows="15" cols="65">
			Need PRIVATE KEY
		</textarea>
		<br/>
		<label for="pubkey">
			Public Key
		</label>
		<br/>
		<textarea id="pubkey" rows="15" cols="65">
			Need PUBLIC KEY
		</textarea>
		<br/>
		<label for="input">
			Text to encrypt:
		</label>
		<br/>
		<textarea id="input" name="input" type="text" rows=4 cols=70>
			This is a test!这是一个测试！
		</textarea>
		<br/>
		<input id="rsaaes" type="button" value="RasAes Test!!!" />
		<input id="testme" type="button" value="Test Me!!!" />
		<br/>
	</body>

</html>